(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var config={overpassBase:"//overpass-cfn-production.tilestream.net/api/interpreter",osmBase:"//www.openstreetmap.org/api/0.6/",mapboxAccessToken:"pk.eyJ1IjoicmFzYWd5IiwiYSI6ImNpejVrMjc4eTAwNGczM2thNWozYnJ1OHkifQ.yFRr3Sd39TJiwEguQpIkWQ"};module.exports=config},{}],2:[function(require,module,exports){var xhr=require("xhr");var osm=require("./osm");var adiffParser=require("osm-adiff-parser-saxjs");var jsonParser=require("real-changesets-parser");var S3_URL="//s3.amazonaws.com/mapbox/real-changesets/production/";var getChangeset=function(changesetID,overpassBase,callback){osm.query(changesetID,function(err,changeset){if(err){callback({msg:"OSM Query failed. Are you sure you entered a valid changeset id?",error:err},null)}var url=S3_URL+changesetID+".json";xhr.get(url,function(err,response){if(err||response.statusCode===403){var data=getDataParam(changeset);var bbox=getBboxParam(changeset.bbox);var url=overpassBase+"?data="+data+"&bbox="+bbox;var xhrOptions={responseType:"application/osm3s+xml"};xhr.get(url,xhrOptions,function(err,response){if(err){return callback({msg:"Overpass query failed.",error:err},null)}adiffParser(response.body,null,function(err,json){if(err){return callback({msg:"Failed to parser adiff xml.",error:err},null)}var geojson=jsonParser({elements:json[changesetID]});var featureMap=getFeatureMap(geojson,changeset);var ret={geojson:geojson,featureMap:featureMap,changeset:changeset};return callback(null,ret)})})}else{var geojson=jsonParser(JSON.parse(response.body));var featureMap=getFeatureMap(geojson,changeset);var ret={geojson:geojson,featureMap:featureMap,changeset:changeset};return callback(null,ret)}})})};function getDataParam(c){return"[out:xml][adiff:%22"+c.from.toString()+",%22,%22"+c.to.toString()+"%22];(node(bbox)(changed);way(bbox)(changed););out%20meta%20geom(bbox);"}function getBboxParam(bbox){return[bbox.left,bbox.bottom,bbox.right,bbox.top].join(",")}function getFeatureMap(geojson,changeset){var features=geojson.features;var featureMap={};for(var i=0,len=features.length;i<len;i++){var id=features[i].properties.id;featureMap[id]=featureMap[id]||[];featureMap[id].push(features[i])}return featureMap}module.exports=getChangeset},{"./osm":3,"osm-adiff-parser-saxjs":218,"real-changesets-parser":546,xhr:569}],3:[function(require,module,exports){var xhr=require("xhr");var moment=require("moment");var config=require("./config");var query=function(changesetID,callback){var url=config.osmBase+"changeset/"+changesetID;var xhrOptions={responseType:"document"};xhr.get(url,xhrOptions,function(err,response){if(err){return callback(err,null)}var xml=response.body;var csFeature=xml.getElementsByTagName("changeset")[0];var cs=csFeature.attributes;var uid=cs.uid.textContent;var user=cs.user.textContent;var from=moment(cs.created_at.textContent,"YYYY-MM-DDTHH:mm:ss\\Z").subtract("seconds",1).format("YYYY-MM-DDTHH:mm:ss\\Z");var to=cs.closed_at?cs.closed_at.textContent:null;var left=cs.min_lon?cs.min_lon.textContent:-180;var bottom=cs.min_lat?cs.min_lat.textContent:-90;var right=cs.max_lon?cs.max_lon.textContent:180;var top=cs.max_lat?cs.max_lat.textContent:90;var changeset={id:changesetID,uid:uid,user:user,from:from,to:to,bbox:{left:left,bottom:bottom,right:right,top:top}};callback(null,changeset)})};module.exports={query:query}},{"./config":1,moment:217,xhr:569}],4:[function(require,module,exports){function propsDiff(propsArray){if(propsArray.length===1||propsArray[0].changeType==="added"){var changeType=propsArray[0].changeType;if(changeType==="added"){return getAdded(propsArray[0])}else{throw new Error("only 1 element but neither added nor deleted")}}else{var oldProps=getOld(propsArray);var newProps=getNew(propsArray);return getDiff(oldProps,newProps)}}function getDiff(oldProps,newProps){var ret={};for(var prop in newProps){ret[prop]={};if(!oldProps.hasOwnProperty(prop)){ret[prop]["added"]=newProps[prop]}else{var oldValue=oldProps[prop];var newValue=newProps[prop];if(oldValue===newValue){ret[prop]["unchanged"]=newValue}else{ret[prop]["modifiedOld"]=oldValue;ret[prop]["modifiedNew"]=newValue}}}for(var oldProp in oldProps){if(!ret.hasOwnProperty(oldProp)){ret[oldProp]={deleted:oldProps[oldProp]}}}return ret}function getAdded(props){var ret={};for(var prop in props){ret[prop]={added:props[prop]}}return ret}function getDeleted(props){var ret={};for(var prop in props){ret[prop]={deleted:props[prop]}}return ret}function getOld(propsArray){for(var i=0;i<propsArray.length;i++){var changeType=propsArray[i].changeType;if(changeType==="modifiedOld"||changeType==="deletedOld"){return propsArray[i]}}}function getNew(propsArray){for(var i=0;i<propsArray.length;i++){var changeType=propsArray[i].changeType;if(changeType==="modifiedNew"||changeType==="deletedNew"){return propsArray[i]}}}module.exports=propsDiff},{}],5:[function(require,module,exports){var mapboxgl=require("mapbox-gl");var getChangeset=require("./getChangeset");var propsDiff=require("./propsDiff");var config=require("./config");var moment=require("moment");var events=require("events").EventEmitter;var turfBboxPolygon=require("@turf/bbox-polygon");var featureCollection=require("@turf/helpers").featureCollection;var cmap,map;function render(container,id,options){var changesetId=id;cmap=new events;container.style.width=options.width||"1000px";container.style.height=options.height||"500px";renderHTML(container);options=options||{};options.overpassBase=options.overpassBase||config.overpassBase;mapboxgl.accessToken=config.mapboxAccessToken;container.classList.add("cmap-loading");getChangeset(changesetId,options.overpassBase,function(err,result){container.classList.remove("cmap-loading");if(err)return errorMessage(err.msg);document.querySelector(".cmap-layer-selector").style.display="block";document.querySelector(".cmap-sidebar-changeset").text="Changeset - "+changesetId;document.querySelector(".cmap-sidebar-user").text="User - "+result.changeset.user;var time=result.changeset.to?result.changeset.to:result.changeset.from;document.querySelector(".cmap-sidebar-time").textContent=moment(time).format("MMMM Do YYYY, h:mm a");document.querySelector(".cmap-sidebar-user").href="https://openstreetmap.org/user/"+result.changeset.user;document.querySelector(".cmap-sidebar-changeset").href="https://openstreetmap.org/changeset/"+changesetId;document.querySelector(".cmap-sidebar").style.display="block";var bbox=result.changeset.bbox;var featureMap=result.featureMap;renderMap(false,result);var layersKey={added:["added-line","added-point"],modified:["modified-old-line","modified-old-point","modified-new-line","modified-new-point"],deleted:["deleted-line","deleted-point"]};var selectedLayers=["added-line","added-point","modified-old-line","modified-old-point","modified-new-line","modified-new-point","deleted-line","deleted-point"];var layerSelector=document.querySelector(".cmap-layer-selector");layerSelector.addEventListener("change",function(e){var key=e.target.value;if(e.target.checked){selectedLayers=selectedLayers.concat(layersKey[key]);layersKey[key].forEach(function(layer){map.setLayoutProperty(layer,"visibility","visible")})}else{selectedLayers=selectedLayers.filter(function(layer){return!layer in layersKey[key]});layersKey[key].forEach(function(layer){map.setLayoutProperty(layer,"visibility","none")})}});var baseLayerSelector=document.querySelector(".cmap-baselayer-selector");baseLayerSelector.addEventListener("change",function(e){var layer=e.target.value;if(layer==="satellite"){renderMap("mapbox://styles/rasagy/cizp6lsah00ct2snu6gi3p16q",result)}if(layer==="dark"){renderMap("mapbox://styles/mapbox/dark-v9",result)}if(layer==="streets"){renderMap("mapbox://styles/mapbox/streets-v9",result)}});cmap.on("selectFeature",function(geometryType,featureId){if(geometryType&&featureId){selectFeature(map,featureMap[featureId][0],featureMap)}});cmap.on("clearFeature",function(){clearFeature(map)})});return cmap}function elt(name,attributes){var node=document.createElement(name);if(attributes){for(var attr in attributes)if(attributes.hasOwnProperty(attr))node.setAttribute(attr,attributes[attr])}for(var i=2;i<arguments.length;i++){var child=arguments[i];if(typeof child=="string")child=document.createTextNode(child);node.appendChild(child)}return node}function renderHTML(container){container.classList.add("cmap-container");var mapContainer=elt("div",{"class":"cmap-map"});container.appendChild(mapContainer);var diff=elt("div",{"class":"cmap-diff",style:"display: none"});container.appendChild(diff);var sidebar=elt("div",{"class":"cmap-sidebar cmap-pad1",style:"display: none"});sidebar.appendChild(elt("div",{"class":"cmap-fill-grey cmap-info"},elt("a",{"class":"cmap-sidebar-changeset"}),elt("br"),elt("a",{"class":"cmap-sidebar-user icon account"}),elt("br"),elt("span",{"class":"cmap-sidebar-time icon time"})));sidebar.appendChild(elt("div",{"class":"cmap-layer-selector cmap-info cmap-fill-grey"},elt("ul",{},elt("li",{},elt("label",{"for":"cmap-layer-selector-added","class":"cmap-noselect cmap-pointer"},elt("input",{type:"checkbox",value:"added",checked:true,id:"cmap-layer-selector-added"}),"Added features",elt("span",{"class":"cmap-fr"},elt("span",{"class":"cmap-color-box added"})))),elt("li",{},elt("label",{"for":"cmap-layer-selector-modified","class":"cmap-noselect cmap-pointer"},elt("input",{type:"checkbox",value:"modified",checked:true,id:"cmap-layer-selector-modified"}),"Modified features",elt("span",{"class":"cmap-fr"},elt("span",{"class":"cmap-color-box modified-old"}),"→",elt("span",{"class":"cmap-color-box modified-new"})))),elt("li",{},elt("label",{"for":"cmap-layer-selector-deleted","class":"cmap-noselect cmap-pointer"},elt("input",{type:"checkbox",value:"deleted",checked:true,id:"cmap-layer-selector-deleted"}),"Deleted features",elt("span",{"class":"cmap-fr"},elt("span",{"class":"cmap-color-box deleted"})))))));sidebar.appendChild(elt("div",{"class":"cmap-info cmap-baselayer-selector cmap-fill-grey"},elt("form",{},elt("input",{type:"radio",value:"satellite",checked:true,name:"baselayer",id:"cmap-baselayer-satellite"}),elt("label",{"for":"cmap-baselayer-satellite","class":"cmap-noselect cmap-pointer"},"Satellite"),elt("input",{type:"radio",value:"streets",name:"baselayer",id:"cmap-baselayer-streets"}),elt("label",{"for":"cmap-baselayer-streets","class":"cmap-noselect cmap-pointer"},"Streets"),elt("input",{type:"radio",value:"dark",name:"baselayer",id:"cmap-baselayer-dark"}),elt("label",{"for":"cmap-baselayer-dark","class":"cmap-noselect cmap-pointer"},"Dark"))));container.appendChild(sidebar)}function addMapLayers(baseLayer,result,bounds){map.addSource("changeset",{type:"geojson",data:result.geojson});map.addSource("bbox",{type:"geojson",data:getBoundingBox(bounds)});map.addLayer({id:"bbox-line",type:"line",source:"bbox",paint:{"line-width":2,"line-color":"HSL(247, 60%, 50%)","line-opacity":.75}});map.addLayer({id:"highlight-point",source:"changeset",type:"circle",layout:{visibility:"visible"},paint:{"circle-radius":8,"circle-color":"#268bd2","circle-opacity":1},filter:["==","id",""]});map.addLayer({id:"highlight-line",source:"changeset",type:"line",layout:{"line-join":"round","line-cap":"round",visibility:"visible"},paint:{"line-color":"#268bd2","line-width":8,"line-opacity":1},filter:["==","id",""]});map.addLayer({id:"added-line",source:"changeset",type:"line",interactive:true,layout:{visibility:"visible"},paint:{"line-color":"#859900","line-width":2},filter:["==","changeType","added"]});map.addLayer({id:"added-point",source:"changeset",type:"circle",interactive:true,layout:{visibility:"visible"},paint:{"circle-color":"#859900","circle-radius":3,"circle-blur":1},filter:["==","changeType","added"]});map.addLayer({id:"modified-old-line",source:"changeset",type:"line",interactive:true,layout:{visibility:"visible"},paint:{"line-color":"#fdf6e3","line-width":2},filter:["==","changeType","modifiedOld"]});map.addLayer({id:"modified-old-point",source:"changeset",type:"circle",interactive:true,layout:{visibility:"visible"},paint:{"circle-color":"#fdf6e3","circle-radius":3,"circle-blur":1},filter:["==","changeType","modifiedOld"]});map.addLayer({id:"modified-new-line",source:"changeset",type:"line",interactive:true,layout:{visibility:"visible"},paint:{"line-color":"#b58900","line-width":6,"line-opacity":.5},filter:["==","changeType","modifiedNew"]});map.addLayer({id:"modified-new-point",source:"changeset",type:"circle",interactive:true,layout:{visibility:"visible"},paint:{"circle-color":"#b58900","circle-radius":3,"circle-blur":1},filter:["==","changeType","modifiedNew"]});map.addLayer({id:"deleted-line",source:"changeset",type:"line",interactive:true,layout:{visibility:"visible"},paint:{"line-color":"#dc322f","line-width":2},filter:["==","changeType","deletedNew"]});map.addLayer({id:"deleted-point",source:"changeset",type:"circle",interactive:true,layout:{visibility:"visible"},paint:{"circle-color":"#dc322f","circle-radius":3,"circle-blur":1},filter:["==","changeType","deletedNew"]});map.on("click",function(e){var x1y1=[e.point.x-5,e.point.y-5];var x2y2=[e.point.x+5,e.point.y+5];var features=map.queryRenderedFeatures([x1y1,x2y2],{layers:["added-line","added-point","modified-old-line","modified-old-point","modified-new-line","modified-new-point","deleted-line","deleted-point"]});if(features.length){selectFeature(map,features[0],result.featureMap)}else{clearFeature(map)}})}function errorMessage(message){message=message||"An unexpected error occured";document.querySelector(".cmap-info").innerHTML=message;document.querySelector(".cmap-sidebar").style.display="block";document.querySelector(".cmap-layer-selector").style.display="none"}function displayDiff(id,featureMap){var featuresWithId=featureMap[id];var propsArray=featuresWithId.map(function(f){var props=Object.assign({},f.properties,f.properties.tags);delete props.tags;delete props.relations;return props});var diff=propsDiff(propsArray);var diffHTML=getDiffHTML(diff);document.querySelector(".cmap-diff").innerHTML="";document.querySelector(".cmap-diff").appendChild(diffHTML);document.querySelector(".cmap-diff").style.display="block"}function clearDiff(){document.querySelector(".cmap-diff").innerHTML="";document.querySelector(".cmap-diff").style.display="none"}function getDiffHTML(diff){var root=document.createElement("table");root.classList.add("cmap-diff-table");var types=["added","unchanged","deleted","modifiedOld","modifiedNew"];for(var prop in diff){var tr=document.createElement("tr");var th=document.createElement("th");th.textContent=prop;tr.appendChild(th);types.forEach(function(type){if(diff[prop].hasOwnProperty(type)){if(type=="added"){var empty=document.createElement("td");empty.classList.add("diff-property");empty.classList.add(type);tr.appendChild(empty)}var td=document.createElement("td");td.classList.add("diff-property");td.classList.add(type);td.textContent=diff[prop][type];tr.appendChild(td);if(type=="deleted"){var empty=document.createElement("td");empty.classList.add("diff-property");empty.classList.add(type);tr.appendChild(empty)}if(type=="unchanged"){tr.appendChild(td.cloneNode(true))}}});root.appendChild(tr)}return root}function highlightFeature(map,featureId){map.setFilter("highlight-line",["==","id",featureId]);map.setFilter("highlight-point",["==","id",featureId])}function clearHighlight(map){map.setFilter("highlight-line",["==","id",""]);map.setFilter("highlight-point",["==","id",""])}function selectFeature(map,feature,featureMap){var featureId=feature.properties.id;var osmType=feature.properties.type;highlightFeature(map,featureId);displayDiff(featureId,featureMap);cmap.emit("featureChange",osmType,featureId)}function clearFeature(map){clearHighlight(map);clearDiff();cmap.emit("featureChange",null,null)}function renderMap(baseLayer,result){if(map){map.remove()}var bounds=getBounds(result.changeset.bbox);map=new mapboxgl.Map({container:document.querySelector(".cmap-map"),style:baseLayer||"mapbox://styles/rasagy/cizp6lsah00ct2snu6gi3p16q",center:bounds.getCenter(),zoom:14,dragRotate:false,touchZoomRotate:false});map.on("load",function(){map.fitBounds(bounds,{linear:true,padding:200});addMapLayers(map,result,bounds);cmap.emit("load")})}function getBounds(bbox){var left=+bbox.left,right=+bbox.right,top=+bbox.top,bottom=+bbox.bottom;return new mapboxgl.LngLatBounds(new mapboxgl.LngLat(left,bottom),new mapboxgl.LngLat(right,top))}function getBoundingBox(bounds){var left=bounds.getWest(),right=bounds.getEast(),top=bounds.getNorth(),bottom=bounds.getSouth();var padX=0;var padY=0;if(!(left===-180&&right===180&&top===90&&bottom===-90)){padX=Math.max((right-left)/5,1e-4);padY=Math.max((top-bottom)/5,1e-4)}var bboxPolygon=turfBboxPolygon([left-padX,bottom-padY,right+padX,top+padY]);return featureCollection([bboxPolygon])}window.changesetMap=module.exports=render},{"./config":1,"./getChangeset":2,"./propsDiff":4,"@turf/bbox-polygon":8,"@turf/helpers":10,events:20,"mapbox-gl":107,moment:217}],6:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.glMatrix=factory()})(this,function(){"use strict";function create(){var out=new Float32Array(3);out[0]=0;out[1]=0;out[2]=0;return out}function transformMat3(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out}var vec=create();function create$1(){var out=new Float32Array(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out}function scale$1(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out}function normalize$1(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len}return out}function transformMat4$1(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out}var vec$1=create$1();function create$2(){var out=new Float32Array(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out}function rotate(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out}function scale$2(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out}function create$3(){var out=new Float32Array(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function fromRotation$1(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function create$4(){var out=new Float32Array(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function identity$2(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function invert$2(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}function multiply$4(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out}function translate$1(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}function scale$4(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function rotateX$1(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out}function rotateZ$1(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out}function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out}function ortho(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out}var mapboxBuild={vec3:{transformMat3:transformMat3},vec4:{transformMat4:transformMat4$1},mat2:{create:create$2,rotate:rotate,scale:scale$2},mat3:{create:create$3,fromRotation:fromRotation$1},mat4:{create:create$4,identity:identity$2,translate:translate$1,scale:scale$4,multiply:multiply$4,perspective:perspective,rotateX:rotateX$1,rotateZ:rotateZ$1,invert:invert$2,ortho:ortho}};return mapboxBuild})},{}],7:[function(require,module,exports){module.exports=UnitBezier;function UnitBezier(p1x,p1y,p2x,p2y){this.cx=3*p1x;this.bx=3*(p2x-p1x)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*p1y;this.by=3*(p2y-p1y)-this.cy;this.ay=1-this.cy-this.by;this.p1x=p1x;this.p1y=p2y;this.p2x=p2x;this.p2y=p2y}UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t};UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t};UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx};UnitBezier.prototype.solveCurveX=function(x,epsilon){if(typeof epsilon==="undefined")epsilon=1e-6;var t0,t1,t2,x2,i;for(t2=x,i=0;i<8;i++){x2=this.sampleCurveX(t2)-x;if(Math.abs(x2)<epsilon)return t2;var d2=this.sampleCurveDerivativeX(t2);if(Math.abs(d2)<1e-6)break;t2=t2-x2/d2}t0=0;t1=1;t2=x;if(t2<t0)return t0;if(t2>t1)return t1;while(t0<t1){x2=this.sampleCurveX(t2);if(Math.abs(x2-x)<epsilon)return t2;if(x>x2){t0=t2}else{t1=t2}t2=(t1-t0)*.5+t0}return t2};UnitBezier.prototype.solve=function(x,epsilon){return this.sampleCurveY(this.solveCurveX(x,epsilon))}},{}],8:[function(require,module,exports){var polygon=require("@turf/helpers").polygon;module.exports=function(bbox){var lowLeft=[bbox[0],bbox[1]];var topLeft=[bbox[0],bbox[3]];var topRight=[bbox[2],bbox[3]];var lowRight=[bbox[2],bbox[1]];return polygon([[lowLeft,lowRight,topRight,topLeft,lowLeft]])}},{"@turf/helpers":10}],9:[function(require,module,exports){var each=require("@turf/meta").coordEach;module.exports=function(geojson){var bbox=[Infinity,Infinity,-Infinity,-Infinity];each(geojson,function(coord){if(bbox[0]>coord[0])bbox[0]=coord[0];if(bbox[1]>coord[1])bbox[1]=coord[1];if(bbox[2]<coord[0])bbox[2]=coord[0];if(bbox[3]<coord[1])bbox[3]=coord[1]});return bbox}},{"@turf/meta":11}],10:[function(require,module,exports){function feature(geometry,properties){if(!geometry)throw new Error("No geometry passed");return{type:"Feature",properties:properties||{},geometry:geometry}}module.exports.feature=feature;module.exports.point=function(coordinates,properties){if(!coordinates)throw new Error("No coordinates passed");if(coordinates.length===undefined)throw new Error("Coordinates must be an array");if(coordinates.length<2)throw new Error("Coordinates must be at least 2 numbers long");if(typeof coordinates[0]!=="number"||typeof coordinates[1]!=="number")throw new Error("Coordinates must numbers");return feature({type:"Point",coordinates:coordinates},properties)};module.exports.polygon=function(coordinates,properties){if(!coordinates)throw new Error("No coordinates passed");for(var i=0;i<coordinates.length;i++){var ring=coordinates[i];if(ring.length<4){throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.")}for(var j=0;j<ring[ring.length-1].length;j++){if(ring[ring.length-1][j]!==ring[0][j]){throw new Error("First and last Position are not equivalent.")}}}return feature({type:"Polygon",coordinates:coordinates},properties)};module.exports.lineString=function(coordinates,properties){if(!coordinates)throw new Error("No coordinates passed");return feature({type:"LineString",coordinates:coordinates},properties)};module.exports.featureCollection=function(features){if(!features)throw new Error("No features passed");return{type:"FeatureCollection",features:features}};module.exports.multiLineString=function(coordinates,properties){if(!coordinates)throw new Error("No coordinates passed");return feature({type:"MultiLineString",coordinates:coordinates},properties)};module.exports.multiPoint=function(coordinates,properties){if(!coordinates)throw new Error("No coordinates passed");return feature({type:"MultiPoint",coordinates:coordinates},properties)};module.exports.multiPolygon=function(coordinates,properties){if(!coordinates)throw new Error("No coordinates passed");return feature({type:"MultiPolygon",coordinates:coordinates},properties)};module.exports.geometryCollection=function(geometries,properties){if(!geometries)throw new Error("No geometries passed");return feature({type:"GeometryCollection",geometries:geometries},properties)};var factors={miles:3960,nauticalmiles:3441.145,degrees:57.2957795,radians:1,inches:250905600,yards:6969600,meters:6373e3,metres:6373e3,kilometers:6373,kilometres:6373,feet:20908792.65};module.exports.radiansToDistance=function(radians,units){var factor=factors[units||"kilometers"];if(factor===undefined)throw new Error("Invalid unit");return radians*factor};module.exports.distanceToRadians=function(distance,units){var factor=factors[units||"kilometers"];if(factor===undefined)throw new Error("Invalid unit");return distance/factor};module.exports.distanceToDegrees=function(distance,units){var factor=factors[units||"kilometers"];if(factor===undefined)throw new Error("Invalid unit");return distance/factor*57.2958}},{}],11:[function(require,module,exports){function coordEach(layer,callback,excludeWrapCoord){var i,j,k,g,l,geometry,stopG,coords,geometryMaybeCollection,wrapShrink=0,currentIndex=0,isGeometryCollection,isFeatureCollection=layer.type==="FeatureCollection",isFeature=layer.type==="Feature",stop=isFeatureCollection?layer.features.length:1;for(i=0;i<stop;i++){geometryMaybeCollection=isFeatureCollection?layer.features[i].geometry:isFeature?layer.geometry:layer;isGeometryCollection=geometryMaybeCollection.type==="GeometryCollection";stopG=isGeometryCollection?geometryMaybeCollection.geometries.length:1;for(g=0;g<stopG;g++){geometry=isGeometryCollection?geometryMaybeCollection.geometries[g]:geometryMaybeCollection;coords=geometry.coordinates;wrapShrink=excludeWrapCoord&&(geometry.type==="Polygon"||geometry.type==="MultiPolygon")?1:0;if(geometry.type==="Point"){callback(coords,currentIndex);currentIndex++}else if(geometry.type==="LineString"||geometry.type==="MultiPoint"){for(j=0;j<coords.length;j++){callback(coords[j],currentIndex);currentIndex++}}else if(geometry.type==="Polygon"||geometry.type==="MultiLineString"){for(j=0;j<coords.length;j++)for(k=0;k<coords[j].length-wrapShrink;k++){callback(coords[j][k],currentIndex);currentIndex++}}else if(geometry.type==="MultiPolygon"){for(j=0;j<coords.length;j++)for(k=0;k<coords[j].length;k++)for(l=0;l<coords[j][k].length-wrapShrink;l++){callback(coords[j][k][l],currentIndex);currentIndex++}}else if(geometry.type==="GeometryCollection"){for(j=0;j<geometry.geometries.length;j++)coordEach(geometry.geometries[j],callback,excludeWrapCoord)}else{throw new Error("Unknown Geometry Type")}}}}module.exports.coordEach=coordEach;function coordReduce(layer,callback,initialValue,excludeWrapCoord){var previousValue=initialValue;coordEach(layer,function(currentCoords,currentIndex){if(currentIndex===0&&initialValue===undefined){previousValue=currentCoords}else{previousValue=callback(previousValue,currentCoords,currentIndex)}},excludeWrapCoord);return previousValue}module.exports.coordReduce=coordReduce;function propEach(layer,callback){var i;switch(layer.type){case"FeatureCollection":for(i=0;i<layer.features.length;i++){callback(layer.features[i].properties,i)}break;case"Feature":callback(layer.properties,0);break}}module.exports.propEach=propEach;function propReduce(layer,callback,initialValue){var previousValue=initialValue;propEach(layer,function(currentProperties,currentIndex){if(currentIndex===0&&initialValue===undefined){previousValue=currentProperties}else{previousValue=callback(previousValue,currentProperties,currentIndex)}});return previousValue}module.exports.propReduce=propReduce;function featureEach(layer,callback){if(layer.type==="Feature"){callback(layer,0)}else if(layer.type==="FeatureCollection"){
for(var i=0;i<layer.features.length;i++){callback(layer.features[i],i)}}}module.exports.featureEach=featureEach;function featureReduce(layer,callback,initialValue){var previousValue=initialValue;featureEach(layer,function(currentFeature,currentIndex){if(currentIndex===0&&initialValue===undefined){previousValue=currentFeature}else{previousValue=callback(previousValue,currentFeature,currentIndex)}});return previousValue}module.exports.featureReduce=featureReduce;function coordAll(layer){var coords=[];coordEach(layer,function(coord){coords.push(coord)});return coords}module.exports.coordAll=coordAll;function geomEach(layer,callback){var i,j,g,geometry,stopG,geometryMaybeCollection,isGeometryCollection,currentIndex=0,isFeatureCollection=layer.type==="FeatureCollection",isFeature=layer.type==="Feature",stop=isFeatureCollection?layer.features.length:1;for(i=0;i<stop;i++){geometryMaybeCollection=isFeatureCollection?layer.features[i].geometry:isFeature?layer.geometry:layer;isGeometryCollection=geometryMaybeCollection.type==="GeometryCollection";stopG=isGeometryCollection?geometryMaybeCollection.geometries.length:1;for(g=0;g<stopG;g++){geometry=isGeometryCollection?geometryMaybeCollection.geometries[g]:geometryMaybeCollection;if(geometry.type==="Point"||geometry.type==="LineString"||geometry.type==="MultiPoint"||geometry.type==="Polygon"||geometry.type==="MultiLineString"||geometry.type==="MultiPolygon"){callback(geometry,currentIndex);currentIndex++}else if(geometry.type==="GeometryCollection"){for(j=0;j<geometry.geometries.length;j++){callback(geometry.geometries[j],currentIndex);currentIndex++}}else{throw new Error("Unknown Geometry Type")}}}}module.exports.geomEach=geomEach;function geomReduce(layer,callback,initialValue){var previousValue=initialValue;geomEach(layer,function(currentGeometry,currentIndex){if(currentIndex===0&&initialValue===undefined){previousValue=currentGeometry}else{previousValue=callback(previousValue,currentGeometry,currentIndex)}});return previousValue}module.exports.geomReduce=geomReduce},{}],12:[function(require,module,exports){},{}],13:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],14:[function(require,module,exports){(function(global){"use strict";var buffer=require("buffer");var Buffer=buffer.Buffer;var SlowBuffer=buffer.SlowBuffer;var MAX_LEN=buffer.kMaxLength||2147483647;exports.alloc=function alloc(size,fill,encoding){if(typeof Buffer.alloc==="function"){return Buffer.alloc(size,fill,encoding)}if(typeof encoding==="number"){throw new TypeError("encoding must not be number")}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}var enc=encoding;var _fill=fill;if(_fill===undefined){enc=undefined;_fill=0}var buf=new Buffer(size);if(typeof _fill==="string"){var fillBuf=new Buffer(_fill,enc);var flen=fillBuf.length;var i=-1;while(++i<size){buf[i]=fillBuf[i%flen]}}else{buf.fill(_fill)}return buf};exports.allocUnsafe=function allocUnsafe(size){if(typeof Buffer.allocUnsafe==="function"){return Buffer.allocUnsafe(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}return new Buffer(size)};exports.from=function from(value,encodingOrOffset,length){if(typeof Buffer.from==="function"&&(!global.Uint8Array||Uint8Array.from!==Buffer.from)){return Buffer.from(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof value==="string"){return new Buffer(value,encodingOrOffset)}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){var offset=encodingOrOffset;if(arguments.length===1){return new Buffer(value)}if(typeof offset==="undefined"){offset=0}var len=length;if(typeof len==="undefined"){len=value.byteLength-offset}if(offset>=value.byteLength){throw new RangeError("'offset' is out of bounds")}if(len>value.byteLength-offset){throw new RangeError("'length' is out of bounds")}return new Buffer(value.slice(offset,offset+len))}if(Buffer.isBuffer(value)){var out=new Buffer(value.length);value.copy(out,0,0,value.length);return out}if(value){if(Array.isArray(value)||typeof ArrayBuffer!=="undefined"&&value.buffer instanceof ArrayBuffer||"length"in value){return new Buffer(value)}if(value.type==="Buffer"&&Array.isArray(value.data)){return new Buffer(value.data)}}throw new TypeError("First argument must be a string, Buffer, "+"ArrayBuffer, Array, or array-like object.")};exports.allocUnsafeSlow=function allocUnsafeSlow(size){if(typeof Buffer.allocUnsafeSlow==="function"){return Buffer.allocUnsafeSlow(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>=MAX_LEN){throw new RangeError("size is too large")}return new SlowBuffer(size)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{buffer:15}],15:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);

if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":16,ieee754:36,isarray:40}],16:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],17:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":38}],18:[function(require,module,exports){var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function clamp_css_byte(i){i=Math.round(i);return i<0?0:i>255?255:i}function clamp_css_float(f){return f<0?0:f>1?1:f}function parse_css_int(str){if(str[str.length-1]==="%")return clamp_css_byte(parseFloat(str)/100*255);return clamp_css_byte(parseInt(str))}function parse_css_float(str){if(str[str.length-1]==="%")return clamp_css_float(parseFloat(str)/100);return clamp_css_float(parseFloat(str))}function css_hue_to_rgb(m1,m2,h){if(h<0)h+=1;else if(h>1)h-=1;if(h*6<1)return m1+(m2-m1)*h*6;if(h*2<1)return m2;if(h*3<2)return m1+(m2-m1)*(2/3-h)*6;return m1}function parseCSSColor(css_str){var str=css_str.replace(/ /g,"").toLowerCase();if(str in kCSSColorTable)return kCSSColorTable[str].slice();if(str[0]==="#"){if(str.length===4){var iv=parseInt(str.substr(1),16);if(!(iv>=0&&iv<=4095))return null;return[(iv&3840)>>4|(iv&3840)>>8,iv&240|(iv&240)>>4,iv&15|(iv&15)<<4,1]}else if(str.length===7){var iv=parseInt(str.substr(1),16);if(!(iv>=0&&iv<=16777215))return null;return[(iv&16711680)>>16,(iv&65280)>>8,iv&255,1]}return null}var op=str.indexOf("("),ep=str.indexOf(")");if(op!==-1&&ep+1===str.length){var fname=str.substr(0,op);var params=str.substr(op+1,ep-(op+1)).split(",");var alpha=1;switch(fname){case"rgba":if(params.length!==4)return null;alpha=parse_css_float(params.pop());case"rgb":if(params.length!==3)return null;return[parse_css_int(params[0]),parse_css_int(params[1]),parse_css_int(params[2]),alpha];case"hsla":if(params.length!==4)return null;alpha=parse_css_float(params.pop());case"hsl":if(params.length!==3)return null;var h=(parseFloat(params[0])%360+360)%360/360;var s=parse_css_float(params[1]);var l=parse_css_float(params[2]);var m2=l<=.5?l*(s+1):l+s-l*s;var m1=l*2-m2;return[clamp_css_byte(css_hue_to_rgb(m1,m2,h+1/3)*255),clamp_css_byte(css_hue_to_rgb(m1,m2,h)*255),clamp_css_byte(css_hue_to_rgb(m1,m2,h-1/3)*255),alpha];default:return null}}return null}try{exports.parseCSSColor=parseCSSColor}catch(e){}},{}],19:[function(require,module,exports){"use strict";module.exports=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}size=Math.max(maxX-minX,maxY-minY)}earcutLinked(outerNode,triangles,dim,minX,minY,size);return triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)return null;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(!ear)return;if(!pass&&size)indexCurve(ear,minX,minY,size);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(size?isEarHashed(ear,minX,minY,size):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1)}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,size,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,size)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,size);earcutLinked(c,triangles,dim,minX,minY,size);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,size){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,size);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize===0){e=q;q=q.nextZ;qSize--}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){x=32767*(x-minX)/size;y=32767*(y-minY)/size;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))return true;return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d])}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}},{}],20:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],21:[function(require,module,exports){var toString={}.toString,isArray=Array.isArray||function(obj){return toString.call(obj)==="[object Array]"},objKeys=Object.keys||function(obj){var keys=[];for(var name in obj){if(obj.hasOwnProperty(name)){keys.push(name)}}return keys},strReg=/[\u0000-\u001f"\\]/g,strReplace=function(str){var code=str.charCodeAt(0);switch(code){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:if(code>15){return"\\u00"+code.toString(16)}else{return"\\u000"+code.toString(16)}}};module.exports=function simpleStableStringify(val){if(val!==undefined){return""+sss(val)}};module.exports.stringSearch=strReg;module.exports.stringReplace=strReplace;

function sss(val){var i,max,str,keys,key,pass;switch(typeof val){case"object":if(val===null){return null}else if(isArray(val)){str="[";max=val.length-1;for(i=0;i<max;i++){str+=sss(val[i])+","}if(max>-1){str+=sss(val[i])}return str+"]"}else{keys=objKeys(val).sort();max=keys.length;str="{";key=keys[i=0];pass=max>0&&val[key]!==undefined;while(i<max){if(pass){str+='"'+key.replace(strReg,strReplace)+'":'+sss(val[key]);key=keys[++i];pass=i<max&&val[key]!==undefined;if(pass){str+=","}}else{key=keys[++i];pass=i<max&&val[key]!==undefined}}return str+"}"}case"undefined":return null;case"string":return'"'+val.replace(strReg,strReplace)+'"';default:return val}}},{}],22:[function(require,module,exports){"use strict";module.exports=createFilter;var types=["Unknown","Point","LineString","Polygon"];function createFilter(filter){return new Function("f","var p = (f && f.properties || {}); return "+compile(filter))}function compile(filter){if(!filter)return"true";var op=filter[0];if(filter.length<=1)return op==="any"?"false":"true";var str=op==="=="?compileComparisonOp(filter[1],filter[2],"===",false):op==="!="?compileComparisonOp(filter[1],filter[2],"!==",false):op==="<"||op===">"||op==="<="||op===">="?compileComparisonOp(filter[1],filter[2],op,true):op==="any"?compileLogicalOp(filter.slice(1),"||"):op==="all"?compileLogicalOp(filter.slice(1),"&&"):op==="none"?compileNegation(compileLogicalOp(filter.slice(1),"||")):op==="in"?compileInOp(filter[1],filter.slice(2)):op==="!in"?compileNegation(compileInOp(filter[1],filter.slice(2))):op==="has"?compileHasOp(filter[1]):op==="!has"?compileNegation(compileHasOp([filter[1]])):"true";return"("+str+")"}function compilePropertyReference(property){return property==="$type"?"f.type":property==="$id"?"f.id":"p["+JSON.stringify(property)+"]"}function compileComparisonOp(property,value,op,checkType){var left=compilePropertyReference(property);var right=property==="$type"?types.indexOf(value):JSON.stringify(value);return(checkType?"typeof "+left+"=== typeof "+right+"&&":"")+left+op+right}function compileLogicalOp(expressions,op){return expressions.map(compile).join(op)}function compileInOp(property,values){if(property==="$type")values=values.map(function(value){return types.indexOf(value)});var left=JSON.stringify(values.sort(compare));var right=compilePropertyReference(property);if(values.length<=200)return left+".indexOf("+right+") !== -1";return"function(v, a, i, j) {"+"while (i <= j) { var m = (i + j) >> 1;"+"    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;"+"}"+"return false; }("+right+", "+left+",0,"+(values.length-1)+")"}function compileHasOp(property){return JSON.stringify(property)+" in p"}function compileNegation(expression){return"!("+expression+")"}function compare(a,b){return a<b?-1:a>b?1:0}},{}],23:[function(require,module,exports){var isFunction=require("is-function");module.exports=forEach;var toString=Object.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;function forEach(list,iterator,context){if(!isFunction(iterator)){throw new TypeError("iterator must be a function")}if(arguments.length<3){context=this}if(toString.call(list)==="[object Array]")forEachArray(list,iterator,context);else if(typeof list==="string")forEachString(list,iterator,context);else forEachObject(list,iterator,context)}function forEachArray(array,iterator,context){for(var i=0,len=array.length;i<len;i++){if(hasOwnProperty.call(array,i)){iterator.call(context,array[i],i,array)}}}function forEachString(string,iterator,context){for(var i=0,len=string.length;i<len;i++){iterator.call(context,string.charAt(i),i,string)}}function forEachObject(object,iterator,context){for(var k in object){if(hasOwnProperty.call(object,k)){iterator.call(context,object[k],k,object)}}}},{"is-function":39}],24:[function(require,module,exports){var wgs84=require("wgs84");module.exports.geometry=geometry;module.exports.ring=ringArea;function geometry(_){if(_.type==="Polygon")return polygonArea(_.coordinates);else if(_.type==="MultiPolygon"){var area=0;for(var i=0;i<_.coordinates.length;i++){area+=polygonArea(_.coordinates[i])}return area}else{return null}}function polygonArea(coords){var area=0;if(coords&&coords.length>0){area+=Math.abs(ringArea(coords[0]));for(var i=1;i<coords.length;i++){area-=Math.abs(ringArea(coords[i]))}}return area}function ringArea(coords){var area=0;if(coords.length>2){var p1,p2;for(var i=0;i<coords.length-1;i++){p1=coords[i];p2=coords[i+1];area+=rad(p2[0]-p1[0])*(2+Math.sin(rad(p1[1]))+Math.sin(rad(p2[1])))}area=area*wgs84.RADIUS*wgs84.RADIUS/2}return area}function rad(_){return _*Math.PI/180}},{wgs84:567}],25:[function(require,module,exports){var geojsonArea=require("geojson-area");module.exports=rewind;function rewind(gj,outer){switch(gj&&gj.type||null){case"FeatureCollection":gj.features=gj.features.map(curryOuter(rewind,outer));return gj;case"Feature":gj.geometry=rewind(gj.geometry,outer);return gj;case"Polygon":case"MultiPolygon":return correct(gj,outer);default:return gj}}function curryOuter(a,b){return function(_){return a(_,b)}}function correct(_,outer){if(_.type==="Polygon"){_.coordinates=correctRings(_.coordinates,outer)}else if(_.type==="MultiPolygon"){_.coordinates=_.coordinates.map(curryOuter(correctRings,outer))}return _}function correctRings(_,outer){outer=!!outer;_[0]=wind(_[0],!outer);for(var i=1;i<_.length;i++){_[i]=wind(_[i],outer)}return _}function wind(_,dir){return cw(_)===dir?_:_.reverse()}function cw(_){return geojsonArea.ring(_)>=0}},{"geojson-area":24}],26:[function(require,module,exports){"use strict";module.exports=clip;var createFeature=require("./feature");function clip(features,scale,k1,k2,axis,intersect,minAll,maxAll){k1/=scale;k2/=scale;if(minAll>=k1&&maxAll<=k2)return features;else if(minAll>k2||maxAll<k1)return null;var clipped=[];for(var i=0;i<features.length;i++){var feature=features[i],geometry=feature.geometry,type=feature.type,min,max;min=feature.min[axis];max=feature.max[axis];if(min>=k1&&max<=k2){clipped.push(feature);continue}else if(min>k2||max<k1)continue;var slices=type===1?clipPoints(geometry,k1,k2,axis):clipGeometry(geometry,k1,k2,axis,intersect,type===3);if(slices.length){clipped.push(createFeature(feature.tags,type,slices,feature.id))}}return clipped.length?clipped:null}function clipPoints(geometry,k1,k2,axis){var slice=[];for(var i=0;i<geometry.length;i++){var a=geometry[i],ak=a[axis];if(ak>=k1&&ak<=k2)slice.push(a)}return slice}function clipGeometry(geometry,k1,k2,axis,intersect,closed){var slices=[];for(var i=0;i<geometry.length;i++){var ak=0,bk=0,b=null,points=geometry[i],area=points.area,dist=points.dist,outer=points.outer,len=points.length,a,j,last;var slice=[];for(j=0;j<len-1;j++){a=b||points[j];b=points[j+1];ak=bk||a[axis];bk=b[axis];if(ak<k1){if(bk>k2){slice.push(intersect(a,b,k1),intersect(a,b,k2));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}else if(bk>=k1)slice.push(intersect(a,b,k1))}else if(ak>k2){if(bk<k1){slice.push(intersect(a,b,k2),intersect(a,b,k1));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}else if(bk<=k2)slice.push(intersect(a,b,k2))}else{slice.push(a);if(bk<k1){slice.push(intersect(a,b,k1));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}else if(bk>k2){slice.push(intersect(a,b,k2));if(!closed)slice=newSlice(slices,slice,area,dist,outer)}}}a=points[len-1];ak=a[axis];if(ak>=k1&&ak<=k2)slice.push(a);last=slice[slice.length-1];if(closed&&last&&(slice[0][0]!==last[0]||slice[0][1]!==last[1]))slice.push(slice[0]);newSlice(slices,slice,area,dist,outer)}return slices}function newSlice(slices,slice,area,dist,outer){if(slice.length){slice.area=area;slice.dist=dist;if(outer!==undefined)slice.outer=outer;slices.push(slice)}return[]}},{"./feature":28}],27:[function(require,module,exports){"use strict";module.exports=convert;var simplify=require("./simplify");var createFeature=require("./feature");function convert(data,tolerance){var features=[];if(data.type==="FeatureCollection"){for(var i=0;i<data.features.length;i++){convertFeature(features,data.features[i],tolerance)}}else if(data.type==="Feature"){convertFeature(features,data,tolerance)}else{convertFeature(features,{geometry:data},tolerance)}return features}function convertFeature(features,feature,tolerance){if(feature.geometry===null){return}var geom=feature.geometry,type=geom.type,coords=geom.coordinates,tags=feature.properties,id=feature.id,i,j,rings,projectedRing;if(type==="Point"){features.push(createFeature(tags,1,[projectPoint(coords)],id))}else if(type==="MultiPoint"){features.push(createFeature(tags,1,project(coords),id))}else if(type==="LineString"){features.push(createFeature(tags,2,[project(coords,tolerance)],id))}else if(type==="MultiLineString"||type==="Polygon"){rings=[];for(i=0;i<coords.length;i++){projectedRing=project(coords[i],tolerance);if(type==="Polygon")projectedRing.outer=i===0;rings.push(projectedRing)}features.push(createFeature(tags,type==="Polygon"?3:2,rings,id))}else if(type==="MultiPolygon"){rings=[];for(i=0;i<coords.length;i++){for(j=0;j<coords[i].length;j++){projectedRing=project(coords[i][j],tolerance);projectedRing.outer=j===0;rings.push(projectedRing)}}features.push(createFeature(tags,3,rings,id))}else if(type==="GeometryCollection"){for(i=0;i<geom.geometries.length;i++){convertFeature(features,{geometry:geom.geometries[i],properties:tags},tolerance)}}else{throw new Error("Input data is not a valid GeoJSON object.")}}function project(lonlats,tolerance){var projected=[];for(var i=0;i<lonlats.length;i++){projected.push(projectPoint(lonlats[i]))}if(tolerance){simplify(projected,tolerance);calcSize(projected)}return projected}function projectPoint(p){var sin=Math.sin(p[1]*Math.PI/180),x=p[0]/360+.5,y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;y=y<0?0:y>1?1:y;return[x,y,0]}function calcSize(points){var area=0,dist=0;for(var i=0,a,b;i<points.length-1;i++){a=b||points[i];b=points[i+1];area+=a[0]*b[1]-b[0]*a[1];dist+=Math.abs(b[0]-a[0])+Math.abs(b[1]-a[1])}points.area=Math.abs(area/2);points.dist=dist}},{"./feature":28,"./simplify":30}],28:[function(require,module,exports){"use strict";module.exports=createFeature;function createFeature(tags,type,geom,id){var feature={id:id||null,type:type,geometry:geom,tags:tags||null,min:[Infinity,Infinity],max:[-Infinity,-Infinity]};calcBBox(feature);return feature}function calcBBox(feature){var geometry=feature.geometry,min=feature.min,max=feature.max;if(feature.type===1){calcRingBBox(min,max,geometry)}else{for(var i=0;i<geometry.length;i++){calcRingBBox(min,max,geometry[i])}}return feature}function calcRingBBox(min,max,points){for(var i=0,p;i<points.length;i++){p=points[i];min[0]=Math.min(p[0],min[0]);max[0]=Math.max(p[0],max[0]);min[1]=Math.min(p[1],min[1]);max[1]=Math.max(p[1],max[1])}}},{}],29:[function(require,module,exports){"use strict";module.exports=geojsonvt;var convert=require("./convert"),transform=require("./transform"),clip=require("./clip"),wrap=require("./wrap"),createTile=require("./tile");function geojsonvt(data,options){return new GeoJSONVT(data,options)}function GeoJSONVT(data,options){options=this.options=extend(Object.create(this.options),options);var debug=options.debug;if(debug)console.time("preprocess data");var z2=1<<options.maxZoom,features=convert(data,options.tolerance/(z2*options.extent));this.tiles={};this.tileCoords=[];if(debug){console.timeEnd("preprocess data");console.log("index: maxZoom: %d, maxPoints: %d",options.indexMaxZoom,options.indexMaxPoints);console.time("generate tiles");this.stats={};this.total=0}features=wrap(features,options.buffer/options.extent,intersectX);if(features.length)this.splitTile(features,0,0,0);if(debug){if(features.length)console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints);console.timeEnd("generate tiles");console.log("tiles generated:",this.total,JSON.stringify(this.stats))}}GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:false,tolerance:3,extent:4096,buffer:64,debug:0};GeoJSONVT.prototype.splitTile=function(features,z,x,y,cz,cx,cy){var stack=[features,z,x,y],options=this.options,debug=options.debug,solid=null;while(stack.length){y=stack.pop();x=stack.pop();z=stack.pop();features=stack.pop();var z2=1<<z,id=toID(z,x,y),tile=this.tiles[id],tileTolerance=z===options.maxZoom?0:options.tolerance/(z2*options.extent);if(!tile){if(debug>1)console.time("creation");tile=this.tiles[id]=createTile(features,z2,x,y,tileTolerance,z===options.maxZoom);this.tileCoords.push({z:z,x:x,y:y});if(debug){if(debug>1){console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,x,y,tile.numFeatures,tile.numPoints,tile.numSimplified);console.timeEnd("creation")}var key="z"+z;this.stats[key]=(this.stats[key]||0)+1;this.total++}}tile.source=features;if(!cz){if(z===options.indexMaxZoom||tile.numPoints<=options.indexMaxPoints)continue}else{if(z===options.maxZoom||z===cz)continue;var m=1<<cz-z;if(x!==Math.floor(cx/m)||y!==Math.floor(cy/m))continue}if(!options.solidChildren&&isClippedSquare(tile,options.extent,options.buffer)){if(cz)solid=z;continue}tile.source=null;if(debug>1)console.time("clipping");var k1=.5*options.buffer/options.extent,k2=.5-k1,k3=.5+k1,k4=1+k1,tl,bl,tr,br,left,right;tl=bl=tr=br=null;left=clip(features,z2,x-k1,x+k3,0,intersectX,tile.min[0],tile.max[0]);right=clip(features,z2,x+k2,x+k4,0,intersectX,tile.min[0],tile.max[0]);if(left){tl=clip(left,z2,y-k1,y+k3,1,intersectY,tile.min[1],tile.max[1]);bl=clip(left,z2,y+k2,y+k4,1,intersectY,tile.min[1],tile.max[1])}if(right){tr=clip(right,z2,y-k1,y+k3,1,intersectY,tile.min[1],tile.max[1]);br=clip(right,z2,y+k2,y+k4,1,intersectY,tile.min[1],tile.max[1])}if(debug>1)console.timeEnd("clipping");if(features.length){stack.push(tl||[],z+1,x*2,y*2);stack.push(bl||[],z+1,x*2,y*2+1);stack.push(tr||[],z+1,x*2+1,y*2);stack.push(br||[],z+1,x*2+1,y*2+1)}}return solid};GeoJSONVT.prototype.getTile=function(z,x,y){var options=this.options,extent=options.extent,debug=options.debug;var z2=1<<z;x=(x%z2+z2)%z2;var id=toID(z,x,y);if(this.tiles[id])return transform.tile(this.tiles[id],extent);if(debug>1)console.log("drilling down to z%d-%d-%d",z,x,y);var z0=z,x0=x,y0=y,parent;while(!parent&&z0>0){z0--;x0=Math.floor(x0/2);y0=Math.floor(y0/2);parent=this.tiles[toID(z0,x0,y0)]}if(!parent||!parent.source)return null;if(debug>1)console.log("found parent tile z%d-%d-%d",z0,x0,y0);if(isClippedSquare(parent,extent,options.buffer))return transform.tile(parent,extent);if(debug>1)console.time("drilling down");var solid=this.splitTile(parent.source,z0,x0,y0,z,x,y);if(debug>1)console.timeEnd("drilling down");if(solid!==null){var m=1<<z-solid;id=toID(solid,Math.floor(x/m),Math.floor(y/m))}return this.tiles[id]?transform.tile(this.tiles[id],extent):null};function toID(z,x,y){return((1<<z)*y+x)*32+z}function intersectX(a,b,x){return[x,(x-a[0])*(b[1]-a[1])/(b[0]-a[0])+a[1],1]}function intersectY(a,b,y){return[(y-a[1])*(b[0]-a[0])/(b[1]-a[1])+a[0],y,1]}function extend(dest,src){for(var i in src)dest[i]=src[i];return dest}function isClippedSquare(tile,extent,buffer){var features=tile.source;if(features.length!==1)return false;var feature=features[0];if(feature.type!==3||feature.geometry.length>1)return false;var len=feature.geometry[0].length;if(len!==5)return false;for(var i=0;i<len;i++){var p=transform.point(feature.geometry[0][i],extent,tile.z2,tile.x,tile.y);if(p[0]!==-buffer&&p[0]!==extent+buffer||p[1]!==-buffer&&p[1]!==extent+buffer)return false}return true}},{"./clip":26,"./convert":27,"./tile":31,"./transform":32,"./wrap":33}],30:[function(require,module,exports){"use strict";module.exports=simplify;function simplify(points,tolerance){var sqTolerance=tolerance*tolerance,len=points.length,first=0,last=len-1,stack=[],i,maxSqDist,sqDist,index;points[first][2]=1;points[last][2]=1;while(last){maxSqDist=0;for(i=first+1;i<last;i++){sqDist=getSqSegDist(points[i],points[first],points[last]);if(sqDist>maxSqDist){index=i;maxSqDist=sqDist}}if(maxSqDist>sqTolerance){points[index][2]=maxSqDist;stack.push(first);stack.push(index);first=index}else{last=stack.pop();first=stack.pop()}}}function getSqSegDist(p,a,b){var x=a[0],y=a[1],bx=b[0],by=b[1],px=p[0],py=p[1],dx=bx-x,dy=by-y;if(dx!==0||dy!==0){var t=((px-x)*dx+(py-y)*dy)/(dx*dx+dy*dy);if(t>1){x=bx;y=by}else if(t>0){x+=dx*t;y+=dy*t}}dx=px-x;dy=py-y;return dx*dx+dy*dy}},{}],31:[function(require,module,exports){"use strict";module.exports=createTile;function createTile(features,z2,tx,ty,tolerance,noSimplify){var tile={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:tx,y:ty,z2:z2,transformed:false,min:[2,1],max:[-1,0]};for(var i=0;i<features.length;i++){tile.numFeatures++;addFeature(tile,features[i],tolerance,noSimplify);var min=features[i].min,max=features[i].max;if(min[0]<tile.min[0])tile.min[0]=min[0];if(min[1]<tile.min[1])tile.min[1]=min[1];if(max[0]>tile.max[0])tile.max[0]=max[0];if(max[1]>tile.max[1])tile.max[1]=max[1]}return tile}function addFeature(tile,feature,tolerance,noSimplify){var geom=feature.geometry,type=feature.type,simplified=[],sqTolerance=tolerance*tolerance,i,j,ring,p;if(type===1){for(i=0;i<geom.length;i++){simplified.push(geom[i]);tile.numPoints++;tile.numSimplified++}}else{for(i=0;i<geom.length;i++){ring=geom[i];if(!noSimplify&&(type===2&&ring.dist<tolerance||type===3&&ring.area<sqTolerance)){tile.numPoints+=ring.length;continue}var simplifiedRing=[];for(j=0;j<ring.length;j++){p=ring[j];if(noSimplify||p[2]>sqTolerance){simplifiedRing.push(p);tile.numSimplified++}tile.numPoints++}if(type===3)rewind(simplifiedRing,ring.outer);simplified.push(simplifiedRing)}}if(simplified.length){var tileFeature={geometry:simplified,type:type,tags:feature.tags||null};if(feature.id!==null){tileFeature.id=feature.id}tile.features.push(tileFeature)}}function rewind(ring,clockwise){var area=signedArea(ring);if(area<0===clockwise)ring.reverse()}function signedArea(ring){var sum=0;for(var i=0,len=ring.length,j=len-1,p1,p2;i<len;j=i++){p1=ring[i];p2=ring[j];sum+=(p2[0]-p1[0])*(p1[1]+p2[1])}return sum}},{}],32:[function(require,module,exports){"use strict";exports.tile=transformTile;exports.point=transformPoint;function transformTile(tile,extent){if(tile.transformed)return tile;var z2=tile.z2,tx=tile.x,ty=tile.y,i,j,k;for(i=0;i<tile.features.length;i++){var feature=tile.features[i],geom=feature.geometry,type=feature.type;if(type===1){for(j=0;j<geom.length;j++)geom[j]=transformPoint(geom[j],extent,z2,tx,ty)}else{for(j=0;j<geom.length;j++){var ring=geom[j];for(k=0;k<ring.length;k++)ring[k]=transformPoint(ring[k],extent,z2,tx,ty)}}}tile.transformed=true;return tile}function transformPoint(p,extent,z2,tx,ty){var x=Math.round(extent*(p[0]*z2-tx)),y=Math.round(extent*(p[1]*z2-ty));return[x,y]}},{}],33:[function(require,module,exports){"use strict";var clip=require("./clip");var createFeature=require("./feature");module.exports=wrap;function wrap(features,buffer,intersectX){var merged=features,left=clip(features,1,-1-buffer,buffer,0,intersectX,-1,2),right=clip(features,1,1-buffer,2+buffer,0,intersectX,-1,2);if(left||right){merged=clip(features,1,-buffer,1+buffer,0,intersectX,-1,2)||[];if(left)merged=shiftFeatureCoords(left,1).concat(merged);if(right)merged=merged.concat(shiftFeatureCoords(right,-1))}return merged}function shiftFeatureCoords(features,offset){var newFeatures=[];for(var i=0;i<features.length;i++){var feature=features[i],type=feature.type;var newGeometry;if(type===1){newGeometry=shiftCoords(feature.geometry,offset)}else{newGeometry=[];for(var j=0;j<feature.geometry.length;j++){newGeometry.push(shiftCoords(feature.geometry[j],offset))}}newFeatures.push(createFeature(feature.tags,type,newGeometry,feature.id))}return newFeatures}function shiftCoords(points,offset){var newPoints=[];newPoints.area=points.area;newPoints.dist=points.dist;for(var i=0;i<points.length;i++){newPoints.push([points[i][0]+offset,points[i][1],points[i][2]])}return newPoints}},{"./clip":26,"./feature":28}],34:[function(require,module,exports){(function(global){if(typeof window!=="undefined"){module.exports=window}else if(typeof global!=="undefined"){module.exports=global}else if(typeof self!=="undefined"){module.exports=self}else{module.exports={}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],35:[function(require,module,exports){"use strict";module.exports=GridIndex;var NUM_PARAMS=3;function GridIndex(extent,n,padding){var cells=this.cells=[];if(extent instanceof ArrayBuffer){this.arrayBuffer=extent;var array=new Int32Array(this.arrayBuffer);extent=array[0];n=array[1];padding=array[2];this.d=n+2*padding;for(var k=0;k<this.d*this.d;k++){var start=array[NUM_PARAMS+k];var end=array[NUM_PARAMS+k+1];cells.push(start===end?null:array.subarray(start,end))}var keysOffset=array[NUM_PARAMS+cells.length];var bboxesOffset=array[NUM_PARAMS+cells.length+1];this.keys=array.subarray(keysOffset,bboxesOffset);this.bboxes=array.subarray(bboxesOffset);this.insert=this._insertReadonly}else{this.d=n+2*padding;for(var i=0;i<this.d*this.d;i++){cells.push([])}this.keys=[];this.bboxes=[]}this.n=n;this.extent=extent;this.padding=padding;this.scale=n/extent;this.uid=0;var p=padding/n*extent;this.min=-p;this.max=extent+p}GridIndex.prototype.insert=function(key,x1,y1,x2,y2){this._forEachCell(x1,y1,x2,y2,this._insertCell,this.uid++);this.keys.push(key);this.bboxes.push(x1);this.bboxes.push(y1);this.bboxes.push(x2);this.bboxes.push(y2)};GridIndex.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."};GridIndex.prototype._insertCell=function(x1,y1,x2,y2,cellIndex,uid){this.cells[cellIndex].push(uid)};GridIndex.prototype.query=function(x1,y1,x2,y2){var min=this.min;var max=this.max;if(x1<=min&&y1<=min&&max<=x2&&max<=y2){return Array.prototype.slice.call(this.keys)}else{var result=[];var seenUids={};this._forEachCell(x1,y1,x2,y2,this._queryCell,result,seenUids);return result}};GridIndex.prototype._queryCell=function(x1,y1,x2,y2,cellIndex,result,seenUids){var cell=this.cells[cellIndex];if(cell!==null){var keys=this.keys;var bboxes=this.bboxes;for(var u=0;u<cell.length;u++){var uid=cell[u];if(seenUids[uid]===undefined){var offset=uid*4;if(x1<=bboxes[offset+2]&&y1<=bboxes[offset+3]&&x2>=bboxes[offset+0]&&y2>=bboxes[offset+1]){seenUids[uid]=true;result.push(keys[uid])}else{seenUids[uid]=false}}}}};GridIndex.prototype._forEachCell=function(x1,y1,x2,y2,fn,arg1,arg2){var cx1=this._convertToCellCoord(x1);var cy1=this._convertToCellCoord(y1);var cx2=this._convertToCellCoord(x2);var cy2=this._convertToCellCoord(y2);for(var x=cx1;x<=cx2;x++){for(var y=cy1;y<=cy2;y++){var cellIndex=this.d*y+x;if(fn.call(this,x1,y1,x2,y2,cellIndex,arg1,arg2))return}}};GridIndex.prototype._convertToCellCoord=function(x){return Math.max(0,Math.min(this.d-1,Math.floor(x*this.scale)+this.padding))};GridIndex.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;var cells=this.cells;var metadataLength=NUM_PARAMS+this.cells.length+1+1;var totalCellLength=0;for(var i=0;i<this.cells.length;i++){totalCellLength+=this.cells[i].length}var array=new Int32Array(metadataLength+totalCellLength+this.keys.length+this.bboxes.length);array[0]=this.extent;array[1]=this.n;array[2]=this.padding;var offset=metadataLength;for(var k=0;k<cells.length;k++){var cell=cells[k];array[NUM_PARAMS+k]=offset;array.set(cell,offset);offset+=cell.length}array[NUM_PARAMS+cells.length]=offset;array.set(this.keys,offset);offset+=this.keys.length;array[NUM_PARAMS+cells.length+1]=offset;array.set(this.bboxes,offset);offset+=this.bboxes.length;return array.buffer}},{}],36:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],37:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],38:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],39:[function(require,module,exports){module.exports=isFunction;var toString=Object.prototype.toString;function isFunction(fn){var string=toString.call(fn);return string==="[object Function]"||typeof fn==="function"&&string!=="[object RegExp]"||typeof window!=="undefined"&&(fn===window.setTimeout||fn===window.alert||fn===window.confirm||fn===window.prompt)}},{}],40:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],41:[function(require,module,exports){"use strict";var sort=require("./sort");var range=require("./range");var within=require("./within");module.exports=kdbush;function kdbush(points,getX,getY,nodeSize,ArrayType){return new KDBush(points,getX,getY,nodeSize,ArrayType)}function KDBush(points,getX,getY,nodeSize,ArrayType){getX=getX||defaultGetX;getY=getY||defaultGetY;ArrayType=ArrayType||Array;this.nodeSize=nodeSize||64;this.points=points;this.ids=new ArrayType(points.length);this.coords=new ArrayType(points.length*2);for(var i=0;i<points.length;i++){this.ids[i]=i;this.coords[2*i]=getX(points[i]);this.coords[2*i+1]=getY(points[i])}sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}KDBush.prototype={range:function(minX,minY,maxX,maxY){return range(this.ids,this.coords,minX,minY,maxX,maxY,this.nodeSize)},within:function(x,y,r){return within(this.ids,this.coords,x,y,r,this.nodeSize)}};function defaultGetX(p){return p[0]}function defaultGetY(p){return p[1]}},{"./range":42,"./sort":43,"./within":44}],42:[function(require,module,exports){"use strict";module.exports=range;function range(ids,coords,minX,minY,maxX,maxY,nodeSize){var stack=[0,ids.length-1,0];var result=[];var x,y;while(stack.length){var axis=stack.pop();var right=stack.pop();var left=stack.pop();if(right-left<=nodeSize){for(var i=left;i<=right;i++){x=coords[2*i];y=coords[2*i+1];if(x>=minX&&x<=maxX&&y>=minY&&y<=maxY)result.push(ids[i])}continue}var m=Math.floor((left+right)/2);x=coords[2*m];y=coords[2*m+1];if(x>=minX&&x<=maxX&&y>=minY&&y<=maxY)result.push(ids[m]);var nextAxis=(axis+1)%2;if(axis===0?minX<=x:minY<=y){stack.push(left);stack.push(m-1);stack.push(nextAxis)}if(axis===0?maxX>=x:maxY>=y){stack.push(m+1);stack.push(right);stack.push(nextAxis)}}return result}},{}],43:[function(require,module,exports){"use strict";module.exports=sortKD;function sortKD(ids,coords,nodeSize,left,right,depth){if(right-left<=nodeSize)return;var m=Math.floor((left+right)/2);select(ids,coords,m,left,right,depth%2);sortKD(ids,coords,nodeSize,left,m-1,depth+1);sortKD(ids,coords,nodeSize,m+1,right,depth+1)}function select(ids,coords,k,left,right,inc){while(right>left){if(right-left>600){var n=right-left+1;var m=k-left+1;var z=Math.log(n);var s=.5*Math.exp(2*z/3);var sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);var newLeft=Math.max(left,Math.floor(k-m*s/n+sd));var newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));select(ids,coords,k,newLeft,newRight,inc)}var t=coords[2*k+inc];var i=left;var j=right;swapItem(ids,coords,left,k);if(coords[2*right+inc]>t)swapItem(ids,coords,left,right);while(i<j){swapItem(ids,coords,i,j);i++;j--;while(coords[2*i+inc]<t)i++;while(coords[2*j+inc]>t)j--}if(coords[2*left+inc]===t)swapItem(ids,coords,left,j);else{j++;swapItem(ids,coords,j,right)}if(j<=k)left=j+1;if(k<=j)right=j-1}}function swapItem(ids,coords,i,j){swap(ids,i,j);swap(coords,2*i,2*j);swap(coords,2*i+1,2*j+1)}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp}},{}],44:[function(require,module,exports){"use strict";module.exports=within;function within(ids,coords,qx,qy,r,nodeSize){var stack=[0,ids.length-1,0];var result=[];var r2=r*r;while(stack.length){var axis=stack.pop();var right=stack.pop();var left=stack.pop();if(right-left<=nodeSize){for(var i=left;i<=right;i++){if(sqDist(coords[2*i],coords[2*i+1],qx,qy)<=r2)result.push(ids[i])}continue}var m=Math.floor((left+right)/2);var x=coords[2*m];var y=coords[2*m+1];if(sqDist(x,y,qx,qy)<=r2)result.push(ids[m]);var nextAxis=(axis+1)%2;if(axis===0?qx-r<=x:qy-r<=y){stack.push(left);stack.push(m-1);stack.push(nextAxis)}if(axis===0?qx+r>=x:qy+r>=y){stack.push(m+1);stack.push(right);stack.push(nextAxis)}}return result}function sqDist(ax,ay,bx,by){var dx=ax-bx;var dy=ay-by;return dx*dx+dy*dy}},{}],45:[function(require,module,exports){var isArray=require("lodash.isarray"),isTypedArray=require("lodash.istypedarray"),keys=require("lodash.keys");var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]";function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB);

}}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);stackA.pop();stackB.pop();return result}function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength)){return false}while(++index<arrLength){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result){continue}return false}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)})){return false}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))){return false}}return true}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key))){return false}}var skipCtor=isLoose;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result)){return false}skipCtor||(skipCtor=key=="constructor")}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseIsEqual},{"lodash.isarray":49,"lodash.istypedarray":51,"lodash.keys":52}],46:[function(require,module,exports){function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(thisArg===undefined){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function identity(value){return value}module.exports=bindCallback},{}],47:[function(require,module,exports){var funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=getNative},{}],48:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var propertyIsEnumerable=objectProto.propertyIsEnumerable;function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}module.exports=isArguments},{}],49:[function(require,module,exports){var arrayTag="[object Array]",funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nativeIsArray=getNative(Array,"isArray");var MAX_SAFE_INTEGER=9007199254740991;function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=isArray},{}],50:[function(require,module,exports){var baseIsEqual=require("lodash._baseisequal"),bindCallback=require("lodash._bindcallback");function isEqual(value,other,customizer,thisArg){customizer=typeof customizer=="function"?bindCallback(customizer,thisArg,3):undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}module.exports=isEqual},{"lodash._baseisequal":45,"lodash._bindcallback":46}],51:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var objectProto=Object.prototype;var objectToString=objectProto.toString;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObjectLike(value){return!!value&&typeof value=="object"}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)]}module.exports=isTypedArray},{}],52:[function(require,module,exports){var getNative=require("lodash._getnative"),isArguments=require("lodash.isarguments"),isArray=require("lodash.isarray");var reIsUint=/^\d+$/;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeKeys=getNative(Object,"keys");var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isIndex(value,length){value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&isArrayLike(object)){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}module.exports=keys},{"lodash._getnative":47,"lodash.isarguments":48,"lodash.isarray":49}],53:[function(require,module,exports){var Kn=18,Xn=.95047,Yn=1,Zn=1.08883,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad=Math.PI/180,rad2deg=180/Math.PI;function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function xyz2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2xyz(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function rgbToLab(rgbColor){var b=rgb2xyz(rgbColor[0]),a=rgb2xyz(rgbColor[1]),l=rgb2xyz(rgbColor[2]),x=xyz2lab((.4124564*b+.3575761*a+.1804375*l)/Xn),y=xyz2lab((.2126729*b+.7151522*a+.072175*l)/Yn),z=xyz2lab((.0193339*b+.119192*a+.9503041*l)/Zn);return[116*y-16,500*(x-y),200*(y-z),rgbColor[3]]}function labToRgb(labColor){var y=(labColor[0]+16)/116,x=isNaN(labColor[1])?y:y+labColor[1]/500,z=isNaN(labColor[2])?y:y-labColor[2]/200;y=Yn*lab2xyz(y);x=Xn*lab2xyz(x);z=Zn*lab2xyz(z);return[xyz2rgb(3.2404542*x-1.5371385*y-.4985314*z),xyz2rgb(-.969266*x+1.8760108*y+.041556*z),xyz2rgb(.0556434*x-.2040259*y+1.0572252*z),labColor[3]]}function rgbToHcl(rgbColor){var labColor=rgbToLab(rgbColor);var l=labColor[0],a=labColor[1],b=labColor[2];var h=Math.atan2(b,a)*rad2deg;return[h<0?h+360:h,Math.sqrt(a*a+b*b),l,rgbColor[3]]}function hclToRgb(hclColor){var h=hclColor[0]*deg2rad,c=hclColor[1],l=hclColor[2];return labToRgb([l,Math.cos(h)*c,Math.sin(h)*c,hclColor[3]])}module.exports={lab:{forward:rgbToLab,reverse:labToRgb},hcl:{forward:rgbToHcl,reverse:hclToRgb}}},{}],54:[function(require,module,exports){"use strict";var colorSpaces=require("./color_spaces");function identityFunction(x){return x}function createFunction(parameters,defaultType){var fun;if(!isFunctionDefinition(parameters)){fun=function(){return parameters};fun.isFeatureConstant=true;fun.isZoomConstant=true}else{var zoomAndFeatureDependent=parameters.stops&&typeof parameters.stops[0][0]==="object";var featureDependent=zoomAndFeatureDependent||parameters.property!==undefined;var zoomDependent=zoomAndFeatureDependent||!featureDependent;var inputType=parameters.stops&&typeof(zoomAndFeatureDependent?parameters.stops[0][0].property:parameters.stops[0][0]);var type=parameters.type||defaultType||(inputType==="string"?"categorical":"exponential");var innerFun;if(type==="exponential"){innerFun=evaluateExponentialFunction}else if(type==="interval"){innerFun=evaluateIntervalFunction}else if(type==="categorical"){innerFun=evaluateCategoricalFunction}else if(type==="identity"){innerFun=evaluateIdentityFunction}else{throw new Error('Unknown function type "'+type+'"')}var outputFunction;if(parameters.colorSpace&&parameters.colorSpace!=="rgb"){if(colorSpaces[parameters.colorSpace]){var colorspace=colorSpaces[parameters.colorSpace];parameters=JSON.parse(JSON.stringify(parameters));for(var s=0;s<parameters.stops.length;s++){parameters.stops[s]=[parameters.stops[s][0],colorspace.forward(parameters.stops[s][1])]}outputFunction=colorspace.reverse}else{throw new Error("Unknown color space: "+parameters.colorSpace)}}else{outputFunction=identityFunction}if(zoomAndFeatureDependent){var featureFunctions={};var featureFunctionStops=[];for(s=0;s<parameters.stops.length;s++){var stop=parameters.stops[s];if(featureFunctions[stop[0].zoom]===undefined){featureFunctions[stop[0].zoom]={zoom:stop[0].zoom,type:parameters.type,property:parameters.property,stops:[]}}featureFunctions[stop[0].zoom].stops.push([stop[0].value,stop[1]])}for(var z in featureFunctions){featureFunctionStops.push([featureFunctions[z].zoom,createFunction(featureFunctions[z])])}fun=function(zoom,feature){return outputFunction(evaluateExponentialFunction({stops:featureFunctionStops,base:parameters.base},zoom)(zoom,feature))};fun.isFeatureConstant=false;fun.isZoomConstant=false}else if(zoomDependent){fun=function(zoom){return outputFunction(innerFun(parameters,zoom))};fun.isFeatureConstant=true;fun.isZoomConstant=false}else{fun=function(zoom,feature){return outputFunction(innerFun(parameters,feature[parameters.property]))};fun.isFeatureConstant=false;fun.isZoomConstant=true}}return fun}function evaluateCategoricalFunction(parameters,input){for(var i=0;i<parameters.stops.length;i++){if(input===parameters.stops[i][0]){return parameters.stops[i][1]}}return parameters.stops[0][1]}function evaluateIntervalFunction(parameters,input){for(var i=0;i<parameters.stops.length;i++){if(input<parameters.stops[i][0])break}return parameters.stops[Math.max(i-1,0)][1]}function evaluateExponentialFunction(parameters,input){var base=parameters.base!==undefined?parameters.base:1;var i=0;while(true){if(i>=parameters.stops.length)break;else if(input<=parameters.stops[i][0])break;else i++}if(i===0){return parameters.stops[i][1]}else if(i===parameters.stops.length){return parameters.stops[i-1][1]}else{return interpolate(input,base,parameters.stops[i-1][0],parameters.stops[i][0],parameters.stops[i-1][1],parameters.stops[i][1])}}function evaluateIdentityFunction(parameters,input){return input}function interpolate(input,base,inputLower,inputUpper,outputLower,outputUpper){if(typeof outputLower==="function"){return function(){var evaluatedLower=outputLower.apply(undefined,arguments);var evaluatedUpper=outputUpper.apply(undefined,arguments);return interpolate(input,base,inputLower,inputUpper,evaluatedLower,evaluatedUpper)}}else if(outputLower.length){return interpolateArray(input,base,inputLower,inputUpper,outputLower,outputUpper)}else{return interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper)}}function interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper){var difference=inputUpper-inputLower;var progress=input-inputLower;var ratio;if(base===1){ratio=progress/difference}else{ratio=(Math.pow(base,progress)-1)/(Math.pow(base,difference)-1)}return outputLower*(1-ratio)+outputUpper*ratio}function interpolateArray(input,base,inputLower,inputUpper,outputLower,outputUpper){var output=[];for(var i=0;i<outputLower.length;i++){output[i]=interpolateNumber(input,base,inputLower,inputUpper,outputLower[i],outputUpper[i])}return output}function isFunctionDefinition(value){return typeof value==="object"&&(value.stops||value.type==="identity")}module.exports.isFunctionDefinition=isFunctionDefinition;module.exports.interpolated=function(parameters){return createFunction(parameters,"exponential")};module.exports["piecewise-constant"]=function(parameters){return createFunction(parameters,"interval")}},{"./color_spaces":53}],55:[function(require,module,exports){"use strict";var refProperties=require("./util/ref_properties");function deref(layer,parent){var result={};for(var k in layer){if(k!=="ref"){result[k]=layer[k]}}refProperties.forEach(function(k){if(k in parent){result[k]=parent[k]}});return result}module.exports=derefLayers;function derefLayers(layers){layers=layers.slice();var map=Object.create(null),i;for(i=0;i<layers.length;i++){map[layers[i].id]=layers[i]}for(i=0;i<layers.length;i++){if("ref"in layers[i]){layers[i]=deref(layers[i],map[layers[i].ref])}}return layers}},{"./util/ref_properties":61}],56:[function(require,module,exports){"use strict";var isEqual=require("lodash.isequal");var operations={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function diffSources(before,after,commands,sourcesRemoved){before=before||{};after=after||{};var sourceId;for(sourceId in before){if(!before.hasOwnProperty(sourceId))continue;if(!after.hasOwnProperty(sourceId)){commands.push({command:operations.removeSource,args:[sourceId]});sourcesRemoved[sourceId]=true}}for(sourceId in after){if(!after.hasOwnProperty(sourceId))continue;if(!before.hasOwnProperty(sourceId)){commands.push({command:operations.addSource,args:[sourceId,after[sourceId]]})}else if(!isEqual(before[sourceId],after[sourceId])){commands.push({command:operations.removeSource,args:[sourceId]});commands.push({command:operations.addSource,args:[sourceId,after[sourceId]]});sourcesRemoved[sourceId]=true}}}function diffLayerPropertyChanges(before,after,commands,layerId,klass,command){before=before||{};after=after||{};var prop;for(prop in before){if(!before.hasOwnProperty(prop))continue;if(!isEqual(before[prop],after[prop])){commands.push({command:command,args:[layerId,prop,after[prop],klass]})}}for(prop in after){if(!after.hasOwnProperty(prop)||before.hasOwnProperty(prop))continue;if(!isEqual(before[prop],after[prop])){commands.push({command:command,args:[layerId,prop,after[prop],klass]})}}}function pluckId(layer){return layer.id}function indexById(group,layer){group[layer.id]=layer;return group}function diffLayers(before,after,commands){before=before||[];after=after||[];var beforeOrder=before.map(pluckId);var afterOrder=after.map(pluckId);var beforeIndex=before.reduce(indexById,{});var afterIndex=after.reduce(indexById,{});var tracker=beforeOrder.slice();var clean=Object.create(null);var i,d,layerId,beforeLayer,afterLayer,insertBeforeLayerId,prop;for(i=0,d=0;i<beforeOrder.length;i++){layerId=beforeOrder[i];if(!afterIndex.hasOwnProperty(layerId)){commands.push({command:operations.removeLayer,args:[layerId]});tracker.splice(tracker.indexOf(layerId,d),1)}else{d++}}for(i=0,d=0;i<afterOrder.length;i++){layerId=afterOrder[afterOrder.length-1-i];if(tracker[tracker.length-1-i]===layerId)continue;if(beforeIndex.hasOwnProperty(layerId)){commands.push({command:operations.removeLayer,args:[layerId]});tracker.splice(tracker.lastIndexOf(layerId,tracker.length-d),1)}else{d++}insertBeforeLayerId=tracker[tracker.length-i];commands.push({command:operations.addLayer,args:[afterIndex[layerId],insertBeforeLayerId]});tracker.splice(tracker.length-i,0,layerId);clean[layerId]=true}for(i=0;i<afterOrder.length;i++){layerId=afterOrder[i];beforeLayer=beforeIndex[layerId];afterLayer=afterIndex[layerId];if(clean[layerId]||isEqual(beforeLayer,afterLayer))continue;if(!isEqual(beforeLayer.source,afterLayer.source)||!isEqual(beforeLayer["source-layer"],afterLayer["source-layer"])||!isEqual(beforeLayer.type,afterLayer.type)){commands.push({command:operations.removeLayer,args:[layerId]});insertBeforeLayerId=tracker[tracker.lastIndexOf(layerId)+1];commands.push({command:operations.addLayer,args:[afterLayer,insertBeforeLayerId]});continue}diffLayerPropertyChanges(beforeLayer.layout,afterLayer.layout,commands,layerId,null,operations.setLayoutProperty);diffLayerPropertyChanges(beforeLayer.paint,afterLayer.paint,commands,layerId,null,operations.setPaintProperty);if(!isEqual(beforeLayer.filter,afterLayer.filter)){commands.push({command:operations.setFilter,args:[layerId,afterLayer.filter]})}if(!isEqual(beforeLayer.minzoom,afterLayer.minzoom)||!isEqual(beforeLayer.maxzoom,afterLayer.maxzoom)){commands.push({command:operations.setLayerZoomRange,args:[layerId,afterLayer.minzoom,afterLayer.maxzoom]})}for(prop in beforeLayer){if(!beforeLayer.hasOwnProperty(prop))continue;if(prop==="layout"||prop==="paint"||prop==="filter"||prop==="metadata"||prop==="minzoom"||prop==="maxzoom")continue;if(prop.indexOf("paint.")===0){diffLayerPropertyChanges(beforeLayer[prop],afterLayer[prop],commands,layerId,prop.slice(6),operations.setPaintProperty)}else if(!isEqual(beforeLayer[prop],afterLayer[prop])){commands.push({command:operations.setLayerProperty,args:[layerId,prop,afterLayer[prop]]})}}for(prop in afterLayer){if(!afterLayer.hasOwnProperty(prop)||beforeLayer.hasOwnProperty(prop))continue;if(prop==="layout"||prop==="paint"||prop==="filter"||prop==="metadata"||prop==="minzoom"||prop==="maxzoom")continue;if(prop.indexOf("paint.")===0){diffLayerPropertyChanges(beforeLayer[prop],afterLayer[prop],commands,layerId,prop.slice(6),operations.setPaintProperty)}else if(!isEqual(beforeLayer[prop],afterLayer[prop])){commands.push({command:operations.setLayerProperty,args:[layerId,prop,afterLayer[prop]]})}}}}function diffStyles(before,after){if(!before)return[{command:operations.setStyle,args:[after]}];var commands=[];try{if(!isEqual(before.version,after.version)){return[{command:operations.setStyle,args:[after]}]}if(!isEqual(before.center,after.center)){commands.push({command:operations.setCenter,args:[after.center]})}if(!isEqual(before.zoom,after.zoom)){commands.push({command:operations.setZoom,args:[after.zoom]})}if(!isEqual(before.bearing,after.bearing)){commands.push({command:operations.setBearing,args:[after.bearing]})}if(!isEqual(before.pitch,after.pitch)){commands.push({command:operations.setPitch,args:[after.pitch]})}if(!isEqual(before.sprite,after.sprite)){commands.push({command:operations.setSprite,args:[after.sprite]})}if(!isEqual(before.glyphs,after.glyphs)){commands.push({command:operations.setGlyphs,args:[after.glyphs]})}if(!isEqual(before.transition,after.transition)){commands.push({command:operations.setTransition,args:[after.transition]})}if(!isEqual(before.light,after.light)){commands.push({command:operations.setLight,args:[after.light]})}var sourcesRemoved={};var removeOrAddSourceCommands=[];diffSources(before.sources,after.sources,removeOrAddSourceCommands,sourcesRemoved);var beforeLayers=[];if(before.layers){before.layers.forEach(function(layer){if(sourcesRemoved[layer.source]){commands.push({command:operations.removeLayer,args:[layer.id]})}else{beforeLayers.push(layer)}})}commands=commands.concat(removeOrAddSourceCommands);diffLayers(beforeLayers,after.layers,commands)}catch(e){console.warn("Unable to compute style diff:",e);commands=[{command:operations.setStyle,args:[after]}]}return commands}module.exports=diffStyles;module.exports.operations=operations},{"lodash.isequal":50}],57:[function(require,module,exports){"use strict";var format=require("util").format;function ValidationError(key,value){this.message=(key?key+": ":"")+format.apply(format,Array.prototype.slice.call(arguments,2));if(value!==null&&value!==undefined&&value.__line__){this.line=value.__line__}}module.exports=ValidationError},{util:558}],58:[function(require,module,exports){"use strict";var refProperties=require("./util/ref_properties");var stringify=require("fast-stable-stringify");function key(layer){return stringify(refProperties.map(function(k){return layer[k]}))}module.exports=groupByLayout;function groupByLayout(layers){var groups={},i,k;for(i=0;i<layers.length;i++){k=key(layers[i]);var group=groups[k];if(!group){group=groups[k]=[]}group.push(layers[i])}var result=[];for(k in groups){result.push(groups[k])}return result}},{"./util/ref_properties":61,"fast-stable-stringify":21}],59:[function(require,module,exports){"use strict";module.exports=function(output){for(var i=1;i<arguments.length;i++){var input=arguments[i];for(var k in input){output[k]=input[k]}}return output}},{}],60:[function(require,module,exports){"use strict";module.exports=function getType(val){if(val instanceof Number){return"number"}else if(val instanceof String){return"string"}else if(val instanceof Boolean){return"boolean"}else if(Array.isArray(val)){return"array"}else if(val===null){return"null"}else{return typeof val}}},{}],61:[function(require,module,exports){"use strict";module.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],62:[function(require,module,exports){"use strict";module.exports=function unbundle(value){if(value instanceof Number||value instanceof String||value instanceof Boolean){return value.valueOf()}else{return value}}},{}],63:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var extend=require("../util/extend");module.exports=function validate(options){var validateFunction=require("./validate_function");var validateObject=require("./validate_object");var VALIDATORS={"*":function(){return[]},array:require("./validate_array"),"boolean":require("./validate_boolean"),number:require("./validate_number"),color:require("./validate_color"),constants:require("./validate_constants"),"enum":require("./validate_enum"),filter:require("./validate_filter"),"function":require("./validate_function"),layer:require("./validate_layer"),object:require("./validate_object"),source:require("./validate_source"),light:require("./validate_light"),string:require("./validate_string")};var value=options.value;var valueSpec=options.valueSpec;var key=options.key;var styleSpec=options.styleSpec;var style=options.style;if(getType(value)==="string"&&value[0]==="@"){if(styleSpec.$version>7){return[new ValidationError(key,value,"constants have been deprecated as of v8")]}if(!(value in style.constants)){return[new ValidationError(key,value,'constant "%s" not found',value)]}options=extend({},options,{value:style.constants[value]})}if(valueSpec.function&&getType(value)==="object"){return validateFunction(options)}else if(valueSpec.type&&VALIDATORS[valueSpec.type]){return VALIDATORS[valueSpec.type](options)}else{return validateObject(extend({},options,{valueSpec:valueSpec.type?styleSpec[valueSpec.type]:valueSpec}))}}},{"../error/validation_error":57,"../util/extend":59,"../util/get_type":60,"./validate_array":64,"./validate_boolean":65,"./validate_color":66,"./validate_constants":67,"./validate_enum":68,"./validate_filter":69,"./validate_function":70,"./validate_layer":72,"./validate_light":74,"./validate_number":75,"./validate_object":76,"./validate_source":78,"./validate_string":79}],64:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var validate=require("./validate");var ValidationError=require("../error/validation_error");module.exports=function validateArray(options){var array=options.value;var arraySpec=options.valueSpec;var style=options.style;var styleSpec=options.styleSpec;var key=options.key;var validateArrayElement=options.arrayElementValidator||validate;if(getType(array)!=="array"){return[new ValidationError(key,array,"array expected, %s found",getType(array))]}if(arraySpec.length&&array.length!==arraySpec.length){return[new ValidationError(key,array,"array length %d expected, length %d found",arraySpec.length,array.length)]}if(arraySpec["min-length"]&&array.length<arraySpec["min-length"]){return[new ValidationError(key,array,"array length at least %d expected, length %d found",arraySpec["min-length"],array.length)]}var arrayElementSpec={type:arraySpec.value};if(styleSpec.$version<7){arrayElementSpec.function=arraySpec.function}if(getType(arraySpec.value)==="object"){arrayElementSpec=arraySpec.value}var errors=[];for(var i=0;i<array.length;i++){errors=errors.concat(validateArrayElement({array:array,arrayIndex:i,value:array[i],valueSpec:arrayElementSpec,style:style,styleSpec:styleSpec,key:key+"["+i+"]"}))}return errors}},{"../error/validation_error":57,"../util/get_type":60,"./validate":63}],65:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var ValidationError=require("../error/validation_error");module.exports=function validateBoolean(options){var value=options.value;var key=options.key;var type=getType(value);if(type!=="boolean"){return[new ValidationError(key,value,"boolean expected, %s found",type)]}return[]}},{"../error/validation_error":57,"../util/get_type":60}],66:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var parseCSSColor=require("csscolorparser").parseCSSColor;module.exports=function validateColor(options){var key=options.key;var value=options.value;var type=getType(value);if(type!=="string"){return[new ValidationError(key,value,"color expected, %s found",type)]}if(parseCSSColor(value)===null){return[new ValidationError(key,value,'color expected, "%s" found',value)]}return[]}},{"../error/validation_error":57,"../util/get_type":60,csscolorparser:18}],67:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");module.exports=function validateConstants(options){var key=options.key;var constants=options.value;var styleSpec=options.styleSpec;if(styleSpec.$version>7){if(constants){return[new ValidationError(key,constants,"constants have been deprecated as of v8")]}else{return[]}}else{var type=getType(constants);if(type!=="object"){return[new ValidationError(key,constants,"object expected, %s found",type)]}var errors=[];for(var constantName in constants){if(constantName[0]!=="@"){errors.push(new ValidationError(key+"."+constantName,constants[constantName],'constants must start with "@"'))}}return errors}}},{"../error/validation_error":57,
"../util/get_type":60}],68:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var unbundle=require("../util/unbundle_jsonlint");module.exports=function validateEnum(options){var key=options.key;var value=options.value;var valueSpec=options.valueSpec;var errors=[];if(Array.isArray(valueSpec.values)){if(valueSpec.values.indexOf(unbundle(value))===-1){errors.push(new ValidationError(key,value,"expected one of [%s], %s found",valueSpec.values.join(", "),value))}}else{if(Object.keys(valueSpec.values).indexOf(unbundle(value))===-1){errors.push(new ValidationError(key,value,"expected one of [%s], %s found",Object.keys(valueSpec.values).join(", "),value))}}return errors}},{"../error/validation_error":57,"../util/unbundle_jsonlint":62}],69:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var validateEnum=require("./validate_enum");var getType=require("../util/get_type");var unbundle=require("../util/unbundle_jsonlint");module.exports=function validateFilter(options){var value=options.value;var key=options.key;var styleSpec=options.styleSpec;var type;var errors=[];if(getType(value)!=="array"){return[new ValidationError(key,value,"array expected, %s found",getType(value))]}if(value.length<1){return[new ValidationError(key,value,"filter array must have at least 1 element")]}errors=errors.concat(validateEnum({key:key+"[0]",value:value[0],valueSpec:styleSpec.filter_operator,style:options.style,styleSpec:options.styleSpec}));switch(unbundle(value[0])){case"<":case"<=":case">":case">=":if(value.length>=2&&value[1]=="$type"){errors.push(new ValidationError(key,value,'"$type" cannot be use with operator "%s"',value[0]))}case"==":case"!=":if(value.length!=3){errors.push(new ValidationError(key,value,'filter array for operator "%s" must have 3 elements',value[0]))}case"in":case"!in":if(value.length>=2){type=getType(value[1]);if(type!=="string"){errors.push(new ValidationError(key+"[1]",value[1],"string expected, %s found",type))}else if(value[1][0]==="@"){errors.push(new ValidationError(key+"[1]",value[1],"filter key cannot be a constant"))}}for(var i=2;i<value.length;i++){type=getType(value[i]);if(value[1]=="$type"){errors=errors.concat(validateEnum({key:key+"["+i+"]",value:value[i],valueSpec:styleSpec.geometry_type,style:options.style,styleSpec:options.styleSpec}))}else if(type==="string"&&value[i][0]==="@"){errors.push(new ValidationError(key+"["+i+"]",value[i],"filter value cannot be a constant"))}else if(type!=="string"&&type!=="number"&&type!=="boolean"){errors.push(new ValidationError(key+"["+i+"]",value[i],"string, number, or boolean expected, %s found",type))}}break;case"any":case"all":case"none":for(i=1;i<value.length;i++){errors=errors.concat(validateFilter({key:key+"["+i+"]",value:value[i],style:options.style,styleSpec:options.styleSpec}))}break;case"has":case"!has":type=getType(value[1]);if(value.length!==2){errors.push(new ValidationError(key,value,'filter array for "%s" operator must have 2 elements',value[0]))}else if(type!=="string"){errors.push(new ValidationError(key+"[1]",value[1],"string expected, %s found",type))}else if(value[1][0]==="@"){errors.push(new ValidationError(key+"[1]",value[1],"filter key cannot be a constant"))}break}return errors}},{"../error/validation_error":57,"../util/get_type":60,"../util/unbundle_jsonlint":62,"./validate_enum":68}],70:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var validate=require("./validate");var validateObject=require("./validate_object");var validateArray=require("./validate_array");var validateNumber=require("./validate_number");var unbundle=require("../util/unbundle_jsonlint");module.exports=function validateFunction(options){var functionValueSpec=options.valueSpec;var functionType=unbundle(options.value.type);var stopKeyType;var stopDomainValues={};var previousStopDomainValue;var previousStopDomainZoom;var isZoomFunction=functionType!=="categorical"&&options.value.property===undefined;var isPropertyFunction=!isZoomFunction;var isZoomAndPropertyFunction=getType(options.value.stops)==="array"&&getType(options.value.stops[0])==="array"&&getType(options.value.stops[0][0])==="object";var errors=validateObject({key:options.key,value:options.value,valueSpec:options.styleSpec.function,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{stops:validateFunctionStops}});if(functionType!=="identity"&&!options.value.stops){errors.push(new ValidationError(options.key,options.value,'missing required property "stops"'))}if(functionType==="exponential"&&options.valueSpec["function"]==="piecewise-constant"){errors.push(new ValidationError(options.key,options.value,"exponential functions not supported"))}if(options.styleSpec.$version>=8){if(isPropertyFunction&&!options.valueSpec["property-function"]){errors.push(new ValidationError(options.key,options.value,"property functions not supported"))}else if(isZoomFunction&&!options.valueSpec["zoom-function"]){errors.push(new ValidationError(options.key,options.value,"zoom functions not supported"))}}if((functionType==="categorical"||isZoomAndPropertyFunction)&&options.value.property===undefined){errors.push(new ValidationError(options.key,options.value,'"property" property is required'))}return errors;function validateFunctionStops(options){if(functionType==="identity"){return[new ValidationError(options.key,options.value,'identity function may not have a "stops" property')]}var errors=[];var value=options.value;errors=errors.concat(validateArray({key:options.key,value:value,valueSpec:options.valueSpec,style:options.style,styleSpec:options.styleSpec,arrayElementValidator:validateFunctionStop}));if(getType(value)==="array"&&value.length===0){errors.push(new ValidationError(options.key,value,"array must have at least one stop"))}return errors}function validateFunctionStop(options){var errors=[];var value=options.value;var key=options.key;if(getType(value)!=="array"){return[new ValidationError(key,value,"array expected, %s found",getType(value))]}if(value.length!==2){return[new ValidationError(key,value,"array length %d expected, length %d found",2,value.length)]}if(isZoomAndPropertyFunction){if(getType(value[0])!=="object"){return[new ValidationError(key,value,"object expected, %s found",getType(value[0]))]}if(value[0].zoom===undefined){return[new ValidationError(key,value,"object stop key must have zoom")]}if(value[0].value===undefined){return[new ValidationError(key,value,"object stop key must have value")]}if(previousStopDomainZoom&&previousStopDomainZoom>unbundle(value[0].zoom)){return[new ValidationError(key,value[0].zoom,"stop zoom values must appear in ascending order")]}if(unbundle(value[0].zoom)!==previousStopDomainZoom){previousStopDomainZoom=unbundle(value[0].zoom);previousStopDomainValue=undefined}errors=errors.concat(validateObject({key:key+"[0]",value:value[0],valueSpec:{zoom:{}},style:options.style,styleSpec:options.styleSpec,objectElementValidators:{zoom:validateNumber,value:validateStopDomainValue}}))}else{errors=errors.concat(validateStopDomainValue({key:key+"[0]",value:value[0],valueSpec:{},style:options.style,styleSpec:options.styleSpec}))}errors=errors.concat(validate({key:key+"[1]",value:value[1],valueSpec:functionValueSpec,style:options.style,styleSpec:options.styleSpec}));if(getType(value[0])==="number"){if(functionValueSpec.function==="piecewise-constant"&&value[0]%1!==0){errors.push(new ValidationError(key+"[0]",value[0],"zoom level for piecewise-constant functions must be an integer"))}}return errors}function validateStopDomainValue(options){var type=getType(options.value);var value=unbundle(options.value);if(!stopKeyType){stopKeyType=type;if(!functionType&&type==="string"){functionType="categorical"}}else if(type!==stopKeyType){return[new ValidationError(options.key,options.value,"%s stop domain type must match previous stop domain type %s",type,stopKeyType)]}if(type!=="number"&&type!=="string"){return[new ValidationError(options.key,options.value,"property value must be a number or string")]}if(type!=="number"&&functionType!=="categorical"){return[new ValidationError(options.key,options.value,"number expected, %s found",type)]}if(functionType==="categorical"&&type==="number"&&(!isFinite(value)||Math.floor(value)!==value)){return[new ValidationError(options.key,options.value,"integer expected, found %s",value)]}if(type==="number"&&previousStopDomainValue!==undefined&&value<previousStopDomainValue){return[new ValidationError(options.key,options.value,"stop domain values must appear in ascending order")]}else{previousStopDomainValue=value}if(functionType==="categorical"&&value in stopDomainValues){return[new ValidationError(options.key,options.value,"stop domain values must be unique")]}else{stopDomainValues[value]=true}return[]}}},{"../error/validation_error":57,"../util/get_type":60,"../util/unbundle_jsonlint":62,"./validate":63,"./validate_array":64,"./validate_number":75,"./validate_object":76}],71:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var validateString=require("./validate_string");module.exports=function(options){var value=options.value;var key=options.key;var errors=validateString(options);if(errors.length)return errors;if(value.indexOf("{fontstack}")===-1){errors.push(new ValidationError(key,value,'"glyphs" url must include a "{fontstack}" token'))}if(value.indexOf("{range}")===-1){errors.push(new ValidationError(key,value,'"glyphs" url must include a "{range}" token'))}return errors}},{"../error/validation_error":57,"./validate_string":79}],72:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var unbundle=require("../util/unbundle_jsonlint");var validateObject=require("./validate_object");var validateFilter=require("./validate_filter");var validatePaintProperty=require("./validate_paint_property");var validateLayoutProperty=require("./validate_layout_property");var extend=require("../util/extend");module.exports=function validateLayer(options){var errors=[];var layer=options.value;var key=options.key;var style=options.style;var styleSpec=options.styleSpec;if(!layer.type&&!layer.ref){errors.push(new ValidationError(key,layer,'either "type" or "ref" is required'))}var type=unbundle(layer.type);var ref=unbundle(layer.ref);if(layer.id){for(var i=0;i<options.arrayIndex;i++){var otherLayer=style.layers[i];if(unbundle(otherLayer.id)===unbundle(layer.id)){errors.push(new ValidationError(key,layer.id,'duplicate layer id "%s", previously used at line %d',layer.id,otherLayer.id.__line__))}}}if("ref"in layer){["type","source","source-layer","filter","layout"].forEach(function(p){if(p in layer){errors.push(new ValidationError(key,layer[p],'"%s" is prohibited for ref layers',p))}});var parent;style.layers.forEach(function(layer){if(layer.id==ref)parent=layer});if(!parent){errors.push(new ValidationError(key,layer.ref,'ref layer "%s" not found',ref))}else if(parent.ref){errors.push(new ValidationError(key,layer.ref,"ref cannot reference another ref layer"))}else{type=unbundle(parent.type)}}else if(type!=="background"){if(!layer.source){errors.push(new ValidationError(key,layer,'missing required property "source"'))}else{var source=style.sources&&style.sources[layer.source];if(!source){errors.push(new ValidationError(key,layer.source,'source "%s" not found',layer.source))}else if(source.type=="vector"&&type=="raster"){errors.push(new ValidationError(key,layer.source,'layer "%s" requires a raster source',layer.id))}else if(source.type=="raster"&&type!="raster"){errors.push(new ValidationError(key,layer.source,'layer "%s" requires a vector source',layer.id))}else if(source.type=="vector"&&!layer["source-layer"]){errors.push(new ValidationError(key,layer,'layer "%s" must specify a "source-layer"',layer.id))}}}errors=errors.concat(validateObject({key:key,value:layer,valueSpec:styleSpec.layer,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{"*":function(){return[]},filter:validateFilter,layout:function(options){return validateObject({layer:layer,key:options.key,value:options.value,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{"*":function(options){return validateLayoutProperty(extend({layerType:type},options))}}})},paint:function(options){return validateObject({layer:layer,key:options.key,value:options.value,style:options.style,styleSpec:options.styleSpec,objectElementValidators:{"*":function(options){return validatePaintProperty(extend({layerType:type},options))}}})}}}));return errors}},{"../error/validation_error":57,"../util/extend":59,"../util/unbundle_jsonlint":62,"./validate_filter":69,"./validate_layout_property":73,"./validate_object":76,"./validate_paint_property":77}],73:[function(require,module,exports){"use strict";var validate=require("./validate");var ValidationError=require("../error/validation_error");module.exports=function validateLayoutProperty(options){var key=options.key;var style=options.style;var styleSpec=options.styleSpec;var value=options.value;var propertyKey=options.objectKey;var layerSpec=styleSpec["layout_"+options.layerType];if(!layerSpec)return[];if(options.valueSpec||layerSpec[propertyKey]){var errors=[];if(options.layerType==="symbol"){if(propertyKey==="icon-image"&&style&&!style.sprite){errors.push(new ValidationError(key,value,'use of "icon-image" requires a style "sprite" property'))}else if(propertyKey==="text-field"&&style&&!style.glyphs){errors.push(new ValidationError(key,value,'use of "text-field" requires a style "glyphs" property'))}}return errors.concat(validate({key:options.key,value:value,valueSpec:options.valueSpec||layerSpec[propertyKey],style:style,styleSpec:styleSpec}))}else{return[new ValidationError(key,value,'unknown property "%s"',propertyKey)]}}},{"../error/validation_error":57,"./validate":63}],74:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var validate=require("./validate");module.exports=function validateLight(options){var light=options.value;var styleSpec=options.styleSpec;var lightSpec=styleSpec.light;var style=options.style;var errors=[];var rootType=getType(light);if(light===undefined){return errors}else if(rootType!=="object"){errors=errors.concat([new ValidationError("light",light,"object expected, %s found",rootType)]);return errors}for(var key in light){var transitionMatch=key.match(/^(.*)-transition$/);if(transitionMatch&&lightSpec[transitionMatch[1]]&&lightSpec[transitionMatch[1]].transition){errors=errors.concat(validate({key:key,value:light[key],valueSpec:styleSpec.transition,style:style,styleSpec:styleSpec}))}else if(lightSpec[key]){errors=errors.concat(validate({key:key,value:light[key],valueSpec:lightSpec[key],style:style,styleSpec:styleSpec}))}else{errors=errors.concat([new ValidationError(key,light[key],'unknown property "%s"',key)])}}return errors}},{"../error/validation_error":57,"../util/get_type":60,"./validate":63}],75:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var ValidationError=require("../error/validation_error");module.exports=function validateNumber(options){var key=options.key;var value=options.value;var valueSpec=options.valueSpec;var type=getType(value);if(type!=="number"){return[new ValidationError(key,value,"number expected, %s found",type)]}if("minimum"in valueSpec&&value<valueSpec.minimum){return[new ValidationError(key,value,"%s is less than the minimum value %s",value,valueSpec.minimum)]}if("maximum"in valueSpec&&value>valueSpec.maximum){return[new ValidationError(key,value,"%s is greater than the maximum value %s",value,valueSpec.maximum)]}return[]}},{"../error/validation_error":57,"../util/get_type":60}],76:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var getType=require("../util/get_type");var validateSpec=require("./validate");module.exports=function validateObject(options){var key=options.key;var object=options.value;var elementSpecs=options.valueSpec||{};var elementValidators=options.objectElementValidators||{};var style=options.style;var styleSpec=options.styleSpec;var errors=[];var type=getType(object);if(type!=="object"){return[new ValidationError(key,object,"object expected, %s found",type)]}for(var objectKey in object){var elementSpecKey=objectKey.split(".")[0];var elementSpec=elementSpecs[elementSpecKey]||elementSpecs["*"];var validateElement;if(elementValidators[elementSpecKey]){validateElement=elementValidators[elementSpecKey]}else if(elementSpecs[elementSpecKey]){validateElement=validateSpec}else if(elementValidators["*"]){validateElement=elementValidators["*"]}else if(elementSpecs["*"]){validateElement=validateSpec}else{errors.push(new ValidationError(key,object[objectKey],'unknown property "%s"',objectKey));continue}errors=errors.concat(validateElement({key:(key?key+".":key)+objectKey,value:object[objectKey],valueSpec:elementSpec,style:style,styleSpec:styleSpec,object:object,objectKey:objectKey}))}for(elementSpecKey in elementSpecs){if(elementSpecs[elementSpecKey].required&&elementSpecs[elementSpecKey]["default"]===undefined&&object[elementSpecKey]===undefined){errors.push(new ValidationError(key,object,'missing required property "%s"',elementSpecKey))}}return errors}},{"../error/validation_error":57,"../util/get_type":60,"./validate":63}],77:[function(require,module,exports){"use strict";var validate=require("./validate");var ValidationError=require("../error/validation_error");module.exports=function validatePaintProperty(options){var key=options.key;var style=options.style;var styleSpec=options.styleSpec;var value=options.value;var propertyKey=options.objectKey;var layerSpec=styleSpec["paint_"+options.layerType];if(!layerSpec)return[];var transitionMatch=propertyKey.match(/^(.*)-transition$/);if(transitionMatch&&layerSpec[transitionMatch[1]]&&layerSpec[transitionMatch[1]].transition){return validate({key:key,value:value,valueSpec:styleSpec.transition,style:style,styleSpec:styleSpec})}else if(options.valueSpec||layerSpec[propertyKey]){return validate({key:options.key,value:value,valueSpec:options.valueSpec||layerSpec[propertyKey],style:style,styleSpec:styleSpec})}else{return[new ValidationError(key,value,'unknown property "%s"',propertyKey)]}}},{"../error/validation_error":57,"./validate":63}],78:[function(require,module,exports){"use strict";var ValidationError=require("../error/validation_error");var unbundle=require("../util/unbundle_jsonlint");var validateObject=require("./validate_object");var validateEnum=require("./validate_enum");module.exports=function validateSource(options){var value=options.value;var key=options.key;var styleSpec=options.styleSpec;var style=options.style;if(!value.type){return[new ValidationError(key,value,'"type" is required')]}var type=unbundle(value.type);switch(type){case"vector":case"raster":var errors=[];errors=errors.concat(validateObject({key:key,value:value,valueSpec:styleSpec.source_tile,style:options.style,styleSpec:styleSpec}));if("url"in value){for(var prop in value){if(["type","url","tileSize"].indexOf(prop)<0){errors.push(new ValidationError(key+"."+prop,value[prop],'a source with a "url" property may not include a "%s" property',prop))}}}return errors;case"geojson":return validateObject({key:key,value:value,valueSpec:styleSpec.source_geojson,style:style,styleSpec:styleSpec});case"video":return validateObject({key:key,value:value,valueSpec:styleSpec.source_video,style:style,styleSpec:styleSpec});case"image":return validateObject({key:key,value:value,valueSpec:styleSpec.source_image,style:style,styleSpec:styleSpec});case"canvas":return validateObject({key:key,value:value,valueSpec:styleSpec.source_canvas,style:style,styleSpec:styleSpec});default:return validateEnum({key:key+".type",value:value.type,valueSpec:{values:["vector","raster","geojson","video","image","canvas"]},style:style,styleSpec:styleSpec})}}},{"../error/validation_error":57,"../util/unbundle_jsonlint":62,"./validate_enum":68,"./validate_object":76}],79:[function(require,module,exports){"use strict";var getType=require("../util/get_type");var ValidationError=require("../error/validation_error");module.exports=function validateString(options){var value=options.value;var key=options.key;var type=getType(value);if(type!=="string"){return[new ValidationError(key,value,"string expected, %s found",type)]}return[]}},{"../error/validation_error":57,"../util/get_type":60}],80:[function(require,module,exports){"use strict";var validateConstants=require("./validate/validate_constants");var validate=require("./validate/validate");var latestStyleSpec=require("../reference/latest.min");var validateGlyphsURL=require("./validate/validate_glyphs_url");function validateStyleMin(style,styleSpec){styleSpec=styleSpec||latestStyleSpec;var errors=[];errors=errors.concat(validate({key:"",value:style,valueSpec:styleSpec.$root,styleSpec:styleSpec,style:style,objectElementValidators:{glyphs:validateGlyphsURL,"*":function(){return[]}}}));if(styleSpec.$version>7&&style.constants){errors=errors.concat(validateConstants({key:"constants",value:style.constants,style:style,styleSpec:styleSpec}))}return sortErrors(errors)}validateStyleMin.source=wrapCleanErrors(require("./validate/validate_source"));validateStyleMin.light=wrapCleanErrors(require("./validate/validate_light"));validateStyleMin.layer=wrapCleanErrors(require("./validate/validate_layer"));validateStyleMin.filter=wrapCleanErrors(require("./validate/validate_filter"));validateStyleMin.paintProperty=wrapCleanErrors(require("./validate/validate_paint_property"));validateStyleMin.layoutProperty=wrapCleanErrors(require("./validate/validate_layout_property"));function sortErrors(errors){return[].concat(errors).sort(function(a,b){return a.line-b.line})}function wrapCleanErrors(inner){return function(){return sortErrors(inner.apply(this,arguments))}}module.exports=validateStyleMin},{"../reference/latest.min":81,"./validate/validate":63,"./validate/validate_constants":67,"./validate/validate_filter":69,"./validate/validate_glyphs_url":71,"./validate/validate_layer":72,"./validate/validate_layout_property":73,"./validate/validate_light":74,"./validate/validate_paint_property":77,"./validate/validate_source":78}],81:[function(require,module,exports){module.exports=require("./v8.min.json")},{"./v8.min.json":82}],82:[function(require,module,exports){module.exports={$version:8,$root:{version:{required:true,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number","default":0,period:360,units:"degrees"},pitch:{type:"number","default":0,units:"degrees"},light:{type:"light"},sources:{required:true,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:true,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image","source_canvas"],source_tile:{type:{required:true,type:"enum",values:{vector:{},raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number","default":0},maxzoom:{type:"number","default":22},tileSize:{type:"number","default":512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:true,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number","default":18},buffer:{type:"number","default":128,maximum:512,minimum:0},tolerance:{type:"number","default":.375},cluster:{type:"boolean","default":false},clusterRadius:{type:"number","default":50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:true,type:"enum",values:{video:{}}},urls:{required:true,type:"array",value:"string"},coordinates:{required:true,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:true,type:"enum",values:{image:{}}},url:{required:true,type:"string"},coordinates:{required:true,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_canvas:{type:{required:true,type:"enum",values:{canvas:{}}},coordinates:{required:true,type:"array",length:4,value:{type:"array",length:2,value:"number"}},animate:{type:"boolean","default":"true"},canvas:{type:"string",required:true}},layer:{id:{type:"string",required:true},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},"fill-extrusion":{},raster:{},background:{}}},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_fill-extrusion","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},"default":"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},"default":"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},"default":"visible"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},"default":"visible"}},layout_line:{"line-cap":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{butt:{},round:{},square:{}},"default":"butt"},"line-join":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{bevel:{},round:{},miter:{}},"default":"miter"},"line-miter-limit":{type:"number","default":2,"function":"interpolated","zoom-function":true,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number","default":1.05,"function":"interpolated","zoom-function":true,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},"default":"visible"}},layout_symbol:{"symbol-placement":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{point:{},line:{}},"default":"point"},"symbol-spacing":{type:"number","default":250,minimum:1,"function":"interpolated","zoom-function":true,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"icon-allow-overlap":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false,requires:["icon-image"]},"icon-optional":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{},auto:{}},"default":"auto",requires:["icon-image"]},"icon-size":{type:"number","default":1,minimum:0,"function":"interpolated","zoom-function":true,requires:["icon-image"]},"icon-text-fit":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{none:{},width:{},height:{},both:{}},"default":"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,"default":[0,0,0,0],units:"pixels","function":"interpolated","zoom-function":true,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string","function":"piecewise-constant","zoom-function":true,tokens:true},"icon-rotate":{type:"number","default":0,period:360,"function":"interpolated","zoom-function":true,"property-function":true,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number","default":2,minimum:0,"function":"interpolated","zoom-function":true,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,requires:["icon-image"]},"text-pitch-alignment":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{},auto:{}},"default":"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{},auto:{}},"default":"auto",requires:["text-field"]},"text-field":{type:"string","function":"piecewise-constant","zoom-function":true,"default":"",tokens:true},"text-font":{type:"array",value:"string","function":"piecewise-constant","zoom-function":true,"default":["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number","default":16,minimum:0,units:"pixels","function":"interpolated","zoom-function":true,requires:["text-field"]},"text-max-width":{type:"number","default":10,minimum:0,units:"ems","function":"interpolated","zoom-function":true,requires:["text-field"]},"text-line-height":{type:"number","default":1.2,units:"ems","function":"interpolated","zoom-function":true,requires:["text-field"]},"text-letter-spacing":{type:"number","default":0,units:"ems","function":"interpolated","zoom-function":true,requires:["text-field"]},"text-justify":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{left:{},center:{},right:{}},"default":"center",requires:["text-field"]},"text-anchor":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center",requires:["text-field"]},"text-max-angle":{type:"number","default":45,units:"degrees","function":"interpolated","zoom-function":true,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number","default":0,period:360,units:"degrees","function":"interpolated","zoom-function":true,requires:["text-field"]},"text-padding":{type:"number","default":2,minimum:0,units:"pixels","function":"interpolated","zoom-function":true,requires:["text-field"]},"text-keep-upright":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":true,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{none:{},uppercase:{},lowercase:{}},"default":"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems","function":"interpolated","zoom-function":true,length:2,"default":[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false,requires:["text-field"]},"text-ignore-placement":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false,requires:["text-field"]},"text-optional":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":false,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},"default":"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},"default":"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},"function":{stops:{type:"array",value:"function_stop"},base:{type:"number","default":1,minimum:0},property:{type:"string","default":"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},"default":"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},"default":"rgb"}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},light:{anchor:{
type:"enum","default":"viewport",values:{map:{},viewport:{}},transition:false},position:{type:"array","default":[1.15,210,30],length:3,value:"number",transition:true,"function":"interpolated","zoom-function":true,"property-function":false},color:{type:"color","default":"#ffffff","function":"interpolated","zoom-function":true,"property-function":false,transition:true},intensity:{type:"number","default":.5,minimum:0,maximum:1,"function":"interpolated","zoom-function":true,"property-function":false,transition:true}},paint:["paint_fill","paint_line","paint_circle","paint_fill-extrusion","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean","function":"piecewise-constant","zoom-function":true,"default":true},"fill-opacity":{type:"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,minimum:0,maximum:1,transition:true},"fill-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color","function":"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"fill-pattern"},{"fill-antialias":true}]},"fill-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":true,transition:true,units:"pixels"},"fill-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{}},"default":"map",requires:["fill-translate"]},"fill-pattern":{type:"string","function":"piecewise-constant","zoom-function":true,transition:true}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,minimum:0,maximum:1,transition:true},"fill-extrusion-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":true,transition:true,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{}},"default":"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string","function":"piecewise-constant","zoom-function":true,transition:true},"fill-extrusion-height":{type:"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,minimum:0,units:"meters",transition:true},"fill-extrusion-base":{type:"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,minimum:0,units:"meters",transition:true,requires:["fill-extrusion-height"]}},paint_line:{"line-opacity":{type:"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,minimum:0,maximum:1,transition:true},"line-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,transition:true,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":true,transition:true,units:"pixels"},"line-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{}},"default":"map",requires:["line-translate"]},"line-width":{type:"number","default":1,minimum:0,"function":"interpolated","zoom-function":true,transition:true,units:"pixels"},"line-gap-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-offset":{type:"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-blur":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"line-dasharray":{type:"array",value:"number","function":"piecewise-constant","zoom-function":true,minimum:0,transition:true,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string","function":"piecewise-constant","zoom-function":true,transition:true}},paint_circle:{"circle-radius":{type:"number","default":5,minimum:0,"function":"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"circle-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-blur":{type:"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":true,transition:true,units:"pixels"},"circle-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{}},"default":"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{}},"default":"map"},"circle-stroke-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":true,"property-function":true,transition:true,units:"pixels"},"circle-stroke-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,transition:true},"circle-stroke-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":true,"property-function":true,transition:true}},paint_symbol:{"icon-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":true,transition:true,requires:["icon-image"]},"icon-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,transition:true,requires:["icon-image"]},"icon-halo-color":{type:"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,transition:true,requires:["icon-image"]},"icon-halo-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":true,transition:true,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":true,transition:true,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":true,transition:true,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{}},"default":"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":true,transition:true,requires:["text-field"]},"text-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,transition:true,requires:["text-field"]},"text-halo-color":{type:"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,transition:true,requires:["text-field"]},"text-halo-width":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":true,transition:true,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number","default":0,minimum:0,"function":"interpolated","zoom-function":true,transition:true,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":"interpolated","zoom-function":true,transition:true,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum","function":"piecewise-constant","zoom-function":true,values:{map:{},viewport:{}},"default":"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":true,transition:true},"raster-hue-rotate":{type:"number","default":0,period:360,"function":"interpolated","zoom-function":true,transition:true,units:"degrees"},"raster-brightness-min":{type:"number","function":"interpolated","zoom-function":true,"default":0,minimum:0,maximum:1,transition:true},"raster-brightness-max":{type:"number","function":"interpolated","zoom-function":true,"default":1,minimum:0,maximum:1,transition:true},"raster-saturation":{type:"number","default":0,minimum:-1,maximum:1,"function":"interpolated","zoom-function":true,transition:true},"raster-contrast":{type:"number","default":0,minimum:-1,maximum:1,"function":"interpolated","zoom-function":true,transition:true},"raster-fade-duration":{type:"number","default":300,minimum:0,"function":"interpolated","zoom-function":true,transition:true,units:"milliseconds"}},paint_background:{"background-color":{type:"color","default":"#000000","function":"interpolated","zoom-function":true,transition:true,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string","function":"piecewise-constant","zoom-function":true,transition:true},"background-opacity":{type:"number","default":1,minimum:0,maximum:1,"function":"interpolated","zoom-function":true,transition:true}},transition:{duration:{type:"number","default":300,minimum:0,units:"milliseconds"},delay:{type:"number","default":0,minimum:0,units:"milliseconds"}}}},{}],83:[function(require,module,exports){"use strict";if(typeof module!=="undefined"&&module.exports){module.exports=isSupported}else if(window){window.mapboxgl=window.mapboxgl||{};window.mapboxgl.supported=isSupported}function isSupported(options){return!!(isBrowser()&&isArraySupported()&&isFunctionSupported()&&isObjectSupported()&&isJSONSupported()&&isWorkerSupported()&&isUint8ClampedArraySupported()&&isWebGLSupportedCached(options&&options.failIfMajorPerformanceCaveat))}function isBrowser(){return typeof window!=="undefined"&&typeof document!=="undefined"}function isArraySupported(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function isFunctionSupported(){return Function.prototype&&Function.prototype.bind}function isObjectSupported(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function isJSONSupported(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function isWorkerSupported(){return"Worker"in window}function isUint8ClampedArraySupported(){return"Uint8ClampedArray"in window}var isWebGLSupportedCache={};function isWebGLSupportedCached(failIfMajorPerformanceCaveat){if(isWebGLSupportedCache[failIfMajorPerformanceCaveat]===undefined){isWebGLSupportedCache[failIfMajorPerformanceCaveat]=isWebGLSupported(failIfMajorPerformanceCaveat)}return isWebGLSupportedCache[failIfMajorPerformanceCaveat]}isSupported.webGLContextAttributes={antialias:false,alpha:true,stencil:true,depth:true};function isWebGLSupported(failIfMajorPerformanceCaveat){var canvas=document.createElement("canvas");var attributes=Object.create(isSupported.webGLContextAttributes);attributes.failIfMajorPerformanceCaveat=failIfMajorPerformanceCaveat;if(canvas.probablySupportsContext){return canvas.probablySupportsContext("webgl",attributes)||canvas.probablySupportsContext("experimental-webgl",attributes)}else if(canvas.supportsContext){return canvas.supportsContext("webgl",attributes)||canvas.supportsContext("experimental-webgl",attributes)}else{return canvas.getContext("webgl",attributes)||canvas.getContext("experimental-webgl",attributes)}}},{}],84:[function(require,module,exports){"use strict";var ProgramConfiguration=require("./program_configuration");var Segment=function Segment(vertexOffset,primitiveOffset){this.vertexOffset=vertexOffset;this.primitiveOffset=primitiveOffset;this.vertexLength=0;this.primitiveLength=0};var ArrayGroup=function ArrayGroup(programInterface,layers,zoom){var this$1=this;this.globalProperties={zoom:zoom};var LayoutVertexArrayType=programInterface.layoutVertexArrayType;this.layoutVertexArray=new LayoutVertexArrayType;var ElementArrayType=programInterface.elementArrayType;if(ElementArrayType)this.elementArray=new ElementArrayType;var ElementArrayType2=programInterface.elementArrayType2;if(ElementArrayType2)this.elementArray2=new ElementArrayType2;this.layerData={};for(var i=0,list=layers;i<list.length;i+=1){var layer=list[i];var programConfiguration=ProgramConfiguration.createDynamic(programInterface.paintAttributes||[],layer,zoom);this$1.layerData[layer.id]={layer:layer,programConfiguration:programConfiguration,paintVertexArray:new programConfiguration.PaintVertexArray}}this.segments=[];this.segments2=[]};ArrayGroup.prototype.prepareSegment=function prepareSegment(numVertices){var segment=this.segments[this.segments.length-1];if(!segment||segment.vertexLength+numVertices>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH){segment=new Segment(this.layoutVertexArray.length,this.elementArray.length);this.segments.push(segment)}return segment};ArrayGroup.prototype.prepareSegment2=function prepareSegment2(numVertices){var segment=this.segments2[this.segments2.length-1];if(!segment||segment.vertexLength+numVertices>ArrayGroup.MAX_VERTEX_ARRAY_LENGTH){segment=new Segment(this.layoutVertexArray.length,this.elementArray2.length);this.segments2.push(segment)}return segment};ArrayGroup.prototype.populatePaintArrays=function populatePaintArrays(featureProperties){var this$1=this;for(var key in this.layerData){var layerData=this$1.layerData[key];if(layerData.paintVertexArray.bytesPerElement===0)continue;layerData.programConfiguration.populatePaintArray(layerData.layer,layerData.paintVertexArray,this$1.layoutVertexArray.length,this$1.globalProperties,featureProperties)}};ArrayGroup.prototype.isEmpty=function isEmpty(){return this.layoutVertexArray.length===0};ArrayGroup.prototype.serialize=function serialize(transferables){return{layoutVertexArray:this.layoutVertexArray.serialize(transferables),elementArray:this.elementArray&&this.elementArray.serialize(transferables),elementArray2:this.elementArray2&&this.elementArray2.serialize(transferables),paintVertexArrays:serializePaintVertexArrays(this.layerData,transferables),segments:this.segments,segments2:this.segments2}};function serializePaintVertexArrays(layerData,transferables){var paintVertexArrays={};for(var layerId in layerData){var inputArray=layerData[layerId].paintVertexArray;if(inputArray.length===0)continue;var array=inputArray.serialize(transferables);var type=inputArray.constructor.serialize();paintVertexArrays[layerId]={array:array,type:type}}return paintVertexArrays}ArrayGroup.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1;module.exports=ArrayGroup},{"./program_configuration":98}],85:[function(require,module,exports){"use strict";var ArrayGroup=require("./array_group");var BufferGroup=require("./buffer_group");var util=require("../util/util");var Bucket=function Bucket(options,programInterface){this.zoom=options.zoom;this.overscaling=options.overscaling;this.layers=options.layers;this.index=options.index;if(options.arrays){this.buffers=new BufferGroup(programInterface,options.layers,options.zoom,options.arrays)}else{this.arrays=new ArrayGroup(programInterface,options.layers,options.zoom)}};Bucket.prototype.populate=function populate(features,options){var this$1=this;for(var i=0,list=features;i<list.length;i+=1){var feature=list[i];if(this$1.layers[0].filter(feature)){this$1.addFeature(feature);options.featureIndex.insert(feature,this$1.index)}}};Bucket.prototype.isEmpty=function isEmpty(){return this.arrays.isEmpty()};Bucket.prototype.serialize=function serialize(transferables){return{zoom:this.zoom,layerIds:this.layers.map(function(l){return l.id}),arrays:this.arrays.serialize(transferables)}};Bucket.prototype.destroy=function destroy(){if(this.buffers){this.buffers.destroy();this.buffers=null}};module.exports=Bucket;Bucket.deserialize=function(input,style){if(!style)return;var output={};for(var i=0,list=input;i<list.length;i+=1){var serialized=list[i];var layers=serialized.layerIds.map(function(id){return style.getLayer(id)}).filter(Boolean);if(layers.length===0){continue}var bucket=layers[0].createBucket(util.extend({layers:layers},serialized));for(var i$1=0,list$1=layers;i$1<list$1.length;i$1+=1){var layer=list$1[i$1];output[layer.id]=bucket}}return output}},{"../util/util":212,"./array_group":84,"./buffer_group":92}],86:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var EXTENT=require("../extent");var circleInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:createElementArrayType(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]};function addCircleVertex(layoutVertexArray,x,y,extrudeX,extrudeY){layoutVertexArray.emplaceBack(x*2+(extrudeX+1)/2,y*2+(extrudeY+1)/2)}var CircleBucket=function(Bucket){function CircleBucket(options){Bucket.call(this,options,circleInterface)}if(Bucket)CircleBucket.__proto__=Bucket;CircleBucket.prototype=Object.create(Bucket&&Bucket.prototype);CircleBucket.prototype.constructor=CircleBucket;CircleBucket.prototype.addFeature=function addFeature(feature){var arrays=this.arrays;for(var i=0,list=loadGeometry(feature);i<list.length;i+=1){var ring=list[i];for(var i$1=0,list$1=ring;i$1<list$1.length;i$1+=1){var point=list$1[i$1];var x=point.x;var y=point.y;if(x<0||x>=EXTENT||y<0||y>=EXTENT)continue;var segment=arrays.prepareSegment(4);var index=segment.vertexLength;addCircleVertex(arrays.layoutVertexArray,x,y,-1,-1);addCircleVertex(arrays.layoutVertexArray,x,y,1,-1);addCircleVertex(arrays.layoutVertexArray,x,y,1,1);addCircleVertex(arrays.layoutVertexArray,x,y,-1,1);arrays.elementArray.emplaceBack(index,index+1,index+2);arrays.elementArray.emplaceBack(index,index+3,index+2);segment.vertexLength+=4;segment.primitiveLength+=2}}arrays.populatePaintArrays(feature.properties)};return CircleBucket}(Bucket);module.exports=CircleBucket},{"../bucket":85,"../element_array_type":93,"../extent":94,"../load_geometry":96,"../vertex_array_type":100}],87:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var earcut=require("earcut");var classifyRings=require("../../util/classify_rings");var EARCUT_MAX_RINGS=500;var fillInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:createElementArrayType(3),elementArrayType2:createElementArrayType(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]};var FillBucket=function(Bucket){function FillBucket(options){Bucket.call(this,options,fillInterface)}if(Bucket)FillBucket.__proto__=Bucket;FillBucket.prototype=Object.create(Bucket&&Bucket.prototype);FillBucket.prototype.constructor=FillBucket;FillBucket.prototype.addFeature=function addFeature(feature){var arrays=this.arrays;for(var i$2=0,list=classifyRings(loadGeometry(feature),EARCUT_MAX_RINGS);i$2<list.length;i$2+=1){var polygon=list[i$2];var numVertices=0;for(var i$3=0,list$1=polygon;i$3<list$1.length;i$3+=1){var ring=list$1[i$3];numVertices+=ring.length}var triangleSegment=arrays.prepareSegment(numVertices);var triangleIndex=triangleSegment.vertexLength;var flattened=[];var holeIndices=[];for(var i$4=0,list$2=polygon;i$4<list$2.length;i$4+=1){var ring$1=list$2[i$4];if(ring$1.length===0){continue}if(ring$1!==polygon[0]){holeIndices.push(flattened.length/2)}var lineSegment=arrays.prepareSegment2(ring$1.length);var lineIndex=lineSegment.vertexLength;arrays.layoutVertexArray.emplaceBack(ring$1[0].x,ring$1[0].y);arrays.elementArray2.emplaceBack(lineIndex+ring$1.length-1,lineIndex);flattened.push(ring$1[0].x);flattened.push(ring$1[0].y);for(var i=1;i<ring$1.length;i++){arrays.layoutVertexArray.emplaceBack(ring$1[i].x,ring$1[i].y);arrays.elementArray2.emplaceBack(lineIndex+i-1,lineIndex+i);flattened.push(ring$1[i].x);flattened.push(ring$1[i].y)}lineSegment.vertexLength+=ring$1.length;lineSegment.primitiveLength+=ring$1.length}var indices=earcut(flattened,holeIndices);for(var i$1=0;i$1<indices.length;i$1+=3){arrays.elementArray.emplaceBack(triangleIndex+indices[i$1],triangleIndex+indices[i$1+1],triangleIndex+indices[i$1+2])}triangleSegment.vertexLength+=numVertices;triangleSegment.primitiveLength+=indices.length/3}arrays.populatePaintArrays(feature.properties)};return FillBucket}(Bucket);module.exports=FillBucket},{"../../util/classify_rings":196,"../bucket":85,"../element_array_type":93,"../load_geometry":96,"../vertex_array_type":100,earcut:19}],88:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var EXTENT=require("../extent");var earcut=require("earcut");var classifyRings=require("../../util/classify_rings");var EARCUT_MAX_RINGS=500;var fillExtrusionInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:createElementArrayType(3),paintAttributes:[{property:"fill-extrusion-base",type:"Uint16"},{property:"fill-extrusion-height",type:"Uint16"},{property:"fill-extrusion-color",type:"Uint8"}]};var FACTOR=Math.pow(2,13);function addVertex(vertexArray,x,y,nx,ny,nz,t,e){vertexArray.emplaceBack(x,y,Math.floor(nx*FACTOR)*2+t,ny*FACTOR*2,nz*FACTOR*2,Math.round(e))}var FillExtrusionBucket=function(Bucket){function FillExtrusionBucket(options){Bucket.call(this,options,fillExtrusionInterface)}if(Bucket)FillExtrusionBucket.__proto__=Bucket;FillExtrusionBucket.prototype=Object.create(Bucket&&Bucket.prototype);FillExtrusionBucket.prototype.constructor=FillExtrusionBucket;FillExtrusionBucket.prototype.addFeature=function addFeature(feature){var arrays=this.arrays;for(var i=0,list=classifyRings(loadGeometry(feature),EARCUT_MAX_RINGS);i<list.length;i+=1){var polygon=list[i];var numVertices=0;for(var i$1=0,list$1=polygon;i$1<list$1.length;i$1+=1){var ring=list$1[i$1];numVertices+=ring.length}var segment=arrays.prepareSegment(numVertices*5);var flattened=[];var holeIndices=[];var indices=[];for(var i$2=0,list$2=polygon;i$2<list$2.length;i$2+=1){var ring$1=list$2[i$2];if(ring$1.length===0){continue}if(ring$1!==polygon[0]){holeIndices.push(flattened.length/2)}var edgeDistance=0;for(var p=0;p<ring$1.length;p++){var p1=ring$1[p];addVertex(arrays.layoutVertexArray,p1.x,p1.y,0,0,1,1,0);indices.push(segment.vertexLength++);if(p>=1){var p2=ring$1[p-1];if(!isBoundaryEdge(p1,p2)){var perp=p1.sub(p2)._perp()._unit();addVertex(arrays.layoutVertexArray,p1.x,p1.y,perp.x,perp.y,0,0,edgeDistance);addVertex(arrays.layoutVertexArray,p1.x,p1.y,perp.x,perp.y,0,1,edgeDistance);edgeDistance+=p2.dist(p1);addVertex(arrays.layoutVertexArray,p2.x,p2.y,perp.x,perp.y,0,0,edgeDistance);addVertex(arrays.layoutVertexArray,p2.x,p2.y,perp.x,perp.y,0,1,edgeDistance);var bottomRight=segment.vertexLength;arrays.elementArray.emplaceBack(bottomRight,bottomRight+1,bottomRight+2);arrays.elementArray.emplaceBack(bottomRight+1,bottomRight+2,bottomRight+3);segment.vertexLength+=4;segment.primitiveLength+=2}}flattened.push(p1.x);flattened.push(p1.y)}}var triangleIndices=earcut(flattened,holeIndices);for(var j=0;j<triangleIndices.length;j+=3){arrays.elementArray.emplaceBack(indices[triangleIndices[j]],indices[triangleIndices[j+1]],indices[triangleIndices[j+2]])}segment.primitiveLength+=triangleIndices.length/3}arrays.populatePaintArrays(feature.properties)};return FillExtrusionBucket}(Bucket);module.exports=FillExtrusionBucket;function isBoundaryEdge(p1,p2){return p1.x===p2.x&&(p1.x<0||p1.x>EXTENT)||p1.y===p2.y&&(p1.y<0||p1.y>EXTENT)}},{"../../util/classify_rings":196,"../bucket":85,"../element_array_type":93,"../extent":94,"../load_geometry":96,"../vertex_array_type":100,earcut:19}],89:[function(require,module,exports){"use strict";var Bucket=require("../bucket");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var loadGeometry=require("../load_geometry");var EXTENT=require("../extent");var EXTRUDE_SCALE=63;var COS_HALF_SHARP_CORNER=Math.cos(75/2*(Math.PI/180));var SHARP_CORNER_OFFSET=15;var LINE_DISTANCE_BUFFER_BITS=15;var LINE_DISTANCE_SCALE=1/2;var MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE;var lineInterface={layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:createElementArrayType()};function addLineVertex(layoutVertexBuffer,point,extrude,tx,ty,dir,linesofar){layoutVertexBuffer.emplaceBack(point.x<<1|tx,point.y<<1|ty,Math.round(EXTRUDE_SCALE*extrude.x)+128,Math.round(EXTRUDE_SCALE*extrude.y)+128,(dir===0?0:dir<0?-1:1)+1|(linesofar*LINE_DISTANCE_SCALE&63)<<2,linesofar*LINE_DISTANCE_SCALE>>6)}var LineBucket=function(Bucket){function LineBucket(options){Bucket.call(this,options,lineInterface)}if(Bucket)LineBucket.__proto__=Bucket;LineBucket.prototype=Object.create(Bucket&&Bucket.prototype);LineBucket.prototype.constructor=LineBucket;LineBucket.prototype.addFeature=function addFeature(feature){var this$1=this;var layout=this.layers[0].layout;var join=layout["line-join"];var cap=layout["line-cap"];var miterLimit=layout["line-miter-limit"];var roundLimit=layout["line-round-limit"];for(var i=0,list=loadGeometry(feature,LINE_DISTANCE_BUFFER_BITS);i<list.length;i+=1){var line=list[i];this$1.addLine(line,feature.properties,join,cap,miterLimit,roundLimit)}};LineBucket.prototype.addLine=function addLine(vertices,featureProperties,join,cap,miterLimit,roundLimit){var this$1=this;var len=vertices.length;while(len>2&&vertices[len-1].equals(vertices[len-2])){len--}if(vertices.length<2)return;if(join==="bevel")miterLimit=1.05;var sharpCornerOffset=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling));var firstVertex=vertices[0],lastVertex=vertices[len-1],closed=firstVertex.equals(lastVertex);var arrays=this.arrays;var segment=arrays.prepareSegment(len*10);if(len===2&&closed)return;this.distance=0;var beginCap=cap,endCap=closed?"butt":cap;var startOfLine=true;var currentVertex,prevVertex,nextVertex,prevNormal,nextNormal,offsetA,offsetB;this.e1=this.e2=this.e3=-1;if(closed){currentVertex=vertices[len-2];nextNormal=firstVertex.sub(currentVertex)._unit()._perp()}for(var i=0;i<len;i++){nextVertex=closed&&i===len-1?vertices[1]:vertices[i+1];if(nextVertex&&vertices[i].equals(nextVertex))continue;if(nextNormal)prevNormal=nextNormal;if(currentVertex)prevVertex=currentVertex;currentVertex=vertices[i];nextNormal=nextVertex?nextVertex.sub(currentVertex)._unit()._perp():prevNormal;prevNormal=prevNormal||nextNormal;var joinNormal=prevNormal.add(nextNormal);if(joinNormal.x!==0||joinNormal.y!==0){joinNormal._unit()}var cosHalfAngle=joinNormal.x*nextNormal.x+joinNormal.y*nextNormal.y;var miterLength=cosHalfAngle!==0?1/cosHalfAngle:Infinity;var isSharpCorner=cosHalfAngle<COS_HALF_SHARP_CORNER&&prevVertex&&nextVertex;if(isSharpCorner&&i>0){var prevSegmentLength=currentVertex.dist(prevVertex);if(prevSegmentLength>2*sharpCornerOffset){var newPrevVertex=currentVertex.sub(currentVertex.sub(prevVertex)._mult(sharpCornerOffset/prevSegmentLength)._round());this$1.distance+=newPrevVertex.dist(prevVertex);this$1.addCurrentVertex(newPrevVertex,this$1.distance,prevNormal.mult(1),0,0,false,segment);prevVertex=newPrevVertex}}var middleVertex=prevVertex&&nextVertex;var currentJoin=middleVertex?join:nextVertex?beginCap:endCap;if(middleVertex&&currentJoin==="round"){if(miterLength<roundLimit){currentJoin="miter"}else if(miterLength<=2){currentJoin="fakeround"}}if(currentJoin==="miter"&&miterLength>miterLimit){currentJoin="bevel"}if(currentJoin==="bevel"){if(miterLength>2)currentJoin="flipbevel";if(miterLength<miterLimit)currentJoin="miter"}if(prevVertex)this$1.distance+=currentVertex.dist(prevVertex);if(currentJoin==="miter"){joinNormal._mult(miterLength);this$1.addCurrentVertex(currentVertex,this$1.distance,joinNormal,0,0,false,segment)}else if(currentJoin==="flipbevel"){if(miterLength>100){joinNormal=nextNormal.clone().mult(-1)}else{var direction=prevNormal.x*nextNormal.y-prevNormal.y*nextNormal.x>0?-1:1;var bevelLength=miterLength*prevNormal.add(nextNormal).mag()/prevNormal.sub(nextNormal).mag();joinNormal._perp()._mult(bevelLength*direction)}this$1.addCurrentVertex(currentVertex,this$1.distance,joinNormal,0,0,false,segment);this$1.addCurrentVertex(currentVertex,this$1.distance,joinNormal.mult(-1),0,0,false,segment)}else if(currentJoin==="bevel"||currentJoin==="fakeround"){var lineTurnsLeft=prevNormal.x*nextNormal.y-prevNormal.y*nextNormal.x>0;var offset=-Math.sqrt(miterLength*miterLength-1);if(lineTurnsLeft){offsetB=0;offsetA=offset}else{offsetA=0;offsetB=offset}if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,offsetA,offsetB,false,segment)}if(currentJoin==="fakeround"){var n=Math.floor((.5-(cosHalfAngle-.5))*8);var approxFractionalJoinNormal;for(var m=0;m<n;m++){approxFractionalJoinNormal=nextNormal.mult((m+1)/(n+1))._add(prevNormal)._unit();this$1.addPieSliceVertex(currentVertex,this$1.distance,approxFractionalJoinNormal,lineTurnsLeft,segment)}this$1.addPieSliceVertex(currentVertex,this$1.distance,joinNormal,lineTurnsLeft,segment);for(var k=n-1;k>=0;k--){approxFractionalJoinNormal=prevNormal.mult((k+1)/(n+1))._add(nextNormal)._unit();this$1.addPieSliceVertex(currentVertex,this$1.distance,approxFractionalJoinNormal,lineTurnsLeft,segment)}}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,-offsetA,-offsetB,false,segment)}}else if(currentJoin==="butt"){if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,0,0,false,segment)}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,0,0,false,segment)}}else if(currentJoin==="square"){if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,1,1,false,segment);this$1.e1=this$1.e2=-1}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,-1,-1,false,segment)}}else if(currentJoin==="round"){if(!startOfLine){this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,0,0,false,segment);this$1.addCurrentVertex(currentVertex,this$1.distance,prevNormal,1,1,true,segment);this$1.e1=this$1.e2=-1}if(nextVertex){this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,-1,-1,true,segment);

this$1.addCurrentVertex(currentVertex,this$1.distance,nextNormal,0,0,false,segment)}}if(isSharpCorner&&i<len-1){var nextSegmentLength=currentVertex.dist(nextVertex);if(nextSegmentLength>2*sharpCornerOffset){var newCurrentVertex=currentVertex.add(nextVertex.sub(currentVertex)._mult(sharpCornerOffset/nextSegmentLength)._round());this$1.distance+=newCurrentVertex.dist(currentVertex);this$1.addCurrentVertex(newCurrentVertex,this$1.distance,nextNormal.mult(1),0,0,false,segment);currentVertex=newCurrentVertex}}startOfLine=false}arrays.populatePaintArrays(featureProperties)};LineBucket.prototype.addCurrentVertex=function addCurrentVertex(currentVertex,distance,normal,endLeft,endRight,round,segment){var tx=round?1:0;var extrude;var arrays=this.arrays;var layoutVertexArray=arrays.layoutVertexArray;var elementArray=arrays.elementArray;extrude=normal.clone();if(endLeft)extrude._sub(normal.perp()._mult(endLeft));addLineVertex(layoutVertexArray,currentVertex,extrude,tx,0,endLeft,distance);this.e3=segment.vertexLength++;if(this.e1>=0&&this.e2>=0){elementArray.emplaceBack(this.e1,this.e2,this.e3);segment.primitiveLength++}this.e1=this.e2;this.e2=this.e3;extrude=normal.mult(-1);if(endRight)extrude._sub(normal.perp()._mult(endRight));addLineVertex(layoutVertexArray,currentVertex,extrude,tx,1,-endRight,distance);this.e3=segment.vertexLength++;if(this.e1>=0&&this.e2>=0){elementArray.emplaceBack(this.e1,this.e2,this.e3);segment.primitiveLength++}this.e1=this.e2;this.e2=this.e3;if(distance>MAX_LINE_DISTANCE/2){this.distance=0;this.addCurrentVertex(currentVertex,this.distance,normal,endLeft,endRight,round,segment)}};LineBucket.prototype.addPieSliceVertex=function addPieSliceVertex(currentVertex,distance,extrude,lineTurnsLeft,segment){var ty=lineTurnsLeft?1:0;extrude=extrude.mult(lineTurnsLeft?-1:1);var arrays=this.arrays;var layoutVertexArray=arrays.layoutVertexArray;var elementArray=arrays.elementArray;addLineVertex(layoutVertexArray,currentVertex,extrude,0,ty,0,distance);this.e3=segment.vertexLength++;if(this.e1>=0&&this.e2>=0){elementArray.emplaceBack(this.e1,this.e2,this.e3);segment.primitiveLength++}if(lineTurnsLeft){this.e2=this.e3}else{this.e1=this.e3}};return LineBucket}(Bucket);module.exports=LineBucket},{"../bucket":85,"../element_array_type":93,"../extent":94,"../load_geometry":96,"../vertex_array_type":100}],90:[function(require,module,exports){"use strict";var Point=require("point-geometry");var ArrayGroup=require("../array_group");var BufferGroup=require("../buffer_group");var createVertexArrayType=require("../vertex_array_type");var createElementArrayType=require("../element_array_type");var EXTENT=require("../extent");var Anchor=require("../../symbol/anchor");var getAnchors=require("../../symbol/get_anchors");var resolveTokens=require("../../util/token");var Quads=require("../../symbol/quads");var Shaping=require("../../symbol/shaping");var resolveText=require("../../symbol/resolve_text");var mergeLines=require("../../symbol/mergelines");var clipLine=require("../../symbol/clip_line");var util=require("../../util/util");var scriptDetection=require("../../util/script_detection");var loadGeometry=require("../load_geometry");var CollisionFeature=require("../../symbol/collision_feature");var findPoleOfInaccessibility=require("../../util/find_pole_of_inaccessibility");var classifyRings=require("../../util/classify_rings");var VectorTileFeature=require("vector-tile").VectorTileFeature;var rtlTextPlugin=require("../../source/rtl_text_plugin");var shapeText=Shaping.shapeText;var shapeIcon=Shaping.shapeIcon;var WritingMode=Shaping.WritingMode;var getGlyphQuads=Quads.getGlyphQuads;var getIconQuads=Quads.getIconQuads;var elementArrayType=createElementArrayType();var layoutVertexArrayType=createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_offset",components:2,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]);var symbolInterfaces={glyph:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType},icon:{layoutVertexArrayType:layoutVertexArrayType,elementArrayType:elementArrayType},collisionBox:{layoutVertexArrayType:createVertexArrayType([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:createElementArrayType(2)}};function addVertex(array,x,y,ox,oy,tx,ty,minzoom,maxzoom,labelminzoom,labelangle){array.emplaceBack(x,y,Math.round(ox*64),Math.round(oy*64),tx/4,ty/4,(labelminzoom||0)*10,labelangle,(minzoom||0)*10,Math.min(maxzoom||25,25)*10)}function addCollisionBoxVertex(layoutVertexArray,point,extrude,maxZoom,placementZoom){return layoutVertexArray.emplaceBack(point.x,point.y,Math.round(extrude.x),Math.round(extrude.y),maxZoom*10,placementZoom*10)}var SymbolBucket=function SymbolBucket(options){var this$1=this;this.collisionBoxArray=options.collisionBoxArray;this.symbolQuadsArray=options.symbolQuadsArray;this.symbolInstancesArray=options.symbolInstancesArray;this.zoom=options.zoom;this.overscaling=options.overscaling;this.layers=options.layers;this.index=options.index;this.sdfIcons=options.sdfIcons;this.iconsNeedLinear=options.iconsNeedLinear;this.adjustedTextSize=options.adjustedTextSize;this.adjustedIconSize=options.adjustedIconSize;this.fontstack=options.fontstack;if(options.arrays){this.buffers={};for(var id in options.arrays){if(options.arrays[id]){this$1.buffers[id]=new BufferGroup(symbolInterfaces[id],options.layers,options.zoom,options.arrays[id])}}}};SymbolBucket.prototype.populate=function populate(features,options){var this$1=this;var layout=this.layers[0].layout;var textField=layout["text-field"];var textFont=layout["text-font"];var iconImage=layout["icon-image"];var hasText=textField&&textFont;var hasIcon=iconImage;this.features=[];if(!hasText&&!hasIcon){return}var icons=options.iconDependencies;var stacks=options.glyphDependencies;var stack=stacks[textFont]=stacks[textFont]||{};for(var i=0;i<features.length;i++){var feature=features[i];if(!this$1.layers[0].filter(feature)){continue}var text;if(hasText){if(rtlTextPlugin.applyArabicShaping){text=rtlTextPlugin.applyArabicShaping(resolveText(feature,layout))}else{text=resolveText(feature,layout)}}var icon;if(hasIcon){icon=resolveTokens(feature.properties,iconImage)}if(!text&&!icon){continue}this$1.features.push({text:text,icon:icon,index:i,sourceLayerIndex:feature.sourceLayerIndex,geometry:loadGeometry(feature),properties:feature.properties,type:VectorTileFeature.types[feature.type]});if(icon){icons[icon]=true}if(text){for(var i$1=0;i$1<text.length;i$1++){stack[text.charCodeAt(i$1)]=true}}}if(layout["symbol-placement"]==="line"){this.features=mergeLines(this.features)}};SymbolBucket.prototype.isEmpty=function isEmpty(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()};SymbolBucket.prototype.serialize=function serialize(transferables){return{zoom:this.zoom,layerIds:this.layers.map(function(l){return l.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:util.mapObject(this.arrays,function(a){return a.isEmpty()?null:a.serialize(transferables)})}};SymbolBucket.prototype.destroy=function destroy(){if(this.buffers){if(this.buffers.icon)this.buffers.icon.destroy();if(this.buffers.glyph)this.buffers.glyph.destroy();if(this.buffers.collisionBox)this.buffers.collisionBox.destroy();this.buffers=null}};SymbolBucket.prototype.createArrays=function createArrays(){var this$1=this;this.arrays=util.mapObject(symbolInterfaces,function(programInterface){return new ArrayGroup(programInterface,this$1.layers,this$1.zoom)})};SymbolBucket.prototype.prepare=function prepare(stacks,icons){var this$1=this;this.createArrays();this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18});this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1});this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18});this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var tileSize=512*this.overscaling;this.tilePixelRatio=EXTENT/tileSize;this.compareText={};this.iconsNeedLinear=false;this.symbolInstancesStartIndex=this.symbolInstancesArray.length;var layout=this.layers[0].layout;var horizontalAlign=.5,verticalAlign=.5;switch(layout["text-anchor"]){case"right":case"top-right":case"bottom-right":horizontalAlign=1;break;case"left":case"top-left":case"bottom-left":horizontalAlign=0;break}switch(layout["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":verticalAlign=1;break;case"top":case"top-right":case"top-left":verticalAlign=0;break}var justify=layout["text-justify"]==="right"?1:layout["text-justify"]==="left"?0:.5;var oneEm=24;var lineHeight=layout["text-line-height"]*oneEm;var maxWidth=layout["symbol-placement"]!=="line"?layout["text-max-width"]*oneEm:0;var spacing=layout["text-letter-spacing"]*oneEm;var textOffset=[layout["text-offset"][0]*oneEm,layout["text-offset"][1]*oneEm];var fontstack=this.fontstack=layout["text-font"].join(",");var textAlongLine=layout["text-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line";for(var i=0,list=this.features;i<list.length;i+=1){var feature=list[i];var shapedTextOrientations;if(feature.text){var allowsVerticalWritingMode=scriptDetection.allowsVerticalWritingMode(feature.text);shapedTextOrientations={};shapedTextOrientations[WritingMode.horizontal]=shapeText(feature.text,stacks[fontstack],maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,textOffset,oneEm,WritingMode.horizontal);shapedTextOrientations[WritingMode.vertical]=allowsVerticalWritingMode&&textAlongLine&&shapeText(feature.text,stacks[fontstack],maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,textOffset,oneEm,WritingMode.vertical)}else{shapedTextOrientations={}}var shapedIcon;if(feature.icon){var image=icons[feature.icon];var iconOffset=this$1.layers[0].getLayoutValue("icon-offset",{zoom:this$1.zoom},feature.properties);shapedIcon=shapeIcon(image,iconOffset);if(image){if(this$1.sdfIcons===undefined){this$1.sdfIcons=image.sdf}else if(this$1.sdfIcons!==image.sdf){util.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer")}if(image.pixelRatio!==1){this$1.iconsNeedLinear=true}else if(layout["icon-rotate"]!==0||!this$1.layers[0].isLayoutValueFeatureConstant("icon-rotate")){this$1.iconsNeedLinear=true}}}if(shapedTextOrientations[WritingMode.horizontal]||shapedIcon){this$1.addFeature(feature,shapedTextOrientations,shapedIcon)}}this.symbolInstancesEndIndex=this.symbolInstancesArray.length};SymbolBucket.prototype.addFeature=function addFeature(feature,shapedTextOrientations,shapedIcon){var this$1=this;var layout=this.layers[0].layout,glyphSize=24,fontScale=this.adjustedTextSize/glyphSize,textMaxSize=this.adjustedTextMaxSize!==undefined?this.adjustedTextMaxSize:this.adjustedTextSize,textBoxScale=this.tilePixelRatio*fontScale,textMaxBoxScale=this.tilePixelRatio*textMaxSize/glyphSize,iconBoxScale=this.tilePixelRatio*this.adjustedIconSize,symbolMinDistance=this.tilePixelRatio*layout["symbol-spacing"],avoidEdges=layout["symbol-avoid-edges"],textPadding=layout["text-padding"]*this.tilePixelRatio,iconPadding=layout["icon-padding"]*this.tilePixelRatio,textMaxAngle=layout["text-max-angle"]/180*Math.PI,textAlongLine=layout["text-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line",iconAlongLine=layout["icon-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line",mayOverlap=layout["text-allow-overlap"]||layout["icon-allow-overlap"]||layout["text-ignore-placement"]||layout["icon-ignore-placement"],symbolPlacement=layout["symbol-placement"],textRepeatDistance=symbolMinDistance/2;var addSymbolInstance=function(line,anchor){var inside=!(anchor.x<0||anchor.x>EXTENT||anchor.y<0||anchor.y>EXTENT);if(avoidEdges&&!inside)return;var addToBuffers=inside||mayOverlap;this$1.addSymbolInstance(anchor,line,shapedTextOrientations,shapedIcon,this$1.layers[0],addToBuffers,this$1.symbolInstancesArray.length,this$1.collisionBoxArray,feature.index,feature.sourceLayerIndex,this$1.index,textBoxScale,textPadding,textAlongLine,iconBoxScale,iconPadding,iconAlongLine,{zoom:this$1.zoom},feature.properties)};if(symbolPlacement==="line"){for(var i=0,list=clipLine(feature.geometry,0,0,EXTENT,EXTENT);i<list.length;i+=1){var line=list[i];var anchors=getAnchors(line,symbolMinDistance,textMaxAngle,shapedTextOrientations[WritingMode.vertical]||shapedTextOrientations[WritingMode.horizontal],shapedIcon,glyphSize,textMaxBoxScale,this$1.overscaling,EXTENT);for(var i$1=0,list$1=anchors;i$1<list$1.length;i$1+=1){var anchor=list$1[i$1];var shapedText=shapedTextOrientations[WritingMode.horizontal];if(!shapedText||!this$1.anchorIsTooClose(shapedText.text,textRepeatDistance,anchor)){addSymbolInstance(line,anchor)}}}}else if(feature.type==="Polygon"){for(var i$2=0,list$2=classifyRings(feature.geometry,0);i$2<list$2.length;i$2+=1){var polygon=list$2[i$2];var poi=findPoleOfInaccessibility(polygon,16);addSymbolInstance(polygon[0],new Anchor(poi.x,poi.y,0))}}else if(feature.type==="LineString"){for(var i$3=0,list$3=feature.geometry;i$3<list$3.length;i$3+=1){var line$1=list$3[i$3];addSymbolInstance(line$1,new Anchor(line$1[0].x,line$1[0].y,0))}}else if(feature.type==="Point"){for(var i$4=0,list$4=feature.geometry;i$4<list$4.length;i$4+=1){var points=list$4[i$4];for(var i$5=0,list$5=points;i$5<list$5.length;i$5+=1){var point=list$5[i$5];addSymbolInstance([point],new Anchor(point.x,point.y,0))}}}};SymbolBucket.prototype.anchorIsTooClose=function anchorIsTooClose(text,repeatDistance,anchor){var compareText=this.compareText;if(!(text in compareText)){compareText[text]=[]}else{var otherAnchors=compareText[text];for(var k=otherAnchors.length-1;k>=0;k--){if(anchor.dist(otherAnchors[k])<repeatDistance){return true}}}compareText[text].push(anchor);return false};SymbolBucket.prototype.place=function place(collisionTile,showCollisionBoxes){var this$1=this;this.createArrays();var layout=this.layers[0].layout;var maxScale=collisionTile.maxScale;var textAlongLine=layout["text-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line";var iconAlongLine=layout["icon-rotation-alignment"]==="map"&&layout["symbol-placement"]==="line";var mayOverlap=layout["text-allow-overlap"]||layout["icon-allow-overlap"]||layout["text-ignore-placement"]||layout["icon-ignore-placement"];if(mayOverlap){var symbolInstancesStructTypeArray=this.symbolInstancesArray.toArray(this.symbolInstancesStartIndex,this.symbolInstancesEndIndex);var angle=collisionTile.angle;var sin=Math.sin(angle),cos=Math.cos(angle);this.sortedSymbolInstances=symbolInstancesStructTypeArray.sort(function(a,b){var aRotated=sin*a.anchorPointX+cos*a.anchorPointY|0;var bRotated=sin*b.anchorPointX+cos*b.anchorPointY|0;return aRotated-bRotated||b.index-a.index})}for(var p=this.symbolInstancesStartIndex;p<this.symbolInstancesEndIndex;p++){var symbolInstance=this$1.sortedSymbolInstances?this$1.sortedSymbolInstances[p-this$1.symbolInstancesStartIndex]:this$1.symbolInstancesArray.get(p);var textCollisionFeature={boxStartIndex:symbolInstance.textBoxStartIndex,boxEndIndex:symbolInstance.textBoxEndIndex};var iconCollisionFeature={boxStartIndex:symbolInstance.iconBoxStartIndex,boxEndIndex:symbolInstance.iconBoxEndIndex};var hasText=!(symbolInstance.textBoxStartIndex===symbolInstance.textBoxEndIndex);var hasIcon=!(symbolInstance.iconBoxStartIndex===symbolInstance.iconBoxEndIndex);var iconWithoutText=layout["text-optional"]||!hasText,textWithoutIcon=layout["icon-optional"]||!hasIcon;var glyphScale=hasText?collisionTile.placeCollisionFeature(textCollisionFeature,layout["text-allow-overlap"],layout["symbol-avoid-edges"]):collisionTile.minScale;var iconScale=hasIcon?collisionTile.placeCollisionFeature(iconCollisionFeature,layout["icon-allow-overlap"],layout["symbol-avoid-edges"]):collisionTile.minScale;if(!iconWithoutText&&!textWithoutIcon){iconScale=glyphScale=Math.max(iconScale,glyphScale)}else if(!textWithoutIcon&&glyphScale){glyphScale=Math.max(iconScale,glyphScale)}else if(!iconWithoutText&&iconScale){iconScale=Math.max(iconScale,glyphScale)}if(hasText){collisionTile.insertCollisionFeature(textCollisionFeature,glyphScale,layout["text-ignore-placement"]);if(glyphScale<=maxScale){this$1.addSymbols(this$1.arrays.glyph,symbolInstance.glyphQuadStartIndex,symbolInstance.glyphQuadEndIndex,glyphScale,layout["text-keep-upright"],textAlongLine,collisionTile.angle,symbolInstance.writingModes)}}if(hasIcon){collisionTile.insertCollisionFeature(iconCollisionFeature,iconScale,layout["icon-ignore-placement"]);if(iconScale<=maxScale){this$1.addSymbols(this$1.arrays.icon,symbolInstance.iconQuadStartIndex,symbolInstance.iconQuadEndIndex,iconScale,layout["icon-keep-upright"],iconAlongLine,collisionTile.angle)}}}if(showCollisionBoxes)this.addToDebugBuffers(collisionTile)};SymbolBucket.prototype.addSymbols=function addSymbols(arrays,quadsStart,quadsEnd,scale,keepUpright,alongLine,placementAngle,writingModes){var this$1=this;var elementArray=arrays.elementArray;var layoutVertexArray=arrays.layoutVertexArray;var zoom=this.zoom;var placementZoom=Math.max(Math.log(scale)/Math.LN2+zoom,0);for(var k=quadsStart;k<quadsEnd;k++){var symbol=this$1.symbolQuadsArray.get(k).SymbolQuad;var a=(symbol.anchorAngle+placementAngle+Math.PI)%(Math.PI*2);if(writingModes&WritingMode.vertical){if(alongLine&&symbol.writingMode===WritingMode.vertical){if(keepUpright&&alongLine&&a<=Math.PI*5/4||a>Math.PI*7/4)continue}else if(keepUpright&&alongLine&&a<=Math.PI*3/4||a>Math.PI*5/4)continue}else if(keepUpright&&alongLine&&(a<=Math.PI/2||a>Math.PI*3/2))continue;var tl=symbol.tl,tr=symbol.tr,bl=symbol.bl,br=symbol.br,tex=symbol.tex,anchorPoint=symbol.anchorPoint;var minZoom=Math.max(zoom+Math.log(symbol.minScale)/Math.LN2,placementZoom);var maxZoom=Math.min(zoom+Math.log(symbol.maxScale)/Math.LN2,25);if(maxZoom<=minZoom)continue;if(minZoom===placementZoom)minZoom=0;var glyphAngle=Math.round(symbol.glyphAngle/(Math.PI*2)*256);var segment=arrays.prepareSegment(4);var index=segment.vertexLength;addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,tl.x,tl.y,tex.x,tex.y,minZoom,maxZoom,placementZoom,glyphAngle);addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,tr.x,tr.y,tex.x+tex.w,tex.y,minZoom,maxZoom,placementZoom,glyphAngle);addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,bl.x,bl.y,tex.x,tex.y+tex.h,minZoom,maxZoom,placementZoom,glyphAngle);addVertex(layoutVertexArray,anchorPoint.x,anchorPoint.y,br.x,br.y,tex.x+tex.w,tex.y+tex.h,minZoom,maxZoom,placementZoom,glyphAngle);elementArray.emplaceBack(index,index+1,index+2);elementArray.emplaceBack(index+1,index+2,index+3);segment.vertexLength+=4;segment.primitiveLength+=2}};SymbolBucket.prototype.addToDebugBuffers=function addToDebugBuffers(collisionTile){var this$1=this;var arrays=this.arrays.collisionBox;var layoutVertexArray=arrays.layoutVertexArray;var elementArray=arrays.elementArray;var angle=-collisionTile.angle;var yStretch=collisionTile.yStretch;for(var j=this.symbolInstancesStartIndex;j<this.symbolInstancesEndIndex;j++){var symbolInstance=this$1.symbolInstancesArray.get(j);symbolInstance.textCollisionFeature={boxStartIndex:symbolInstance.textBoxStartIndex,boxEndIndex:symbolInstance.textBoxEndIndex};symbolInstance.iconCollisionFeature={boxStartIndex:symbolInstance.iconBoxStartIndex,boxEndIndex:symbolInstance.iconBoxEndIndex};for(var i=0;i<2;i++){var feature=symbolInstance[i===0?"textCollisionFeature":"iconCollisionFeature"];if(!feature)continue;for(var b=feature.boxStartIndex;b<feature.boxEndIndex;b++){var box=this$1.collisionBoxArray.get(b);var anchorPoint=box.anchorPoint;var tl=new Point(box.x1,box.y1*yStretch)._rotate(angle);var tr=new Point(box.x2,box.y1*yStretch)._rotate(angle);var bl=new Point(box.x1,box.y2*yStretch)._rotate(angle);var br=new Point(box.x2,box.y2*yStretch)._rotate(angle);var maxZoom=Math.max(0,Math.min(25,this$1.zoom+Math.log(box.maxScale)/Math.LN2));var placementZoom=Math.max(0,Math.min(25,this$1.zoom+Math.log(box.placementScale)/Math.LN2));var segment=arrays.prepareSegment(4);var index=segment.vertexLength;addCollisionBoxVertex(layoutVertexArray,anchorPoint,tl,maxZoom,placementZoom);addCollisionBoxVertex(layoutVertexArray,anchorPoint,tr,maxZoom,placementZoom);addCollisionBoxVertex(layoutVertexArray,anchorPoint,br,maxZoom,placementZoom);addCollisionBoxVertex(layoutVertexArray,anchorPoint,bl,maxZoom,placementZoom);elementArray.emplaceBack(index,index+1);elementArray.emplaceBack(index+1,index+2);elementArray.emplaceBack(index+2,index+3);elementArray.emplaceBack(index+3,index);segment.vertexLength+=4;segment.primitiveLength+=4}}}};SymbolBucket.prototype.addSymbolInstance=function addSymbolInstance(anchor,line,shapedTextOrientations,shapedIcon,layer,addToBuffers,index,collisionBoxArray,featureIndex,sourceLayerIndex,bucketIndex,textBoxScale,textPadding,textAlongLine,iconBoxScale,iconPadding,iconAlongLine,globalProperties,featureProperties){var this$1=this;var textCollisionFeature,iconCollisionFeature,iconQuads;var glyphQuads=[];for(var writingModeString in shapedTextOrientations){var writingMode=parseInt(writingModeString,10);if(!shapedTextOrientations[writingMode])continue;glyphQuads=glyphQuads.concat(addToBuffers?getGlyphQuads(anchor,shapedTextOrientations[writingMode],textBoxScale,line,layer,textAlongLine,writingMode):[]);textCollisionFeature=new CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shapedTextOrientations[writingMode],textBoxScale,textPadding,textAlongLine,false)}var glyphQuadStartIndex=this.symbolQuadsArray.length;if(glyphQuads&&glyphQuads.length){for(var i=0;i<glyphQuads.length;i++){this$1.addSymbolQuad(glyphQuads[i])}}var glyphQuadEndIndex=this.symbolQuadsArray.length;var textBoxStartIndex=textCollisionFeature?textCollisionFeature.boxStartIndex:this.collisionBoxArray.length;var textBoxEndIndex=textCollisionFeature?textCollisionFeature.boxEndIndex:this.collisionBoxArray.length;if(shapedIcon){iconQuads=addToBuffers?getIconQuads(anchor,shapedIcon,iconBoxScale,line,layer,iconAlongLine,shapedTextOrientations[WritingMode.horizontal],globalProperties,featureProperties):[];iconCollisionFeature=new CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shapedIcon,iconBoxScale,iconPadding,iconAlongLine,true)}var iconQuadStartIndex=this.symbolQuadsArray.length;if(iconQuads&&iconQuads.length===1){this.addSymbolQuad(iconQuads[0])}var iconQuadEndIndex=this.symbolQuadsArray.length;var iconBoxStartIndex=iconCollisionFeature?iconCollisionFeature.boxStartIndex:this.collisionBoxArray.length;var iconBoxEndIndex=iconCollisionFeature?iconCollisionFeature.boxEndIndex:this.collisionBoxArray.length;if(iconQuadEndIndex>SymbolBucket.MAX_QUADS)util.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");if(glyphQuadEndIndex>SymbolBucket.MAX_QUADS)util.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var writingModes=(shapedTextOrientations[WritingMode.vertical]?WritingMode.vertical:0)|(shapedTextOrientations[WritingMode.horizontal]?WritingMode.horizontal:0);return this.symbolInstancesArray.emplaceBack(textBoxStartIndex,textBoxEndIndex,iconBoxStartIndex,iconBoxEndIndex,glyphQuadStartIndex,glyphQuadEndIndex,iconQuadStartIndex,iconQuadEndIndex,anchor.x,anchor.y,index,writingModes)};SymbolBucket.prototype.addSymbolQuad=function addSymbolQuad(symbolQuad){return this.symbolQuadsArray.emplaceBack(symbolQuad.anchorPoint.x,symbolQuad.anchorPoint.y,symbolQuad.tl.x,symbolQuad.tl.y,symbolQuad.tr.x,symbolQuad.tr.y,symbolQuad.bl.x,symbolQuad.bl.y,symbolQuad.br.x,symbolQuad.br.y,symbolQuad.tex.h,symbolQuad.tex.w,symbolQuad.tex.x,symbolQuad.tex.y,symbolQuad.anchorAngle,symbolQuad.glyphAngle,symbolQuad.maxScale,symbolQuad.minScale,symbolQuad.writingMode)};SymbolBucket.MAX_QUADS=65535;module.exports=SymbolBucket},{"../../source/rtl_text_plugin":132,"../../symbol/anchor":158,"../../symbol/clip_line":160,"../../symbol/collision_feature":162,"../../symbol/get_anchors":164,"../../symbol/mergelines":167,"../../symbol/quads":168,"../../symbol/resolve_text":169,"../../symbol/shaping":170,"../../util/classify_rings":196,"../../util/find_pole_of_inaccessibility":202,"../../util/script_detection":209,"../../util/token":211,"../../util/util":212,"../array_group":84,"../buffer_group":92,"../element_array_type":93,"../extent":94,"../load_geometry":96,"../vertex_array_type":100,"point-geometry":223,"vector-tile":559}],91:[function(require,module,exports){"use strict";var AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"};var Buffer=function Buffer(array,arrayType,type){this.arrayBuffer=array.arrayBuffer;this.length=array.length;this.attributes=arrayType.members;this.itemSize=arrayType.bytesPerElement;this.type=type;this.arrayType=arrayType};Buffer.fromStructArray=function fromStructArray(array,type){return new Buffer(array.serialize(),array.constructor.serialize(),type)};Buffer.prototype.bind=function bind(gl){var type=gl[this.type];if(!this.buffer){this.gl=gl;this.buffer=gl.createBuffer();gl.bindBuffer(type,this.buffer);gl.bufferData(type,this.arrayBuffer,gl.STATIC_DRAW);this.arrayBuffer=null}else{gl.bindBuffer(type,this.buffer)}};Buffer.prototype.setVertexAttribPointers=function setVertexAttribPointers(gl,program,vertexOffset){var this$1=this;for(var j=0;j<this.attributes.length;j++){var member=this$1.attributes[j];var attribIndex=program[member.name];if(attribIndex!==undefined){gl.vertexAttribPointer(attribIndex,member.components,gl[AttributeType[member.type]],false,this$1.arrayType.bytesPerElement,member.offset+(this$1.arrayType.bytesPerElement*vertexOffset||0))}}};Buffer.prototype.destroy=function destroy(){if(this.buffer){this.gl.deleteBuffer(this.buffer)}};Buffer.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"};module.exports=Buffer},{}],92:[function(require,module,exports){"use strict";var util=require("../util/util");var Buffer=require("./buffer");var ProgramConfiguration=require("./program_configuration");var VertexArrayObject=require("../render/vertex_array_object");var BufferGroup=function BufferGroup(programInterface,layers,zoom,arrays){var this$1=this;this.layoutVertexBuffer=new Buffer(arrays.layoutVertexArray,programInterface.layoutVertexArrayType.serialize(),Buffer.BufferType.VERTEX);if(arrays.elementArray){this.elementBuffer=new Buffer(arrays.elementArray,programInterface.elementArrayType.serialize(),Buffer.BufferType.ELEMENT)}if(arrays.elementArray2){this.elementBuffer2=new Buffer(arrays.elementArray2,programInterface.elementArrayType2.serialize(),Buffer.BufferType.ELEMENT)}this.layerData={};for(var i=0,list=layers;i<list.length;i+=1){var layer=list[i];var array=arrays.paintVertexArrays&&arrays.paintVertexArrays[layer.id];var programConfiguration=ProgramConfiguration.createDynamic(programInterface.paintAttributes||[],layer,zoom);var paintVertexBuffer=array?new Buffer(array.array,array.type,Buffer.BufferType.VERTEX):null;this$1.layerData[layer.id]={programConfiguration:programConfiguration,paintVertexBuffer:paintVertexBuffer}}this.segments=arrays.segments;this.segments2=arrays.segments2;for(var i$1=0,list$1=[this.segments,this.segments2];i$1<list$1.length;i$1+=1){var segments=list$1[i$1];for(var i$2=0,list$2=segments||[];i$2<list$2.length;i$2+=1){var segment=list$2[i$2];segment.vaos=util.mapObject(this$1.layerData,function(){return new VertexArrayObject})}}};BufferGroup.prototype.destroy=function destroy(){var this$1=this;this.layoutVertexBuffer.destroy();if(this.elementBuffer){this.elementBuffer.destroy()}if(this.elementBuffer2){this.elementBuffer2.destroy()}for(var layerId in this.layerData){var paintVertexBuffer=this$1.layerData[layerId].paintVertexBuffer;if(paintVertexBuffer){paintVertexBuffer.destroy()}}for(var i=0,list=[this.segments,this.segments2];i<list.length;i+=1){var segments=list[i];for(var i$1=0,list$1=segments||[];i$1<list$1.length;i$1+=1){var segment=list$1[i$1];for(var k in segment.vaos){segment.vaos[k].destroy()}}}};module.exports=BufferGroup},{"../render/vertex_array_object":122,"../util/util":212,"./buffer":91,"./program_configuration":98}],93:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");module.exports=createElementArrayType;function createElementArrayType(components){return createStructArrayType({members:[{type:"Uint16",name:"vertices",components:components||3}]})}},{"../util/struct_array":210}],94:[function(require,module,exports){"use strict";module.exports=8192},{}],95:[function(require,module,exports){"use strict";var Point=require("point-geometry");var loadGeometry=require("./load_geometry");var EXTENT=require("./extent");var featureFilter=require("feature-filter");var createStructArrayType=require("../util/struct_array");var Grid=require("grid-index");var DictionaryCoder=require("../util/dictionary_coder");var vt=require("vector-tile");var Protobuf=require("pbf");var GeoJSONFeature=require("../util/vectortile_to_geojson");var arraysIntersect=require("../util/util").arraysIntersect;var intersection=require("../util/intersection_tests");var multiPolygonIntersectsBufferedMultiPoint=intersection.multiPolygonIntersectsBufferedMultiPoint;var multiPolygonIntersectsMultiPolygon=intersection.multiPolygonIntersectsMultiPolygon;var multiPolygonIntersectsBufferedMultiLine=intersection.multiPolygonIntersectsBufferedMultiLine;var FeatureIndexArray=createStructArrayType({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]});var FeatureIndex=function FeatureIndex(coord,overscaling,collisionTile){if(coord.grid){var serialized=coord;var rawTileData=overscaling;coord=serialized.coord;overscaling=serialized.overscaling;this.grid=new Grid(serialized.grid);this.featureIndexArray=new FeatureIndexArray(serialized.featureIndexArray);this.rawTileData=rawTileData;this.bucketLayerIDs=serialized.bucketLayerIDs}else{this.grid=new Grid(EXTENT,16,0);this.featureIndexArray=new FeatureIndexArray}this.coord=coord;this.overscaling=overscaling;this.x=coord.x;this.y=coord.y;this.z=coord.z-Math.log(overscaling)/Math.LN2;this.setCollisionTile(collisionTile)};FeatureIndex.prototype.insert=function insert(feature,bucketIndex){var this$1=this;var key=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(feature.index,feature.sourceLayerIndex,bucketIndex);var geometry=loadGeometry(feature);for(var r=0;r<geometry.length;r++){var ring=geometry[r];var bbox=[Infinity,Infinity,-Infinity,-Infinity];for(var i=0;i<ring.length;i++){var p=ring[i];bbox[0]=Math.min(bbox[0],p.x);bbox[1]=Math.min(bbox[1],p.y);bbox[2]=Math.max(bbox[2],p.x);bbox[3]=Math.max(bbox[3],p.y)}this$1.grid.insert(key,bbox[0],bbox[1],bbox[2],bbox[3])}};FeatureIndex.prototype.setCollisionTile=function setCollisionTile(collisionTile){this.collisionTile=collisionTile};FeatureIndex.prototype.serialize=function serialize(transferables){var grid=this.grid.toArrayBuffer();if(transferables){transferables.push(grid)}return{coord:this.coord,overscaling:this.overscaling,grid:grid,featureIndexArray:this.featureIndexArray.serialize(transferables),bucketLayerIDs:this.bucketLayerIDs}};FeatureIndex.prototype.query=function query(args,styleLayers){if(!this.vtLayers){this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers;this.sourceLayerCoder=new DictionaryCoder(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])}var result={};var params=args.params||{},pixelsToTileUnits=EXTENT/args.tileSize/args.scale,filter=featureFilter(params.filter);var additionalRadius=0;for(var id in styleLayers){var styleLayer=styleLayers[id];var paint=styleLayer.paint;var styleLayerDistance=0;if(styleLayer.type==="line"){styleLayerDistance=getLineWidth(paint)/2+Math.abs(paint["line-offset"])+translateDistance(paint["line-translate"]);

}else if(styleLayer.type==="fill"){styleLayerDistance=translateDistance(paint["fill-translate"])}else if(styleLayer.type==="fill-extrusion"){styleLayerDistance=translateDistance(paint["fill-extrusion-translate"])}else if(styleLayer.type==="circle"){styleLayerDistance=paint["circle-radius"]+translateDistance(paint["circle-translate"])}additionalRadius=Math.max(additionalRadius,styleLayerDistance*pixelsToTileUnits)}var queryGeometry=args.queryGeometry.map(function(q){return q.map(function(p){return new Point(p.x,p.y)})});var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;for(var i=0;i<queryGeometry.length;i++){var ring=queryGeometry[i];for(var k=0;k<ring.length;k++){var p=ring[k];minX=Math.min(minX,p.x);minY=Math.min(minY,p.y);maxX=Math.max(maxX,p.x);maxY=Math.max(maxY,p.y)}}var matching=this.grid.query(minX-additionalRadius,minY-additionalRadius,maxX+additionalRadius,maxY+additionalRadius);matching.sort(topDownFeatureComparator);this.filterMatching(result,matching,this.featureIndexArray,queryGeometry,filter,params.layers,styleLayers,args.bearing,pixelsToTileUnits);var matchingSymbols=this.collisionTile.queryRenderedSymbols(queryGeometry,args.scale);matchingSymbols.sort();this.filterMatching(result,matchingSymbols,this.collisionTile.collisionBoxArray,queryGeometry,filter,params.layers,styleLayers,args.bearing,pixelsToTileUnits);return result};FeatureIndex.prototype.filterMatching=function filterMatching(result,matching,array,queryGeometry,filter,filterLayerIDs,styleLayers,bearing,pixelsToTileUnits){var this$1=this;var previousIndex;for(var k=0;k<matching.length;k++){var index=matching[k];if(index===previousIndex)continue;previousIndex=index;var match=array.get(index);var layerIDs=this$1.bucketLayerIDs[match.bucketIndex];if(filterLayerIDs&&!arraysIntersect(filterLayerIDs,layerIDs))continue;var sourceLayerName=this$1.sourceLayerCoder.decode(match.sourceLayerIndex);var sourceLayer=this$1.vtLayers[sourceLayerName];var feature=sourceLayer.feature(match.featureIndex);if(!filter(feature))continue;var geometry=null;for(var l=0;l<layerIDs.length;l++){var layerID=layerIDs[l];if(filterLayerIDs&&filterLayerIDs.indexOf(layerID)<0){continue}var styleLayer=styleLayers[layerID];if(!styleLayer)continue;var translatedPolygon;if(styleLayer.type!=="symbol"){if(!geometry)geometry=loadGeometry(feature);var paint=styleLayer.paint;if(styleLayer.type==="line"){translatedPolygon=translate(queryGeometry,paint["line-translate"],paint["line-translate-anchor"],bearing,pixelsToTileUnits);var halfWidth=getLineWidth(paint)/2*pixelsToTileUnits;if(paint["line-offset"]){geometry=offsetLine(geometry,paint["line-offset"]*pixelsToTileUnits)}if(!multiPolygonIntersectsBufferedMultiLine(translatedPolygon,geometry,halfWidth))continue}else if(styleLayer.type==="fill"||styleLayer.type==="fill-extrusion"){var typePrefix=styleLayer.type;translatedPolygon=translate(queryGeometry,paint[typePrefix+"-translate"],paint[typePrefix+"-translate-anchor"],bearing,pixelsToTileUnits);if(!multiPolygonIntersectsMultiPolygon(translatedPolygon,geometry))continue}else if(styleLayer.type==="circle"){translatedPolygon=translate(queryGeometry,paint["circle-translate"],paint["circle-translate-anchor"],bearing,pixelsToTileUnits);var circleRadius=paint["circle-radius"]*pixelsToTileUnits;if(!multiPolygonIntersectsBufferedMultiPoint(translatedPolygon,geometry,circleRadius))continue}}var geojsonFeature=new GeoJSONFeature(feature,this$1.z,this$1.x,this$1.y);geojsonFeature.layer=styleLayer.serialize();var layerResult=result[layerID];if(layerResult===undefined){layerResult=result[layerID]=[]}layerResult.push(geojsonFeature)}}};module.exports=FeatureIndex;function translateDistance(translate){return Math.sqrt(translate[0]*translate[0]+translate[1]*translate[1])}function topDownFeatureComparator(a,b){return b-a}function getLineWidth(paint){if(paint["line-gap-width"]>0){return paint["line-gap-width"]+2*paint["line-width"]}else{return paint["line-width"]}}function translate(queryGeometry,translate,translateAnchor,bearing,pixelsToTileUnits){if(!translate[0]&&!translate[1]){return queryGeometry}translate=Point.convert(translate);if(translateAnchor==="viewport"){translate._rotate(-bearing)}var translated=[];for(var i=0;i<queryGeometry.length;i++){var ring=queryGeometry[i];var translatedRing=[];for(var k=0;k<ring.length;k++){translatedRing.push(ring[k].sub(translate._mult(pixelsToTileUnits)))}translated.push(translatedRing)}return translated}function offsetLine(rings,offset){var newRings=[];var zero=new Point(0,0);for(var k=0;k<rings.length;k++){var ring=rings[k];var newRing=[];for(var i=0;i<ring.length;i++){var a=ring[i-1];var b=ring[i];var c=ring[i+1];var aToB=i===0?zero:b.sub(a)._unit()._perp();var bToC=i===ring.length-1?zero:c.sub(b)._unit()._perp();var extrude=aToB._add(bToC)._unit();var cosHalfAngle=extrude.x*bToC.x+extrude.y*bToC.y;extrude._mult(1/cosHalfAngle);newRing.push(extrude._mult(offset)._add(b))}newRings.push(newRing)}return newRings}},{"../util/dictionary_coder":198,"../util/intersection_tests":205,"../util/struct_array":210,"../util/util":212,"../util/vectortile_to_geojson":213,"./extent":94,"./load_geometry":96,"feature-filter":22,"grid-index":35,pbf:222,"point-geometry":223,"vector-tile":559}],96:[function(require,module,exports){"use strict";var util=require("../util/util");var EXTENT=require("./extent");function createBounds(bits){return{min:-1*Math.pow(2,bits-1),max:Math.pow(2,bits-1)-1}}var boundsLookup={15:createBounds(15),16:createBounds(16)};module.exports=function loadGeometry(feature,bits){var bounds=boundsLookup[bits||16];var scale=EXTENT/feature.extent;var geometry=feature.loadGeometry();for(var r=0;r<geometry.length;r++){var ring=geometry[r];for(var p=0;p<ring.length;p++){var point=ring[p];point.x=Math.round(point.x*scale);point.y=Math.round(point.y*scale);if(point.x<bounds.min||point.x>bounds.max||point.y<bounds.min||point.y>bounds.max){util.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}}return geometry}},{"../util/util":212,"./extent":94}],97:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var PosArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2}]});module.exports=PosArray},{"../util/struct_array":210}],98:[function(require,module,exports){"use strict";var createVertexArrayType=require("./vertex_array_type");var util=require("../util/util");var ProgramConfiguration=function ProgramConfiguration(){this.attributes=[];this.uniforms=[];this.interpolationUniforms=[];this.pragmas={vertex:{},fragment:{}};this.cacheKey=""};ProgramConfiguration.createDynamic=function createDynamic(attributes,layer,zoom){var self=new ProgramConfiguration;for(var i=0,list=attributes;i<list.length;i+=1){var attributeConfig=list[i];var attribute=normalizePaintAttribute(attributeConfig,layer);var name=attribute.name.slice(2);if(layer.isPaintValueFeatureConstant(attribute.property)){self.addZoomAttribute(name,attribute)}else if(layer.isPaintValueZoomConstant(attribute.property)){self.addPropertyAttribute(name,attribute)}else{self.addZoomAndPropertyAttribute(name,attribute,layer,zoom)}}self.PaintVertexArray=createVertexArrayType(self.attributes);return self};ProgramConfiguration.createStatic=function createStatic(uniformNames){var self=new ProgramConfiguration;for(var i=0,list=uniformNames;i<list.length;i+=1){var name=list[i];self.addUniform(name,"u_"+name)}return self};ProgramConfiguration.prototype.addUniform=function addUniform(name,inputName){var pragmas=this.getPragmas(name);pragmas.define.push("uniform {precision} {type} "+inputName+";");pragmas.initialize.push("{precision} {type} "+name+" = "+inputName+";");this.cacheKey+="/u_"+name};ProgramConfiguration.prototype.addZoomAttribute=function addZoomAttribute(name,attribute){this.uniforms.push(attribute);this.addUniform(name,attribute.name)};ProgramConfiguration.prototype.addPropertyAttribute=function addPropertyAttribute(name,attribute){var pragmas=this.getPragmas(name);this.attributes.push(attribute);pragmas.define.push("varying {precision} {type} "+name+";");pragmas.vertex.define.push("attribute {precision} {type} "+attribute.name+";");pragmas.vertex.initialize.push(name+" = "+attribute.name+" / "+attribute.multiplier+".0;");this.cacheKey+="/a_"+name};ProgramConfiguration.prototype.addZoomAndPropertyAttribute=function addZoomAndPropertyAttribute(name,attribute,layer,zoom){var this$1=this;var pragmas=this.getPragmas(name);pragmas.define.push("varying {precision} {type} "+name+";");var numStops=0;var zoomLevels=layer.getPaintValueStopZoomLevels(attribute.property);while(numStops<zoomLevels.length&&zoomLevels[numStops]<zoom)numStops++;var stopOffset=Math.max(0,Math.min(zoomLevels.length-4,numStops-2));var tName="u_"+name+"_t";pragmas.vertex.define.push("uniform lowp float "+tName+";");this.interpolationUniforms.push({name:tName,property:attribute.property,stopOffset:stopOffset});var zoomStops=[];for(var s=0;s<4;s++){zoomStops.push(zoomLevels[Math.min(stopOffset+s,zoomLevels.length-1)])}var componentNames=[];if(attribute.components===1){this.attributes.push(util.extend({},attribute,{components:4,zoomStops:zoomStops}));pragmas.vertex.define.push("attribute {precision} vec4 "+attribute.name+";");componentNames.push(attribute.name)}else{for(var k=0;k<4;k++){var componentName=attribute.name+k;componentNames.push(componentName);this$1.attributes.push(util.extend({},attribute,{name:componentName,zoomStops:[zoomStops[k]]}));pragmas.vertex.define.push("attribute {precision} {type} "+componentName+";")}}pragmas.vertex.initialize.push(name+" = evaluate_zoom_function_"+attribute.components+"(            "+componentNames.join(", ")+", "+tName+") / "+attribute.multiplier+".0;");this.cacheKey+="/z_"+name};ProgramConfiguration.prototype.getPragmas=function getPragmas(name){if(!this.pragmas[name]){this.pragmas[name]={define:[],initialize:[]};this.pragmas[name].fragment={define:[],initialize:[]};this.pragmas[name].vertex={define:[],initialize:[]}}return this.pragmas[name]};ProgramConfiguration.prototype.applyPragmas=function applyPragmas(source,shaderType){var this$1=this;return source.replace(/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(match,operation,precision,type,name){return this$1.pragmas[name][operation].concat(this$1.pragmas[name][shaderType][operation]).join("\n").replace(/{type}/g,type).replace(/{precision}/g,precision)})};ProgramConfiguration.prototype.populatePaintArray=function populatePaintArray(layer,paintArray,length,globalProperties,featureProperties){var start=paintArray.length;paintArray.resize(length);for(var i$1=0,list=this.attributes;i$1<list.length;i$1+=1){var attribute=list[i$1];var value=getPaintAttributeValue(attribute,layer,globalProperties,featureProperties);for(var i=start;i<length;i++){var vertex=paintArray.get(i);if(attribute.components===4){for(var c=0;c<4;c++){vertex[attribute.name+c]=value[c]*attribute.multiplier}}else{vertex[attribute.name]=value*attribute.multiplier}}}};ProgramConfiguration.prototype.setUniforms=function setUniforms(gl,program,layer,globalProperties){for(var i=0,list=this.uniforms;i<list.length;i+=1){var uniform=list[i];var value=layer.getPaintValue(uniform.property,globalProperties);if(uniform.components===4){gl.uniform4fv(program[uniform.name],value)}else{gl.uniform1f(program[uniform.name],value)}}for(var i$1=0,list$1=this.interpolationUniforms;i$1<list$1.length;i$1+=1){var uniform$1=list$1[i$1];var stopInterp=layer.getPaintInterpolationT(uniform$1.property,globalProperties);gl.uniform1f(program[uniform$1.name],Math.max(0,Math.min(4,stopInterp-uniform$1.stopOffset)))}};function getPaintAttributeValue(attribute,layer,globalProperties,featureProperties){if(!attribute.zoomStops){return layer.getPaintValue(attribute.property,globalProperties,featureProperties)}var values=attribute.zoomStops.map(function(zoom){return layer.getPaintValue(attribute.property,util.extend({},globalProperties,{zoom:zoom}),featureProperties)});return values.length===1?values[0]:values}function normalizePaintAttribute(attribute,layer){var name=attribute.property.replace(layer.type+"-","").replace(/-/g,"_");var isColor=layer._paintSpecifications[attribute.property].type==="color";return util.extend({name:"a_"+name,components:isColor?4:1,multiplier:isColor?255:1},attribute)}module.exports=ProgramConfiguration},{"../util/util":212,"./vertex_array_type":100}],99:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var RasterBoundsArray=createStructArrayType({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});module.exports=RasterBoundsArray},{"../util/struct_array":210}],100:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");module.exports=createVertexArrayType;function createVertexArrayType(members){return createStructArrayType({members:members,alignment:4})}},{"../util/struct_array":210}],101:[function(require,module,exports){"use strict";var Coordinate=function Coordinate(column,row,zoom){this.column=column;this.row=row;this.zoom=zoom};Coordinate.prototype.clone=function clone(){return new Coordinate(this.column,this.row,this.zoom)};Coordinate.prototype.zoomTo=function zoomTo(zoom){return this.clone()._zoomTo(zoom)};Coordinate.prototype.sub=function sub(c){return this.clone()._sub(c)};Coordinate.prototype._zoomTo=function _zoomTo(zoom){var scale=Math.pow(2,zoom-this.zoom);this.column*=scale;this.row*=scale;this.zoom=zoom;return this};Coordinate.prototype._sub=function _sub(c){c=c.zoomTo(this.zoom);this.column-=c.column;this.row-=c.row;return this};module.exports=Coordinate},{}],102:[function(require,module,exports){"use strict";var wrap=require("../util/util").wrap;var LngLat=function LngLat(lng,lat){if(isNaN(lng)||isNaN(lat)){throw new Error("Invalid LngLat object: ("+lng+", "+lat+")")}this.lng=+lng;this.lat=+lat;if(this.lat>90||this.lat<-90){throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}};LngLat.prototype.wrap=function wrap$1(){return new LngLat(wrap(this.lng,-180,180),this.lat)};LngLat.prototype.toArray=function toArray(){return[this.lng,this.lat]};LngLat.prototype.toString=function toString(){return"LngLat("+this.lng+", "+this.lat+")"};LngLat.convert=function(input){if(input instanceof LngLat){return input}else if(input&&input.hasOwnProperty("lng")&&input.hasOwnProperty("lat")){return new LngLat(input.lng,input.lat)}else if(Array.isArray(input)&&input.length===2){return new LngLat(input[0],input[1])}else{throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};module.exports=LngLat},{"../util/util":212}],103:[function(require,module,exports){"use strict";var LngLat=require("./lng_lat");var LngLatBounds=function LngLatBounds(sw,ne){if(!sw){return}else if(ne){this.setSouthWest(sw).setNorthEast(ne)}else if(sw.length===4){this.setSouthWest([sw[0],sw[1]]).setNorthEast([sw[2],sw[3]])}else{this.setSouthWest(sw[0]).setNorthEast(sw[1])}};LngLatBounds.prototype.setNorthEast=function setNorthEast(ne){this._ne=LngLat.convert(ne);return this};LngLatBounds.prototype.setSouthWest=function setSouthWest(sw){this._sw=LngLat.convert(sw);return this};LngLatBounds.prototype.extend=function extend(obj){var sw=this._sw,ne=this._ne;var sw2,ne2;if(obj instanceof LngLat){sw2=obj;ne2=obj}else if(obj instanceof LngLatBounds){sw2=obj._sw;ne2=obj._ne;if(!sw2||!ne2)return this}else{if(Array.isArray(obj)){if(obj.every(Array.isArray)){return this.extend(LngLatBounds.convert(obj))}else{return this.extend(LngLat.convert(obj))}}return this}if(!sw&&!ne){this._sw=new LngLat(sw2.lng,sw2.lat);this._ne=new LngLat(ne2.lng,ne2.lat)}else{sw.lng=Math.min(sw2.lng,sw.lng);sw.lat=Math.min(sw2.lat,sw.lat);ne.lng=Math.max(ne2.lng,ne.lng);ne.lat=Math.max(ne2.lat,ne.lat)}return this};LngLatBounds.prototype.getCenter=function getCenter(){return new LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)};LngLatBounds.prototype.getSouthWest=function getSouthWest(){return this._sw};LngLatBounds.prototype.getNorthEast=function getNorthEast(){return this._ne};LngLatBounds.prototype.getNorthWest=function getNorthWest(){return new LngLat(this.getWest(),this.getNorth())};LngLatBounds.prototype.getSouthEast=function getSouthEast(){return new LngLat(this.getEast(),this.getSouth())};LngLatBounds.prototype.getWest=function getWest(){return this._sw.lng};LngLatBounds.prototype.getSouth=function getSouth(){return this._sw.lat};LngLatBounds.prototype.getEast=function getEast(){return this._ne.lng};LngLatBounds.prototype.getNorth=function getNorth(){return this._ne.lat};LngLatBounds.prototype.toArray=function toArray(){return[this._sw.toArray(),this._ne.toArray()]};LngLatBounds.prototype.toString=function toString(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"};LngLatBounds.convert=function(input){if(!input||input instanceof LngLatBounds)return input;return new LngLatBounds(input)};module.exports=LngLatBounds},{"./lng_lat":102}],104:[function(require,module,exports){"use strict";var LngLat=require("./lng_lat"),Point=require("point-geometry"),Coordinate=require("./coordinate"),util=require("../util/util"),interp=require("../util/interpolate"),TileCoord=require("../source/tile_coord"),EXTENT=require("../data/extent"),glmatrix=require("@mapbox/gl-matrix");var vec4=glmatrix.vec4,mat4=glmatrix.mat4,mat2=glmatrix.mat2;var Transform=function Transform(minZoom,maxZoom,renderWorldCopies){this.tileSize=512;this._renderWorldCopies=renderWorldCopies===undefined?true:renderWorldCopies;this._minZoom=minZoom||0;this._maxZoom=maxZoom||22;this.latRange=[-85.05113,85.05113];this.width=0;this.height=0;this._center=new LngLat(0,0);this.zoom=0;this.angle=0;this._fov=.6435011087932844;this._pitch=0;this._unmodified=true};var prototypeAccessors={minZoom:{},maxZoom:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};prototypeAccessors.minZoom.get=function(){return this._minZoom};prototypeAccessors.minZoom.set=function(zoom){if(this._minZoom===zoom)return;this._minZoom=zoom;this.zoom=Math.max(this.zoom,zoom)};prototypeAccessors.maxZoom.get=function(){return this._maxZoom};prototypeAccessors.maxZoom.set=function(zoom){if(this._maxZoom===zoom)return;this._maxZoom=zoom;this.zoom=Math.min(this.zoom,zoom)};prototypeAccessors.worldSize.get=function(){return this.tileSize*this.scale};prototypeAccessors.centerPoint.get=function(){return this.size._div(2)};prototypeAccessors.size.get=function(){return new Point(this.width,this.height)};prototypeAccessors.bearing.get=function(){return-this.angle/Math.PI*180};prototypeAccessors.bearing.set=function(bearing){var b=-util.wrap(bearing,-180,180)*Math.PI/180;if(this.angle===b)return;this._unmodified=false;this.angle=b;this._calcMatrices();this.rotationMatrix=mat2.create();mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle)};prototypeAccessors.pitch.get=function(){return this._pitch/Math.PI*180};prototypeAccessors.pitch.set=function(pitch){var p=util.clamp(pitch,0,60)/180*Math.PI;if(this._pitch===p)return;this._unmodified=false;this._pitch=p;this._calcMatrices()};prototypeAccessors.fov.get=function(){return this._fov/Math.PI*180};prototypeAccessors.fov.set=function(fov){fov=Math.max(.01,Math.min(60,fov));if(this._fov===fov)return;this._unmodified=false;this._fov=fov/180*Math.PI;this._calcMatrices()};prototypeAccessors.zoom.get=function(){return this._zoom};prototypeAccessors.zoom.set=function(zoom){var z=Math.min(Math.max(zoom,this.minZoom),this.maxZoom);if(this._zoom===z)return;this._unmodified=false;this._zoom=z;this.scale=this.zoomScale(z);this.tileZoom=Math.floor(z);this.zoomFraction=z-this.tileZoom;this._constrain();this._calcMatrices()};prototypeAccessors.center.get=function(){return this._center};prototypeAccessors.center.set=function(center){if(center.lat===this._center.lat&&center.lng===this._center.lng)return;this._unmodified=false;this._center=center;this._constrain();this._calcMatrices()};Transform.prototype.coveringZoomLevel=function coveringZoomLevel(options){return(options.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/options.tileSize))};Transform.prototype.coveringTiles=function coveringTiles(options){var z=this.coveringZoomLevel(options);var actualZ=z;if(z<options.minzoom)return[];if(z>options.maxzoom)z=options.maxzoom;var centerCoord=this.pointCoordinate(this.centerPoint,z);var centerPoint=new Point(centerCoord.column-.5,centerCoord.row-.5);var cornerCoords=[this.pointCoordinate(new Point(0,0),z),this.pointCoordinate(new Point(this.width,0),z),this.pointCoordinate(new Point(this.width,this.height),z),this.pointCoordinate(new Point(0,this.height),z)];return TileCoord.cover(z,cornerCoords,options.reparseOverscaled?actualZ:z,this._renderWorldCopies).sort(function(a,b){return centerPoint.dist(a)-centerPoint.dist(b)})};Transform.prototype.resize=function resize(width,height){this.width=width;this.height=height;this.pixelsToGLUnits=[2/width,-2/height];this._constrain();this._calcMatrices()};prototypeAccessors.unmodified.get=function(){return this._unmodified};Transform.prototype.zoomScale=function zoomScale(zoom){return Math.pow(2,zoom)};Transform.prototype.scaleZoom=function scaleZoom(scale){return Math.log(scale)/Math.LN2};Transform.prototype.project=function project(lnglat){return new Point(this.lngX(lnglat.lng),this.latY(lnglat.lat))};Transform.prototype.unproject=function unproject(point){return new LngLat(this.xLng(point.x),this.yLat(point.y))};prototypeAccessors.x.get=function(){return this.lngX(this.center.lng)};prototypeAccessors.y.get=function(){return this.latY(this.center.lat)};prototypeAccessors.point.get=function(){return new Point(this.x,this.y)};Transform.prototype.lngX=function lngX(lng){return(180+lng)*this.worldSize/360};Transform.prototype.latY=function latY(lat){var y=180/Math.PI*Math.log(Math.tan(Math.PI/4+lat*Math.PI/360));return(180-y)*this.worldSize/360};Transform.prototype.xLng=function xLng(x){return x*360/this.worldSize-180};Transform.prototype.yLat=function yLat(y){var y2=180-y*360/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90};Transform.prototype.setLocationAtPoint=function setLocationAtPoint(lnglat,point){var translate=this.pointCoordinate(point)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(lnglat)._sub(translate))};Transform.prototype.locationPoint=function locationPoint(lnglat){return this.coordinatePoint(this.locationCoordinate(lnglat))};Transform.prototype.pointLocation=function pointLocation(p){return this.coordinateLocation(this.pointCoordinate(p))};Transform.prototype.locationCoordinate=function locationCoordinate(lnglat){return new Coordinate(this.lngX(lnglat.lng)/this.tileSize,this.latY(lnglat.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)};Transform.prototype.coordinateLocation=function coordinateLocation(coord){var zoomedCoord=coord.zoomTo(this.zoom);return new LngLat(this.xLng(zoomedCoord.column*this.tileSize),this.yLat(zoomedCoord.row*this.tileSize))};Transform.prototype.pointCoordinate=function pointCoordinate(p,zoom){if(zoom===undefined)zoom=this.tileZoom;var targetZ=0;var coord0=[p.x,p.y,0,1];var coord1=[p.x,p.y,1,1];vec4.transformMat4(coord0,coord0,this.pixelMatrixInverse);vec4.transformMat4(coord1,coord1,this.pixelMatrixInverse);var w0=coord0[3];var w1=coord1[3];var x0=coord0[0]/w0;var x1=coord1[0]/w1;var y0=coord0[1]/w0;var y1=coord1[1]/w1;var z0=coord0[2]/w0;var z1=coord1[2]/w1;var t=z0===z1?0:(targetZ-z0)/(z1-z0);return new Coordinate(interp(x0,x1,t)/this.tileSize,interp(y0,y1,t)/this.tileSize,this.zoom)._zoomTo(zoom)};Transform.prototype.coordinatePoint=function coordinatePoint(coord){var zoomedCoord=coord.zoomTo(this.zoom);var p=[zoomedCoord.column*this.tileSize,zoomedCoord.row*this.tileSize,0,1];vec4.transformMat4(p,p,this.pixelMatrix);return new Point(p[0]/p[3],p[1]/p[3])};Transform.prototype.calculatePosMatrix=function calculatePosMatrix(tileCoord,maxZoom){var coord=tileCoord.toCoordinate(maxZoom);var scale=this.worldSize/this.zoomScale(coord.zoom);var posMatrix=mat4.identity(new Float64Array(16));mat4.translate(posMatrix,posMatrix,[coord.column*scale,coord.row*scale,0]);mat4.scale(posMatrix,posMatrix,[scale/EXTENT,scale/EXTENT,1]);mat4.multiply(posMatrix,this.projMatrix,posMatrix);return new Float32Array(posMatrix)};Transform.prototype._constrain=function _constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=true;var minY,maxY,minX,maxX,sy,sx,x2,y2;var size=this.size,unmodified=this._unmodified;if(this.latRange){minY=this.latY(this.latRange[1]);maxY=this.latY(this.latRange[0]);sy=maxY-minY<size.y?size.y/(maxY-minY):0}if(this.lngRange){minX=this.lngX(this.lngRange[0]);maxX=this.lngX(this.lngRange[1]);sx=maxX-minX<size.x?size.x/(maxX-minX):0}var s=Math.max(sx||0,sy||0);if(s){this.center=this.unproject(new Point(sx?(maxX+minX)/2:this.x,sy?(maxY+minY)/2:this.y));this.zoom+=this.scaleZoom(s);this._unmodified=unmodified;this._constraining=false;return}if(this.latRange){var y=this.y,h2=size.y/2;if(y-h2<minY)y2=minY+h2;if(y+h2>maxY)y2=maxY-h2}if(this.lngRange){var x=this.x,w2=size.x/2;if(x-w2<minX)x2=minX+w2;if(x+w2>maxX)x2=maxX-w2}if(x2!==undefined||y2!==undefined){this.center=this.unproject(new Point(x2!==undefined?x2:this.x,y2!==undefined?y2:this.y))}this._unmodified=unmodified;this._constraining=false};Transform.prototype._calcMatrices=function _calcMatrices(){if(!this.height)return;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var halfFov=this._fov/2;var groundAngle=Math.PI/2+this._pitch;var topHalfSurfaceDistance=Math.sin(halfFov)*this.cameraToCenterDistance/Math.sin(Math.PI-groundAngle-halfFov);var furthestDistance=Math.cos(Math.PI/2-this._pitch)*topHalfSurfaceDistance+this.cameraToCenterDistance;var farZ=furthestDistance*1.01;var m=new Float64Array(16);mat4.perspective(m,this._fov,this.width/this.height,1,farZ);mat4.scale(m,m,[1,-1,1]);mat4.translate(m,m,[0,0,-this.cameraToCenterDistance]);mat4.rotateX(m,m,this._pitch);mat4.rotateZ(m,m,this.angle);mat4.translate(m,m,[-this.x,-this.y,0]);var verticalScale=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));mat4.scale(m,m,[1,1,verticalScale,1]);this.projMatrix=m;m=mat4.create();mat4.scale(m,m,[this.width/2,-this.height/2,1]);mat4.translate(m,m,[1,-1,0]);this.pixelMatrix=mat4.multiply(new Float64Array(16),m,this.projMatrix);m=mat4.invert(new Float64Array(16),this.pixelMatrix);if(!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m};Object.defineProperties(Transform.prototype,prototypeAccessors);module.exports=Transform},{"../data/extent":94,"../source/tile_coord":136,"../util/interpolate":204,"../util/util":212,"./coordinate":101,"./lng_lat":102,"@mapbox/gl-matrix":6,"point-geometry":223}],105:[function(require,module,exports){"use strict";var WorkerPool=require("./util/worker_pool");var globalWorkerPool;module.exports=function getGlobalWorkerPool(){if(!globalWorkerPool){globalWorkerPool=new WorkerPool}return globalWorkerPool}},{"./util/worker_pool":215}],106:[function(require,module,exports){"use strict";var simplexFont={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],
a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};module.exports=function textVertices(text,left,baseline,scale){scale=scale||1;var strokes=[];var i,len,j,len2,glyph,x,y,prev;for(i=0,len=text.length;i<len;i++){glyph=simplexFont[text[i]];if(!glyph)continue;prev=null;for(j=0,len2=glyph[1].length;j<len2;j+=2){if(glyph[1][j]===-1&&glyph[1][j+1]===-1){prev=null}else{x=left+glyph[1][j]*scale;y=baseline-glyph[1][j+1]*scale;if(prev){strokes.push(prev.x,prev.y,x,y)}prev={x:x,y:y}}}left+=glyph[0]*scale}return strokes}},{}],107:[function(require,module,exports){"use strict";var browser=require("./util/browser");var mapboxgl=module.exports={};mapboxgl.version=require("../package.json").version;mapboxgl.workerCount=Math.max(Math.floor(browser.hardwareConcurrency/2),1);mapboxgl.Map=require("./ui/map");mapboxgl.NavigationControl=require("./ui/control/navigation_control");mapboxgl.GeolocateControl=require("./ui/control/geolocate_control");mapboxgl.AttributionControl=require("./ui/control/attribution_control");mapboxgl.ScaleControl=require("./ui/control/scale_control");mapboxgl.Popup=require("./ui/popup");mapboxgl.Marker=require("./ui/marker");mapboxgl.Style=require("./style/style");mapboxgl.LngLat=require("./geo/lng_lat");mapboxgl.LngLatBounds=require("./geo/lng_lat_bounds");mapboxgl.Point=require("point-geometry");mapboxgl.Evented=require("./util/evented");mapboxgl.util=require("./util/util");mapboxgl.supported=require("./util/browser").supported;var ajax=require("./util/ajax");mapboxgl.util.getJSON=ajax.getJSON;mapboxgl.util.getArrayBuffer=ajax.getArrayBuffer;var config=require("./util/config");mapboxgl.config=config;var rtlTextPlugin=require("./source/rtl_text_plugin");mapboxgl.setRTLTextPlugin=rtlTextPlugin.setRTLTextPlugin;Object.defineProperty(mapboxgl,"accessToken",{get:function(){return config.ACCESS_TOKEN},set:function(token){config.ACCESS_TOKEN=token}})},{"../package.json":216,"./geo/lng_lat":102,"./geo/lng_lat_bounds":103,"./source/rtl_text_plugin":132,"./style/style":146,"./ui/control/attribution_control":176,"./ui/control/geolocate_control":177,"./ui/control/navigation_control":178,"./ui/control/scale_control":179,"./ui/map":188,"./ui/marker":189,"./ui/popup":190,"./util/ajax":192,"./util/browser":193,"./util/config":197,"./util/evented":201,"./util/util":212,"point-geometry":223}],108:[function(require,module,exports){"use strict";var pattern=require("./pattern");module.exports=drawBackground;function drawBackground(painter,sourceCache,layer){var gl=painter.gl;var transform=painter.transform;var tileSize=transform.tileSize;var color=layer.paint["background-color"];var image=layer.paint["background-pattern"];var opacity=layer.paint["background-opacity"];var isOpaque=!image&&color[3]===1&&opacity===1;if(painter.isOpaquePass!==isOpaque)return;gl.disable(gl.STENCIL_TEST);painter.setDepthSublayer(0);var program;if(image){program=painter.useProgram("fillPattern",painter.basicFillProgramConfiguration);pattern.prepare(image,painter,program);painter.tileExtentPatternVAO.bind(gl,program,painter.tileExtentBuffer)}else{program=painter.useProgram("fill",painter.basicFillProgramConfiguration);gl.uniform4fv(program.u_color,color);painter.tileExtentVAO.bind(gl,program,painter.tileExtentBuffer)}gl.uniform1f(program.u_opacity,opacity);var coords=transform.coveringTiles({tileSize:tileSize});for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];if(image){pattern.setTile({coord:coord,tileSize:tileSize},painter,program)}gl.uniformMatrix4fv(program.u_matrix,false,painter.transform.calculatePosMatrix(coord));gl.drawArrays(gl.TRIANGLE_STRIP,0,painter.tileExtentBuffer.length)}}},{"./pattern":120}],109:[function(require,module,exports){"use strict";var browser=require("../util/browser");module.exports=drawCircles;function drawCircles(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;var gl=painter.gl;painter.setDepthSublayer(0);painter.depthMask(false);gl.disable(gl.STENCIL_TEST);for(var i=0;i<coords.length;i++){var coord=coords[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var buffers=bucket.buffers;var layerData=buffers.layerData[layer.id];var programConfiguration=layerData.programConfiguration;var program=painter.useProgram("circle",programConfiguration);programConfiguration.setUniforms(gl,program,layer,{zoom:painter.transform.zoom});if(layer.paint["circle-pitch-scale"]==="map"){gl.uniform1i(program.u_scale_with_map,true);gl.uniform2f(program.u_extrude_scale,painter.transform.pixelsToGLUnits[0]*painter.transform.cameraToCenterDistance,painter.transform.pixelsToGLUnits[1]*painter.transform.cameraToCenterDistance)}else{gl.uniform1i(program.u_scale_with_map,false);gl.uniform2fv(program.u_extrude_scale,painter.transform.pixelsToGLUnits)}gl.uniform1f(program.u_devicepixelratio,browser.devicePixelRatio);gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["circle-translate"],layer.paint["circle-translate-anchor"]));for(var i$1=0,list=buffers.segments;i$1<list.length;i$1+=1){var segment=list[i$1];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}}},{"../util/browser":193}],110:[function(require,module,exports){"use strict";module.exports=drawCollisionDebug;function drawCollisionDebug(painter,sourceCache,layer,coords){var gl=painter.gl;gl.enable(gl.STENCIL_TEST);var program=painter.useProgram("collisionBox");for(var i=0;i<coords.length;i++){var coord=coords[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var buffers=bucket.buffers.collisionBox;if(!buffers)continue;gl.uniformMatrix4fv(program.u_matrix,false,coord.posMatrix);painter.enableTileClippingMask(coord);painter.lineWidth(1);gl.uniform1f(program.u_scale,Math.pow(2,painter.transform.zoom-tile.coord.z));gl.uniform1f(program.u_zoom,painter.transform.zoom*10);gl.uniform1f(program.u_maxzoom,(tile.coord.z+1)*10);for(var i$1=0,list=buffers.segments;i$1<list.length;i$1+=1){var segment=list[i$1];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,null,segment.vertexOffset);gl.drawElements(gl.LINES,segment.primitiveLength*2,gl.UNSIGNED_SHORT,segment.primitiveOffset*2*2)}}}},{}],111:[function(require,module,exports){"use strict";var textVertices=require("../lib/debugtext");var browser=require("../util/browser");var mat4=require("@mapbox/gl-matrix").mat4;var EXTENT=require("../data/extent");var Buffer=require("../data/buffer");var VertexArrayObject=require("./vertex_array_object");var PosArray=require("../data/pos_array");module.exports=drawDebug;function drawDebug(painter,sourceCache,coords){for(var i=0;i<coords.length;i++){drawDebugTile(painter,sourceCache,coords[i])}}function drawDebugTile(painter,sourceCache,coord){var gl=painter.gl;gl.disable(gl.STENCIL_TEST);painter.lineWidth(1*browser.devicePixelRatio);var posMatrix=coord.posMatrix;var program=painter.useProgram("debug");gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.uniform4f(program.u_color,1,0,0,1);painter.debugVAO.bind(gl,program,painter.debugBuffer);gl.drawArrays(gl.LINE_STRIP,0,painter.debugBuffer.length);var vertices=textVertices(coord.toString(),50,200,5);var debugTextArray=new PosArray;for(var v=0;v<vertices.length;v+=2){debugTextArray.emplaceBack(vertices[v],vertices[v+1])}var debugTextBuffer=Buffer.fromStructArray(debugTextArray,Buffer.BufferType.VERTEX);var debugTextVAO=new VertexArrayObject;debugTextVAO.bind(gl,program,debugTextBuffer);gl.uniform4f(program.u_color,1,1,1,1);var tileSize=sourceCache.getTile(coord).tileSize;var onePixel=EXTENT/(Math.pow(2,painter.transform.zoom-coord.z)*tileSize);var translations=[[-1,-1],[-1,1],[1,-1],[1,1]];for(var i=0;i<translations.length;i++){var translation=translations[i];gl.uniformMatrix4fv(program.u_matrix,false,mat4.translate([],posMatrix,[onePixel*translation[0],onePixel*translation[1],0]));gl.drawArrays(gl.LINES,0,debugTextBuffer.length)}gl.uniform4f(program.u_color,0,0,0,1);gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.drawArrays(gl.LINES,0,debugTextBuffer.length)}},{"../data/buffer":91,"../data/extent":94,"../data/pos_array":97,"../lib/debugtext":106,"../util/browser":193,"./vertex_array_object":122,"@mapbox/gl-matrix":6}],112:[function(require,module,exports){"use strict";var pattern=require("./pattern");module.exports=drawFill;function drawFill(painter,sourceCache,layer,coords){var gl=painter.gl;gl.enable(gl.STENCIL_TEST);var isOpaque=!layer.paint["fill-pattern"]&&layer.isPaintValueFeatureConstant("fill-color")&&layer.isPaintValueFeatureConstant("fill-opacity")&&layer.paint["fill-color"][3]===1&&layer.paint["fill-opacity"]===1;if(painter.isOpaquePass===isOpaque){painter.setDepthSublayer(1);drawFillTiles(painter,sourceCache,layer,coords,drawFillTile)}if(!painter.isOpaquePass&&layer.paint["fill-antialias"]){painter.lineWidth(2);painter.depthMask(false);painter.setDepthSublayer(layer.getPaintProperty("fill-outline-color")?2:0);drawFillTiles(painter,sourceCache,layer,coords,drawStrokeTile)}}function drawFillTiles(painter,sourceCache,layer,coords,drawFn){var firstTile=true;for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;painter.enableTileClippingMask(coord);drawFn(painter,sourceCache,layer,tile,coord,bucket.buffers,firstTile);firstTile=false}}function drawFillTile(painter,sourceCache,layer,tile,coord,buffers,firstTile){var gl=painter.gl;var layerData=buffers.layerData[layer.id];var program=setFillProgram("fill",layer.paint["fill-pattern"],painter,layerData,layer,tile,coord,firstTile);for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}function drawStrokeTile(painter,sourceCache,layer,tile,coord,buffers,firstTile){var gl=painter.gl;var layerData=buffers.layerData[layer.id];var usePattern=layer.paint["fill-pattern"]&&!layer.getPaintProperty("fill-outline-color");var program=setFillProgram("fillOutline",usePattern,painter,layerData,layer,tile,coord,firstTile);gl.uniform2f(program.u_world,gl.drawingBufferWidth,gl.drawingBufferHeight);for(var i=0,list=buffers.segments2;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer2,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.LINES,segment.primitiveLength*2,gl.UNSIGNED_SHORT,segment.primitiveOffset*2*2)}}function setFillProgram(programId,usePattern,painter,layerData,layer,tile,coord,firstTile){var program;var prevProgram=painter.currentProgram;if(!usePattern){program=painter.useProgram(programId,layerData.programConfiguration);if(firstTile||program!==prevProgram){layerData.programConfiguration.setUniforms(painter.gl,program,layer,{zoom:painter.transform.zoom})}}else{program=painter.useProgram(programId+"Pattern",layerData.programConfiguration);if(firstTile||program!==prevProgram){layerData.programConfiguration.setUniforms(painter.gl,program,layer,{zoom:painter.transform.zoom});pattern.prepare(layer.paint["fill-pattern"],painter,program)}pattern.setTile(tile,painter,program)}painter.gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["fill-translate"],layer.paint["fill-translate-anchor"]));return program}},{"./pattern":120}],113:[function(require,module,exports){"use strict";var glMatrix=require("@mapbox/gl-matrix");var Buffer=require("../data/buffer");var VertexArrayObject=require("./vertex_array_object");var PosArray=require("../data/pos_array");var pattern=require("./pattern");var mat3=glMatrix.mat3;var mat4=glMatrix.mat4;var vec3=glMatrix.vec3;module.exports=draw;function draw(painter,source,layer,coords){if(layer.paint["fill-extrusion-opacity"]===0)return;var gl=painter.gl;gl.disable(gl.STENCIL_TEST);gl.enable(gl.DEPTH_TEST);painter.depthMask(true);var texture=new ExtrusionTexture(gl,painter,layer);texture.bindFramebuffer();gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);for(var i=0;i<coords.length;i++){drawExtrusion(painter,source,layer,coords[i])}texture.unbindFramebuffer();texture.renderToMap()}function ExtrusionTexture(gl,painter,layer){this.gl=gl;this.width=painter.width;this.height=painter.height;this.painter=painter;this.layer=layer;this.texture=null;this.fbo=null;this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}ExtrusionTexture.prototype.bindFramebuffer=function(){var gl=this.gl;this.texture=this.painter.getViewportTexture(this.width,this.height);gl.activeTexture(gl.TEXTURE1);if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);this.texture.width=this.width;this.texture.height=this.height}else{gl.bindTexture(gl.TEXTURE_2D,this.texture)}if(!this.fbos){this.fbo=gl.createFramebuffer();var stencil=gl.createRenderbuffer();var depthRenderBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil);gl.bindRenderbuffer(gl.RENDERBUFFER,depthRenderBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.RGBA4,this.width,this.height);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,this.width,this.height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,stencil);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,depthRenderBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)}else{this.fbo=this.fbos.pop();gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)}};ExtrusionTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer();if(this.fbos){this.fbos.push(this.fbo)}else{if(!this.painter.preFbos[this.width])this.painter.preFbos[this.width]={};this.painter.preFbos[this.width][this.height]=[this.fbo]}this.painter.saveViewportTexture(this.texture)};ExtrusionTexture.prototype.renderToMap=function(){var gl=this.gl;var painter=this.painter;var program=painter.useProgram("extrusionTexture");gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.uniform1f(program.u_opacity,this.layer.paint["fill-extrusion-opacity"]);gl.uniform1i(program.u_texture,1);gl.uniformMatrix4fv(program.u_matrix,false,mat4.ortho(mat4.create(),0,painter.width,painter.height,0,0,1));gl.disable(gl.DEPTH_TEST);gl.uniform1i(program.u_xdim,painter.width);gl.uniform1i(program.u_ydim,painter.height);var array=new PosArray;array.emplaceBack(0,0);array.emplaceBack(painter.width,0);array.emplaceBack(0,painter.height);array.emplaceBack(painter.width,painter.height);var buffer=Buffer.fromStructArray(array,Buffer.BufferType.VERTEX);var vao=new VertexArrayObject;vao.bind(gl,program,buffer);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);gl.enable(gl.DEPTH_TEST)};function drawExtrusion(painter,source,layer,coord){if(painter.isOpaquePass)return;var tile=source.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)return;var buffers=bucket.buffers;var gl=painter.gl;var image=layer.paint["fill-extrusion-pattern"];var layerData=buffers.layerData[layer.id];var programConfiguration=layerData.programConfiguration;var program=painter.useProgram(image?"fillExtrusionPattern":"fillExtrusion",programConfiguration);programConfiguration.setUniforms(gl,program,layer,{zoom:painter.transform.zoom});if(image){pattern.prepare(image,painter,program);pattern.setTile(tile,painter,program);gl.uniform1f(program.u_height_factor,-Math.pow(2,coord.z)/tile.tileSize/8)}painter.gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["fill-extrusion-translate"],layer.paint["fill-extrusion-translate-anchor"]));setLight(program,painter);for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}function setLight(program,painter){var gl=painter.gl;var light=painter.style.light;var _lp=light.calculated.position,lightPos=[_lp.x,_lp.y,_lp.z];var lightMat=mat3.create();if(light.calculated.anchor==="viewport")mat3.fromRotation(lightMat,-painter.transform.angle);vec3.transformMat3(lightPos,lightPos,lightMat);gl.uniform3fv(program.u_lightpos,lightPos);gl.uniform1f(program.u_lightintensity,light.calculated.intensity);gl.uniform3fv(program.u_lightcolor,light.calculated.color.slice(0,3))}},{"../data/buffer":91,"../data/pos_array":97,"./pattern":120,"./vertex_array_object":122,"@mapbox/gl-matrix":6}],114:[function(require,module,exports){"use strict";var browser=require("../util/browser");var pixelsToTileUnits=require("../source/pixels_to_tile_units");module.exports=function drawLine(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;painter.setDepthSublayer(0);painter.depthMask(false);var gl=painter.gl;gl.enable(gl.STENCIL_TEST);if(layer.paint["line-width"]<=0)return;var programId=layer.paint["line-dasharray"]?"lineSDF":layer.paint["line-pattern"]?"linePattern":"line";var prevTileZoom;var firstTile=true;for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var layerData=bucket.buffers.layerData[layer.id];var prevProgram=painter.currentProgram;var program=painter.useProgram(programId,layerData.programConfiguration);var programChanged=firstTile||program!==prevProgram;var tileRatioChanged=prevTileZoom!==tile.coord.z;if(programChanged){layerData.programConfiguration.setUniforms(painter.gl,program,layer,{zoom:painter.transform.zoom})}drawLineTile(program,painter,tile,bucket.buffers,layer,coord,layerData,programChanged,tileRatioChanged);prevTileZoom=tile.coord.z;firstTile=false}};function drawLineTile(program,painter,tile,buffers,layer,coord,layerData,programChanged,tileRatioChanged){var gl=painter.gl;var dasharray=layer.paint["line-dasharray"];var image=layer.paint["line-pattern"];var posA,posB,imagePosA,imagePosB;if(programChanged||tileRatioChanged){var tileRatio=1/pixelsToTileUnits(tile,1,painter.transform.tileZoom);if(dasharray){posA=painter.lineAtlas.getDash(dasharray.from,layer.layout["line-cap"]==="round");posB=painter.lineAtlas.getDash(dasharray.to,layer.layout["line-cap"]==="round");var widthA=posA.width*dasharray.fromScale;var widthB=posB.width*dasharray.toScale;gl.uniform2f(program.u_patternscale_a,tileRatio/widthA,-posA.height/2);gl.uniform2f(program.u_patternscale_b,tileRatio/widthB,-posB.height/2);gl.uniform1f(program.u_sdfgamma,painter.lineAtlas.width/(Math.min(widthA,widthB)*256*browser.devicePixelRatio)/2)}else if(image){imagePosA=painter.spriteAtlas.getPosition(image.from,true);imagePosB=painter.spriteAtlas.getPosition(image.to,true);if(!imagePosA||!imagePosB)return;gl.uniform2f(program.u_pattern_size_a,imagePosA.size[0]*image.fromScale/tileRatio,imagePosB.size[1]);gl.uniform2f(program.u_pattern_size_b,imagePosB.size[0]*image.toScale/tileRatio,imagePosB.size[1])}gl.uniform2f(program.u_gl_units_to_pixels,1/painter.transform.pixelsToGLUnits[0],1/painter.transform.pixelsToGLUnits[1])}if(programChanged){if(dasharray){gl.uniform1i(program.u_image,0);gl.activeTexture(gl.TEXTURE0);painter.lineAtlas.bind(gl);gl.uniform1f(program.u_tex_y_a,posA.y);gl.uniform1f(program.u_tex_y_b,posB.y);gl.uniform1f(program.u_mix,dasharray.t)}else if(image){gl.uniform1i(program.u_image,0);gl.activeTexture(gl.TEXTURE0);painter.spriteAtlas.bind(gl,true);gl.uniform2fv(program.u_pattern_tl_a,imagePosA.tl);gl.uniform2fv(program.u_pattern_br_a,imagePosA.br);gl.uniform2fv(program.u_pattern_tl_b,imagePosB.tl);gl.uniform2fv(program.u_pattern_br_b,imagePosB.br);gl.uniform1f(program.u_fade,image.t)}gl.uniform1f(program.u_width,layer.paint["line-width"])}painter.enableTileClippingMask(coord);var posMatrix=painter.translatePosMatrix(coord.posMatrix,tile,layer.paint["line-translate"],layer.paint["line-translate-anchor"]);gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.uniform1f(program.u_ratio,1/pixelsToTileUnits(tile,1,painter.transform.zoom));for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,layerData.paintVertexBuffer,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}},{"../source/pixels_to_tile_units":129,"../util/browser":193}],115:[function(require,module,exports){"use strict";var util=require("../util/util");module.exports=drawRaster;function drawRaster(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;var gl=painter.gl;gl.enable(gl.DEPTH_TEST);painter.depthMask(true);gl.depthFunc(gl.LESS);var minTileZ=coords.length&&coords[0].z;for(var i=0;i<coords.length;i++){var coord=coords[i];painter.setDepthSublayer(coord.z-minTileZ);drawRasterTile(painter,sourceCache,layer,coord)}gl.depthFunc(gl.LEQUAL)}function drawRasterTile(painter,sourceCache,layer,coord){var gl=painter.gl;gl.disable(gl.STENCIL_TEST);var tile=sourceCache.getTile(coord);var posMatrix=painter.transform.calculatePosMatrix(coord,sourceCache.getSource().maxzoom);tile.registerFadeDuration(painter.style.animationLoop,layer.paint["raster-fade-duration"]);var program=painter.useProgram("raster");gl.uniformMatrix4fv(program.u_matrix,false,posMatrix);gl.uniform1f(program.u_brightness_low,layer.paint["raster-brightness-min"]);gl.uniform1f(program.u_brightness_high,layer.paint["raster-brightness-max"]);gl.uniform1f(program.u_saturation_factor,saturationFactor(layer.paint["raster-saturation"]));gl.uniform1f(program.u_contrast_factor,contrastFactor(layer.paint["raster-contrast"]));gl.uniform3fv(program.u_spin_weights,spinWeights(layer.paint["raster-hue-rotate"]));var parentTile=tile.sourceCache&&tile.sourceCache.findLoadedParent(coord,0,{}),fade=getFadeValues(tile,parentTile,layer,painter.transform);var parentScaleBy,parentTL;gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,tile.texture);gl.activeTexture(gl.TEXTURE1);if(parentTile){gl.bindTexture(gl.TEXTURE_2D,parentTile.texture);parentScaleBy=Math.pow(2,parentTile.coord.z-tile.coord.z);parentTL=[tile.coord.x*parentScaleBy%1,tile.coord.y*parentScaleBy%1]}else{gl.bindTexture(gl.TEXTURE_2D,tile.texture)}gl.uniform2fv(program.u_tl_parent,parentTL||[0,0]);gl.uniform1f(program.u_scale_parent,parentScaleBy||1);gl.uniform1f(program.u_buffer_scale,1);gl.uniform1f(program.u_fade_t,fade.mix);gl.uniform1f(program.u_opacity,fade.opacity*layer.paint["raster-opacity"]);gl.uniform1i(program.u_image0,0);gl.uniform1i(program.u_image1,1);var buffer=tile.boundsBuffer||painter.rasterBoundsBuffer;var vao=tile.boundsVAO||painter.rasterBoundsVAO;vao.bind(gl,program,buffer);gl.drawArrays(gl.TRIANGLE_STRIP,0,buffer.length)}function spinWeights(angle){angle*=Math.PI/180;var s=Math.sin(angle);var c=Math.cos(angle);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}function contrastFactor(contrast){return contrast>0?1/(1-contrast):1+contrast}function saturationFactor(saturation){return saturation>0?1-1/(1.001-saturation):-saturation}function getFadeValues(tile,parentTile,layer,transform){var fadeDuration=layer.paint["raster-fade-duration"];if(tile.sourceCache&&fadeDuration>0){var now=Date.now();var sinceTile=(now-tile.timeAdded)/fadeDuration;var sinceParent=parentTile?(now-parentTile.timeAdded)/fadeDuration:-1;var source=tile.sourceCache.getSource();var idealZ=transform.coveringZoomLevel({tileSize:source.tileSize,roundZoom:source.roundZoom});var fadeIn=!parentTile||Math.abs(parentTile.coord.z-idealZ)>Math.abs(tile.coord.z-idealZ);var childOpacity=util.clamp(fadeIn?sinceTile:1-sinceParent,0,1);if(parentTile){return{opacity:1,mix:1-childOpacity}}else{return{opacity:childOpacity,mix:0}}}else{return{opacity:1,mix:0}}}},{"../util/util":212}],116:[function(require,module,exports){"use strict";var browser=require("../util/browser");var drawCollisionDebug=require("./draw_collision_debug");var pixelsToTileUnits=require("../source/pixels_to_tile_units");module.exports=drawSymbols;var sdfPx=8;var blurOffset=1.19;var haloOffset=6;var gamma=.105/browser.devicePixelRatio;function drawSymbols(painter,sourceCache,layer,coords){if(painter.isOpaquePass)return;var drawAcrossEdges=!layer.layout["text-allow-overlap"]&&!layer.layout["icon-allow-overlap"]&&!layer.layout["text-ignore-placement"]&&!layer.layout["icon-ignore-placement"];var gl=painter.gl;if(drawAcrossEdges){gl.disable(gl.STENCIL_TEST)}else{gl.enable(gl.STENCIL_TEST)}painter.setDepthSublayer(0);painter.depthMask(false);drawLayerSymbols(painter,sourceCache,layer,coords,false,layer.paint["icon-translate"],layer.paint["icon-translate-anchor"],layer.layout["icon-rotation-alignment"],layer.layout["icon-rotation-alignment"],layer.layout["icon-size"],layer.paint["icon-halo-width"],layer.paint["icon-halo-color"],layer.paint["icon-halo-blur"],layer.paint["icon-opacity"],layer.paint["icon-color"]);drawLayerSymbols(painter,sourceCache,layer,coords,true,layer.paint["text-translate"],layer.paint["text-translate-anchor"],layer.layout["text-rotation-alignment"],layer.layout["text-pitch-alignment"],layer.layout["text-size"],layer.paint["text-halo-width"],layer.paint["text-halo-color"],layer.paint["text-halo-blur"],layer.paint["text-opacity"],layer.paint["text-color"]);if(sourceCache.map.showCollisionBoxes){drawCollisionDebug(painter,sourceCache,layer,coords)}}function drawLayerSymbols(painter,sourceCache,layer,coords,isText,translate,translateAnchor,rotationAlignment,pitchAlignment,size,haloWidth,haloColor,haloBlur,opacity,color){if(!isText&&painter.style.sprite&&!painter.style.sprite.loaded())return;var gl=painter.gl;var rotateWithMap=rotationAlignment==="map";var pitchWithMap=pitchAlignment==="map";var depthOn=pitchWithMap;if(depthOn){gl.enable(gl.DEPTH_TEST)}else{gl.disable(gl.DEPTH_TEST)}var program,prevFontstack;for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var tile=sourceCache.getTile(coord);var bucket=tile.getBucket(layer);if(!bucket)continue;var buffers=isText?bucket.buffers.glyph:bucket.buffers.icon;if(!buffers||!buffers.segments.length)continue;var isSDF=isText||bucket.sdfIcons;if(!program||bucket.fontstack!==prevFontstack){program=painter.useProgram(isSDF?"symbolSDF":"symbolIcon");setSymbolDrawState(program,painter,isText,isSDF,rotateWithMap,pitchWithMap,bucket.fontstack,size,bucket.iconsNeedLinear,isText?bucket.adjustedTextSize:bucket.adjustedIconSize,opacity)}painter.enableTileClippingMask(coord);gl.uniformMatrix4fv(program.u_matrix,false,painter.translatePosMatrix(coord.posMatrix,tile,translate,translateAnchor));drawTileSymbols(program,painter,layer,tile,buffers,isText,isSDF,pitchWithMap,size,haloWidth,haloColor,haloBlur,color);prevFontstack=bucket.fontstack}if(!depthOn)gl.enable(gl.DEPTH_TEST)}function setSymbolDrawState(program,painter,isText,isSDF,rotateWithMap,pitchWithMap,fontstack,size,iconsNeedLinear,adjustedSize,opacity){var gl=painter.gl;var tr=painter.transform;gl.uniform1i(program.u_rotate_with_map,rotateWithMap);gl.uniform1i(program.u_pitch_with_map,pitchWithMap);gl.activeTexture(gl.TEXTURE0);gl.uniform1i(program.u_texture,0);if(isText){var glyphAtlas=fontstack&&painter.glyphSource.getGlyphAtlas(fontstack);if(!glyphAtlas)return;glyphAtlas.updateTexture(gl);gl.uniform2f(program.u_texsize,glyphAtlas.width/4,glyphAtlas.height/4)}else{var mapMoving=painter.options.rotating||painter.options.zooming;var iconScaled=size!==1||browser.devicePixelRatio!==painter.spriteAtlas.pixelRatio||iconsNeedLinear;var iconTransformed=pitchWithMap||tr.pitch;painter.spriteAtlas.bind(gl,isSDF||mapMoving||iconScaled||iconTransformed);gl.uniform2f(program.u_texsize,painter.spriteAtlas.width/4,painter.spriteAtlas.height/4)}gl.activeTexture(gl.TEXTURE1);painter.frameHistory.bind(gl);gl.uniform1i(program.u_fadetexture,1);var zoomAdjust=Math.log(size/adjustedSize)/Math.LN2||0;gl.uniform1f(program.u_zoom,(tr.zoom-zoomAdjust)*10);gl.uniform1f(program.u_pitch,tr.pitch/360*2*Math.PI);gl.uniform1f(program.u_bearing,tr.bearing/360*2*Math.PI);gl.uniform1f(program.u_aspect_ratio,tr.width/tr.height);gl.uniform1f(program.u_opacity,opacity)}function drawTileSymbols(program,painter,layer,tile,buffers,isText,isSDF,pitchWithMap,size,haloWidth,haloColor,haloBlur,color){var gl=painter.gl;var tr=painter.transform;var fontScale=size/(isText?24:1);if(pitchWithMap){var s=pixelsToTileUnits(tile,fontScale,tr.zoom);gl.uniform2f(program.u_extrude_scale,s,s)}else{var s$1=tr.cameraToCenterDistance*fontScale;gl.uniform2f(program.u_extrude_scale,tr.pixelsToGLUnits[0]*s$1,tr.pixelsToGLUnits[1]*s$1)}if(isSDF){var gammaScale=fontScale*(pitchWithMap?Math.cos(tr._pitch):1)*tr.cameraToCenterDistance;if(haloWidth){gl.uniform1f(program.u_gamma,(haloBlur*blurOffset/sdfPx+gamma)/gammaScale);gl.uniform4fv(program.u_color,haloColor);gl.uniform1f(program.u_buffer,(haloOffset-haloWidth/fontScale)/sdfPx);

drawSymbolElements(buffers,layer,gl,program)}gl.uniform1f(program.u_gamma,gamma/gammaScale);gl.uniform4fv(program.u_color,color);gl.uniform1f(program.u_buffer,(256-64)/256)}drawSymbolElements(buffers,layer,gl,program)}function drawSymbolElements(buffers,layer,gl,program){for(var i=0,list=buffers.segments;i<list.length;i+=1){var segment=list[i];segment.vaos[layer.id].bind(gl,program,buffers.layoutVertexBuffer,buffers.elementBuffer,null,segment.vertexOffset);gl.drawElements(gl.TRIANGLES,segment.primitiveLength*3,gl.UNSIGNED_SHORT,segment.primitiveOffset*3*2)}}},{"../source/pixels_to_tile_units":129,"../util/browser":193,"./draw_collision_debug":110}],117:[function(require,module,exports){"use strict";var FrameHistory=function FrameHistory(){this.changeTimes=new Float64Array(256);this.changeOpacities=new Uint8Array(256);this.opacities=new Uint8ClampedArray(256);this.array=new Uint8Array(this.opacities.buffer);this.previousZoom=0;this.firstFrame=true};FrameHistory.prototype.record=function record(now,zoom,duration){var this$1=this;if(this.firstFrame){now=0;this.firstFrame=false}zoom=Math.floor(zoom*10);var z;if(zoom<this.previousZoom){for(z=zoom+1;z<=this.previousZoom;z++){this$1.changeTimes[z]=now;this$1.changeOpacities[z]=this$1.opacities[z]}}else{for(z=zoom;z>this.previousZoom;z--){this$1.changeTimes[z]=now;this$1.changeOpacities[z]=this$1.opacities[z]}}for(z=0;z<256;z++){var timeSince=now-this$1.changeTimes[z];var opacityChange=(duration?timeSince/duration:1)*255;if(z<=zoom){this$1.opacities[z]=this$1.changeOpacities[z]+opacityChange}else{this$1.opacities[z]=this$1.changeOpacities[z]-opacityChange}}this.changed=true;this.previousZoom=zoom};FrameHistory.prototype.bind=function bind(gl){if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texImage2D(gl.TEXTURE_2D,0,gl.ALPHA,256,1,0,gl.ALPHA,gl.UNSIGNED_BYTE,this.array)}else{gl.bindTexture(gl.TEXTURE_2D,this.texture);if(this.changed){gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,256,1,gl.ALPHA,gl.UNSIGNED_BYTE,this.array);this.changed=false}}};module.exports=FrameHistory},{}],118:[function(require,module,exports){"use strict";var util=require("../util/util");var LineAtlas=function LineAtlas(width,height){this.width=width;this.height=height;this.nextRow=0;this.bytes=4;this.data=new Uint8Array(this.width*this.height*this.bytes);this.positions={}};LineAtlas.prototype.setSprite=function setSprite(sprite){this.sprite=sprite};LineAtlas.prototype.getDash=function getDash(dasharray,round){var key=dasharray.join(",")+round;if(!this.positions[key]){this.positions[key]=this.addDash(dasharray,round)}return this.positions[key]};LineAtlas.prototype.addDash=function addDash(dasharray,round){var this$1=this;var n=round?7:0;var height=2*n+1;var offset=128;if(this.nextRow+height>this.height){util.warnOnce("LineAtlas out of space");return null}var length=0;for(var i=0;i<dasharray.length;i++){length+=dasharray[i]}var stretch=this.width/length;var halfWidth=stretch/2;var oddLength=dasharray.length%2===1;for(var y=-n;y<=n;y++){var row=this$1.nextRow+n+y;var index=this$1.width*row;var left=oddLength?-dasharray[dasharray.length-1]:0;var right=dasharray[0];var partIndex=1;for(var x=0;x<this.width;x++){while(right<x/stretch){left=right;right=right+dasharray[partIndex];if(oddLength&&partIndex===dasharray.length-1){right+=dasharray[0]}partIndex++}var distLeft=Math.abs(x-left*stretch);var distRight=Math.abs(x-right*stretch);var dist=Math.min(distLeft,distRight);var inside=partIndex%2===1;var signedDistance;if(round){var distMiddle=n?y/n*(halfWidth+1):0;if(inside){var distEdge=halfWidth-Math.abs(distMiddle);signedDistance=Math.sqrt(dist*dist+distEdge*distEdge)}else{signedDistance=halfWidth-Math.sqrt(dist*dist+distMiddle*distMiddle)}}else{signedDistance=(inside?1:-1)*dist}this$1.data[3+(index+x)*4]=Math.max(0,Math.min(255,signedDistance+offset))}}var pos={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:length};this.nextRow+=height;this.dirty=true;return pos};LineAtlas.prototype.bind=function bind(gl){if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,this.data)}else{gl.bindTexture(gl.TEXTURE_2D,this.texture);if(this.dirty){this.dirty=false;gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.width,this.height,gl.RGBA,gl.UNSIGNED_BYTE,this.data)}}};module.exports=LineAtlas},{"../util/util":212}],119:[function(require,module,exports){"use strict";var browser=require("../util/browser");var mat4=require("@mapbox/gl-matrix").mat4;var FrameHistory=require("./frame_history");var SourceCache=require("../source/source_cache");var EXTENT=require("../data/extent");var pixelsToTileUnits=require("../source/pixels_to_tile_units");var util=require("../util/util");var Buffer=require("../data/buffer");var VertexArrayObject=require("./vertex_array_object");var RasterBoundsArray=require("../data/raster_bounds_array");var PosArray=require("../data/pos_array");var ProgramConfiguration=require("../data/program_configuration");var shaders=require("./shaders");var draw={symbol:require("./draw_symbol"),circle:require("./draw_circle"),line:require("./draw_line"),fill:require("./draw_fill"),"fill-extrusion":require("./draw_fill_extrusion"),raster:require("./draw_raster"),background:require("./draw_background"),debug:require("./draw_debug")};var Painter=function Painter(gl,transform){this.gl=gl;this.transform=transform;this.reusableTextures={tiles:{},viewport:null};this.preFbos={};this.frameHistory=new FrameHistory;this.setup();this.numSublayers=SourceCache.maxUnderzooming+SourceCache.maxOverzooming+1;this.depthEpsilon=1/Math.pow(2,16);this.lineWidthRange=gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE);this.basicFillProgramConfiguration=ProgramConfiguration.createStatic(["color","opacity"]);this.emptyProgramConfiguration=new ProgramConfiguration};Painter.prototype.resize=function resize(width,height){var gl=this.gl;this.width=width*browser.devicePixelRatio;this.height=height*browser.devicePixelRatio;gl.viewport(0,0,this.width,this.height)};Painter.prototype.setup=function setup(){var gl=this.gl;gl.verbose=true;gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.STENCIL_TEST);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);this._depthMask=false;gl.depthMask(false);var tileExtentArray=new PosArray;tileExtentArray.emplaceBack(0,0);tileExtentArray.emplaceBack(EXTENT,0);tileExtentArray.emplaceBack(0,EXTENT);tileExtentArray.emplaceBack(EXTENT,EXTENT);this.tileExtentBuffer=Buffer.fromStructArray(tileExtentArray,Buffer.BufferType.VERTEX);this.tileExtentVAO=new VertexArrayObject;this.tileExtentPatternVAO=new VertexArrayObject;var debugArray=new PosArray;debugArray.emplaceBack(0,0);debugArray.emplaceBack(EXTENT,0);debugArray.emplaceBack(EXTENT,EXTENT);debugArray.emplaceBack(0,EXTENT);debugArray.emplaceBack(0,0);this.debugBuffer=Buffer.fromStructArray(debugArray,Buffer.BufferType.VERTEX);this.debugVAO=new VertexArrayObject;var rasterBoundsArray=new RasterBoundsArray;rasterBoundsArray.emplaceBack(0,0,0,0);rasterBoundsArray.emplaceBack(EXTENT,0,32767,0);rasterBoundsArray.emplaceBack(0,EXTENT,0,32767);rasterBoundsArray.emplaceBack(EXTENT,EXTENT,32767,32767);this.rasterBoundsBuffer=Buffer.fromStructArray(rasterBoundsArray,Buffer.BufferType.VERTEX);this.rasterBoundsVAO=new VertexArrayObject};Painter.prototype.clearColor=function clearColor(){var gl=this.gl;gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT)};Painter.prototype.clearStencil=function clearStencil(){var gl=this.gl;gl.clearStencil(0);gl.stencilMask(255);gl.clear(gl.STENCIL_BUFFER_BIT)};Painter.prototype.clearDepth=function clearDepth(){var gl=this.gl;gl.clearDepth(1);this.depthMask(true);gl.clear(gl.DEPTH_BUFFER_BIT)};Painter.prototype._renderTileClippingMasks=function _renderTileClippingMasks(coords){var this$1=this;var gl=this.gl;gl.colorMask(false,false,false,false);this.depthMask(false);gl.disable(gl.DEPTH_TEST);gl.enable(gl.STENCIL_TEST);gl.stencilMask(248);gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE);var idNext=1;this._tileClippingMaskIDs={};for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];var id=this$1._tileClippingMaskIDs[coord.id]=idNext++<<3;gl.stencilFunc(gl.ALWAYS,id,248);var program=this$1.useProgram("fill",this$1.basicFillProgramConfiguration);gl.uniformMatrix4fv(program.u_matrix,false,coord.posMatrix);this$1.tileExtentVAO.bind(gl,program,this$1.tileExtentBuffer);gl.drawArrays(gl.TRIANGLE_STRIP,0,this$1.tileExtentBuffer.length)}gl.stencilMask(0);gl.colorMask(true,true,true,true);this.depthMask(true);gl.enable(gl.DEPTH_TEST)};Painter.prototype.enableTileClippingMask=function enableTileClippingMask(coord){var gl=this.gl;gl.stencilFunc(gl.EQUAL,this._tileClippingMaskIDs[coord.id],248)};Painter.prototype.prepareBuffers=function prepareBuffers(){};Painter.prototype.bindDefaultFramebuffer=function bindDefaultFramebuffer(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,null)};Painter.prototype.render=function render(style,options){this.style=style;this.options=options;this.lineAtlas=style.lineAtlas;this.spriteAtlas=style.spriteAtlas;this.spriteAtlas.setSprite(style.sprite);this.glyphSource=style.glyphSource;this.frameHistory.record(Date.now(),this.transform.zoom,style.getTransition().duration);this.prepareBuffers();this.clearColor();this.clearDepth();this.showOverdrawInspector(options.showOverdrawInspector);this.depthRange=(style._order.length+2)*this.numSublayers*this.depthEpsilon;this.isOpaquePass=true;this.renderPass();this.isOpaquePass=false;this.renderPass();if(this.options.showTileBoundaries){var sourceCache=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];if(sourceCache){draw.debug(this,sourceCache,sourceCache.getVisibleCoordinates())}}};Painter.prototype.renderPass=function renderPass(){var this$1=this;var layerIds=this.style._order;var sourceCache,coords;this.currentLayer=this.isOpaquePass?layerIds.length-1:0;if(this.isOpaquePass){if(!this._showOverdrawInspector){this.gl.disable(this.gl.BLEND)}}else{this.gl.enable(this.gl.BLEND)}for(var i=0;i<layerIds.length;i++){var layer=this$1.style._layers[layerIds[this$1.currentLayer]];if(layer.source!==(sourceCache&&sourceCache.id)){sourceCache=this$1.style.sourceCaches[layer.source];coords=[];if(sourceCache){if(sourceCache.prepare)sourceCache.prepare();this$1.clearStencil();coords=sourceCache.getVisibleCoordinates();if(sourceCache.getSource().isTileClipped){this$1._renderTileClippingMasks(coords)}}if(!this$1.isOpaquePass){coords.reverse()}}this$1.renderLayer(this$1,sourceCache,layer,coords);this$1.currentLayer+=this$1.isOpaquePass?-1:1}};Painter.prototype.depthMask=function depthMask(mask){if(mask!==this._depthMask){this._depthMask=mask;this.gl.depthMask(mask)}};Painter.prototype.renderLayer=function renderLayer(painter,sourceCache,layer,coords){if(layer.isHidden(this.transform.zoom))return;if(layer.type!=="background"&&!coords.length)return;this.id=layer.id;draw[layer.type](painter,sourceCache,layer,coords)};Painter.prototype.setDepthSublayer=function setDepthSublayer(n){var farDepth=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;var nearDepth=farDepth-1+this.depthRange;this.gl.depthRange(nearDepth,farDepth)};Painter.prototype.translatePosMatrix=function translatePosMatrix(matrix,tile,translate,anchor){if(!translate[0]&&!translate[1])return matrix;if(anchor==="viewport"){var sinA=Math.sin(-this.transform.angle);var cosA=Math.cos(-this.transform.angle);translate=[translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA]}var translation=[pixelsToTileUnits(tile,translate[0],this.transform.zoom),pixelsToTileUnits(tile,translate[1],this.transform.zoom),0];var translatedMatrix=new Float32Array(16);mat4.translate(translatedMatrix,matrix,translation);return translatedMatrix};Painter.prototype.saveTileTexture=function saveTileTexture(texture){var textures=this.reusableTextures.tiles[texture.size];if(!textures){this.reusableTextures.tiles[texture.size]=[texture]}else{textures.push(texture)}};Painter.prototype.saveViewportTexture=function saveViewportTexture(texture){this.reusableTextures.viewport=texture};Painter.prototype.getTileTexture=function getTileTexture(size){var textures=this.reusableTextures.tiles[size];return textures&&textures.length>0?textures.pop():null};Painter.prototype.getViewportTexture=function getViewportTexture(width,height){var texture=this.reusableTextures.viewport;if(!texture)return;if(texture.width===width&&texture.height===height){return texture}else{this.gl.deleteTexture(texture);this.reusableTextures.viewport=null;return}};Painter.prototype.lineWidth=function lineWidth(width){this.gl.lineWidth(util.clamp(width,this.lineWidthRange[0],this.lineWidthRange[1]))};Painter.prototype.showOverdrawInspector=function showOverdrawInspector(enabled){if(!enabled&&!this._showOverdrawInspector)return;this._showOverdrawInspector=enabled;var gl=this.gl;if(enabled){gl.blendFunc(gl.CONSTANT_COLOR,gl.ONE);var numOverdrawSteps=8;var a=1/numOverdrawSteps;gl.blendColor(a,a,a,0);gl.clearColor(0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT)}else{gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}};Painter.prototype.createProgram=function createProgram(name,configuration){var gl=this.gl;var program=gl.createProgram();var definition=shaders[name];var definesSource="#define MAPBOX_GL_JS\n#define DEVICE_PIXEL_RATIO "+browser.devicePixelRatio.toFixed(1)+"\n";if(this._showOverdrawInspector){definesSource+="#define OVERDRAW_INSPECTOR;\n"}var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,configuration.applyPragmas(definesSource+shaders.prelude.fragmentSource+definition.fragmentSource,"fragment"));gl.compileShader(fragmentShader);gl.attachShader(program,fragmentShader);var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,configuration.applyPragmas(definesSource+shaders.prelude.vertexSource+definition.vertexSource,"vertex"));gl.compileShader(vertexShader);gl.attachShader(program,vertexShader);gl.linkProgram(program);var numAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);var result={program:program,numAttributes:numAttributes};for(var i=0;i<numAttributes;i++){var attribute=gl.getActiveAttrib(program,i);result[attribute.name]=gl.getAttribLocation(program,attribute.name)}var numUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i$1=0;i$1<numUniforms;i$1++){var uniform=gl.getActiveUniform(program,i$1);result[uniform.name]=gl.getUniformLocation(program,uniform.name)}return result};Painter.prototype._createProgramCached=function _createProgramCached(name,programConfiguration){this.cache=this.cache||{};var key=""+name+(programConfiguration.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");if(!this.cache[key]){this.cache[key]=this.createProgram(name,programConfiguration)}return this.cache[key]};Painter.prototype.useProgram=function useProgram(name,programConfiguration){var gl=this.gl;var nextProgram=this._createProgramCached(name,programConfiguration||this.emptyProgramConfiguration);if(this.currentProgram!==nextProgram){gl.useProgram(nextProgram.program);this.currentProgram=nextProgram}return nextProgram};module.exports=Painter},{"../data/buffer":91,"../data/extent":94,"../data/pos_array":97,"../data/program_configuration":98,"../data/raster_bounds_array":99,"../source/pixels_to_tile_units":129,"../source/source_cache":134,"../util/browser":193,"../util/util":212,"./draw_background":108,"./draw_circle":109,"./draw_debug":111,"./draw_fill":112,"./draw_fill_extrusion":113,"./draw_line":114,"./draw_raster":115,"./draw_symbol":116,"./frame_history":117,"./shaders":121,"./vertex_array_object":122,"@mapbox/gl-matrix":6}],120:[function(require,module,exports){"use strict";var pixelsToTileUnits=require("../source/pixels_to_tile_units");exports.prepare=function(image,painter,program){var gl=painter.gl;var imagePosA=painter.spriteAtlas.getPosition(image.from,true);var imagePosB=painter.spriteAtlas.getPosition(image.to,true);if(!imagePosA||!imagePosB)return;gl.uniform1i(program.u_image,0);gl.uniform2fv(program.u_pattern_tl_a,imagePosA.tl);gl.uniform2fv(program.u_pattern_br_a,imagePosA.br);gl.uniform2fv(program.u_pattern_tl_b,imagePosB.tl);gl.uniform2fv(program.u_pattern_br_b,imagePosB.br);gl.uniform1f(program.u_mix,image.t);gl.uniform2fv(program.u_pattern_size_a,imagePosA.size);gl.uniform2fv(program.u_pattern_size_b,imagePosB.size);gl.uniform1f(program.u_scale_a,image.fromScale);gl.uniform1f(program.u_scale_b,image.toScale);gl.activeTexture(gl.TEXTURE0);painter.spriteAtlas.bind(gl,true)};exports.setTile=function(tile,painter,program){var gl=painter.gl;gl.uniform1f(program.u_tile_units_to_pixels,1/pixelsToTileUnits(tile,1,painter.transform.tileZoom));var numTiles=Math.pow(2,tile.coord.z);var tileSizeAtNearestZoom=tile.tileSize*Math.pow(2,painter.transform.tileZoom)/numTiles;var pixelX=tileSizeAtNearestZoom*(tile.coord.x+tile.coord.w*numTiles);var pixelY=tileSizeAtNearestZoom*tile.coord.y;gl.uniform2f(program.u_pixel_coord_upper,pixelX>>16,pixelY>>16);gl.uniform2f(program.u_pixel_coord_lower,pixelX&65535,pixelY&65535)}},{"../source/pixels_to_tile_units":129}],121:[function(require,module,exports){"use strict";var path=require("path");module.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\nuniform float u_maxzoom;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    if (v_placement_zoom > u_zoom) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    if (u_zoom >= v_max_zoom) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n}\n"},debug:{fragmentSource:"uniform lowp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    gl_FragColor = v_color;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform lowp vec4 u_outline_color;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n#ifdef OUTLINE\n    color = u_outline_color;\n#endif\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",
vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos.x = a_pos.x / float(u_xdim);\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},line:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_opacity;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * u_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp vec4 u_color;\nuniform lowp float u_opacity;\nuniform lowp float u_buffer;\nuniform lowp float u_gamma;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    lowp float gamma = u_gamma * v_gamma_scale;\n    lowp float alpha = smoothstep(u_buffer - gamma, u_buffer + gamma, dist) * fade_alpha;\n\n    gl_FragColor = u_color * (alpha * u_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"}}},{path:220}],122:[function(require,module,exports){"use strict";var VertexArrayObject=function VertexArrayObject(){this.boundProgram=null;this.boundVertexBuffer=null;this.boundVertexBuffer2=null;this.boundElementBuffer=null;this.boundVertexOffset=null;this.vao=null};VertexArrayObject.prototype.bind=function bind(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2,vertexOffset){if(gl.extVertexArrayObject===undefined){gl.extVertexArrayObject=gl.getExtension("OES_vertex_array_object")}var isFreshBindRequired=!this.vao||this.boundProgram!==program||this.boundVertexBuffer!==layoutVertexBuffer||this.boundVertexBuffer2!==vertexBuffer2||this.boundElementBuffer!==elementBuffer||this.boundVertexOffset!==vertexOffset;if(!gl.extVertexArrayObject||isFreshBindRequired){this.freshBind(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2,vertexOffset);this.gl=gl}else{gl.extVertexArrayObject.bindVertexArrayOES(this.vao)}};VertexArrayObject.prototype.freshBind=function freshBind(gl,program,layoutVertexBuffer,elementBuffer,vertexBuffer2,vertexOffset){var numPrevAttributes;var numNextAttributes=program.numAttributes;if(gl.extVertexArrayObject){if(this.vao)this.destroy();this.vao=gl.extVertexArrayObject.createVertexArrayOES();gl.extVertexArrayObject.bindVertexArrayOES(this.vao);numPrevAttributes=0;this.boundProgram=program;this.boundVertexBuffer=layoutVertexBuffer;this.boundVertexBuffer2=vertexBuffer2;this.boundElementBuffer=elementBuffer;this.boundVertexOffset=vertexOffset}else{numPrevAttributes=gl.currentNumAttributes||0;for(var i=numNextAttributes;i<numPrevAttributes;i++){gl.disableVertexAttribArray(i)}}for(var j=numPrevAttributes;j<numNextAttributes;j++){gl.enableVertexAttribArray(j)}layoutVertexBuffer.bind(gl);layoutVertexBuffer.setVertexAttribPointers(gl,program,vertexOffset);if(vertexBuffer2){vertexBuffer2.bind(gl);vertexBuffer2.setVertexAttribPointers(gl,program,vertexOffset)}if(elementBuffer){elementBuffer.bind(gl)}gl.currentNumAttributes=numNextAttributes};VertexArrayObject.prototype.destroy=function destroy(){if(this.vao){this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao);this.vao=null}};module.exports=VertexArrayObject},{}],123:[function(require,module,exports){"use strict";var ImageSource=require("./image_source");var window=require("../util/window");var CanvasSource=function(ImageSource){function CanvasSource(id,options,dispatcher,eventedParent){ImageSource.call(this,id,options,dispatcher,eventedParent);this.options=options;this.animate=options.hasOwnProperty("animate")?options.animate:true}if(ImageSource)CanvasSource.__proto__=ImageSource;CanvasSource.prototype=Object.create(ImageSource&&ImageSource.prototype);CanvasSource.prototype.constructor=CanvasSource;CanvasSource.prototype.load=function load(){this.canvas=this.canvas||window.document.getElementById(this.options.canvas);this.width=this.canvas.width;this.height=this.canvas.height;if(this._hasInvalidDimensions(this.canvas))return this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero."));var loopID;this.play=function(){loopID=this.map.style.animationLoop.set(Infinity);this.map._rerender()};this.pause=function(){this.map.style.animationLoop.cancel(loopID)};this._finishLoading()};CanvasSource.prototype.getCanvas=function getCanvas(){return this.canvas};CanvasSource.prototype.onAdd=function onAdd(map){if(this.map)return;this.map=map;this.load();if(this.canvas){if(this.animate)this.play();this.setCoordinates(this.coordinates)}};CanvasSource.prototype.prepare=function prepare(){var resize=false;if(this.canvas.width!==this.width){this.width=this.canvas.width;resize=true}if(this.canvas.height!==this.height){this.height=this.canvas.height;resize=true}if(this._hasInvalidDimensions())return;if(!this.tile)return;this._prepareImage(this.map.painter.gl,this.canvas,resize)};CanvasSource.prototype.serialize=function serialize(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}};CanvasSource.prototype._hasInvalidDimensions=function _hasInvalidDimensions(){for(var i=0,list=[this.canvas.width,this.canvas.height];i<list.length;i+=1){var x=list[i];if(isNaN(x)||x<=0)return true}return false};return CanvasSource}(ImageSource);module.exports=CanvasSource},{"../util/window":195,"./image_source":127}],124:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var util=require("../util/util");var window=require("../util/window");var EXTENT=require("../data/extent");var GeoJSONSource=function(Evented){function GeoJSONSource(id,options,dispatcher,eventedParent){Evented.call(this);options=options||{};this.id=id;this.type="geojson";this.minzoom=0;this.maxzoom=18;this.tileSize=512;this.isTileClipped=true;this.reparseOverscaled=true;this.dispatcher=dispatcher;this.setEventedParent(eventedParent);this._data=options.data;if(options.maxzoom!==undefined)this.maxzoom=options.maxzoom;if(options.type)this.type=options.type;var scale=EXTENT/this.tileSize;this.workerOptions=util.extend({source:this.id,cluster:options.cluster||false,geojsonVtOptions:{buffer:(options.buffer!==undefined?options.buffer:128)*scale,tolerance:(options.tolerance!==undefined?options.tolerance:.375)*scale,extent:EXTENT,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(options.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:EXTENT,radius:(options.clusterRadius||50)*scale,log:false}},options.workerOptions)}if(Evented)GeoJSONSource.__proto__=Evented;GeoJSONSource.prototype=Object.create(Evented&&Evented.prototype);GeoJSONSource.prototype.constructor=GeoJSONSource;GeoJSONSource.prototype.load=function load(){var this$1=this;this.fire("dataloading",{dataType:"source"});this._updateWorkerData(function(err){if(err){this$1.fire("error",{error:err});return}this$1.fire("data",{dataType:"source"});this$1.fire("source.load")})};GeoJSONSource.prototype.onAdd=function onAdd(map){this.load();this.map=map};GeoJSONSource.prototype.setData=function setData(data){var this$1=this;this._data=data;this.fire("dataloading",{dataType:"source"});this._updateWorkerData(function(err){if(err){return this$1.fire("error",{error:err})}this$1.fire("data",{dataType:"source"})});return this};GeoJSONSource.prototype._updateWorkerData=function _updateWorkerData(callback){var this$1=this;var options=util.extend({},this.workerOptions);var data=this._data;if(typeof data==="string"){options.url=resolveURL(data)}else{options.data=JSON.stringify(data)}this.workerID=this.dispatcher.send(this.type+".loadData",options,function(err){this$1._loaded=true;callback(err)})};GeoJSONSource.prototype.loadTile=function loadTile(tile,callback){var this$1=this;var overscaling=tile.coord.z>this.maxzoom?Math.pow(2,tile.coord.z-this.maxzoom):1;var params={type:this.type,uid:tile.uid,coord:tile.coord,zoom:tile.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:overscaling,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};tile.workerID=this.dispatcher.send("loadTile",params,function(err,data){tile.unloadVectorData();if(tile.aborted)return;if(err){return callback(err)}tile.loadVectorData(data,this$1.map.painter);if(tile.redoWhenDone){tile.redoWhenDone=false;tile.redoPlacement(this$1)}return callback(null)},this.workerID)};GeoJSONSource.prototype.abortTile=function abortTile(tile){
tile.aborted=true};GeoJSONSource.prototype.unloadTile=function unloadTile(tile){tile.unloadVectorData();this.dispatcher.send("removeTile",{uid:tile.uid,type:this.type,source:this.id},function(){},tile.workerID)};GeoJSONSource.prototype.onRemove=function onRemove(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})};GeoJSONSource.prototype.serialize=function serialize(){return{type:this.type,data:this._data}};return GeoJSONSource}(Evented);function resolveURL(url){var a=window.document.createElement("a");a.href=url;return a.href}module.exports=GeoJSONSource},{"../data/extent":94,"../util/evented":201,"../util/util":212,"../util/window":195}],125:[function(require,module,exports){"use strict";var ajax=require("../util/ajax");var rewind=require("geojson-rewind");var GeoJSONWrapper=require("./geojson_wrapper");var vtpbf=require("vt-pbf");var supercluster=require("supercluster");var geojsonvt=require("geojson-vt");var VectorTileWorkerSource=require("./vector_tile_worker_source");var GeoJSONWorkerSource=function(VectorTileWorkerSource){function GeoJSONWorkerSource(actor,layerIndex,loadGeoJSON){VectorTileWorkerSource.call(this,actor,layerIndex);if(loadGeoJSON){this.loadGeoJSON=loadGeoJSON}this._geoJSONIndexes={}}if(VectorTileWorkerSource)GeoJSONWorkerSource.__proto__=VectorTileWorkerSource;GeoJSONWorkerSource.prototype=Object.create(VectorTileWorkerSource&&VectorTileWorkerSource.prototype);GeoJSONWorkerSource.prototype.constructor=GeoJSONWorkerSource;GeoJSONWorkerSource.prototype.loadVectorData=function loadVectorData(params,callback){var source=params.source,coord=params.coord;if(!this._geoJSONIndexes[source]){return callback(null,null)}var geoJSONTile=this._geoJSONIndexes[source].getTile(Math.min(coord.z,params.maxZoom),coord.x,coord.y);if(!geoJSONTile){return callback(null,null)}var geojsonWrapper=new GeoJSONWrapper(geoJSONTile.features);geojsonWrapper.name="_geojsonTileLayer";var pbf=vtpbf({layers:{_geojsonTileLayer:geojsonWrapper}});if(pbf.byteOffset!==0||pbf.byteLength!==pbf.buffer.byteLength){pbf=new Uint8Array(pbf)}geojsonWrapper.rawData=pbf.buffer;callback(null,geojsonWrapper)};GeoJSONWorkerSource.prototype.loadData=function loadData(params,callback){var handleData=function(err,data){var this$1=this;if(err)return callback(err);if(typeof data!="object"){return callback(new Error("Input data is not a valid GeoJSON object."))}rewind(data,true);this._indexData(data,params,function(err,indexed){if(err){return callback(err)}this$1._geoJSONIndexes[params.source]=indexed;callback(null)})}.bind(this);this.loadGeoJSON(params,handleData)};GeoJSONWorkerSource.prototype.loadGeoJSON=function loadGeoJSON(params,callback){if(params.url){ajax.getJSON(params.url,callback)}else if(typeof params.data==="string"){try{return callback(null,JSON.parse(params.data))}catch(e){return callback(new Error("Input data is not a valid GeoJSON object."))}}else{return callback(new Error("Input data is not a valid GeoJSON object."))}};GeoJSONWorkerSource.prototype.removeSource=function removeSource(params){if(this._geoJSONIndexes[params.source]){delete this._geoJSONIndexes[params.source]}};GeoJSONWorkerSource.prototype._indexData=function _indexData(data,params,callback){try{if(params.cluster){callback(null,supercluster(params.superclusterOptions).load(data.features))}else{callback(null,geojsonvt(data,params.geojsonVtOptions))}}catch(err){return callback(err)}};return GeoJSONWorkerSource}(VectorTileWorkerSource);module.exports=GeoJSONWorkerSource},{"../util/ajax":192,"./geojson_wrapper":126,"./vector_tile_worker_source":138,"geojson-rewind":25,"geojson-vt":29,supercluster:552,"vt-pbf":563}],126:[function(require,module,exports){"use strict";var Point=require("point-geometry");var VectorTileFeature=require("vector-tile").VectorTileFeature;var EXTENT=require("../data/extent");var FeatureWrapper=function FeatureWrapper(feature){var this$1=this;this.type=feature.type;if(feature.type===1){this.rawGeometry=[];for(var i=0;i<feature.geometry.length;i++){this$1.rawGeometry.push([feature.geometry[i]])}}else{this.rawGeometry=feature.geometry}this.properties=feature.tags;this.extent=EXTENT};FeatureWrapper.prototype.loadGeometry=function loadGeometry(){var this$1=this;var rings=this.rawGeometry;this.geometry=[];for(var i=0;i<rings.length;i++){var ring=rings[i],newRing=[];for(var j=0;j<ring.length;j++){newRing.push(new Point(ring[j][0],ring[j][1]))}this$1.geometry.push(newRing)}return this.geometry};FeatureWrapper.prototype.bbox=function bbox(){if(!this.geometry)this.loadGeometry();var rings=this.geometry;var x1=Infinity,x2=-Infinity,y1=Infinity,y2=-Infinity;for(var i=0;i<rings.length;i++){var ring=rings[i];for(var j=0;j<ring.length;j++){var coord=ring[j];x1=Math.min(x1,coord.x);x2=Math.max(x2,coord.x);y1=Math.min(y1,coord.y);y2=Math.max(y2,coord.y)}}return[x1,y1,x2,y2]};FeatureWrapper.prototype.toGeoJSON=function toGeoJSON(){VectorTileFeature.prototype.toGeoJSON.call(this)};var GeoJSONWrapper=function GeoJSONWrapper(features){this.features=features;this.length=features.length;this.extent=EXTENT};GeoJSONWrapper.prototype.feature=function feature(i){return new FeatureWrapper(this.features[i])};module.exports=GeoJSONWrapper},{"../data/extent":94,"point-geometry":223,"vector-tile":559}],127:[function(require,module,exports){"use strict";var util=require("../util/util");var window=require("../util/window");var TileCoord=require("./tile_coord");var LngLat=require("../geo/lng_lat");var Point=require("point-geometry");var Evented=require("../util/evented");var ajax=require("../util/ajax");var EXTENT=require("../data/extent");var RasterBoundsArray=require("../data/raster_bounds_array");var Buffer=require("../data/buffer");var VertexArrayObject=require("../render/vertex_array_object");var ImageSource=function(Evented){function ImageSource(id,options,dispatcher,eventedParent){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.coordinates=options.coordinates;this.type="image";this.minzoom=0;this.maxzoom=22;this.tileSize=512;this.setEventedParent(eventedParent);this.options=options}if(Evented)ImageSource.__proto__=Evented;ImageSource.prototype=Object.create(Evented&&Evented.prototype);ImageSource.prototype.constructor=ImageSource;ImageSource.prototype.load=function load(){var this$1=this;this.fire("dataloading",{dataType:"source"});this.url=this.options.url;ajax.getImage(this.options.url,function(err,image){if(err)return this$1.fire("error",{error:err});this$1.image=image;this$1._finishLoading()})};ImageSource.prototype._finishLoading=function _finishLoading(){this.fire("source.load");if(this.map){this.setCoordinates(this.coordinates)}};ImageSource.prototype.onAdd=function onAdd(map){this.load();this.map=map;if(this.image){this.setCoordinates(this.coordinates)}};ImageSource.prototype.setCoordinates=function setCoordinates(coordinates){this.coordinates=coordinates;var map=this.map;var cornerZ0Coords=coordinates.map(function(coord){return map.transform.locationCoordinate(LngLat.convert(coord)).zoomTo(0)});var centerCoord=this.centerCoord=util.getCoordinatesCenter(cornerZ0Coords);centerCoord.column=Math.round(centerCoord.column);centerCoord.row=Math.round(centerCoord.row);this.minzoom=this.maxzoom=centerCoord.zoom;this.coord=new TileCoord(centerCoord.zoom,centerCoord.column,centerCoord.row);this._tileCoords=cornerZ0Coords.map(function(coord){var zoomedCoord=coord.zoomTo(centerCoord.zoom);return new Point(Math.round((zoomedCoord.column-centerCoord.column)*EXTENT),Math.round((zoomedCoord.row-centerCoord.row)*EXTENT))});this.fire("data",{dataType:"source"});return this};ImageSource.prototype._setTile=function _setTile(tile){this.tile=tile;var maxInt16=32767;var array=new RasterBoundsArray;array.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0);array.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,maxInt16,0);array.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,maxInt16);array.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,maxInt16,maxInt16);this.tile.buckets={};this.tile.boundsBuffer=Buffer.fromStructArray(array,Buffer.BufferType.VERTEX);this.tile.boundsVAO=new VertexArrayObject};ImageSource.prototype.prepare=function prepare(){if(!this.tile||!this.image)return;this._prepareImage(this.map.painter.gl,this.image)};ImageSource.prototype._prepareImage=function _prepareImage(gl,image,resize){if(this.tile.state!=="loaded"){this.tile.state="loaded";this.tile.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.tile.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image)}else if(resize){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image)}else if(image instanceof window.HTMLVideoElement||image instanceof window.ImageData||image instanceof window.HTMLCanvasElement){gl.bindTexture(gl.TEXTURE_2D,this.tile.texture);gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,image)}};ImageSource.prototype.loadTile=function loadTile(tile,callback){if(this.coord&&this.coord.toString()===tile.coord.toString()){this._setTile(tile);callback(null)}else{tile.state="errored";callback(null)}};ImageSource.prototype.serialize=function serialize(){return{type:"image",urls:this.url,coordinates:this.coordinates}};return ImageSource}(Evented);module.exports=ImageSource},{"../data/buffer":91,"../data/extent":94,"../data/raster_bounds_array":99,"../geo/lng_lat":102,"../render/vertex_array_object":122,"../util/ajax":192,"../util/evented":201,"../util/util":212,"../util/window":195,"./tile_coord":136,"point-geometry":223}],128:[function(require,module,exports){"use strict";var util=require("../util/util");var ajax=require("../util/ajax");var browser=require("../util/browser");var normalizeURL=require("../util/mapbox").normalizeSourceURL;module.exports=function(options,callback){var loaded=function(err,tileJSON){if(err){return callback(err)}var result=util.pick(tileJSON,["tiles","minzoom","maxzoom","attribution"]);if(tileJSON.vector_layers){result.vectorLayers=tileJSON.vector_layers;result.vectorLayerIds=result.vectorLayers.map(function(layer){return layer.id})}callback(null,result)};if(options.url){ajax.getJSON(normalizeURL(options.url),loaded)}else{browser.frame(loaded.bind(null,null,options))}}},{"../util/ajax":192,"../util/browser":193,"../util/mapbox":208,"../util/util":212}],129:[function(require,module,exports){"use strict";var EXTENT=require("../data/extent");module.exports=function(tile,pixelValue,z){return pixelValue*(EXTENT/(tile.tileSize*Math.pow(2,z-tile.coord.z)))}},{"../data/extent":94}],130:[function(require,module,exports){"use strict";var TileCoord=require("./tile_coord");exports.rendered=function(sourceCache,styleLayers,queryGeometry,params,zoom,bearing){var tilesIn=sourceCache.tilesIn(queryGeometry);tilesIn.sort(sortTilesIn);var renderedFeatureLayers=[];for(var r=0;r<tilesIn.length;r++){var tileIn=tilesIn[r];if(!tileIn.tile.featureIndex)continue;renderedFeatureLayers.push(tileIn.tile.featureIndex.query({queryGeometry:tileIn.queryGeometry,scale:tileIn.scale,tileSize:tileIn.tile.tileSize,bearing:bearing,params:params},styleLayers))}return mergeRenderedFeatureLayers(renderedFeatureLayers)};exports.source=function(sourceCache,params){var tiles=sourceCache.getRenderableIds().map(function(id){return sourceCache.getTileByID(id)});var result=[];var dataTiles={};for(var i=0;i<tiles.length;i++){var tile=tiles[i];var dataID=new TileCoord(Math.min(tile.sourceMaxZoom,tile.coord.z),tile.coord.x,tile.coord.y,0).id;if(!dataTiles[dataID]){dataTiles[dataID]=true;tile.querySourceFeatures(result,params)}}return result};function sortTilesIn(a,b){var coordA=a.coord;var coordB=b.coord;return coordA.z-coordB.z||coordA.y-coordB.y||coordA.w-coordB.w||coordA.x-coordB.x}function mergeRenderedFeatureLayers(tiles){var result=tiles[0]||{};for(var i=1;i<tiles.length;i++){var tile=tiles[i];for(var layerID in tile){var tileFeatures=tile[layerID];var resultFeatures=result[layerID];if(resultFeatures===undefined){resultFeatures=result[layerID]=tileFeatures}else{for(var f=0;f<tileFeatures.length;f++){resultFeatures.push(tileFeatures[f])}}}}return result}},{"./tile_coord":136}],131:[function(require,module,exports){"use strict";var util=require("../util/util");var ajax=require("../util/ajax");var Evented=require("../util/evented");var loadTileJSON=require("./load_tilejson");var normalizeURL=require("../util/mapbox").normalizeTileURL;var RasterTileSource=function(Evented){function RasterTileSource(id,options,dispatcher,eventedParent){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.setEventedParent(eventedParent);this.type="raster";this.minzoom=0;this.maxzoom=22;this.roundZoom=true;this.scheme="xyz";this.tileSize=512;this._loaded=false;this.options=options;util.extend(this,util.pick(options,["url","scheme","tileSize"]))}if(Evented)RasterTileSource.__proto__=Evented;RasterTileSource.prototype=Object.create(Evented&&Evented.prototype);RasterTileSource.prototype.constructor=RasterTileSource;RasterTileSource.prototype.load=function load(){var this$1=this;this.fire("dataloading",{dataType:"source"});loadTileJSON(this.options,function(err,tileJSON){if(err){return this$1.fire("error",err)}util.extend(this$1,tileJSON);this$1.fire("data",{dataType:"source"});this$1.fire("source.load")})};RasterTileSource.prototype.onAdd=function onAdd(map){this.load();this.map=map};RasterTileSource.prototype.serialize=function serialize(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}};RasterTileSource.prototype.loadTile=function loadTile(tile,callback){var url=normalizeURL(tile.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);tile.request=ajax.getImage(url,done.bind(this));function done(err,img){delete tile.request;if(tile.aborted){this.state="unloaded";return callback(null)}if(err){this.state="errored";return callback(err)}tile.setExpiryData(img);delete img.cacheControl;delete img.expires;var gl=this.map.painter.gl;tile.texture=this.map.painter.getTileTexture(img.width);if(tile.texture){gl.bindTexture(gl.TEXTURE_2D,tile.texture);gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,img)}else{tile.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tile.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,img);tile.texture.size=img.width}gl.generateMipmap(gl.TEXTURE_2D);tile.state="loaded";callback(null)}};RasterTileSource.prototype.abortTile=function abortTile(tile){if(tile.request){tile.request.abort();delete tile.request}};RasterTileSource.prototype.unloadTile=function unloadTile(tile){if(tile.texture)this.map.painter.saveTileTexture(tile.texture)};return RasterTileSource}(Evented);module.exports=RasterTileSource},{"../util/ajax":192,"../util/evented":201,"../util/mapbox":208,"../util/util":212,"./load_tilejson":128}],132:[function(require,module,exports){"use strict";var ajax=require("../util/ajax");var window=require("../util/window");var pluginAvailableCallbacks=[];var pluginRequested=false;var pluginBlobURL=null;module.exports.registerForPluginAvailability=function(callback){if(pluginBlobURL){callback(pluginBlobURL)}else{pluginAvailableCallbacks.push(callback)}};module.exports.errorCallback=null;module.exports.setRTLTextPlugin=function(pluginURL,callback){if(pluginRequested){throw new Error("setRTLTextPlugin cannot be called multiple times.")}pluginRequested=true;module.exports.errorCallback=callback;ajax.getArrayBuffer(pluginURL,function(err,response){if(err){callback(err)}else{pluginBlobURL=window.URL.createObjectURL(new window.Blob([response.data]),{type:"text/javascript"});for(var i=0,list=pluginAvailableCallbacks;i<list.length;i+=1){var pluginAvailableCallback=list[i];pluginAvailableCallback(pluginBlobURL)}}})}},{"../util/ajax":192,"../util/window":195}],133:[function(require,module,exports){"use strict";var util=require("../util/util");var sourceTypes={vector:require("../source/vector_tile_source"),raster:require("../source/raster_tile_source"),geojson:require("../source/geojson_source"),video:require("../source/video_source"),image:require("../source/image_source"),canvas:require("../source/canvas_source")};exports.create=function(id,source,dispatcher,eventedParent){source=new sourceTypes[source.type](id,source,dispatcher,eventedParent);if(source.id!==id){throw new Error("Expected Source id to be "+id+" instead of "+source.id)}util.bindAll(["load","abort","unload","serialize","prepare"],source);return source};exports.getType=function(name){return sourceTypes[name]};exports.setType=function(name,type){sourceTypes[name]=type}},{"../source/canvas_source":123,"../source/geojson_source":124,"../source/image_source":127,"../source/raster_tile_source":131,"../source/vector_tile_source":137,"../source/video_source":139,"../util/util":212}],134:[function(require,module,exports){"use strict";var Source=require("./source");var Tile=require("./tile");var Evented=require("../util/evented");var TileCoord=require("./tile_coord");var Cache=require("../util/lru_cache");var Coordinate=require("../geo/coordinate");var util=require("../util/util");var EXTENT=require("../data/extent");var SourceCache=function(Evented){function SourceCache(id,options,dispatcher){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.on("source.load",function(){this._sourceLoaded=true});this.on("error",function(){this._sourceErrored=true});this.on("data",function(event){if(this._sourceLoaded&&event.dataType==="source"){this.reload();if(this.transform){this.update(this.transform)}}});this._source=Source.create(id,options,dispatcher,this);this._tiles={};this._cache=new Cache(0,this.unloadTile.bind(this));this._timers={};this._cacheTimers={};this._isIdRenderable=this._isIdRenderable.bind(this)}if(Evented)SourceCache.__proto__=Evented;SourceCache.prototype=Object.create(Evented&&Evented.prototype);SourceCache.prototype.constructor=SourceCache;SourceCache.prototype.onAdd=function onAdd(map){this.map=map;if(this._source&&this._source.onAdd){this._source.onAdd(map)}};SourceCache.prototype.onRemove=function onRemove(map){if(this._source&&this._source.onRemove){this._source.onRemove(map)}};SourceCache.prototype.loaded=function loaded(){var this$1=this;if(this._sourceErrored){return true}if(!this._sourceLoaded){return false}for(var t in this._tiles){var tile=this$1._tiles[t];if(tile.state!=="loaded"&&tile.state!=="errored")return false}return true};SourceCache.prototype.getSource=function getSource(){return this._source};SourceCache.prototype.loadTile=function loadTile(tile,callback){return this._source.loadTile(tile,callback)};SourceCache.prototype.unloadTile=function unloadTile(tile){if(this._source.unloadTile)return this._source.unloadTile(tile)};SourceCache.prototype.abortTile=function abortTile(tile){if(this._source.abortTile)return this._source.abortTile(tile)};SourceCache.prototype.serialize=function serialize(){return this._source.serialize()};SourceCache.prototype.prepare=function prepare(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()};SourceCache.prototype.getIds=function getIds(){return Object.keys(this._tiles).map(Number).sort(compareKeyZoom)};SourceCache.prototype.getRenderableIds=function getRenderableIds(){return this.getIds().filter(this._isIdRenderable)};SourceCache.prototype._isIdRenderable=function _isIdRenderable(id){return this._tiles[id].hasData()&&!this._coveredTiles[id]};SourceCache.prototype.reload=function reload(){var this$1=this;this._cache.reset();for(var i in this._tiles){this$1.reloadTile(i,"reloading")}};SourceCache.prototype.reloadTile=function reloadTile(id,state){var tile=this._tiles[id];if(tile.state!=="loading"){tile.state=state}this.loadTile(tile,this._tileLoaded.bind(this,tile,id))};SourceCache.prototype._tileLoaded=function _tileLoaded(tile,id,err){if(err){tile.state="errored";this._source.fire("error",{tile:tile,error:err});return}tile.sourceCache=this;tile.timeAdded=(new Date).getTime();this._setTileReloadTimer(id,tile);this._source.fire("data",{tile:tile,coord:tile.coord,dataType:"tile"});if(this.map)this.map.painter.tileExtentVAO.vao=null};SourceCache.prototype.getTile=function getTile(coord){return this.getTileByID(coord.id)};SourceCache.prototype.getTileByID=function getTileByID(id){return this._tiles[id]};SourceCache.prototype.getZoom=function getZoom(transform){return transform.zoom+transform.scaleZoom(transform.tileSize/this._source.tileSize)};SourceCache.prototype.findLoadedChildren=function findLoadedChildren(coord,maxCoveringZoom,retain){var this$1=this;var found=false;for(var id in this._tiles){var tile=this$1._tiles[id];if(retain[id]||!tile.hasData()||tile.coord.z<=coord.z||tile.coord.z>maxCoveringZoom)continue;var z2=Math.pow(2,Math.min(tile.coord.z,this$1._source.maxzoom)-Math.min(coord.z,this$1._source.maxzoom));if(Math.floor(tile.coord.x/z2)!==coord.x||Math.floor(tile.coord.y/z2)!==coord.y)continue;retain[id]=true;found=true;while(tile&&tile.coord.z-1>coord.z){var parentId=tile.coord.parent(this$1._source.maxzoom).id;tile=this$1._tiles[parentId];if(tile&&tile.hasData()){delete retain[id];retain[parentId]=true}}}return found};SourceCache.prototype.findLoadedParent=function findLoadedParent(coord,minCoveringZoom,retain){var this$1=this;for(var z=coord.z-1;z>=minCoveringZoom;z--){coord=coord.parent(this$1._source.maxzoom);var tile=this$1._tiles[coord.id];if(tile&&tile.hasData()){retain[coord.id]=true;return tile}if(this$1._cache.has(coord.id)){retain[coord.id]=true;return this$1._cache.get(coord.id)}}};SourceCache.prototype.updateCacheSize=function updateCacheSize(transform){var widthInTiles=Math.ceil(transform.width/transform.tileSize)+1;var heightInTiles=Math.ceil(transform.height/transform.tileSize)+1;var approxTilesInView=widthInTiles*heightInTiles;var commonZoomRange=5;this._cache.setMaxSize(Math.floor(approxTilesInView*commonZoomRange))};SourceCache.prototype.update=function update(transform){var this$1=this;if(!this._sourceLoaded){return}var i;var coord;var tile;var parentTile;this.updateCacheSize(transform);var zoom=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(transform));var minCoveringZoom=Math.max(zoom-SourceCache.maxOverzooming,this._source.minzoom);var maxCoveringZoom=Math.max(zoom+SourceCache.maxUnderzooming,this._source.minzoom);var retain={};this._coveredTiles={};var visibleCoords;if(!this.used){visibleCoords=[]}else if(this._source.coord){visibleCoords=[this._source.coord]}else{visibleCoords=transform.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled})}for(i=0;i<visibleCoords.length;i++){coord=visibleCoords[i];tile=this$1.addTile(coord);retain[coord.id]=true;if(tile.hasData())continue;if(!this$1.findLoadedChildren(coord,maxCoveringZoom,retain)){parentTile=this$1.findLoadedParent(coord,minCoveringZoom,retain);if(parentTile){this$1.addTile(parentTile.coord)}}}var parentsForFading={};if(isRasterType(this._source.type)){var ids=Object.keys(retain);for(var k=0;k<ids.length;k++){var id=ids[k];coord=TileCoord.fromID(id);tile=this$1._tiles[id];if(!tile)continue;if(typeof tile.fadeEndTime==="undefined"||tile.fadeEndTime>=Date.now()){if(this$1.findLoadedChildren(coord,maxCoveringZoom,retain)){retain[id]=true}parentTile=this$1.findLoadedParent(coord,minCoveringZoom,parentsForFading);if(parentTile){this$1.addTile(parentTile.coord)}}}}var fadedParent;for(fadedParent in parentsForFading){if(!retain[fadedParent]){this$1._coveredTiles[fadedParent]=true}}for(fadedParent in parentsForFading){retain[fadedParent]=true}var remove=util.keysDifference(this._tiles,retain);for(i=0;i<remove.length;i++){this$1.removeTile(+remove[i])}this.transform=transform};SourceCache.prototype.addTile=function addTile(coord){var tile=this._tiles[coord.id];if(tile)return tile;var wrapped=coord.wrapped();tile=this._tiles[wrapped.id];if(!tile){tile=this._cache.get(wrapped.id);if(tile){tile.redoPlacement(this._source);if(this._cacheTimers[wrapped.id]){clearTimeout(this._cacheTimers[wrapped.id]);this._cacheTimers[wrapped.id]=undefined;this._setTileReloadTimer(wrapped.id,tile)}}}if(!tile){var zoom=coord.z;var overscaling=zoom>this._source.maxzoom?Math.pow(2,zoom-this._source.maxzoom):1;tile=new Tile(wrapped,this._source.tileSize*overscaling,this._source.maxzoom);this.loadTile(tile,this._tileLoaded.bind(this,tile,coord.id))}tile.uses++;this._tiles[coord.id]=tile;this._source.fire("dataloading",{tile:tile,coord:tile.coord,dataType:"tile"});return tile};SourceCache.prototype._setTileReloadTimer=function _setTileReloadTimer(id,tile){var this$1=this;var tileExpires=tile.getExpiry();if(tileExpires){this._timers[id]=setTimeout(function(){this$1.reloadTile(id,"expired");this$1._timers[id]=undefined},tileExpires-(new Date).getTime())}};SourceCache.prototype._setCacheInvalidationTimer=function _setCacheInvalidationTimer(id,tile){var this$1=this;var tileExpires=tile.getExpiry();if(tileExpires){this._cacheTimers[id]=setTimeout(function(){this$1._cache.remove(id);this$1._cacheTimers[id]=undefined},tileExpires-(new Date).getTime())}};SourceCache.prototype.removeTile=function removeTile(id){var tile=this._tiles[id];if(!tile)return;tile.uses--;delete this._tiles[id];if(this._timers[id]){clearTimeout(this._timers[id]);this._timers[id]=undefined}this._source.fire("data",{tile:tile,coord:tile.coord,dataType:"tile"});if(tile.uses>0)return;if(tile.hasData()){var wrappedId=tile.coord.wrapped().id;this._cache.add(wrappedId,tile);this._setCacheInvalidationTimer(wrappedId,tile)}else{tile.aborted=true;this.abortTile(tile);this.unloadTile(tile)}};SourceCache.prototype.clearTiles=function clearTiles(){var this$1=this;for(var id in this._tiles)this$1.removeTile(id);this._cache.reset()};SourceCache.prototype.tilesIn=function tilesIn(queryGeometry){var this$1=this;var tileResults={};var ids=this.getIds();var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;var z=queryGeometry[0].zoom;for(var k=0;k<queryGeometry.length;k++){var p=queryGeometry[k];minX=Math.min(minX,p.column);minY=Math.min(minY,p.row);maxX=Math.max(maxX,p.column);maxY=Math.max(maxY,p.row)}for(var i=0;i<ids.length;i++){var tile=this$1._tiles[ids[i]];var coord=TileCoord.fromID(ids[i]);var tileSpaceBounds=[coordinateToTilePoint(coord,tile.sourceMaxZoom,new Coordinate(minX,minY,z)),coordinateToTilePoint(coord,tile.sourceMaxZoom,new Coordinate(maxX,maxY,z))];if(tileSpaceBounds[0].x<EXTENT&&tileSpaceBounds[0].y<EXTENT&&tileSpaceBounds[1].x>=0&&tileSpaceBounds[1].y>=0){var tileSpaceQueryGeometry=[];for(var j=0;j<queryGeometry.length;j++){tileSpaceQueryGeometry.push(coordinateToTilePoint(coord,tile.sourceMaxZoom,queryGeometry[j]))}var tileResult=tileResults[tile.coord.id];if(tileResult===undefined){tileResult=tileResults[tile.coord.id]={tile:tile,coord:coord,queryGeometry:[],scale:Math.pow(2,this$1.transform.zoom-tile.coord.z)}}tileResult.queryGeometry.push(tileSpaceQueryGeometry)}}var results=[];for(var t in tileResults){results.push(tileResults[t])}return results};SourceCache.prototype.redoPlacement=function redoPlacement(){var this$1=this;var ids=this.getIds();for(var i=0;i<ids.length;i++){var tile=this$1.getTileByID(ids[i]);tile.redoPlacement(this$1._source)}};SourceCache.prototype.getVisibleCoordinates=function getVisibleCoordinates(){var this$1=this;var coords=this.getRenderableIds().map(TileCoord.fromID);for(var i=0,list=coords;i<list.length;i+=1){var coord=list[i];coord.posMatrix=this$1.transform.calculatePosMatrix(coord,this$1._source.maxzoom)}return coords};return SourceCache}(Evented);SourceCache.maxOverzooming=10;SourceCache.maxUnderzooming=3;function coordinateToTilePoint(tileCoord,sourceMaxZoom,coord){var zoomedCoord=coord.zoomTo(Math.min(tileCoord.z,sourceMaxZoom));return{x:(zoomedCoord.column-(tileCoord.x+tileCoord.w*Math.pow(2,tileCoord.z)))*EXTENT,y:(zoomedCoord.row-tileCoord.y)*EXTENT}}function compareKeyZoom(a,b){return a%32-b%32}function isRasterType(type){return type==="raster"||type==="image"||type==="video"}module.exports=SourceCache},{"../data/extent":94,"../geo/coordinate":101,"../util/evented":201,"../util/lru_cache":207,"../util/util":212,"./source":133,"./tile":135,"./tile_coord":136}],135:[function(require,module,exports){"use strict";var util=require("../util/util");var Bucket=require("../data/bucket");var FeatureIndex=require("../data/feature_index");var vt=require("vector-tile");var Protobuf=require("pbf");var GeoJSONFeature=require("../util/vectortile_to_geojson");var featureFilter=require("feature-filter");var CollisionTile=require("../symbol/collision_tile");var CollisionBoxArray=require("../symbol/collision_box");var SymbolInstancesArray=require("../symbol/symbol_instances");var SymbolQuadsArray=require("../symbol/symbol_quads");var Tile=function Tile(coord,size,sourceMaxZoom){this.coord=coord;this.uid=util.uniqueId();this.uses=0;this.tileSize=size;this.sourceMaxZoom=sourceMaxZoom;this.buckets={};this.expires=null;this.cacheControl=null;this.state="loading"};Tile.prototype.registerFadeDuration=function registerFadeDuration(animationLoop,duration){var fadeEndTime=duration+this.timeAdded;if(fadeEndTime<Date.now())return;if(this.fadeEndTime&&fadeEndTime<this.fadeEndTime)return;this.fadeEndTime=fadeEndTime;animationLoop.set(this.fadeEndTime-Date.now())};Tile.prototype.loadVectorData=function loadVectorData(data,painter){if(this.hasData()){this.unloadVectorData(painter)}this.state="loaded";if(!data)return;if(data.rawTileData){this.rawTileData=data.rawTileData}this.collisionBoxArray=new CollisionBoxArray(data.collisionBoxArray);this.collisionTile=new CollisionTile(data.collisionTile,this.collisionBoxArray);this.symbolInstancesArray=new SymbolInstancesArray(data.symbolInstancesArray);this.symbolQuadsArray=new SymbolQuadsArray(data.symbolQuadsArray);this.featureIndex=new FeatureIndex(data.featureIndex,this.rawTileData,this.collisionTile);this.buckets=Bucket.deserialize(data.buckets,painter.style)};Tile.prototype.reloadSymbolData=function reloadSymbolData(data,style){var this$1=this;if(this.state==="unloaded")return;this.collisionTile=new CollisionTile(data.collisionTile,this.collisionBoxArray);this.featureIndex.setCollisionTile(this.collisionTile);for(var id in this.buckets){var bucket=this$1.buckets[id];if(bucket.layers[0].type==="symbol"){bucket.destroy();delete this$1.buckets[id]}}util.extend(this.buckets,Bucket.deserialize(data.buckets,style))};Tile.prototype.unloadVectorData=function unloadVectorData(){var this$1=this;for(var id in this.buckets){this$1.buckets[id].destroy()}this.buckets={};this.collisionBoxArray=null;this.symbolQuadsArray=null;this.symbolInstancesArray=null;this.collisionTile=null;this.featureIndex=null;this.state="unloaded"};Tile.prototype.redoPlacement=function redoPlacement(source){var this$1=this;if(source.type!=="vector"&&source.type!=="geojson"){return}if(this.state!=="loaded"){this.redoWhenDone=true;return}if(!this.collisionTile){return}this.state="reloading";source.dispatcher.send("redoPlacement",{type:source.type,uid:this.uid,source:source.id,angle:source.map.transform.angle,pitch:source.map.transform.pitch,showCollisionBoxes:source.map.showCollisionBoxes},function(_,data){this$1.reloadSymbolData(data,source.map.style);source.fire("data",{tile:this$1,coord:this$1.coord,dataType:"tile"});if(source.map)source.map.painter.tileExtentVAO.vao=null;this$1.state="loaded";if(this$1.redoWhenDone){this$1.redoWhenDone=false;this$1.redoPlacement(source)}},this.workerID)};Tile.prototype.getBucket=function getBucket(layer){
return this.buckets[layer.id]};Tile.prototype.querySourceFeatures=function querySourceFeatures(result,params){var this$1=this;if(!this.rawTileData)return;if(!this.vtLayers){this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers}var layer=this.vtLayers._geojsonTileLayer||this.vtLayers[params.sourceLayer];if(!layer)return;var filter=featureFilter(params&&params.filter);var coord={z:this.coord.z,x:this.coord.x,y:this.coord.y};for(var i=0;i<layer.length;i++){var feature=layer.feature(i);if(filter(feature)){var geojsonFeature=new GeoJSONFeature(feature,this$1.coord.z,this$1.coord.x,this$1.coord.y);geojsonFeature.tile=coord;result.push(geojsonFeature)}}};Tile.prototype.hasData=function hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"};Tile.prototype.setExpiryData=function setExpiryData(data){if(data.cacheControl)this.cacheControl=data.cacheControl;if(data.expires)this.expires=data.expires};Tile.prototype.getExpiry=function getExpiry(){if(this.cacheControl){var parsedCC=util.parseCacheControl(this.cacheControl);if(parsedCC["max-age"])return this.timeAdded+parsedCC["max-age"]*1e3}else if(this.expires){return new Date(this.expires).getTime()}};module.exports=Tile},{"../data/bucket":85,"../data/feature_index":95,"../symbol/collision_box":161,"../symbol/collision_tile":163,"../symbol/symbol_instances":172,"../symbol/symbol_quads":173,"../util/util":212,"../util/vectortile_to_geojson":213,"feature-filter":22,pbf:222,"vector-tile":559}],136:[function(require,module,exports){"use strict";var WhooTS=require("whoots-js");var Coordinate=require("../geo/coordinate");var TileCoord=function TileCoord(z,x,y,w){if(isNaN(w))w=0;this.z=+z;this.x=+x;this.y=+y;this.w=+w;w*=2;if(w<0)w=w*-1-1;var dim=1<<this.z;this.id=(dim*dim*w+dim*this.y+this.x)*32+this.z;this.posMatrix=null};TileCoord.prototype.toString=function toString(){return this.z+"/"+this.x+"/"+this.y};TileCoord.prototype.toCoordinate=function toCoordinate(sourceMaxZoom){var zoom=Math.min(this.z,sourceMaxZoom===undefined?this.z:sourceMaxZoom);var tileScale=Math.pow(2,zoom);var row=this.y;var column=this.x+tileScale*this.w;return new Coordinate(column,row,zoom)};TileCoord.prototype.url=function url(urls,sourceMaxZoom,scheme){var bbox=WhooTS.getTileBBox(this.x,this.y,this.z);var quadkey=getQuadkey(this.z,this.x,this.y);return urls[(this.x+this.y)%urls.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,sourceMaxZoom||this.z)).replace("{x}",this.x).replace("{y}",scheme==="tms"?Math.pow(2,this.z)-this.y-1:this.y).replace("{quadkey}",quadkey).replace("{bbox-epsg-3857}",bbox)};TileCoord.prototype.parent=function parent(sourceMaxZoom){if(this.z===0)return null;if(this.z>sourceMaxZoom){return new TileCoord(this.z-1,this.x,this.y,this.w)}return new TileCoord(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)};TileCoord.prototype.wrapped=function wrapped(){return new TileCoord(this.z,this.x,this.y,0)};TileCoord.prototype.children=function children(sourceMaxZoom){if(this.z>=sourceMaxZoom){return[new TileCoord(this.z+1,this.x,this.y,this.w)]}var z=this.z+1;var x=this.x*2;var y=this.y*2;return[new TileCoord(z,x,y,this.w),new TileCoord(z,x+1,y,this.w),new TileCoord(z,x,y+1,this.w),new TileCoord(z,x+1,y+1,this.w)]};function edge(a,b){if(a.row>b.row){var t=a;a=b;b=t}return{x0:a.column,y0:a.row,x1:b.column,y1:b.row,dx:b.column-a.column,dy:b.row-a.row}}function scanSpans(e0,e1,ymin,ymax,scanLine){var y0=Math.max(ymin,Math.floor(e1.y0));var y1=Math.min(ymax,Math.ceil(e1.y1));if(e0.x0===e1.x0&&e0.y0===e1.y0?e0.x0+e1.dy/e0.dy*e0.dx<e1.x1:e0.x1-e1.dy/e0.dy*e0.dx<e1.x0){var t=e0;e0=e1;e1=t}var m0=e0.dx/e0.dy;var m1=e1.dx/e1.dy;var d0=e0.dx>0;var d1=e1.dx<0;for(var y=y0;y<y1;y++){var x0=m0*Math.max(0,Math.min(e0.dy,y+d0-e0.y0))+e0.x0;var x1=m1*Math.max(0,Math.min(e1.dy,y+d1-e1.y0))+e1.x0;scanLine(Math.floor(x1),Math.ceil(x0),y)}}function scanTriangle(a,b,c,ymin,ymax,scanLine){var ab=edge(a,b),bc=edge(b,c),ca=edge(c,a);var t;if(ab.dy>bc.dy){t=ab;ab=bc;bc=t}if(ab.dy>ca.dy){t=ab;ab=ca;ca=t}if(bc.dy>ca.dy){t=bc;bc=ca;ca=t}if(ab.dy)scanSpans(ca,ab,ymin,ymax,scanLine);if(bc.dy)scanSpans(ca,bc,ymin,ymax,scanLine)}TileCoord.cover=function(z,bounds,actualZ,renderWorldCopies){if(renderWorldCopies===undefined){renderWorldCopies=true}var tiles=1<<z;var t={};function scanLine(x0,x1,y){var x,w,wx,coord;if(y>=0&&y<=tiles){for(x=x0;x<x1;x++){w=Math.floor(x/tiles);wx=(x%tiles+tiles)%tiles;if(w===0||renderWorldCopies===true){coord=new TileCoord(actualZ,wx,y,w);t[coord.id]=coord}}}}scanTriangle(bounds[0],bounds[1],bounds[2],0,tiles,scanLine);scanTriangle(bounds[2],bounds[3],bounds[0],0,tiles,scanLine);return Object.keys(t).map(function(id){return t[id]})};TileCoord.fromID=function(id){var z=id%32,dim=1<<z;var xy=(id-z)/32;var x=xy%dim,y=(xy-x)/dim%dim;var w=Math.floor(xy/(dim*dim));if(w%2!==0)w=w*-1-1;w/=2;return new TileCoord(z,x,y,w)};function getQuadkey(z,x,y){var quadkey="",mask;for(var i=z;i>0;i--){mask=1<<i-1;quadkey+=(x&mask?1:0)+(y&mask?2:0)}return quadkey}module.exports=TileCoord},{"../geo/coordinate":101,"whoots-js":568}],137:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var util=require("../util/util");var loadTileJSON=require("./load_tilejson");var normalizeURL=require("../util/mapbox").normalizeTileURL;var VectorTileSource=function(Evented){function VectorTileSource(id,options,dispatcher,eventedParent){Evented.call(this);this.id=id;this.dispatcher=dispatcher;this.type="vector";this.minzoom=0;this.maxzoom=22;this.scheme="xyz";this.tileSize=512;this.reparseOverscaled=true;this.isTileClipped=true;util.extend(this,util.pick(options,["url","scheme","tileSize"]));this._options=util.extend({type:"vector"},options);if(this.tileSize!==512){throw new Error("vector tile sources must have a tileSize of 512")}this.setEventedParent(eventedParent)}if(Evented)VectorTileSource.__proto__=Evented;VectorTileSource.prototype=Object.create(Evented&&Evented.prototype);VectorTileSource.prototype.constructor=VectorTileSource;VectorTileSource.prototype.load=function load(){var this$1=this;this.fire("dataloading",{dataType:"source"});loadTileJSON(this._options,function(err,tileJSON){if(err){this$1.fire("error",err);return}util.extend(this$1,tileJSON);this$1.fire("data",{dataType:"source"});this$1.fire("source.load")})};VectorTileSource.prototype.onAdd=function onAdd(map){this.load();this.map=map};VectorTileSource.prototype.serialize=function serialize(){return util.extend({},this._options)};VectorTileSource.prototype.loadTile=function loadTile(tile,callback){var overscaling=tile.coord.z>this.maxzoom?Math.pow(2,tile.coord.z-this.maxzoom):1;var params={url:normalizeURL(tile.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:tile.uid,coord:tile.coord,zoom:tile.coord.z,tileSize:this.tileSize*overscaling,type:this.type,source:this.id,overscaling:overscaling,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};if(!tile.workerID||tile.state==="expired"){tile.workerID=this.dispatcher.send("loadTile",params,done.bind(this))}else if(tile.state==="loading"){tile.reloadCallback=callback}else{this.dispatcher.send("reloadTile",params,done.bind(this),tile.workerID)}function done(err,data){if(tile.aborted)return;if(err){return callback(err)}tile.setExpiryData(data);tile.loadVectorData(data,this.map.painter);if(tile.redoWhenDone){tile.redoWhenDone=false;tile.redoPlacement(this)}callback(null);if(tile.reloadCallback){this.loadTile(tile,tile.reloadCallback);tile.reloadCallback=null}}};VectorTileSource.prototype.abortTile=function abortTile(tile){this.dispatcher.send("abortTile",{uid:tile.uid,type:this.type,source:this.id},null,tile.workerID)};VectorTileSource.prototype.unloadTile=function unloadTile(tile){tile.unloadVectorData();this.dispatcher.send("removeTile",{uid:tile.uid,type:this.type,source:this.id},null,tile.workerID)};return VectorTileSource}(Evented);module.exports=VectorTileSource},{"../util/evented":201,"../util/mapbox":208,"../util/util":212,"./load_tilejson":128}],138:[function(require,module,exports){"use strict";var ajax=require("../util/ajax");var vt=require("vector-tile");var Protobuf=require("pbf");var WorkerTile=require("./worker_tile");var util=require("../util/util");var VectorTileWorkerSource=function VectorTileWorkerSource(actor,layerIndex,loadVectorData){this.actor=actor;this.layerIndex=layerIndex;if(loadVectorData){this.loadVectorData=loadVectorData}this.loading={};this.loaded={}};VectorTileWorkerSource.prototype.loadTile=function loadTile(params,callback){var source=params.source,uid=params.uid;if(!this.loading[source])this.loading[source]={};var workerTile=this.loading[source][uid]=new WorkerTile(params);workerTile.abort=this.loadVectorData(params,done.bind(this));function done(err,vectorTile){delete this.loading[source][uid];if(err)return callback(err);if(!vectorTile)return callback(null,null);workerTile.vectorTile=vectorTile;workerTile.parse(vectorTile,this.layerIndex,this.actor,function(err,result,transferrables){if(err)return callback(err);var cacheControl={};if(vectorTile.expires)cacheControl.expires=vectorTile.expires;if(vectorTile.cacheControl)cacheControl.cacheControl=vectorTile.cacheControl;callback(null,util.extend({rawTileData:vectorTile.rawData},result,cacheControl),transferrables)});this.loaded[source]=this.loaded[source]||{};this.loaded[source][uid]=workerTile}};VectorTileWorkerSource.prototype.reloadTile=function reloadTile(params,callback){var loaded=this.loaded[params.source],uid=params.uid,vtSource=this;if(loaded&&loaded[uid]){var workerTile=loaded[uid];if(workerTile.status==="parsing"){workerTile.reloadCallback=callback}else if(workerTile.status==="done"){workerTile.parse(workerTile.vectorTile,this.layerIndex,this.actor,done.bind(workerTile))}}function done(err,data){if(this.reloadCallback){var reloadCallback=this.reloadCallback;delete this.reloadCallback;this.parse(this.vectorTile,vtSource.layerIndex,vtSource.actor,reloadCallback)}callback(err,data)}};VectorTileWorkerSource.prototype.abortTile=function abortTile(params){var loading=this.loading[params.source],uid=params.uid;if(loading&&loading[uid]&&loading[uid].abort){loading[uid].abort();delete loading[uid]}};VectorTileWorkerSource.prototype.removeTile=function removeTile(params){var loaded=this.loaded[params.source],uid=params.uid;if(loaded&&loaded[uid]){delete loaded[uid]}};VectorTileWorkerSource.prototype.loadVectorData=function loadVectorData(params,callback){var xhr=ajax.getArrayBuffer(params.url,done.bind(this));return function abort(){xhr.abort()};function done(err,response){if(err){return callback(err)}var vectorTile=new vt.VectorTile(new Protobuf(response.data));vectorTile.rawData=response.data;vectorTile.cacheControl=response.cacheControl;vectorTile.expires=response.expires;callback(err,vectorTile)}};VectorTileWorkerSource.prototype.redoPlacement=function redoPlacement(params,callback){var loaded=this.loaded[params.source],loading=this.loading[params.source],uid=params.uid;if(loaded&&loaded[uid]){var workerTile=loaded[uid];var result=workerTile.redoPlacement(params.angle,params.pitch,params.showCollisionBoxes);if(result.result){callback(null,result.result,result.transferables)}}else if(loading&&loading[uid]){loading[uid].angle=params.angle}};module.exports=VectorTileWorkerSource},{"../util/ajax":192,"../util/util":212,"./worker_tile":141,pbf:222,"vector-tile":559}],139:[function(require,module,exports){"use strict";var ajax=require("../util/ajax");var ImageSource=require("./image_source");var VideoSource=function(ImageSource){function VideoSource(id,options,dispatcher,eventedParent){ImageSource.call(this,id,options,dispatcher,eventedParent);this.roundZoom=true;this.type="video";this.options=options}if(ImageSource)VideoSource.__proto__=ImageSource;VideoSource.prototype=Object.create(ImageSource&&ImageSource.prototype);VideoSource.prototype.constructor=VideoSource;VideoSource.prototype.load=function load(){var this$1=this;var options=this.options;this.urls=options.urls;ajax.getVideo(options.urls,function(err,video){if(err)return this$1.fire("error",{error:err});this$1.video=video;this$1.video.loop=true;var loopID;this$1.video.addEventListener("playing",function(){loopID=this$1.map.style.animationLoop.set(Infinity);this$1.map._rerender()});this$1.video.addEventListener("pause",function(){this$1.map.style.animationLoop.cancel(loopID)});if(this$1.map){this$1.video.play()}this$1._finishLoading()})};VideoSource.prototype.getVideo=function getVideo(){return this.video};VideoSource.prototype.onAdd=function onAdd(map){if(this.map)return;this.load();this.map=map;if(this.video){this.video.play();this.setCoordinates(this.coordinates)}};VideoSource.prototype.prepare=function prepare(){if(!this.tile||this.video.readyState<2)return;this._prepareImage(this.map.painter.gl,this.video)};VideoSource.prototype.serialize=function serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}};return VideoSource}(ImageSource);module.exports=VideoSource},{"../util/ajax":192,"./image_source":127}],140:[function(require,module,exports){"use strict";var Actor=require("../util/actor");var StyleLayerIndex=require("../style/style_layer_index");var VectorTileWorkerSource=require("./vector_tile_worker_source");var GeoJSONWorkerSource=require("./geojson_worker_source");var globalRTLTextPlugin=require("./rtl_text_plugin");var Worker=function Worker(self){var this$1=this;this.self=self;this.actor=new Actor(self,this);this.layerIndexes={};this.workerSourceTypes={vector:VectorTileWorkerSource,geojson:GeoJSONWorkerSource};this.workerSources={};this.self.registerWorkerSource=function(name,WorkerSource){if(this$1.workerSourceTypes[name]){throw new Error('Worker source with name "'+name+'" already registered.')}this$1.workerSourceTypes[name]=WorkerSource};this.self.registerRTLTextPlugin=function(rtlTextPlugin){if(globalRTLTextPlugin.applyArabicShaping||globalRTLTextPlugin.processBidirectionalText){throw new Error("RTL text plugin already registered.")}globalRTLTextPlugin["applyArabicShaping"]=rtlTextPlugin.applyArabicShaping;globalRTLTextPlugin["processBidirectionalText"]=rtlTextPlugin.processBidirectionalText}};Worker.prototype.setLayers=function setLayers(mapId,layers){this.getLayerIndex(mapId).replace(layers)};Worker.prototype.updateLayers=function updateLayers(mapId,params){this.getLayerIndex(mapId).update(params.layers,params.removedIds,params.symbolOrder)};Worker.prototype.loadTile=function loadTile(mapId,params,callback){this.getWorkerSource(mapId,params.type).loadTile(params,callback)};Worker.prototype.reloadTile=function reloadTile(mapId,params,callback){this.getWorkerSource(mapId,params.type).reloadTile(params,callback)};Worker.prototype.abortTile=function abortTile(mapId,params){this.getWorkerSource(mapId,params.type).abortTile(params)};Worker.prototype.removeTile=function removeTile(mapId,params){this.getWorkerSource(mapId,params.type).removeTile(params)};Worker.prototype.removeSource=function removeSource(mapId,params){var worker=this.getWorkerSource(mapId,params.type);if(worker.removeSource!==undefined){worker.removeSource(params)}};Worker.prototype.redoPlacement=function redoPlacement(mapId,params,callback){this.getWorkerSource(mapId,params.type).redoPlacement(params,callback)};Worker.prototype.loadWorkerSource=function loadWorkerSource(map,params,callback){try{this.self.importScripts(params.url);callback()}catch(e){callback(e)}};Worker.prototype.loadRTLTextPlugin=function loadRTLTextPlugin(map,pluginURL,callback){try{if(!globalRTLTextPlugin.applyArabicShaping&&!globalRTLTextPlugin.processBidirectionalText){this.self.importScripts(pluginURL)}}catch(e){callback(e)}};Worker.prototype.getLayerIndex=function getLayerIndex(mapId){var layerIndexes=this.layerIndexes[mapId];if(!layerIndexes){layerIndexes=this.layerIndexes[mapId]=new StyleLayerIndex}return layerIndexes};Worker.prototype.getWorkerSource=function getWorkerSource(mapId,type){var this$1=this;if(!this.workerSources[mapId])this.workerSources[mapId]={};if(!this.workerSources[mapId][type]){var actor={send:function(type,data,callback,buffers){this$1.actor.send(type,data,callback,buffers,mapId)}};this.workerSources[mapId][type]=new this.workerSourceTypes[type](actor,this.getLayerIndex(mapId))}return this.workerSources[mapId][type]};module.exports=function createWorker(self){return new Worker(self)}},{"../style/style_layer_index":154,"../util/actor":191,"./geojson_worker_source":125,"./rtl_text_plugin":132,"./vector_tile_worker_source":138}],141:[function(require,module,exports){"use strict";var FeatureIndex=require("../data/feature_index");var CollisionTile=require("../symbol/collision_tile");var CollisionBoxArray=require("../symbol/collision_box");var DictionaryCoder=require("../util/dictionary_coder");var util=require("../util/util");var SymbolInstancesArray=require("../symbol/symbol_instances");var SymbolQuadsArray=require("../symbol/symbol_quads");var WorkerTile=function WorkerTile(params){this.coord=params.coord;this.uid=params.uid;this.zoom=params.zoom;this.tileSize=params.tileSize;this.source=params.source;this.overscaling=params.overscaling;this.angle=params.angle;this.pitch=params.pitch;this.showCollisionBoxes=params.showCollisionBoxes};WorkerTile.prototype.parse=function parse(data,layerIndex,actor,callback){var this$1=this;if(!data.layers){data={layers:{_geojsonTileLayer:data}}}this.status="parsing";this.data=data;this.collisionBoxArray=new CollisionBoxArray;this.symbolInstancesArray=new SymbolInstancesArray;this.symbolQuadsArray=new SymbolQuadsArray;var sourceLayerCoder=new DictionaryCoder(Object.keys(data.layers).sort());var featureIndex=new FeatureIndex(this.coord,this.overscaling);featureIndex.bucketLayerIDs={};var buckets={};var bucketIndex=0;var options={featureIndex:featureIndex,iconDependencies:{},glyphDependencies:{}};var layerFamilies=layerIndex.familiesBySource[this.source];for(var sourceLayerId in layerFamilies){var sourceLayer=data.layers[sourceLayerId];if(!sourceLayer){continue}if(sourceLayer.version===1){util.warnOnce('Vector tile source "'+this$1.source+'" layer "'+sourceLayerId+'" does not use vector tile spec v2 '+"and therefore may have some rendering errors.")}var sourceLayerIndex=sourceLayerCoder.encode(sourceLayerId);var features=[];for(var i=0;i<sourceLayer.length;i++){var feature=sourceLayer.feature(i);feature.index=i;feature.sourceLayerIndex=sourceLayerIndex;features.push(feature)}for(var i$2=0,list=layerFamilies[sourceLayerId];i$2<list.length;i$2+=1){var family=list[i$2];var layer=family[0];if(layer.minzoom&&this$1.zoom<layer.minzoom)continue;if(layer.maxzoom&&this$1.zoom>=layer.maxzoom)continue;if(layer.layout&&layer.layout.visibility==="none")continue;for(var i$3=0,list$1=family;i$3<list$1.length;i$3+=1){var layer$1=list$1[i$3];layer$1.recalculate(this$1.zoom)}var bucket=buckets[layer.id]=layer.createBucket({index:bucketIndex,layers:family,zoom:this$1.zoom,overscaling:this$1.overscaling,collisionBoxArray:this$1.collisionBoxArray,symbolQuadsArray:this$1.symbolQuadsArray,symbolInstancesArray:this$1.symbolInstancesArray});bucket.populate(features,options);featureIndex.bucketLayerIDs[bucketIndex]=family.map(function(l){return l.id});bucketIndex++}}var done=function(collisionTile){this$1.status="done";var transferables=[];callback(null,{buckets:serializeBuckets(util.values(buckets),transferables),featureIndex:featureIndex.serialize(transferables),collisionTile:collisionTile.serialize(transferables),collisionBoxArray:this$1.collisionBoxArray.serialize(),symbolInstancesArray:this$1.symbolInstancesArray.serialize(),symbolQuadsArray:this$1.symbolQuadsArray.serialize()},transferables)};this.symbolBuckets=[];for(var i$1=layerIndex.symbolOrder.length-1;i$1>=0;i$1--){var bucket$1=buckets[layerIndex.symbolOrder[i$1]];if(bucket$1){this$1.symbolBuckets.push(bucket$1)}}if(this.symbolBuckets.length===0){return done(new CollisionTile(this.angle,this.pitch,this.collisionBoxArray))}var deps=0;var icons=Object.keys(options.iconDependencies);var stacks=util.mapObject(options.glyphDependencies,function(glyphs){return Object.keys(glyphs).map(Number)});var gotDependency=function(err){if(err)return callback(err);deps++;if(deps===2){var collisionTile=new CollisionTile(this$1.angle,this$1.pitch,this$1.collisionBoxArray);for(var i=0,list=this$1.symbolBuckets;i<list.length;i+=1){var bucket=list[i];recalculateLayers(bucket,this$1.zoom);bucket.prepare(stacks,icons);bucket.place(collisionTile,this$1.showCollisionBoxes)}done(collisionTile)}};if(Object.keys(stacks).length){actor.send("getGlyphs",{uid:this.uid,stacks:stacks},function(err,newStacks){stacks=newStacks;gotDependency(err)})}else{gotDependency()}if(icons.length){actor.send("getIcons",{icons:icons},function(err,newIcons){icons=newIcons;gotDependency(err)})}else{gotDependency()}};WorkerTile.prototype.redoPlacement=function redoPlacement(angle,pitch,showCollisionBoxes){var this$1=this;this.angle=angle;this.pitch=pitch;if(this.status!=="done"){return{}}var collisionTile=new CollisionTile(this.angle,this.pitch,this.collisionBoxArray);for(var i=0,list=this.symbolBuckets;i<list.length;i+=1){var bucket=list[i];recalculateLayers(bucket,this$1.zoom);bucket.place(collisionTile,showCollisionBoxes)}var transferables=[];return{result:{buckets:serializeBuckets(this.symbolBuckets,transferables),collisionTile:collisionTile.serialize(transferables)},transferables:transferables}};function recalculateLayers(bucket,zoom){for(var i=0,list=bucket.layers;i<list.length;i+=1){var layer=list[i];layer.recalculate(zoom)}}function serializeBuckets(buckets,transferables){return buckets.filter(function(b){return!b.isEmpty()}).map(function(b){return b.serialize(transferables)})}module.exports=WorkerTile},{"../data/feature_index":95,"../symbol/collision_box":161,"../symbol/collision_tile":163,"../symbol/symbol_instances":172,"../symbol/symbol_quads":173,"../util/dictionary_coder":198,"../util/util":212}],142:[function(require,module,exports){"use strict";var AnimationLoop=function AnimationLoop(){this.n=0;this.times=[]};AnimationLoop.prototype.stopped=function stopped(){this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()});return!this.times.length};AnimationLoop.prototype.set=function set(t){this.times.push({id:this.n,time:t+(new Date).getTime()});return this.n++};AnimationLoop.prototype.cancel=function cancel(n){this.times=this.times.filter(function(t){return t.id!==n})};module.exports=AnimationLoop},{}],143:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var ajax=require("../util/ajax");var browser=require("../util/browser");var normalizeURL=require("../util/mapbox").normalizeSpriteURL;var SpritePosition=function SpritePosition(){this.x=0;this.y=0;this.width=0;this.height=0;this.pixelRatio=1;this.sdf=false};var ImageSprite=function(Evented){function ImageSprite(base,eventedParent){var this$1=this;Evented.call(this);this.base=base;this.retina=browser.devicePixelRatio>1;this.setEventedParent(eventedParent);var format=this.retina?"@2x":"";ajax.getJSON(normalizeURL(base,format,".json"),function(err,data){if(err){this$1.fire("error",{error:err});return}this$1.data=data;if(this$1.imgData)this$1.fire("data",{dataType:"style"})});ajax.getImage(normalizeURL(base,format,".png"),function(err,img){if(err){this$1.fire("error",{error:err});return}this$1.imgData=browser.getImageData(img);for(var i=0;i<this$1.imgData.length;i+=4){var alpha=this$1.imgData[i+3]/255;this$1.imgData[i+0]*=alpha;this$1.imgData[i+1]*=alpha;this$1.imgData[i+2]*=alpha}this$1.width=img.width;if(this$1.data)this$1.fire("data",{dataType:"style"})})}if(Evented)ImageSprite.__proto__=Evented;ImageSprite.prototype=Object.create(Evented&&Evented.prototype);ImageSprite.prototype.constructor=ImageSprite;ImageSprite.prototype.toJSON=function toJSON(){return this.base};ImageSprite.prototype.loaded=function loaded(){return!!(this.data&&this.imgData)};ImageSprite.prototype.resize=function resize(){var this$1=this;if(browser.devicePixelRatio>1!==this.retina){var newSprite=new ImageSprite(this.base);newSprite.on("data",function(){this$1.data=newSprite.data;this$1.imgData=newSprite.imgData;this$1.width=newSprite.width;this$1.retina=newSprite.retina})}};ImageSprite.prototype.getSpritePosition=function getSpritePosition(name){if(!this.loaded())return new SpritePosition;var pos=this.data&&this.data[name];if(pos&&this.imgData)return pos;return new SpritePosition};return ImageSprite}(Evented);module.exports=ImageSprite},{"../util/ajax":192,"../util/browser":193,"../util/evented":201,"../util/mapbox":208}],144:[function(require,module,exports){"use strict";var styleSpec=require("./style_spec");var util=require("../util/util");var Evented=require("../util/evented");var validateStyle=require("./validate_style");var StyleDeclaration=require("./style_declaration");var StyleTransition=require("./style_transition");var TRANSITION_SUFFIX="-transition";var Light=function(Evented){function Light(lightOptions){Evented.call(this);this.properties=["anchor","color","position","intensity"];this._specifications=styleSpec.light;this.set(lightOptions)}if(Evented)Light.__proto__=Evented;Light.prototype=Object.create(Evented&&Evented.prototype);Light.prototype.constructor=Light;Light.prototype.set=function set(lightOpts){var this$1=this;if(this._validate(validateStyle.light,lightOpts))return;this._declarations={};this._transitions={};this._transitionOptions={};this.calculated={};lightOpts=util.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},lightOpts);for(var i=0,list=this.properties;i<list.length;i+=1){var prop=list[i];this$1._declarations[prop]=new StyleDeclaration(this$1._specifications[prop],lightOpts[prop])}return this};Light.prototype.getLight=function getLight(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}};Light.prototype.getLightProperty=function getLightProperty(property){if(util.endsWith(property,TRANSITION_SUFFIX)){return this._transitionOptions[property]}else{return this._declarations[property]&&this._declarations[property].value}};Light.prototype.getLightValue=function getLightValue(property,globalProperties){if(property==="position"){var calculated=this._transitions[property].calculate(globalProperties),cartesian=util.sphericalToCartesian(calculated);return{x:cartesian[0],y:cartesian[1],z:cartesian[2]}}return this._transitions[property].calculate(globalProperties)};Light.prototype.setLight=function setLight(options){var this$1=this;if(this._validate(validateStyle.light,options))return;for(var key in options){var value=options[key];if(util.endsWith(key,TRANSITION_SUFFIX)){this$1._transitionOptions[key]=value}else if(value===null||value===undefined){delete this$1._declarations[key]}else{this$1._declarations[key]=new StyleDeclaration(this$1._specifications[key],value)}}};Light.prototype.recalculate=function recalculate(zoom){var this$1=this;for(var property in this._declarations){this$1.calculated[property]=this$1.getLightValue(property,{zoom:zoom})}};Light.prototype._applyLightDeclaration=function _applyLightDeclaration(property,declaration,options,globalOptions,animationLoop){var oldTransition=options.transition?this._transitions[property]:undefined;var spec=this._specifications[property];if(declaration===null||declaration===undefined){declaration=new StyleDeclaration(spec,spec.default)}if(oldTransition&&oldTransition.declaration.json===declaration.json)return;var transitionOptions=util.extend({duration:300,delay:0},globalOptions,this.getLightProperty(property+TRANSITION_SUFFIX));var newTransition=this._transitions[property]=new StyleTransition(spec,declaration,oldTransition,transitionOptions);if(!newTransition.instant()){newTransition.loopID=animationLoop.set(newTransition.endTime-Date.now())}if(oldTransition){animationLoop.cancel(oldTransition.loopID)}};Light.prototype.updateLightTransitions=function updateLightTransitions(options,globalOptions,animationLoop){var this$1=this;var property;for(property in this._declarations){this$1._applyLightDeclaration(property,this$1._declarations[property],options,globalOptions,animationLoop)}};Light.prototype._validate=function _validate(validate,value){return validateStyle.emitErrors(this,validate.call(validateStyle,util.extend({value:value,style:{glyphs:true,sprite:true},styleSpec:styleSpec})))};return Light}(Evented);module.exports=Light},{"../util/evented":201,"../util/util":212,"./style_declaration":147,"./style_spec":155,"./style_transition":156,"./validate_style":157}],145:[function(require,module,exports){"use strict";var parseColorString=require("csscolorparser").parseCSSColor;var util=require("../util/util");var MapboxGLFunction=require("mapbox-gl-function");var cache={};module.exports=function parseColor(input){if(input&&MapboxGLFunction.isFunctionDefinition(input)){if(!input.stops)return input;else return util.extend({},input,{stops:input.stops.map(function(stop){return[stop[0],parseColor(stop[1])]})})}else if(typeof input==="string"){if(!cache[input]){var rgba=parseColorString(input);if(!rgba){throw new Error("Invalid color "+input)}cache[input]=[rgba[0]/255*rgba[3],rgba[1]/255*rgba[3],rgba[2]/255*rgba[3],rgba[3]]}return cache[input]}else if(Array.isArray(input)){return input}else{throw new Error("Invalid color "+input)}}},{"../util/util":212,csscolorparser:18,"mapbox-gl-function":54}],146:[function(require,module,exports){"use strict";var Evented=require("../util/evented");var StyleLayer=require("./style_layer");var ImageSprite=require("./image_sprite");var Light=require("./light");var GlyphSource=require("../symbol/glyph_source");var SpriteAtlas=require("../symbol/sprite_atlas");var LineAtlas=require("../render/line_atlas");var util=require("../util/util");var ajax=require("../util/ajax");var mapbox=require("../util/mapbox");var browser=require("../util/browser");var Dispatcher=require("../util/dispatcher");var AnimationLoop=require("./animation_loop");var validateStyle=require("./validate_style");var Source=require("../source/source");var QueryFeatures=require("../source/query_features");var SourceCache=require("../source/source_cache");var styleSpec=require("./style_spec");var MapboxGLFunction=require("mapbox-gl-function");var getWorkerPool=require("../global_worker_pool");var deref=require("mapbox-gl-style-spec/lib/deref");var diff=require("mapbox-gl-style-spec/lib/diff");var rtlTextPlugin=require("../source/rtl_text_plugin");var supportedDiffOperations=util.pick(diff.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]);var ignoredDiffOperations=util.pick(diff.operations,["setCenter","setZoom","setBearing","setPitch"]);var Style=function(Evented){function Style(stylesheet,map,options){var this$1=this;Evented.call(this);this.map=map;this.animationLoop=map&&map.animationLoop||new AnimationLoop;this.dispatcher=new Dispatcher(getWorkerPool(),this);this.spriteAtlas=new SpriteAtlas(1024,1024);this.lineAtlas=new LineAtlas(256,512);this._layers={};this._order=[];this.sourceCaches={};this.zoomHistory={};this._loaded=false;util.bindAll(["_redoPlacement"],this);this._resetUpdates();options=util.extend({validate:typeof stylesheet==="string"?!mapbox.isMapboxURL(stylesheet):true},options);this.setEventedParent(map);this.fire("dataloading",{dataType:"style"});var self=this;rtlTextPlugin.registerForPluginAvailability(function(pluginBlobURL){self.dispatcher.broadcast("loadRTLTextPlugin",pluginBlobURL,rtlTextPlugin.errorCallback);for(var id in self.sourceCaches){self.sourceCaches[id].reload()}});var stylesheetLoaded=function(err,stylesheet){if(err){this$1.fire("error",{error:err});return}if(options.validate&&validateStyle.emitErrors(this$1,validateStyle(stylesheet)))return;

this$1._loaded=true;this$1.stylesheet=stylesheet;this$1.updateClasses();for(var id in stylesheet.sources){this$1.addSource(id,stylesheet.sources[id],options)}if(stylesheet.sprite){this$1.sprite=new ImageSprite(stylesheet.sprite,this$1)}this$1.glyphSource=new GlyphSource(stylesheet.glyphs);this$1._resolve();this$1.fire("data",{dataType:"style"});this$1.fire("style.load")};if(typeof stylesheet==="string"){ajax.getJSON(mapbox.normalizeStyleURL(stylesheet),stylesheetLoaded)}else{browser.frame(stylesheetLoaded.bind(this,null,stylesheet))}this.on("source.load",function(event){var source=this$1.sourceCaches[event.sourceId].getSource();if(source&&source.vectorLayerIds){for(var layerId in this$1._layers){var layer=this$1._layers[layerId];if(layer.source===source.id){this$1._validateLayer(layer)}}}})}if(Evented)Style.__proto__=Evented;Style.prototype=Object.create(Evented&&Evented.prototype);Style.prototype.constructor=Style;Style.prototype._validateLayer=function _validateLayer(layer){var sourceCache=this.sourceCaches[layer.source];if(!layer.sourceLayer)return;if(!sourceCache)return;var source=sourceCache.getSource();if(source.type==="geojson"||source.vectorLayerIds&&source.vectorLayerIds.indexOf(layer.sourceLayer)===-1){this.fire("error",{error:new Error('Source layer "'+layer.sourceLayer+'" '+'does not exist on source "'+source.id+'" '+'as specified by style layer "'+layer.id+'"')})}};Style.prototype.loaded=function loaded(){var this$1=this;if(!this._loaded)return false;if(Object.keys(this._updatedSources).length)return false;for(var id in this.sourceCaches)if(!this$1.sourceCaches[id].loaded())return false;if(this.sprite&&!this.sprite.loaded())return false;return true};Style.prototype._resolve=function _resolve(){var this$1=this;var layers=deref(this.stylesheet.layers);this._order=layers.map(function(layer){return layer.id});this._layers={};for(var i=0,list=layers;i<list.length;i+=1){var layer=list[i];layer=StyleLayer.create(layer);layer.setEventedParent(this$1,{layer:{id:layer.id}});this$1._layers[layer.id]=layer}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order));this.light=new Light(this.stylesheet.light)};Style.prototype._serializeLayers=function _serializeLayers(ids){var this$1=this;return ids.map(function(id){return this$1._layers[id].serialize()})};Style.prototype._applyClasses=function _applyClasses(classes,options){var this$1=this;if(!this._loaded)return;classes=classes||[];options=options||{transition:true};var transition=this.stylesheet.transition||{};var layers=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var id in layers){var layer=this$1._layers[id];var props=this$1._updatedPaintProps[id];if(this$1._updatedAllPaintProps||props.all){layer.updatePaintTransitions(classes,options,transition,this$1.animationLoop,this$1.zoomHistory)}else{for(var paintName in props){this$1._layers[id].updatePaintTransition(paintName,classes,options,transition,this$1.animationLoop,this$1.zoomHistory)}}}this.light.updateLightTransitions(options,transition,this.animationLoop)};Style.prototype._recalculate=function _recalculate(z){var this$1=this;if(!this._loaded)return;for(var sourceId in this.sourceCaches)this$1.sourceCaches[sourceId].used=false;this._updateZoomHistory(z);for(var i=0,list=this._order;i<list.length;i+=1){var layerId=list[i];var layer=this$1._layers[layerId];layer.recalculate(z);if(!layer.isHidden(z)&&layer.source){this$1.sourceCaches[layer.source].used=true}}this.light.recalculate(z);var maxZoomTransitionDuration=300;if(Math.floor(this.z)!==Math.floor(z)){this.animationLoop.set(maxZoomTransitionDuration)}this.z=z};Style.prototype._updateZoomHistory=function _updateZoomHistory(z){var zh=this.zoomHistory;if(zh.lastIntegerZoom===undefined){zh.lastIntegerZoom=Math.floor(z);zh.lastIntegerZoomTime=0;zh.lastZoom=z}if(Math.floor(zh.lastZoom)<Math.floor(z)){zh.lastIntegerZoom=Math.floor(z);zh.lastIntegerZoomTime=Date.now()}else if(Math.floor(zh.lastZoom)>Math.floor(z)){zh.lastIntegerZoom=Math.floor(z+1);zh.lastIntegerZoomTime=Date.now()}zh.lastZoom=z};Style.prototype._checkLoaded=function _checkLoaded(){if(!this._loaded){throw new Error("Style is not done loading")}};Style.prototype.update=function update(classes,options){var this$1=this;if(!this._changed)return;var updatedIds=Object.keys(this._updatedLayers);var removedIds=Object.keys(this._removedLayers);if(updatedIds.length||removedIds.length||this._updatedSymbolOrder){this._updateWorkerLayers(updatedIds,removedIds)}for(var id in this._updatedSources){var action=this$1._updatedSources[id];if(action==="reload"){this$1._reloadSource(id)}else if(action==="clear"){this$1._clearSource(id)}}this._applyClasses(classes,options);this._resetUpdates();this.fire("data",{dataType:"style"})};Style.prototype._updateWorkerLayers=function _updateWorkerLayers(updatedIds,removedIds){var this$1=this;var symbolOrder=this._updatedSymbolOrder?this._order.filter(function(id){return this$1._layers[id].type==="symbol"}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(updatedIds),removedIds:removedIds,symbolOrder:symbolOrder})};Style.prototype._resetUpdates=function _resetUpdates(){this._changed=false;this._updatedLayers={};this._removedLayers={};this._updatedSymbolOrder=false;this._updatedSources={};this._updatedPaintProps={};this._updatedAllPaintProps=false};Style.prototype.setState=function setState(nextState){var this$1=this;this._checkLoaded();if(validateStyle.emitErrors(this,validateStyle(nextState)))return false;nextState=util.extend({},nextState);nextState.layers=deref(nextState.layers);var changes=diff(this.serialize(),nextState).filter(function(op){return!(op.command in ignoredDiffOperations)});if(changes.length===0){return false}var unimplementedOps=changes.filter(function(op){return!(op.command in supportedDiffOperations)});if(unimplementedOps.length>0){throw new Error("Unimplemented: "+unimplementedOps.map(function(op){return op.command}).join(", ")+".")}changes.forEach(function(op){if(op.command==="setTransition"){return}this$1[op.command].apply(this$1,op.args)});this.stylesheet=nextState;return true};Style.prototype.addSource=function addSource(id,source,options){this._checkLoaded();if(this.sourceCaches[id]!==undefined){throw new Error("There is already a source with this ID")}if(!source.type){throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(source)+".")}var builtIns=["vector","raster","geojson","video","image","canvas"];var shouldValidate=builtIns.indexOf(source.type)>=0;if(shouldValidate&&this._validate(validateStyle.source,"sources."+id,source,null,options))return;var sourceCache=this.sourceCaches[id]=new SourceCache(id,source,this.dispatcher);sourceCache.style=this;sourceCache.setEventedParent(this,function(){return{isSourceLoaded:sourceCache.loaded(),source:sourceCache.serialize(),sourceId:id}});sourceCache.onAdd(this.map);this._changed=true};Style.prototype.removeSource=function removeSource(id){this._checkLoaded();if(this.sourceCaches[id]===undefined){throw new Error("There is no source with this ID")}var sourceCache=this.sourceCaches[id];delete this.sourceCaches[id];delete this._updatedSources[id];sourceCache.setEventedParent(null);sourceCache.clearTiles();if(sourceCache.onRemove)sourceCache.onRemove(this.map);this._changed=true};Style.prototype.getSource=function getSource(id){return this.sourceCaches[id]&&this.sourceCaches[id].getSource()};Style.prototype.addLayer=function addLayer(layerObject,before,options){this._checkLoaded();var id=layerObject.id;if(typeof layerObject.source==="object"){this.addSource(id,layerObject.source);layerObject=util.extend(layerObject,{source:id})}if(this._validate(validateStyle.layer,"layers."+id,layerObject,{arrayIndex:-1},options))return;var layer=StyleLayer.create(layerObject);this._validateLayer(layer);layer.setEventedParent(this,{layer:{id:id}});var index=before?this._order.indexOf(before):this._order.length;this._order.splice(index,0,id);this._layers[id]=layer;if(this._removedLayers[id]&&layer.source){var removed=this._removedLayers[id];delete this._removedLayers[id];this._updatedSources[layer.source]=removed.type!==layer.type?"clear":"reload"}this._updateLayer(layer);if(layer.type==="symbol"){this._updatedSymbolOrder=true}this.updateClasses(id)};Style.prototype.moveLayer=function moveLayer(id,before){this._checkLoaded();this._changed=true;var layer=this._layers[id];if(!layer){this.fire("error",{error:new Error("The layer '"+id+"' does not exist in "+"the map's style and cannot be moved.")});return}var index=this._order.indexOf(id);this._order.splice(index,1);var newIndex=before?this._order.indexOf(before):this._order.length;this._order.splice(newIndex,0,id);if(layer.type==="symbol"){this._updatedSymbolOrder=true;if(layer.source&&!this._updatedSources[layer.source]){this._updatedSources[layer.source]="reload"}}};Style.prototype.removeLayer=function removeLayer(id){this._checkLoaded();var layer=this._layers[id];if(!layer){this.fire("error",{error:new Error("The layer '"+id+"' does not exist in "+"the map's style and cannot be removed.")});return}layer.setEventedParent(null);var index=this._order.indexOf(id);this._order.splice(index,1);if(layer.type==="symbol"){this._updatedSymbolOrder=true}this._changed=true;this._removedLayers[id]=layer;delete this._layers[id];delete this._updatedLayers[id];delete this._updatedPaintProps[id]};Style.prototype.getLayer=function getLayer(id){return this._layers[id]};Style.prototype.setLayerZoomRange=function setLayerZoomRange(layerId,minzoom,maxzoom){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot have zoom extent.")});return}if(layer.minzoom===minzoom&&layer.maxzoom===maxzoom)return;if(minzoom!=null){layer.minzoom=minzoom}if(maxzoom!=null){layer.maxzoom=maxzoom}this._updateLayer(layer)};Style.prototype.setFilter=function setFilter(layerId,filter){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot be filtered.")});return}if(filter!==null&&filter!==undefined&&this._validate(validateStyle.filter,"layers."+layer.id+".filter",filter))return;if(util.deepEqual(layer.filter,filter))return;layer.filter=util.clone(filter);this._updateLayer(layer)};Style.prototype.getFilter=function getFilter(layer){return util.clone(this.getLayer(layer).filter)};Style.prototype.setLayoutProperty=function setLayoutProperty(layerId,name,value){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot be styled.")});return}if(util.deepEqual(layer.getLayoutProperty(name),value))return;layer.setLayoutProperty(name,value);this._updateLayer(layer)};Style.prototype.getLayoutProperty=function getLayoutProperty(layer,name){return this.getLayer(layer).getLayoutProperty(name)};Style.prototype.setPaintProperty=function setPaintProperty(layerId,name,value,klass){this._checkLoaded();var layer=this.getLayer(layerId);if(!layer){this.fire("error",{error:new Error("The layer '"+layerId+"' does not exist in "+"the map's style and cannot be styled.")});return}if(util.deepEqual(layer.getPaintProperty(name,klass),value))return;var wasFeatureConstant=layer.isPaintValueFeatureConstant(name);layer.setPaintProperty(name,value,klass);var isFeatureConstant=!(value&&MapboxGLFunction.isFunctionDefinition(value)&&value.property!=="$zoom"&&value.property!==undefined);if(!isFeatureConstant||!wasFeatureConstant){this._updateLayer(layer)}this.updateClasses(layerId,name)};Style.prototype.getPaintProperty=function getPaintProperty(layer,name,klass){return this.getLayer(layer).getPaintProperty(name,klass)};Style.prototype.getTransition=function getTransition(){return util.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)};Style.prototype.updateClasses=function updateClasses(layerId,paintName){this._changed=true;if(!layerId){this._updatedAllPaintProps=true}else{var props=this._updatedPaintProps;if(!props[layerId])props[layerId]={};props[layerId][paintName||"all"]=true}};Style.prototype.serialize=function serialize(){var this$1=this;return util.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:util.mapObject(this.sourceCaches,function(source){return source.serialize()}),layers:this._order.map(function(id){return this$1._layers[id].serialize()})},function(value){return value!==undefined})};Style.prototype._updateLayer=function _updateLayer(layer){this._updatedLayers[layer.id]=true;if(layer.source&&!this._updatedSources[layer.source]){this._updatedSources[layer.source]="reload"}this._changed=true};Style.prototype._flattenRenderedFeatures=function _flattenRenderedFeatures(sourceResults){var this$1=this;var features=[];for(var l=this._order.length-1;l>=0;l--){var layerId=this$1._order[l];for(var i=0,list=sourceResults;i<list.length;i+=1){var sourceResult=list[i];var layerFeatures=sourceResult[layerId];if(layerFeatures){for(var i$1=0,list$1=layerFeatures;i$1<list$1.length;i$1+=1){var feature=list$1[i$1];features.push(feature)}}}}return features};Style.prototype.queryRenderedFeatures=function queryRenderedFeatures(queryGeometry,params,zoom,bearing){var this$1=this;if(params&&params.filter){this._validate(validateStyle.filter,"queryRenderedFeatures.filter",params.filter)}var includedSources={};if(params&&params.layers){for(var i=0,list=params.layers;i<list.length;i+=1){var layerId=list[i];var layer=this$1._layers[layerId];if(!layer){this$1.fire("error",{error:"The layer '"+layerId+"' does not exist in the map's style and cannot be queried for features."});return}includedSources[layer.source]=true}}var sourceResults=[];for(var id in this.sourceCaches){if(params.layers&&!includedSources[id])continue;var results=QueryFeatures.rendered(this$1.sourceCaches[id],this$1._layers,queryGeometry,params,zoom,bearing);sourceResults.push(results)}return this._flattenRenderedFeatures(sourceResults)};Style.prototype.querySourceFeatures=function querySourceFeatures(sourceID,params){if(params&&params.filter){this._validate(validateStyle.filter,"querySourceFeatures.filter",params.filter)}var sourceCache=this.sourceCaches[sourceID];return sourceCache?QueryFeatures.source(sourceCache,params):[]};Style.prototype.addSourceType=function addSourceType(name,SourceType,callback){if(Source.getType(name)){return callback(new Error('A source type called "'+name+'" already exists.'))}Source.setType(name,SourceType);if(!SourceType.workerSourceURL){return callback(null,null)}this.dispatcher.broadcast("loadWorkerSource",{name:name,url:SourceType.workerSourceURL},callback)};Style.prototype.getLight=function getLight(){return this.light.getLight()};Style.prototype.setLight=function setLight(lightOptions,transitionOptions){this._checkLoaded();var light=this.light.getLight();var _update=false;for(var key in lightOptions){if(!util.deepEqual(lightOptions[key],light[key])){_update=true;break}}if(!_update)return;var transition=this.stylesheet.transition||{};this.light.setLight(lightOptions);this.light.updateLightTransitions(transitionOptions||{transition:true},transition,this.animationLoop)};Style.prototype._validate=function _validate(validate,key,value,props,options){if(options&&options.validate===false){return false}return validateStyle.emitErrors(this,validate.call(validateStyle,util.extend({key:key,style:this.serialize(),value:value,styleSpec:styleSpec},props)))};Style.prototype._remove=function _remove(){var this$1=this;for(var id in this.sourceCaches){this$1.sourceCaches[id].clearTiles()}this.dispatcher.remove()};Style.prototype._clearSource=function _clearSource(id){this.sourceCaches[id].clearTiles()};Style.prototype._reloadSource=function _reloadSource(id){this.sourceCaches[id].reload()};Style.prototype._updateSources=function _updateSources(transform){var this$1=this;for(var id in this.sourceCaches){this$1.sourceCaches[id].update(transform)}};Style.prototype._redoPlacement=function _redoPlacement(){var this$1=this;for(var id in this.sourceCaches){this$1.sourceCaches[id].redoPlacement()}};Style.prototype.getIcons=function getIcons(mapId,params,callback){var this$1=this;var updateSpriteAtlas=function(){this$1.spriteAtlas.setSprite(this$1.sprite);this$1.spriteAtlas.addIcons(params.icons,callback)};if(this.sprite.loaded()){updateSpriteAtlas()}else{this.sprite.on("data",updateSpriteAtlas)}};Style.prototype.getGlyphs=function getGlyphs(mapId,params,callback){var this$1=this;var stacks=params.stacks;var remaining=Object.keys(stacks).length;var allGlyphs={};for(var fontName in stacks){this$1.glyphSource.getSimpleGlyphs(fontName,stacks[fontName],params.uid,done)}function done(err,glyphs,fontName){if(err)console.error(err);allGlyphs[fontName]=glyphs;remaining--;if(remaining===0)callback(null,allGlyphs)}};return Style}(Evented);module.exports=Style},{"../global_worker_pool":105,"../render/line_atlas":118,"../source/query_features":130,"../source/rtl_text_plugin":132,"../source/source":133,"../source/source_cache":134,"../symbol/glyph_source":166,"../symbol/sprite_atlas":171,"../util/ajax":192,"../util/browser":193,"../util/dispatcher":199,"../util/evented":201,"../util/mapbox":208,"../util/util":212,"./animation_loop":142,"./image_sprite":143,"./light":144,"./style_layer":148,"./style_spec":155,"./validate_style":157,"mapbox-gl-function":54,"mapbox-gl-style-spec/lib/deref":55,"mapbox-gl-style-spec/lib/diff":56}],147:[function(require,module,exports){"use strict";var MapboxGLFunction=require("mapbox-gl-function");var parseColor=require("./parse_color");var util=require("../util/util");var StyleDeclaration=function StyleDeclaration(reference,value){var this$1=this;this.value=util.clone(value);this.isFunction=MapboxGLFunction.isFunctionDefinition(value);this.json=JSON.stringify(this.value);this.minimum=reference.minimum;this.isColor=reference.type==="color";var parsedValue=this.isColor&&this.value?parseColor(this.value):value;var specDefault=reference.default;if(specDefault&&reference.type==="color")specDefault=parseColor(specDefault);this.function=MapboxGLFunction[reference.function||"piecewise-constant"](parsedValue,specDefault);this.isFeatureConstant=this.function.isFeatureConstant;this.isZoomConstant=this.function.isZoomConstant;if(!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];var interpolationAmountStops=[];for(var i=0,list=this.value.stops;i<list.length;i+=1){var stop=list[i];var zoom=stop[0].zoom;if(this$1.stopZoomLevels.indexOf(zoom)<0){this$1.stopZoomLevels.push(zoom);interpolationAmountStops.push([zoom,interpolationAmountStops.length])}}this.functionInterpolationT=MapboxGLFunction.interpolated({stops:interpolationAmountStops,base:value.base,colorSpace:value.colorSpace})}};StyleDeclaration.prototype.calculate=function calculate(globalProperties,featureProperties){var value=this.function(globalProperties&&globalProperties.zoom,featureProperties||{});if(this.isColor&&value){return parseColor(value)}if(this.minimum!==undefined&&value<this.minimum){return this.minimum}return value};StyleDeclaration.prototype.calculateInterpolationT=function calculateInterpolationT(globalProperties,featureProperties){return this.functionInterpolationT(globalProperties&&globalProperties.zoom,featureProperties||{})};module.exports=StyleDeclaration},{"../util/util":212,"./parse_color":145,"mapbox-gl-function":54}],148:[function(require,module,exports){"use strict";var util=require("../util/util");var StyleTransition=require("./style_transition");var StyleDeclaration=require("./style_declaration");var styleSpec=require("./style_spec");var validateStyle=require("./validate_style");var parseColor=require("./parse_color");var Evented=require("../util/evented");var TRANSITION_SUFFIX="-transition";var StyleLayer=function(Evented){function StyleLayer(layer){var this$1=this;Evented.call(this);this.id=layer.id;this.metadata=layer.metadata;this.type=layer.type;this.source=layer.source;this.sourceLayer=layer["source-layer"];this.minzoom=layer.minzoom;this.maxzoom=layer.maxzoom;this.filter=layer.filter;this.paint={};this.layout={};this._paintSpecifications=styleSpec["paint_"+this.type];this._layoutSpecifications=styleSpec["layout_"+this.type];this._paintTransitions={};this._paintTransitionOptions={};this._paintDeclarations={};this._layoutDeclarations={};this._layoutFunctions={};var paintName,layoutName;var options={validate:false};for(var key in layer){var match=key.match(/^paint(?:\.(.*))?$/);if(match){var klass=match[1]||"";for(paintName in layer[key]){this$1.setPaintProperty(paintName,layer[key][paintName],klass,options)}}}for(layoutName in layer.layout){this$1.setLayoutProperty(layoutName,layer.layout[layoutName],options)}for(paintName in this._paintSpecifications){this$1.paint[paintName]=this$1.getPaintValue(paintName)}for(layoutName in this._layoutSpecifications){this$1._updateLayoutValue(layoutName)}}if(Evented)StyleLayer.__proto__=Evented;StyleLayer.prototype=Object.create(Evented&&Evented.prototype);StyleLayer.prototype.constructor=StyleLayer;StyleLayer.prototype.setLayoutProperty=function setLayoutProperty(name,value,options){if(value==null){delete this._layoutDeclarations[name]}else{var key="layers."+this.id+".layout."+name;if(this._validate(validateStyle.layoutProperty,key,name,value,options))return;this._layoutDeclarations[name]=new StyleDeclaration(this._layoutSpecifications[name],value)}this._updateLayoutValue(name)};StyleLayer.prototype.getLayoutProperty=function getLayoutProperty(name){return this._layoutDeclarations[name]&&this._layoutDeclarations[name].value};StyleLayer.prototype.getLayoutValue=function getLayoutValue(name,globalProperties,featureProperties){var specification=this._layoutSpecifications[name];var declaration=this._layoutDeclarations[name];if(declaration){return declaration.calculate(globalProperties,featureProperties)}else{return specification.default}};StyleLayer.prototype.setPaintProperty=function setPaintProperty(name,value,klass,options){var validateStyleKey="layers."+this.id+(klass?'["paint.'+klass+'"].':".paint.")+name;if(util.endsWith(name,TRANSITION_SUFFIX)){if(!this._paintTransitionOptions[klass||""]){this._paintTransitionOptions[klass||""]={}}if(value===null||value===undefined){delete this._paintTransitionOptions[klass||""][name]}else{if(this._validate(validateStyle.paintProperty,validateStyleKey,name,value,options))return;this._paintTransitionOptions[klass||""][name]=value}}else{if(!this._paintDeclarations[klass||""]){this._paintDeclarations[klass||""]={}}if(value===null||value===undefined){delete this._paintDeclarations[klass||""][name]}else{if(this._validate(validateStyle.paintProperty,validateStyleKey,name,value,options))return;this._paintDeclarations[klass||""][name]=new StyleDeclaration(this._paintSpecifications[name],value)}}};StyleLayer.prototype.getPaintProperty=function getPaintProperty(name,klass){klass=klass||"";if(util.endsWith(name,TRANSITION_SUFFIX)){return this._paintTransitionOptions[klass]&&this._paintTransitionOptions[klass][name]}else{return this._paintDeclarations[klass]&&this._paintDeclarations[klass][name]&&this._paintDeclarations[klass][name].value}};StyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){var specification=this._paintSpecifications[name];var transition=this._paintTransitions[name];if(transition){return transition.calculate(globalProperties,featureProperties)}else if(specification.type==="color"&&specification.default){return parseColor(specification.default)}else{return specification.default}};StyleLayer.prototype.getPaintValueStopZoomLevels=function getPaintValueStopZoomLevels(name){var transition=this._paintTransitions[name];if(transition){return transition.declaration.stopZoomLevels}else{return[]}};StyleLayer.prototype.getPaintInterpolationT=function getPaintInterpolationT(name,globalProperties){var transition=this._paintTransitions[name];return transition.declaration.calculateInterpolationT(globalProperties)};StyleLayer.prototype.isPaintValueFeatureConstant=function isPaintValueFeatureConstant(name){var transition=this._paintTransitions[name];if(transition){return transition.declaration.isFeatureConstant}else{return true}};StyleLayer.prototype.isLayoutValueFeatureConstant=function isLayoutValueFeatureConstant(name){var declaration=this._layoutDeclarations[name];if(declaration){return declaration.isFeatureConstant}else{return true}};StyleLayer.prototype.isPaintValueZoomConstant=function isPaintValueZoomConstant(name){var transition=this._paintTransitions[name];if(transition){return transition.declaration.isZoomConstant}else{return true}};StyleLayer.prototype.isHidden=function isHidden(zoom){if(this.minzoom&&zoom<this.minzoom)return true;if(this.maxzoom&&zoom>=this.maxzoom)return true;if(this.layout["visibility"]==="none")return true;return false};StyleLayer.prototype.updatePaintTransitions=function updatePaintTransitions(classes,options,globalOptions,animationLoop,zoomHistory){var this$1=this;var declarations=util.extend({},this._paintDeclarations[""]);for(var i=0;i<classes.length;i++){util.extend(declarations,this$1._paintDeclarations[classes[i]])}var name;for(name in declarations){this$1._applyPaintDeclaration(name,declarations[name],options,globalOptions,animationLoop,zoomHistory)}for(name in this._paintTransitions){if(!(name in declarations))this$1._applyPaintDeclaration(name,null,options,globalOptions,animationLoop,zoomHistory)}};StyleLayer.prototype.updatePaintTransition=function updatePaintTransition(name,classes,options,globalOptions,animationLoop,zoomHistory){var this$1=this;var declaration=this._paintDeclarations[""][name];for(var i=0;i<classes.length;i++){var classPaintDeclarations=this$1._paintDeclarations[classes[i]];if(classPaintDeclarations&&classPaintDeclarations[name]){declaration=classPaintDeclarations[name]}}this._applyPaintDeclaration(name,declaration,options,globalOptions,animationLoop,zoomHistory)};StyleLayer.prototype.recalculate=function recalculate(zoom){var this$1=this;for(var paintName in this._paintTransitions){this$1.paint[paintName]=this$1.getPaintValue(paintName,{zoom:zoom})}for(var layoutName in this._layoutFunctions){this$1.layout[layoutName]=this$1.getLayoutValue(layoutName,{zoom:zoom})}};StyleLayer.prototype.serialize=function serialize(){var this$1=this;var output={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:util.mapObject(this._layoutDeclarations,getDeclarationValue)};for(var klass in this._paintDeclarations){var key=klass===""?"paint":"paint."+klass;output[key]=util.mapObject(this$1._paintDeclarations[klass],getDeclarationValue)}return util.filterObject(output,function(value,key){return value!==undefined&&!(key==="layout"&&!Object.keys(value).length)})};StyleLayer.prototype._applyPaintDeclaration=function _applyPaintDeclaration(name,declaration,options,globalOptions,animationLoop,zoomHistory){var oldTransition=options.transition?this._paintTransitions[name]:undefined;var spec=this._paintSpecifications[name];if(declaration===null||declaration===undefined){declaration=new StyleDeclaration(spec,spec.default)}if(oldTransition&&oldTransition.declaration.json===declaration.json)return;var transitionOptions=util.extend({duration:300,delay:0},globalOptions,this.getPaintProperty(name+TRANSITION_SUFFIX));var newTransition=this._paintTransitions[name]=new StyleTransition(spec,declaration,oldTransition,transitionOptions,zoomHistory);if(!newTransition.instant()){newTransition.loopID=animationLoop.set(newTransition.endTime-Date.now())}if(oldTransition){animationLoop.cancel(oldTransition.loopID)}};StyleLayer.prototype._updateLayoutValue=function _updateLayoutValue(name){var declaration=this._layoutDeclarations[name];if(declaration&&declaration.isFunction){this._layoutFunctions[name]=true}else{delete this._layoutFunctions[name];this.layout[name]=this.getLayoutValue(name)}};StyleLayer.prototype._validate=function _validate(validate,key,name,value,options){if(options&&options.validate===false){return false}return validateStyle.emitErrors(this,validate.call(validateStyle,{key:key,layerType:this.type,objectKey:name,value:value,styleSpec:styleSpec,style:{glyphs:true,sprite:true}}))};return StyleLayer}(Evented);module.exports=StyleLayer;var subclasses={circle:require("./style_layer/circle_style_layer"),fill:require("./style_layer/fill_style_layer"),"fill-extrusion":require("./style_layer/fill_extrusion_style_layer"),line:require("./style_layer/line_style_layer"),symbol:require("./style_layer/symbol_style_layer")};StyleLayer.create=function(layer){var LayerClass=subclasses[layer.type]||StyleLayer;return new LayerClass(layer)};function getDeclarationValue(declaration){return declaration.value}},{"../util/evented":201,"../util/util":212,"./parse_color":145,"./style_declaration":147,"./style_layer/circle_style_layer":149,"./style_layer/fill_extrusion_style_layer":150,"./style_layer/fill_style_layer":151,"./style_layer/line_style_layer":152,"./style_layer/symbol_style_layer":153,"./style_spec":155,"./style_transition":156,"./validate_style":157}],149:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var CircleBucket=require("../../data/bucket/circle_bucket");var CircleStyleLayer=function(StyleLayer){function CircleStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)CircleStyleLayer.__proto__=StyleLayer;CircleStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);CircleStyleLayer.prototype.constructor=CircleStyleLayer;CircleStyleLayer.prototype.createBucket=function createBucket(options){return new CircleBucket(options)};return CircleStyleLayer}(StyleLayer);module.exports=CircleStyleLayer},{"../../data/bucket/circle_bucket":86,"../style_layer":148}],150:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var FillExtrusionBucket=require("../../data/bucket/fill_extrusion_bucket");var FillExtrusionStyleLayer=function(StyleLayer){function FillExtrusionStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)FillExtrusionStyleLayer.__proto__=StyleLayer;FillExtrusionStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);FillExtrusionStyleLayer.prototype.constructor=FillExtrusionStyleLayer;FillExtrusionStyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){var value=StyleLayer.prototype.getPaintValue.call(this,name,globalProperties,featureProperties);if(name==="fill-extrusion-color"&&value){value[3]=1}return value};FillExtrusionStyleLayer.prototype.createBucket=function createBucket(options){return new FillExtrusionBucket(options)};return FillExtrusionStyleLayer}(StyleLayer);module.exports=FillExtrusionStyleLayer},{"../../data/bucket/fill_extrusion_bucket":88,"../style_layer":148}],151:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var FillBucket=require("../../data/bucket/fill_bucket");var FillStyleLayer=function(StyleLayer){function FillStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)FillStyleLayer.__proto__=StyleLayer;FillStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);FillStyleLayer.prototype.constructor=FillStyleLayer;FillStyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){var this$1=this;if(name==="fill-outline-color"){if(this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.getPaintValue.call(this,"fill-color",globalProperties,featureProperties);

}var transition=this._paintTransitions["fill-outline-color"];while(transition){var declaredValue=transition&&transition.declaration&&transition.declaration.value;if(!declaredValue){return StyleLayer.prototype.getPaintValue.call(this$1,"fill-color",globalProperties,featureProperties)}transition=transition.oldTransition}}return StyleLayer.prototype.getPaintValue.call(this,name,globalProperties,featureProperties)};FillStyleLayer.prototype.getPaintValueStopZoomLevels=function getPaintValueStopZoomLevels(name){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.getPaintValueStopZoomLevels.call(this,"fill-color")}else{return StyleLayer.prototype.getPaintValueStopZoomLevels.call(this,name)}};FillStyleLayer.prototype.getPaintInterpolationT=function getPaintInterpolationT(name,globalProperties){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.getPaintInterpolationT.call(this,"fill-color",globalProperties)}else{return StyleLayer.prototype.getPaintInterpolationT.call(this,name,globalProperties)}};FillStyleLayer.prototype.isPaintValueFeatureConstant=function isPaintValueFeatureConstant(name){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.isPaintValueFeatureConstant.call(this,"fill-color")}else{return StyleLayer.prototype.isPaintValueFeatureConstant.call(this,name)}};FillStyleLayer.prototype.isPaintValueZoomConstant=function isPaintValueZoomConstant(name){if(name==="fill-outline-color"&&this.getPaintProperty("fill-outline-color")===undefined){return StyleLayer.prototype.isPaintValueZoomConstant.call(this,"fill-color")}else{return StyleLayer.prototype.isPaintValueZoomConstant.call(this,name)}};FillStyleLayer.prototype.createBucket=function createBucket(options){return new FillBucket(options)};return FillStyleLayer}(StyleLayer);module.exports=FillStyleLayer},{"../../data/bucket/fill_bucket":87,"../style_layer":148}],152:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var LineBucket=require("../../data/bucket/line_bucket");var util=require("../../util/util");var LineStyleLayer=function(StyleLayer){function LineStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)LineStyleLayer.__proto__=StyleLayer;LineStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);LineStyleLayer.prototype.constructor=LineStyleLayer;LineStyleLayer.prototype.getPaintValue=function getPaintValue(name,globalProperties,featureProperties){var value=StyleLayer.prototype.getPaintValue.call(this,name,globalProperties,featureProperties);if(value&&name==="line-dasharray"){var width=this.getPaintValue("line-width",util.extend({},globalProperties,{zoom:Math.floor(globalProperties.zoom)}),featureProperties);value.fromScale*=width;value.toScale*=width}return value};LineStyleLayer.prototype.createBucket=function createBucket(options){return new LineBucket(options)};return LineStyleLayer}(StyleLayer);module.exports=LineStyleLayer},{"../../data/bucket/line_bucket":89,"../../util/util":212,"../style_layer":148}],153:[function(require,module,exports){"use strict";var StyleLayer=require("../style_layer");var SymbolBucket=require("../../data/bucket/symbol_bucket");var SymbolStyleLayer=function(StyleLayer){function SymbolStyleLayer(){StyleLayer.apply(this,arguments)}if(StyleLayer)SymbolStyleLayer.__proto__=StyleLayer;SymbolStyleLayer.prototype=Object.create(StyleLayer&&StyleLayer.prototype);SymbolStyleLayer.prototype.constructor=SymbolStyleLayer;SymbolStyleLayer.prototype.getLayoutValue=function getLayoutValue(name,globalProperties,featureProperties){var value=StyleLayer.prototype.getLayoutValue.call(this,name,globalProperties,featureProperties);if(value!=="auto"){return value}switch(name){case"text-rotation-alignment":case"icon-rotation-alignment":return this.getLayoutValue("symbol-placement",globalProperties,featureProperties)==="line"?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",globalProperties,featureProperties);default:return value}};SymbolStyleLayer.prototype.createBucket=function createBucket(options){return new SymbolBucket(options)};return SymbolStyleLayer}(StyleLayer);module.exports=SymbolStyleLayer},{"../../data/bucket/symbol_bucket":90,"../style_layer":148}],154:[function(require,module,exports){"use strict";var StyleLayer=require("./style_layer");var util=require("../util/util");var featureFilter=require("feature-filter");var groupByLayout=require("mapbox-gl-style-spec/lib/group_by_layout");var StyleLayerIndex=function StyleLayerIndex(layerConfigs){if(layerConfigs){this.replace(layerConfigs)}};StyleLayerIndex.prototype.replace=function replace(layerConfigs){var this$1=this;this.symbolOrder=[];for(var i=0,list=layerConfigs;i<list.length;i+=1){var layerConfig=list[i];if(layerConfig.type==="symbol"){this$1.symbolOrder.push(layerConfig.id)}}this._layerConfigs={};this._layers={};this.update(layerConfigs,[])};StyleLayerIndex.prototype.update=function update(layerConfigs,removedIds,symbolOrder){var this$1=this;for(var i=0,list=layerConfigs;i<list.length;i+=1){var layerConfig=list[i];this$1._layerConfigs[layerConfig.id]=layerConfig;var layer=this$1._layers[layerConfig.id]=StyleLayer.create(layerConfig);layer.updatePaintTransitions({},{transition:false});layer.filter=featureFilter(layer.filter)}for(var i$1=0,list$1=removedIds;i$1<list$1.length;i$1+=1){var id=list$1[i$1];delete this$1._layerConfigs[id];delete this$1._layers[id]}if(symbolOrder){this.symbolOrder=symbolOrder}this.familiesBySource={};var groups=groupByLayout(util.values(this._layerConfigs));for(var i$2=0,list$2=groups;i$2<list$2.length;i$2+=1){var layerConfigs$1=list$2[i$2];var layers=layerConfigs$1.map(function(layerConfig){return this$1._layers[layerConfig.id]});var layer$1=layers[0];if(layer$1.layout&&layer$1.layout.visibility==="none"){continue}var sourceId=layer$1.source||"";var sourceGroup=this$1.familiesBySource[sourceId];if(!sourceGroup){sourceGroup=this$1.familiesBySource[sourceId]={}}var sourceLayerId=layer$1.sourceLayer||"_geojsonTileLayer";var sourceLayerFamilies=sourceGroup[sourceLayerId];if(!sourceLayerFamilies){sourceLayerFamilies=sourceGroup[sourceLayerId]=[]}sourceLayerFamilies.push(layers)}};module.exports=StyleLayerIndex},{"../util/util":212,"./style_layer":148,"feature-filter":22,"mapbox-gl-style-spec/lib/group_by_layout":58}],155:[function(require,module,exports){"use strict";module.exports=require("mapbox-gl-style-spec/reference/latest.min")},{"mapbox-gl-style-spec/reference/latest.min":81}],156:[function(require,module,exports){"use strict";var util=require("../util/util");var interpolate=require("../util/interpolate");var fakeZoomHistory={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0};var StyleTransition=function StyleTransition(reference,declaration,oldTransition,options,zoomHistory){this.declaration=declaration;this.startTime=this.endTime=(new Date).getTime();this.oldTransition=oldTransition;this.duration=options.duration||0;this.delay=options.delay||0;this.zoomTransitioned=reference.function==="piecewise-constant"&&reference.transition;this.interp=this.zoomTransitioned?interpZoomTransitioned:interpolate[reference.type];this.zoomHistory=zoomHistory||fakeZoomHistory;if(!this.instant()){this.endTime=this.startTime+this.duration+this.delay}if(oldTransition&&oldTransition.endTime<=this.startTime){delete oldTransition.oldTransition}};StyleTransition.prototype.instant=function instant(){return!this.oldTransition||!this.interp||this.duration===0&&this.delay===0};StyleTransition.prototype.calculate=function calculate(globalProperties,featureProperties,time){var value=this._calculateTargetValue(globalProperties,featureProperties);if(this.instant())return value;time=time||Date.now();if(time>=this.endTime)return value;var oldValue=this.oldTransition.calculate(globalProperties,featureProperties,this.startTime);var t=util.easeCubicInOut((time-this.startTime-this.delay)/this.duration);return this.interp(oldValue,value,t)};StyleTransition.prototype._calculateTargetValue=function _calculateTargetValue(globalProperties,featureProperties){if(!this.zoomTransitioned)return this.declaration.calculate(globalProperties,featureProperties);var z=globalProperties.zoom;var lastIntegerZoom=this.zoomHistory.lastIntegerZoom;var fromScale=z>lastIntegerZoom?2:.5;var from=this.declaration.calculate({zoom:z>lastIntegerZoom?z-1:z+1},featureProperties);var to=this.declaration.calculate({zoom:z},featureProperties);var timeFraction=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1);var zoomFraction=Math.abs(z-lastIntegerZoom);var t=interpolate(timeFraction,1,zoomFraction);if(from===undefined||to===undefined)return undefined;return{from:from,fromScale:fromScale,to:to,toScale:1,t:t}};module.exports=StyleTransition;function interpZoomTransitioned(from,to,t){if(from===undefined||to===undefined)return undefined;return{from:from.to,fromScale:from.toScale,to:to.to,toScale:to.toScale,t:t}}},{"../util/interpolate":204,"../util/util":212}],157:[function(require,module,exports){"use strict";module.exports=require("mapbox-gl-style-spec/lib/validate_style.min");module.exports.emitErrors=function(emitter,errors){if(errors&&errors.length){for(var i=0;i<errors.length;i++){emitter.fire("error",{error:new Error(errors[i].message)})}return true}else{return false}}},{"mapbox-gl-style-spec/lib/validate_style.min":80}],158:[function(require,module,exports){"use strict";var Point=require("point-geometry");var Anchor=function(Point){function Anchor(x,y,angle,segment){Point.call(this,x,y);this.angle=angle;if(segment!==undefined){this.segment=segment}}if(Point)Anchor.__proto__=Point;Anchor.prototype=Object.create(Point&&Point.prototype);Anchor.prototype.constructor=Anchor;Anchor.prototype.clone=function clone(){return new Anchor(this.x,this.y,this.angle,this.segment)};return Anchor}(Point);module.exports=Anchor},{"point-geometry":223}],159:[function(require,module,exports){"use strict";module.exports=checkMaxAngle;function checkMaxAngle(line,anchor,labelLength,windowSize,maxAngle){if(anchor.segment===undefined)return true;var p=anchor;var index=anchor.segment+1;var anchorDistance=0;while(anchorDistance>-labelLength/2){index--;if(index<0)return false;anchorDistance-=line[index].dist(p);p=line[index]}anchorDistance+=line[index].dist(line[index+1]);index++;var recentCorners=[];var recentAngleDelta=0;while(anchorDistance<labelLength/2){var prev=line[index-1];var current=line[index];var next=line[index+1];if(!next)return false;var angleDelta=prev.angleTo(current)-current.angleTo(next);angleDelta=Math.abs((angleDelta+3*Math.PI)%(Math.PI*2)-Math.PI);recentCorners.push({distance:anchorDistance,angleDelta:angleDelta});recentAngleDelta+=angleDelta;while(anchorDistance-recentCorners[0].distance>windowSize){recentAngleDelta-=recentCorners.shift().angleDelta}if(recentAngleDelta>maxAngle)return false;index++;anchorDistance+=current.dist(next)}return true}},{}],160:[function(require,module,exports){"use strict";var Point=require("point-geometry");module.exports=clipLine;function clipLine(lines,x1,y1,x2,y2){var clippedLines=[];for(var l=0;l<lines.length;l++){var line=lines[l];var clippedLine;for(var i=0;i<line.length-1;i++){var p0=line[i];var p1=line[i+1];if(p0.x<x1&&p1.x<x1){continue}else if(p0.x<x1){p0=new Point(x1,p0.y+(p1.y-p0.y)*((x1-p0.x)/(p1.x-p0.x)))._round()}else if(p1.x<x1){p1=new Point(x1,p0.y+(p1.y-p0.y)*((x1-p0.x)/(p1.x-p0.x)))._round()}if(p0.y<y1&&p1.y<y1){continue}else if(p0.y<y1){p0=new Point(p0.x+(p1.x-p0.x)*((y1-p0.y)/(p1.y-p0.y)),y1)._round()}else if(p1.y<y1){p1=new Point(p0.x+(p1.x-p0.x)*((y1-p0.y)/(p1.y-p0.y)),y1)._round()}if(p0.x>=x2&&p1.x>=x2){continue}else if(p0.x>=x2){p0=new Point(x2,p0.y+(p1.y-p0.y)*((x2-p0.x)/(p1.x-p0.x)))._round()}else if(p1.x>=x2){p1=new Point(x2,p0.y+(p1.y-p0.y)*((x2-p0.x)/(p1.x-p0.x)))._round()}if(p0.y>=y2&&p1.y>=y2){continue}else if(p0.y>=y2){p0=new Point(p0.x+(p1.x-p0.x)*((y2-p0.y)/(p1.y-p0.y)),y2)._round()}else if(p1.y>=y2){p1=new Point(p0.x+(p1.x-p0.x)*((y2-p0.y)/(p1.y-p0.y)),y2)._round()}if(!clippedLine||!p0.equals(clippedLine[clippedLine.length-1])){clippedLine=[p0];clippedLines.push(clippedLine)}clippedLine.push(p1)}}return clippedLines}},{"point-geometry":223}],161:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var Point=require("point-geometry");var CollisionBoxArray=createStructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(CollisionBoxArray.prototype.StructType.prototype,"anchorPoint",{get:function get(){return new Point(this.anchorPointX,this.anchorPointY)}});module.exports=CollisionBoxArray},{"../util/struct_array":210,"point-geometry":223}],162:[function(require,module,exports){"use strict";var CollisionFeature=function CollisionFeature(collisionBoxArray,line,anchor,featureIndex,sourceLayerIndex,bucketIndex,shaped,boxScale,padding,alignLine,straight){var y1=shaped.top*boxScale-padding;var y2=shaped.bottom*boxScale+padding;var x1=shaped.left*boxScale-padding;var x2=shaped.right*boxScale+padding;this.boxStartIndex=collisionBoxArray.length;if(alignLine){var height=y2-y1;var length=x2-x1;if(height>0){height=Math.max(10*boxScale,height);if(straight){var vector=line[anchor.segment+1].sub(line[anchor.segment])._unit()._mult(length);var straightLine=[anchor.sub(vector),anchor.add(vector)];this._addLineCollisionBoxes(collisionBoxArray,straightLine,anchor,0,length,height,featureIndex,sourceLayerIndex,bucketIndex)}else{this._addLineCollisionBoxes(collisionBoxArray,line,anchor,anchor.segment,length,height,featureIndex,sourceLayerIndex,bucketIndex)}}}else{collisionBoxArray.emplaceBack(anchor.x,anchor.y,x1,y1,x2,y2,Infinity,featureIndex,sourceLayerIndex,bucketIndex,0,0,0,0,0)}this.boxEndIndex=collisionBoxArray.length};CollisionFeature.prototype._addLineCollisionBoxes=function _addLineCollisionBoxes(collisionBoxArray,line,anchor,segment,labelLength,boxSize,featureIndex,sourceLayerIndex,bucketIndex){var step=boxSize/2;var nBoxes=Math.floor(labelLength/step);var firstBoxOffset=-boxSize/2;var bboxes=this.boxes;var p=anchor;var index=segment+1;var anchorDistance=firstBoxOffset;do{index--;if(index<0)return bboxes;anchorDistance-=line[index].dist(p);p=line[index]}while(anchorDistance>-labelLength/2);var segmentLength=line[index].dist(line[index+1]);for(var i=0;i<nBoxes;i++){var boxDistanceToAnchor=-labelLength/2+i*step;while(anchorDistance+segmentLength<boxDistanceToAnchor){anchorDistance+=segmentLength;index++;if(index+1>=line.length)return bboxes;segmentLength=line[index].dist(line[index+1])}var segmentBoxDistance=boxDistanceToAnchor-anchorDistance;var p0=line[index];var p1=line[index+1];var boxAnchorPoint=p1.sub(p0)._unit()._mult(segmentBoxDistance)._add(p0)._round();var distanceToInnerEdge=Math.max(Math.abs(boxDistanceToAnchor-firstBoxOffset)-step/2,0);var maxScale=labelLength/2/distanceToInnerEdge;collisionBoxArray.emplaceBack(boxAnchorPoint.x,boxAnchorPoint.y,-boxSize/2,-boxSize/2,boxSize/2,boxSize/2,maxScale,featureIndex,sourceLayerIndex,bucketIndex,0,0,0,0,0)}return bboxes};module.exports=CollisionFeature},{}],163:[function(require,module,exports){"use strict";var Point=require("point-geometry");var EXTENT=require("../data/extent");var Grid=require("grid-index");var intersectionTests=require("../util/intersection_tests");var CollisionTile=function CollisionTile(angle,pitch,collisionBoxArray){if(typeof angle==="object"){var serialized=angle;collisionBoxArray=pitch;angle=serialized.angle;pitch=serialized.pitch;this.grid=new Grid(serialized.grid);this.ignoredGrid=new Grid(serialized.ignoredGrid)}else{this.grid=new Grid(EXTENT,12,6);this.ignoredGrid=new Grid(EXTENT,12,0)}this.minScale=.5;this.maxScale=2;this.angle=angle;this.pitch=pitch;var sin=Math.sin(angle),cos=Math.cos(angle);this.rotationMatrix=[cos,-sin,sin,cos];this.reverseRotationMatrix=[cos,sin,-sin,cos];this.yStretch=1/Math.cos(pitch/180*Math.PI);this.yStretch=Math.pow(this.yStretch,1.3);this.collisionBoxArray=collisionBoxArray;if(collisionBoxArray.length===0){collisionBoxArray.emplaceBack();var maxInt16=32767;collisionBoxArray.emplaceBack(0,0,0,-maxInt16,0,maxInt16,maxInt16,0,0,0,0,0,0,0,0,0);collisionBoxArray.emplaceBack(EXTENT,0,0,-maxInt16,0,maxInt16,maxInt16,0,0,0,0,0,0,0,0,0);collisionBoxArray.emplaceBack(0,0,-maxInt16,0,maxInt16,0,maxInt16,0,0,0,0,0,0,0,0,0);collisionBoxArray.emplaceBack(0,EXTENT,-maxInt16,0,maxInt16,0,maxInt16,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=collisionBoxArray.get(0);this.edges=[collisionBoxArray.get(1),collisionBoxArray.get(2),collisionBoxArray.get(3),collisionBoxArray.get(4)]};CollisionTile.prototype.serialize=function serialize(transferables){var grid=this.grid.toArrayBuffer();var ignoredGrid=this.ignoredGrid.toArrayBuffer();if(transferables){transferables.push(grid);transferables.push(ignoredGrid)}return{angle:this.angle,pitch:this.pitch,grid:grid,ignoredGrid:ignoredGrid}};CollisionTile.prototype.placeCollisionFeature=function placeCollisionFeature(collisionFeature,allowOverlap,avoidEdges){var this$1=this;var collisionBoxArray=this.collisionBoxArray;var minPlacementScale=this.minScale;var rotationMatrix=this.rotationMatrix;var yStretch=this.yStretch;for(var b=collisionFeature.boxStartIndex;b<collisionFeature.boxEndIndex;b++){var box=collisionBoxArray.get(b);var anchorPoint=box.anchorPoint._matMult(rotationMatrix);var x=anchorPoint.x;var y=anchorPoint.y;var x1=x+box.x1;var y1=y+box.y1*yStretch;var x2=x+box.x2;var y2=y+box.y2*yStretch;box.bbox0=x1;box.bbox1=y1;box.bbox2=x2;box.bbox3=y2;if(!allowOverlap){var blockingBoxes=this$1.grid.query(x1,y1,x2,y2);for(var i=0;i<blockingBoxes.length;i++){var blocking=collisionBoxArray.get(blockingBoxes[i]);var blockingAnchorPoint=blocking.anchorPoint._matMult(rotationMatrix);minPlacementScale=this$1.getPlacementScale(minPlacementScale,anchorPoint,box,blockingAnchorPoint,blocking);if(minPlacementScale>=this$1.maxScale){return minPlacementScale}}}if(avoidEdges){var rotatedCollisionBox;if(this$1.angle){var reverseRotationMatrix=this$1.reverseRotationMatrix;var tl=new Point(box.x1,box.y1).matMult(reverseRotationMatrix);var tr=new Point(box.x2,box.y1).matMult(reverseRotationMatrix);var bl=new Point(box.x1,box.y2).matMult(reverseRotationMatrix);var br=new Point(box.x2,box.y2).matMult(reverseRotationMatrix);rotatedCollisionBox=this$1.tempCollisionBox;rotatedCollisionBox.anchorPointX=box.anchorPoint.x;rotatedCollisionBox.anchorPointY=box.anchorPoint.y;rotatedCollisionBox.x1=Math.min(tl.x,tr.x,bl.x,br.x);rotatedCollisionBox.y1=Math.min(tl.y,tr.x,bl.x,br.x);rotatedCollisionBox.x2=Math.max(tl.x,tr.x,bl.x,br.x);rotatedCollisionBox.y2=Math.max(tl.y,tr.x,bl.x,br.x);rotatedCollisionBox.maxScale=box.maxScale}else{rotatedCollisionBox=box}for(var k=0;k<this.edges.length;k++){var edgeBox=this$1.edges[k];minPlacementScale=this$1.getPlacementScale(minPlacementScale,box.anchorPoint,rotatedCollisionBox,edgeBox.anchorPoint,edgeBox);if(minPlacementScale>=this$1.maxScale){return minPlacementScale}}}}return minPlacementScale};CollisionTile.prototype.queryRenderedSymbols=function queryRenderedSymbols(queryGeometry,scale){var sourceLayerFeatures={};var result=[];if(queryGeometry.length===0||this.grid.length===0&&this.ignoredGrid.length===0){return result}var collisionBoxArray=this.collisionBoxArray;var rotationMatrix=this.rotationMatrix;var yStretch=this.yStretch;var rotatedQuery=[];var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;for(var i=0;i<queryGeometry.length;i++){var ring=queryGeometry[i];for(var k=0;k<ring.length;k++){var p=ring[k].matMult(rotationMatrix);minX=Math.min(minX,p.x);minY=Math.min(minY,p.y);maxX=Math.max(maxX,p.x);maxY=Math.max(maxY,p.y);rotatedQuery.push(p)}}var features=this.grid.query(minX,minY,maxX,maxY);var ignoredFeatures=this.ignoredGrid.query(minX,minY,maxX,maxY);for(var i$1=0;i$1<ignoredFeatures.length;i$1++){features.push(ignoredFeatures[i$1])}var roundedScale=Math.pow(2,Math.ceil(Math.log(scale)/Math.LN2*10)/10);for(var i$2=0;i$2<features.length;i$2++){var blocking=collisionBoxArray.get(features[i$2]);var sourceLayer=blocking.sourceLayerIndex;var featureIndex=blocking.featureIndex;if(sourceLayerFeatures[sourceLayer]===undefined){sourceLayerFeatures[sourceLayer]={}}if(sourceLayerFeatures[sourceLayer][featureIndex])continue;if(roundedScale<blocking.placementScale||roundedScale>blocking.maxScale)continue;var anchor=blocking.anchorPoint.matMult(rotationMatrix);var x1=anchor.x+blocking.x1/scale;var y1=anchor.y+blocking.y1/scale*yStretch;var x2=anchor.x+blocking.x2/scale;var y2=anchor.y+blocking.y2/scale*yStretch;var bbox=[new Point(x1,y1),new Point(x2,y1),new Point(x2,y2),new Point(x1,y2)];if(!intersectionTests.polygonIntersectsPolygon(rotatedQuery,bbox))continue;sourceLayerFeatures[sourceLayer][featureIndex]=true;result.push(features[i$2])}return result};CollisionTile.prototype.getPlacementScale=function getPlacementScale(minPlacementScale,anchorPoint,box,blockingAnchorPoint,blocking){var anchorDiffX=anchorPoint.x-blockingAnchorPoint.x;var anchorDiffY=anchorPoint.y-blockingAnchorPoint.y;var s1=(blocking.x1-box.x2)/anchorDiffX;var s2=(blocking.x2-box.x1)/anchorDiffX;var s3=(blocking.y1-box.y2)*this.yStretch/anchorDiffY;var s4=(blocking.y2-box.y1)*this.yStretch/anchorDiffY;if(isNaN(s1)||isNaN(s2))s1=s2=1;if(isNaN(s3)||isNaN(s4))s3=s4=1;var collisionFreeScale=Math.min(Math.max(s1,s2),Math.max(s3,s4));var blockingMaxScale=blocking.maxScale;var boxMaxScale=box.maxScale;if(collisionFreeScale>blockingMaxScale){collisionFreeScale=blockingMaxScale}if(collisionFreeScale>boxMaxScale){collisionFreeScale=boxMaxScale}if(collisionFreeScale>minPlacementScale&&collisionFreeScale>=blocking.placementScale){minPlacementScale=collisionFreeScale}return minPlacementScale};CollisionTile.prototype.insertCollisionFeature=function insertCollisionFeature(collisionFeature,minPlacementScale,ignorePlacement){var this$1=this;var grid=ignorePlacement?this.ignoredGrid:this.grid;var collisionBoxArray=this.collisionBoxArray;for(var k=collisionFeature.boxStartIndex;k<collisionFeature.boxEndIndex;k++){var box=collisionBoxArray.get(k);box.placementScale=minPlacementScale;if(minPlacementScale<this$1.maxScale){grid.insert(k,box.bbox0,box.bbox1,box.bbox2,box.bbox3)}}};module.exports=CollisionTile},{"../data/extent":94,"../util/intersection_tests":205,"grid-index":35,"point-geometry":223}],164:[function(require,module,exports){"use strict";var interpolate=require("../util/interpolate");var Anchor=require("../symbol/anchor");var checkMaxAngle=require("./check_max_angle");module.exports=getAnchors;function getAnchors(line,spacing,maxAngle,shapedText,shapedIcon,glyphSize,boxScale,overscaling,tileExtent){var angleWindowSize=shapedText?3/5*glyphSize*boxScale:0;var labelLength=Math.max(shapedText?shapedText.right-shapedText.left:0,shapedIcon?shapedIcon.right-shapedIcon.left:0);var isLineContinued=line[0].x===0||line[0].x===tileExtent||line[0].y===0||line[0].y===tileExtent;if(spacing-labelLength*boxScale<spacing/4){spacing=labelLength*boxScale+spacing/4}var fixedExtraOffset=glyphSize*2;var offset=!isLineContinued?(labelLength/2+fixedExtraOffset)*boxScale*overscaling%spacing:spacing/2*overscaling%spacing;return resample(line,offset,spacing,angleWindowSize,maxAngle,labelLength*boxScale,isLineContinued,false,tileExtent)}function resample(line,offset,spacing,angleWindowSize,maxAngle,labelLength,isLineContinued,placeAtMiddle,tileExtent){var halfLabelLength=labelLength/2;var lineLength=0;for(var k=0;k<line.length-1;k++){lineLength+=line[k].dist(line[k+1])}var distance=0,markedDistance=offset-spacing;var anchors=[];for(var i=0;i<line.length-1;i++){var a=line[i],b=line[i+1];var segmentDist=a.dist(b),angle=b.angleTo(a);while(markedDistance+spacing<distance+segmentDist){markedDistance+=spacing;var t=(markedDistance-distance)/segmentDist,x=interpolate(a.x,b.x,t),y=interpolate(a.y,b.y,t);if(x>=0&&x<tileExtent&&y>=0&&y<tileExtent&&markedDistance-halfLabelLength>=0&&markedDistance+halfLabelLength<=lineLength){var anchor=new Anchor(x,y,angle,i)._round();if(!angleWindowSize||checkMaxAngle(line,anchor,labelLength,angleWindowSize,maxAngle)){anchors.push(anchor)}}}distance+=segmentDist}if(!placeAtMiddle&&!anchors.length&&!isLineContinued){anchors=resample(line,distance/2,spacing,angleWindowSize,maxAngle,labelLength,isLineContinued,true,tileExtent)}return anchors}},{"../symbol/anchor":158,"../util/interpolate":204,"./check_max_angle":159}],165:[function(require,module,exports){"use strict";var ShelfPack=require("shelf-pack");var util=require("../util/util");var SIZE_GROWTH_RATE=4;var DEFAULT_SIZE=128;var MAX_SIZE=2048;var GlyphAtlas=function GlyphAtlas(){this.width=DEFAULT_SIZE;this.height=DEFAULT_SIZE;this.bin=new ShelfPack(this.width,this.height);this.index={};this.ids={};this.data=new Uint8Array(this.width*this.height)};GlyphAtlas.prototype.getGlyphs=function getGlyphs(){var glyphs={};var split,name,id;for(var key in this.ids){split=key.split("#");name=split[0];id=split[1];if(!glyphs[name])glyphs[name]=[];glyphs[name].push(id)}return glyphs};GlyphAtlas.prototype.getRects=function getRects(){var this$1=this;var rects={};var split,name,id;for(var key in this.ids){split=key.split("#");name=split[0];id=split[1];if(!rects[name])rects[name]={};rects[name][id]=this$1.index[key]}return rects};GlyphAtlas.prototype.addGlyph=function addGlyph(id,name,glyph,buffer){var this$1=this;if(!glyph)return null;var key=name+"#"+glyph.id;if(this.index[key]){if(this.ids[key].indexOf(id)<0){this.ids[key].push(id)}return this.index[key]}if(!glyph.bitmap){return null}var bufferedWidth=glyph.width+buffer*2;var bufferedHeight=glyph.height+buffer*2;var padding=1;var packWidth=bufferedWidth+2*padding;var packHeight=bufferedHeight+2*padding;packWidth+=4-packWidth%4;packHeight+=4-packHeight%4;var rect=this.bin.packOne(packWidth,packHeight);if(!rect){this.resize();rect=this.bin.packOne(packWidth,packHeight)}if(!rect){util.warnOnce("glyph bitmap overflow");return null}this.index[key]=rect;this.ids[key]=[id];var target=this.data;var source=glyph.bitmap;for(var y=0;y<bufferedHeight;y++){var y1=this$1.width*(rect.y+y+padding)+rect.x+padding;var y2=bufferedWidth*y;for(var x=0;x<bufferedWidth;x++){target[y1+x]=source[y2+x]}}this.dirty=true;return rect};GlyphAtlas.prototype.resize=function resize(){var this$1=this;var prevWidth=this.width;var prevHeight=this.height;if(prevWidth>=MAX_SIZE||prevHeight>=MAX_SIZE)return;if(this.texture){if(this.gl){this.gl.deleteTexture(this.texture)}this.texture=null}this.width*=SIZE_GROWTH_RATE;this.height*=SIZE_GROWTH_RATE;this.bin.resize(this.width,this.height);var buf=new ArrayBuffer(this.width*this.height);for(var i=0;i<prevHeight;i++){var src=new Uint8Array(this$1.data.buffer,prevHeight*i,prevWidth);var dst=new Uint8Array(buf,prevHeight*i*SIZE_GROWTH_RATE,prevWidth);dst.set(src)}this.data=new Uint8Array(buf)};GlyphAtlas.prototype.bind=function bind(gl){this.gl=gl;if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texImage2D(gl.TEXTURE_2D,0,gl.ALPHA,this.width,this.height,0,gl.ALPHA,gl.UNSIGNED_BYTE,null)}else{gl.bindTexture(gl.TEXTURE_2D,this.texture)}};GlyphAtlas.prototype.updateTexture=function updateTexture(gl){this.bind(gl);if(this.dirty){gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.width,this.height,gl.ALPHA,gl.UNSIGNED_BYTE,this.data);this.dirty=false}};module.exports=GlyphAtlas},{"../util/util":212,"shelf-pack":549}],166:[function(require,module,exports){"use strict";var normalizeURL=require("../util/mapbox").normalizeGlyphsURL;var ajax=require("../util/ajax");var verticalizePunctuation=require("../util/verticalize_punctuation");var Glyphs=require("../util/glyphs");var GlyphAtlas=require("../symbol/glyph_atlas");var Protobuf=require("pbf");var SimpleGlyph=function SimpleGlyph(glyph,rect,buffer){var padding=1;this.advance=glyph.advance;this.left=glyph.left-buffer-padding;this.top=glyph.top+buffer+padding;this.rect=rect};var GlyphSource=function GlyphSource(url){this.url=url&&normalizeURL(url);this.atlases={};this.stacks={};this.loading={}};GlyphSource.prototype.getSimpleGlyphs=function getSimpleGlyphs(fontstack,glyphIDs,uid,callback){var this$1=this;if(this.stacks[fontstack]===undefined){this.stacks[fontstack]={}}if(this.atlases[fontstack]===undefined){this.atlases[fontstack]=new GlyphAtlas}var glyphs={};var stack=this.stacks[fontstack];var atlas=this.atlases[fontstack];var buffer=3;var missing={};var remaining=0;var getGlyph=function(glyphID){var range=Math.floor(glyphID/256);if(stack[range]){var glyph=stack[range].glyphs[glyphID];var rect=atlas.addGlyph(uid,fontstack,glyph,buffer);if(glyph)glyphs[glyphID]=new SimpleGlyph(glyph,rect,buffer)}else{if(missing[range]===undefined){missing[range]=[];remaining++}missing[range].push(glyphID)}};for(var i=0;i<glyphIDs.length;i++){var glyphID=glyphIDs[i];var string=String.fromCharCode(glyphID);getGlyph(glyphID);if(verticalizePunctuation.lookup[string]){getGlyph(verticalizePunctuation.lookup[string].charCodeAt(0))}}if(!remaining)callback(undefined,glyphs,fontstack);var onRangeLoaded=function(err,range,data){if(!err){var stack=this$1.stacks[fontstack][range]=data.stacks[0];for(var i=0;i<missing[range].length;i++){var glyphID=missing[range][i];var glyph=stack.glyphs[glyphID];var rect=atlas.addGlyph(uid,fontstack,glyph,buffer);if(glyph)glyphs[glyphID]=new SimpleGlyph(glyph,rect,buffer)}}remaining--;if(!remaining)callback(undefined,glyphs,fontstack)};for(var r in missing){this$1.loadRange(fontstack,r,onRangeLoaded)}};GlyphSource.prototype.loadRange=function loadRange(fontstack,range,callback){if(range*256>65535)return callback("glyphs > 65535 not supported");if(this.loading[fontstack]===undefined){this.loading[fontstack]={}}var loading=this.loading[fontstack];if(loading[range]){loading[range].push(callback)}else{loading[range]=[callback];var rangeName=range*256+"-"+(range*256+255);var url=glyphUrl(fontstack,rangeName,this.url);ajax.getArrayBuffer(url,function(err,response){var glyphs=!err&&new Glyphs(new Protobuf(response.data));for(var i=0;i<loading[range].length;i++){loading[range][i](err,range,glyphs)}delete loading[range]})}};GlyphSource.prototype.getGlyphAtlas=function getGlyphAtlas(fontstack){return this.atlases[fontstack]};function glyphUrl(fontstack,range,url,subdomains){subdomains=subdomains||"abc";return url.replace("{s}",subdomains[fontstack.length%subdomains.length]).replace("{fontstack}",fontstack).replace("{range}",range)}module.exports=GlyphSource},{"../symbol/glyph_atlas":165,"../util/ajax":192,"../util/glyphs":203,"../util/mapbox":208,"../util/verticalize_punctuation":214,pbf:222}],167:[function(require,module,exports){"use strict";module.exports=function(features){var leftIndex={};var rightIndex={};var mergedFeatures=[];var mergedIndex=0;function add(k){mergedFeatures.push(features[k]);mergedIndex++}function mergeFromRight(leftKey,rightKey,geom){var i=rightIndex[leftKey];delete rightIndex[leftKey];rightIndex[rightKey]=i;mergedFeatures[i].geometry[0].pop();mergedFeatures[i].geometry[0]=mergedFeatures[i].geometry[0].concat(geom[0]);return i}function mergeFromLeft(leftKey,rightKey,geom){var i=leftIndex[rightKey];delete leftIndex[rightKey];leftIndex[leftKey]=i;mergedFeatures[i].geometry[0].shift();

mergedFeatures[i].geometry[0]=geom[0].concat(mergedFeatures[i].geometry[0]);return i}function getKey(text,geom,onRight){var point=onRight?geom[0][geom[0].length-1]:geom[0][0];return text+":"+point.x+":"+point.y}for(var k=0;k<features.length;k++){var feature=features[k];var geom=feature.geometry;var text=feature.text;if(!text){add(k);continue}var leftKey=getKey(text,geom),rightKey=getKey(text,geom,true);if(leftKey in rightIndex&&rightKey in leftIndex&&rightIndex[leftKey]!==leftIndex[rightKey]){var j=mergeFromLeft(leftKey,rightKey,geom);var i=mergeFromRight(leftKey,rightKey,mergedFeatures[j].geometry);delete leftIndex[leftKey];delete rightIndex[rightKey];rightIndex[getKey(text,mergedFeatures[i].geometry,true)]=i;mergedFeatures[j].geometry=null}else if(leftKey in rightIndex){mergeFromRight(leftKey,rightKey,geom)}else if(rightKey in leftIndex){mergeFromLeft(leftKey,rightKey,geom)}else{add(k);leftIndex[leftKey]=mergedIndex-1;rightIndex[rightKey]=mergedIndex-1}}return mergedFeatures.filter(function(f){return f.geometry})}},{}],168:[function(require,module,exports){"use strict";var Point=require("point-geometry");module.exports={getIconQuads:getIconQuads,getGlyphQuads:getGlyphQuads,SymbolQuad:SymbolQuad};var minScale=.5;function SymbolQuad(anchorPoint,tl,tr,bl,br,tex,anchorAngle,glyphAngle,minScale,maxScale,writingMode){this.anchorPoint=anchorPoint;this.tl=tl;this.tr=tr;this.bl=bl;this.br=br;this.tex=tex;this.anchorAngle=anchorAngle;this.glyphAngle=glyphAngle;this.minScale=minScale;this.maxScale=maxScale;this.writingMode=writingMode}function getIconQuads(anchor,shapedIcon,boxScale,line,layer,alongLine,shapedText,globalProperties,featureProperties){var rect=shapedIcon.image.rect;var layout=layer.layout;var border=1;var left=shapedIcon.left-border;var right=left+rect.w/shapedIcon.image.pixelRatio;var top=shapedIcon.top-border;var bottom=top+rect.h/shapedIcon.image.pixelRatio;var tl,tr,br,bl;if(layout["icon-text-fit"]!=="none"&&shapedText){var iconWidth=right-left,iconHeight=bottom-top,size=layout["text-size"]/24,textLeft=shapedText.left*size,textRight=shapedText.right*size,textTop=shapedText.top*size,textBottom=shapedText.bottom*size,textWidth=textRight-textLeft,textHeight=textBottom-textTop,padT=layout["icon-text-fit-padding"][0],padR=layout["icon-text-fit-padding"][1],padB=layout["icon-text-fit-padding"][2],padL=layout["icon-text-fit-padding"][3],offsetY=layout["icon-text-fit"]==="width"?(textHeight-iconHeight)*.5:0,offsetX=layout["icon-text-fit"]==="height"?(textWidth-iconWidth)*.5:0,width=layout["icon-text-fit"]==="width"||layout["icon-text-fit"]==="both"?textWidth:iconWidth,height=layout["icon-text-fit"]==="height"||layout["icon-text-fit"]==="both"?textHeight:iconHeight;tl=new Point(textLeft+offsetX-padL,textTop+offsetY-padT);tr=new Point(textLeft+offsetX+padR+width,textTop+offsetY-padT);br=new Point(textLeft+offsetX+padR+width,textTop+offsetY+padB+height);bl=new Point(textLeft+offsetX-padL,textTop+offsetY+padB+height)}else{tl=new Point(left,top);tr=new Point(right,top);br=new Point(right,bottom);bl=new Point(left,bottom)}var angle=layer.getLayoutValue("icon-rotate",globalProperties,featureProperties)*Math.PI/180;if(alongLine){var prev=line[anchor.segment];if(anchor.y===prev.y&&anchor.x===prev.x&&anchor.segment+1<line.length){var next=line[anchor.segment+1];angle+=Math.atan2(anchor.y-next.y,anchor.x-next.x)+Math.PI}else{angle+=Math.atan2(anchor.y-prev.y,anchor.x-prev.x)}}if(angle){var sin=Math.sin(angle),cos=Math.cos(angle),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix);tr=tr.matMult(matrix);bl=bl.matMult(matrix);br=br.matMult(matrix)}return[new SymbolQuad(new Point(anchor.x,anchor.y),tl,tr,bl,br,shapedIcon.image.rect,0,0,minScale,Infinity)]}function getGlyphQuads(anchor,shaping,boxScale,line,layer,alongLine){var textRotate=layer.layout["text-rotate"]*Math.PI/180;var keepUpright=layer.layout["text-keep-upright"];var positionedGlyphs=shaping.positionedGlyphs;var quads=[];for(var k=0;k<positionedGlyphs.length;k++){var positionedGlyph=positionedGlyphs[k];var glyph=positionedGlyph.glyph;if(!glyph)continue;var rect=glyph.rect;if(!rect)continue;var centerX=(positionedGlyph.x+glyph.advance/2)*boxScale;var glyphInstances;var labelMinScale=minScale;if(alongLine){glyphInstances=[];labelMinScale=getSegmentGlyphs(glyphInstances,anchor,centerX,line,anchor.segment,true);if(keepUpright){labelMinScale=Math.min(labelMinScale,getSegmentGlyphs(glyphInstances,anchor,centerX,line,anchor.segment,false))}}else{glyphInstances=[{anchorPoint:new Point(anchor.x,anchor.y),offset:0,angle:0,maxScale:Infinity,minScale:minScale}]}var x1=positionedGlyph.x+glyph.left;var y1=positionedGlyph.y-glyph.top;var x2=x1+rect.w;var y2=y1+rect.h;var center=new Point(positionedGlyph.x,glyph.advance/2);var otl=new Point(x1,y1);var otr=new Point(x2,y1);var obl=new Point(x1,y2);var obr=new Point(x2,y2);if(positionedGlyph.angle!==0){otl._sub(center)._rotate(positionedGlyph.angle)._add(center);otr._sub(center)._rotate(positionedGlyph.angle)._add(center);obl._sub(center)._rotate(positionedGlyph.angle)._add(center);obr._sub(center)._rotate(positionedGlyph.angle)._add(center)}for(var i=0;i<glyphInstances.length;i++){var instance=glyphInstances[i];var tl=otl,tr=otr,bl=obl,br=obr;if(textRotate){var sin=Math.sin(textRotate),cos=Math.cos(textRotate),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix);tr=tr.matMult(matrix);bl=bl.matMult(matrix);br=br.matMult(matrix)}var glyphMinScale=Math.max(instance.minScale,labelMinScale);var anchorAngle=(anchor.angle+instance.offset+2*Math.PI)%(2*Math.PI);var glyphAngle=(instance.angle+instance.offset+2*Math.PI)%(2*Math.PI);quads.push(new SymbolQuad(instance.anchorPoint,tl,tr,bl,br,rect,anchorAngle,glyphAngle,glyphMinScale,instance.maxScale,shaping.writingMode))}}return quads}function getSegmentGlyphs(glyphs,anchor,offset,line,segment,forward){var upsideDown=!forward;if(offset<0)forward=!forward;if(forward)segment++;var newAnchorPoint=new Point(anchor.x,anchor.y);var end=line[segment];var prevScale=Infinity;offset=Math.abs(offset);var placementScale=minScale;while(true){var distance=newAnchorPoint.dist(end);var scale=offset/distance;var angle=Math.atan2(end.y-newAnchorPoint.y,end.x-newAnchorPoint.x);if(!forward)angle+=Math.PI;glyphs.push({anchorPoint:newAnchorPoint,offset:upsideDown?Math.PI:0,minScale:scale,maxScale:prevScale,angle:(angle+2*Math.PI)%(2*Math.PI)});if(scale<=placementScale)break;newAnchorPoint=end;while(newAnchorPoint.equals(end)){segment+=forward?1:-1;end=line[segment];if(!end){return scale}}var unit=end.sub(newAnchorPoint)._unit();newAnchorPoint=newAnchorPoint.sub(unit._mult(distance));prevScale=scale}return placementScale}},{"point-geometry":223}],169:[function(require,module,exports){"use strict";var resolveTokens=require("../util/token");module.exports=function resolveText(feature,layout){var text=resolveTokens(feature.properties,layout["text-field"]);if(!text){return}text=text.toString();var transform=layout["text-transform"];if(transform==="uppercase"){text=text.toLocaleUpperCase()}else if(transform==="lowercase"){text=text.toLocaleLowerCase()}return text}},{"../util/token":211}],170:[function(require,module,exports){"use strict";var scriptDetection=require("../util/script_detection");var verticalizePunctuation=require("../util/verticalize_punctuation");var rtlTextPlugin=require("../source/rtl_text_plugin");var WritingMode={horizontal:1,vertical:2};module.exports={shapeText:shapeText,shapeIcon:shapeIcon,WritingMode:WritingMode};function PositionedGlyph(codePoint,x,y,glyph,angle){this.codePoint=codePoint;this.x=x;this.y=y;this.glyph=glyph||null;this.angle=angle}function Shaping(positionedGlyphs,text,top,bottom,left,right,writingMode){this.positionedGlyphs=positionedGlyphs;this.text=text;this.top=top;this.bottom=bottom;this.left=left;this.right=right;this.writingMode=writingMode}function breakLines(text,lineBreakPoints){var lines=[];var start=0;for(var i=0,list=lineBreakPoints;i<list.length;i+=1){var lineBreak=list[i];lines.push(text.substring(start,lineBreak));start=lineBreak}if(start<text.length){lines.push(text.substring(start,text.length))}return lines}function shapeText(text,glyphs,maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,translate,verticalHeight,writingMode){var logicalInput=text.trim();if(writingMode===WritingMode.vertical)logicalInput=verticalizePunctuation(logicalInput);var positionedGlyphs=[];var shaping=new Shaping(positionedGlyphs,logicalInput,translate[1],translate[1],translate[0],translate[0],writingMode);var lines;if(rtlTextPlugin.processBidirectionalText){lines=rtlTextPlugin.processBidirectionalText(logicalInput,determineLineBreaks(logicalInput,spacing,maxWidth,glyphs))}else{lines=breakLines(logicalInput,determineLineBreaks(logicalInput,spacing,maxWidth,glyphs))}shapeLines(shaping,glyphs,lines,lineHeight,horizontalAlign,verticalAlign,justify,translate,writingMode,spacing,verticalHeight);if(!positionedGlyphs.length)return false;return shaping}var whitespace={9:true,10:true,11:true,12:true,13:true,32:true};var breakable={10:true,32:true,38:true,40:true,41:true,43:true,45:true,47:true,173:true,183:true,8203:true,8208:true,8211:true,8231:true};function determineAverageLineWidth(logicalInput,spacing,maxWidth,glyphs){var totalWidth=0;for(var index in logicalInput){var glyph=glyphs[logicalInput.charCodeAt(index)];if(!glyph)continue;totalWidth+=glyph.advance+spacing}var lineCount=Math.max(1,Math.ceil(totalWidth/maxWidth));return totalWidth/lineCount}function calculateBadness(lineWidth,targetWidth,penalty,isLastBreak){var raggedness=Math.pow(lineWidth-targetWidth,2);if(isLastBreak){if(lineWidth<targetWidth){return raggedness/2}else{return raggedness*2}}return raggedness+Math.abs(penalty)*penalty}function calculatePenalty(codePoint,nextCodePoint){var penalty=0;if(codePoint===10){penalty-=1e4}if(codePoint===40||codePoint===65288){penalty+=50}if(nextCodePoint===41||nextCodePoint===65289){penalty+=50}return penalty}function evaluateBreak(breakIndex,breakX,targetWidth,potentialBreaks,penalty,isLastBreak){var bestPriorBreak=null;var bestBreakBadness=calculateBadness(breakX,targetWidth,penalty,isLastBreak);for(var i=0,list=potentialBreaks;i<list.length;i+=1){var potentialBreak=list[i];var lineWidth=breakX-potentialBreak.x;var breakBadness=calculateBadness(lineWidth,targetWidth,penalty,isLastBreak)+potentialBreak.badness;if(breakBadness<=bestBreakBadness){bestPriorBreak=potentialBreak;bestBreakBadness=breakBadness}}return{index:breakIndex,x:breakX,priorBreak:bestPriorBreak,badness:bestBreakBadness}}function leastBadBreaks(lastLineBreak){if(!lastLineBreak){return[]}return leastBadBreaks(lastLineBreak.priorBreak).concat(lastLineBreak.index)}function determineLineBreaks(logicalInput,spacing,maxWidth,glyphs){if(!maxWidth)return[];if(!logicalInput)return[];var potentialLineBreaks=[];var targetWidth=determineAverageLineWidth(logicalInput,spacing,maxWidth,glyphs);var currentX=0;for(var i=0;i<logicalInput.length;i++){var codePoint=logicalInput.charCodeAt(i);var glyph=glyphs[codePoint];if(glyph&&!whitespace[codePoint])currentX+=glyph.advance+spacing;if(i<logicalInput.length-1&&(breakable[codePoint]||scriptDetection.charAllowsIdeographicBreaking(codePoint))){potentialLineBreaks.push(evaluateBreak(i+1,currentX,targetWidth,potentialLineBreaks,calculatePenalty(codePoint,logicalInput.charCodeAt(i+1)),false))}}return leastBadBreaks(evaluateBreak(logicalInput.length,currentX,targetWidth,potentialLineBreaks,0,true))}function shapeLines(shaping,glyphs,lines,lineHeight,horizontalAlign,verticalAlign,justify,translate,writingMode,spacing,verticalHeight){var yOffset=-17;var x=0;var y=yOffset;var maxLineLength=0;var positionedGlyphs=shaping.positionedGlyphs;for(var i in lines){var line=lines[i].trim();if(!line.length){y+=lineHeight;continue}var lineStartIndex=positionedGlyphs.length;for(var i$1=0;i$1<line.length;i$1++){var codePoint=line.charCodeAt(i$1);var glyph=glyphs[codePoint];if(!glyph)continue;if(!scriptDetection.charHasUprightVerticalOrientation(codePoint)||writingMode===WritingMode.horizontal){positionedGlyphs.push(new PositionedGlyph(codePoint,x,y,glyph,0));x+=glyph.advance+spacing}else{positionedGlyphs.push(new PositionedGlyph(codePoint,x,0,glyph,-Math.PI/2));x+=verticalHeight+spacing}}if(positionedGlyphs.length!==lineStartIndex){var lineLength=x-spacing;maxLineLength=Math.max(lineLength,maxLineLength);justifyLine(positionedGlyphs,glyphs,lineStartIndex,positionedGlyphs.length-1,justify)}x=0;y+=lineHeight}align(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,lines.length,translate);var height=lines.length*lineHeight;shaping.top+=-verticalAlign*height;shaping.bottom=shaping.top+height;shaping.left+=-horizontalAlign*maxLineLength;shaping.right=shaping.left+maxLineLength}function justifyLine(positionedGlyphs,glyphs,start,end,justify){if(!justify)return;var lastAdvance=glyphs[positionedGlyphs[end].codePoint].advance;var lineIndent=(positionedGlyphs[end].x+lastAdvance)*justify;for(var j=start;j<=end;j++){positionedGlyphs[j].x-=lineIndent}}function align(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,lineCount,translate){var shiftX=(justify-horizontalAlign)*maxLineLength+translate[0];var shiftY=(-verticalAlign*lineCount+.5)*lineHeight+translate[1];for(var j=0;j<positionedGlyphs.length;j++){positionedGlyphs[j].x+=shiftX;positionedGlyphs[j].y+=shiftY}}function shapeIcon(image,iconOffset){if(!image||!image.rect)return null;var dx=iconOffset[0];var dy=iconOffset[1];var x1=dx-image.width/2;var x2=x1+image.width;var y1=dy-image.height/2;var y2=y1+image.height;return new PositionedIcon(image,y1,y2,x1,x2)}function PositionedIcon(image,top,bottom,left,right){this.image=image;this.top=top;this.bottom=bottom;this.left=left;this.right=right}},{"../source/rtl_text_plugin":132,"../util/script_detection":209,"../util/verticalize_punctuation":214}],171:[function(require,module,exports){"use strict";var ShelfPack=require("shelf-pack");var browser=require("../util/browser");var util=require("../util/util");var AtlasImage=function AtlasImage(rect,width,height,sdf,pixelRatio){this.rect=rect;this.width=width;this.height=height;this.sdf=sdf;this.pixelRatio=pixelRatio};var SpriteAtlas=function SpriteAtlas(width,height){this.width=width;this.height=height;this.bin=new ShelfPack(width,height);this.images={};this.data=false;this.texture=0;this.filter=0;this.pixelRatio=1;this.dirty=true};SpriteAtlas.prototype.allocateImage=function allocateImage(pixelWidth,pixelHeight){pixelWidth=pixelWidth/this.pixelRatio;pixelHeight=pixelHeight/this.pixelRatio;var padding=2;var packWidth=pixelWidth+padding+(4-(pixelWidth+padding)%4);var packHeight=pixelHeight+padding+(4-(pixelHeight+padding)%4);var rect=this.bin.packOne(packWidth,packHeight);if(!rect){util.warnOnce("SpriteAtlas out of space.");return null}return rect};SpriteAtlas.prototype.getImage=function getImage(name,wrap){if(this.images[name]){return this.images[name]}if(!this.sprite){return null}var pos=this.sprite.getSpritePosition(name);if(!pos.width||!pos.height){return null}var rect=this.allocateImage(pos.width,pos.height);if(!rect){return null}var image=new AtlasImage(rect,pos.width/pos.pixelRatio,pos.height/pos.pixelRatio,pos.sdf,pos.pixelRatio/this.pixelRatio);this.images[name]=image;this.copy(rect,pos,wrap);return image};SpriteAtlas.prototype.getPosition=function getPosition(name,repeating){var image=this.getImage(name,repeating);var rect=image&&image.rect;if(!rect){return null}var width=image.width*image.pixelRatio;var height=image.height*image.pixelRatio;var padding=1;return{size:[image.width,image.height],tl:[(rect.x+padding)/this.width,(rect.y+padding)/this.height],br:[(rect.x+padding+width)/this.width,(rect.y+padding+height)/this.height]}};SpriteAtlas.prototype.allocate=function allocate(){var this$1=this;if(!this.data){var w=Math.floor(this.width*this.pixelRatio);var h=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(w*h);for(var i=0;i<this.data.length;i++){this$1.data[i]=0}}};SpriteAtlas.prototype.copy=function copy(dst,src,wrap){if(!this.sprite.imgData)return;var srcImg=new Uint32Array(this.sprite.imgData.buffer);this.allocate();var dstImg=this.data;var padding=1;copyBitmap(srcImg,this.sprite.width,src.x,src.y,dstImg,this.width*this.pixelRatio,(dst.x+padding)*this.pixelRatio,(dst.y+padding)*this.pixelRatio,src.width,src.height,wrap);this.dirty=true};SpriteAtlas.prototype.setSprite=function setSprite(sprite){if(sprite){this.pixelRatio=browser.devicePixelRatio>1?2:1;if(this.canvas){this.canvas.width=this.width*this.pixelRatio;this.canvas.height=this.height*this.pixelRatio}}this.sprite=sprite};SpriteAtlas.prototype.addIcons=function addIcons(icons,callback){var this$1=this;for(var i=0;i<icons.length;i++){this$1.getImage(icons[i])}callback(null,this.images)};SpriteAtlas.prototype.bind=function bind(gl,linear){var first=false;if(!this.texture){this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);first=true}else{gl.bindTexture(gl.TEXTURE_2D,this.texture)}var filterVal=linear?gl.LINEAR:gl.NEAREST;if(filterVal!==this.filter){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filterVal);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filterVal);this.filter=filterVal}if(this.dirty){this.allocate();if(first){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(this.data.buffer))}else{gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(this.data.buffer))}this.dirty=false}};module.exports=SpriteAtlas;function copyBitmap(src,srcStride,srcX,srcY,dst,dstStride,dstX,dstY,width,height,wrap){var srcI=srcY*srcStride+srcX;var dstI=dstY*dstStride+dstX;var x,y;if(wrap){dstI-=dstStride;for(y=-1;y<=height;y++,srcI=((y+height)%height+srcY)*srcStride+srcX,dstI+=dstStride){for(x=-1;x<=width;x++){dst[dstI+x]=src[srcI+(x+width)%width]}}}else{for(y=0;y<height;y++,srcI+=srcStride,dstI+=dstStride){for(x=0;x<width;x++){dst[dstI+x]=src[srcI+x]}}}}},{"../util/browser":193,"../util/util":212,"shelf-pack":549}],172:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var Point=require("point-geometry");var SymbolInstancesArray=createStructArrayType({members:[{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"glyphQuadStartIndex"},{type:"Uint16",name:"glyphQuadEndIndex"},{type:"Uint16",name:"iconQuadStartIndex"},{type:"Uint16",name:"iconQuadEndIndex"},{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int8",name:"index"},{type:"Uint8",name:"writingModes"}]});Object.defineProperty(SymbolInstancesArray.prototype.StructType.prototype,"anchorPoint",{get:function get(){return new Point(this.anchorPointX,this.anchorPointY)}});module.exports=SymbolInstancesArray},{"../util/struct_array":210,"point-geometry":223}],173:[function(require,module,exports){"use strict";var createStructArrayType=require("../util/struct_array");var Point=require("point-geometry");var SymbolQuad=require("./quads").SymbolQuad;var SymbolQuadsArray=createStructArrayType({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"tlX"},{type:"Float32",name:"tlY"},{type:"Float32",name:"trX"},{type:"Float32",name:"trY"},{type:"Float32",name:"blX"},{type:"Float32",name:"blY"},{type:"Float32",name:"brX"},{type:"Float32",name:"brY"},{type:"Int16",name:"texH"},{type:"Int16",name:"texW"},{type:"Int16",name:"texX"},{type:"Int16",name:"texY"},{type:"Float32",name:"anchorAngle"},{type:"Float32",name:"glyphAngle"},{type:"Float32",name:"maxScale"},{type:"Float32",name:"minScale"},{type:"Uint8",name:"writingMode"}]});Object.defineProperty(SymbolQuadsArray.prototype.StructType.prototype,"anchorPoint",{get:function get(){return new Point(this.anchorPointX,this.anchorPointY)}});Object.defineProperty(SymbolQuadsArray.prototype.StructType.prototype,"SymbolQuad",{get:function get$1(){return new SymbolQuad(this.anchorPoint,new Point(this.tlX,this.tlY),new Point(this.trX,this.trY),new Point(this.blX,this.blY),new Point(this.brX,this.brY),{x:this.texX,y:this.texY,h:this.texH,w:this.texW,height:this.texH,width:this.texW},this.anchorAngle,this.glyphAngle,this.minScale,this.maxScale,this.writingMode)}});module.exports=SymbolQuadsArray},{"../util/struct_array":210,"./quads":168,"point-geometry":223}],174:[function(require,module,exports){"use strict";var DOM=require("../util/dom");var Point=require("point-geometry");var handlers={scrollZoom:require("./handler/scroll_zoom"),boxZoom:require("./handler/box_zoom"),dragRotate:require("./handler/drag_rotate"),dragPan:require("./handler/drag_pan"),keyboard:require("./handler/keyboard"),doubleClickZoom:require("./handler/dblclick_zoom"),touchZoomRotate:require("./handler/touch_zoom_rotate")};module.exports=function bindHandlers(map,options){var el=map.getCanvasContainer();var contextMenuEvent=null;var mouseDown=false;var startPos=null;var tapped=null;for(var name in handlers){map[name]=new handlers[name](map,options);if(options.interactive&&options[name]){map[name].enable(options[name])}}el.addEventListener("mouseout",onMouseOut,false);el.addEventListener("mousedown",onMouseDown,false);el.addEventListener("mouseup",onMouseUp,false);el.addEventListener("mousemove",onMouseMove,false);el.addEventListener("touchstart",onTouchStart,false);el.addEventListener("touchend",onTouchEnd,false);el.addEventListener("touchmove",onTouchMove,false);el.addEventListener("touchcancel",onTouchCancel,false);el.addEventListener("click",onClick,false);el.addEventListener("dblclick",onDblClick,false);el.addEventListener("contextmenu",onContextMenu,false);function onMouseOut(e){fireMouseEvent("mouseout",e)}function onMouseDown(e){map.stop();startPos=DOM.mousePos(el,e);fireMouseEvent("mousedown",e);mouseDown=true}function onMouseUp(e){var rotating=map.dragRotate&&map.dragRotate.isActive();if(contextMenuEvent&&!rotating){fireMouseEvent("contextmenu",contextMenuEvent)}contextMenuEvent=null;mouseDown=false;fireMouseEvent("mouseup",e)}function onMouseMove(e){if(map.dragPan&&map.dragPan.isActive())return;if(map.dragRotate&&map.dragRotate.isActive())return;var target=e.toElement||e.target;while(target&&target!==el)target=target.parentNode;if(target!==el)return;fireMouseEvent("mousemove",e)}function onTouchStart(e){map.stop();fireTouchEvent("touchstart",e);if(!e.touches||e.touches.length>1)return;if(!tapped){tapped=setTimeout(onTouchTimeout,300)}else{clearTimeout(tapped);tapped=null;fireMouseEvent("dblclick",e)}}function onTouchMove(e){fireTouchEvent("touchmove",e)}function onTouchEnd(e){fireTouchEvent("touchend",e)}function onTouchCancel(e){fireTouchEvent("touchcancel",e)}function onTouchTimeout(){tapped=null}function onClick(e){var pos=DOM.mousePos(el,e);if(pos.equals(startPos)){fireMouseEvent("click",e)}}function onDblClick(e){fireMouseEvent("dblclick",e);e.preventDefault()}function onContextMenu(e){var rotating=map.dragRotate&&map.dragRotate.isActive();if(!mouseDown&&!rotating){fireMouseEvent("contextmenu",e)}else if(mouseDown){contextMenuEvent=e}e.preventDefault()}function fireMouseEvent(type,e){var pos=DOM.mousePos(el,e);return map.fire(type,{lngLat:map.unproject(pos),point:pos,originalEvent:e})}function fireTouchEvent(type,e){var touches=DOM.touchPos(el,e);var singular=touches.reduce(function(prev,curr,i,arr){return prev.add(curr.div(arr.length))},new Point(0,0));return map.fire(type,{lngLat:map.unproject(singular),point:singular,lngLats:touches.map(function(t){return map.unproject(t)},this),points:touches,originalEvent:e})}}},{"../util/dom":200,"./handler/box_zoom":180,"./handler/dblclick_zoom":181,"./handler/drag_pan":182,"./handler/drag_rotate":183,"./handler/keyboard":184,"./handler/scroll_zoom":185,"./handler/touch_zoom_rotate":186,"point-geometry":223}],175:[function(require,module,exports){"use strict";var util=require("../util/util");var interpolate=require("../util/interpolate");var browser=require("../util/browser");var LngLat=require("../geo/lng_lat");var LngLatBounds=require("../geo/lng_lat_bounds");var Point=require("point-geometry");var Evented=require("../util/evented");var Camera=function(Evented){function Camera(transform,options){Evented.call(this);this.moving=false;this.transform=transform;this._bearingSnap=options.bearingSnap}if(Evented)Camera.__proto__=Evented;Camera.prototype=Object.create(Evented&&Evented.prototype);Camera.prototype.constructor=Camera;Camera.prototype.getCenter=function getCenter(){return this.transform.center};Camera.prototype.setCenter=function setCenter(center,eventData){this.jumpTo({center:center},eventData);return this};Camera.prototype.panBy=function panBy(offset,options,eventData){this.panTo(this.transform.center,util.extend({offset:Point.convert(offset).mult(-1)},options),eventData);return this};Camera.prototype.panTo=function panTo(lnglat,options,eventData){return this.easeTo(util.extend({center:lnglat},options),eventData)};Camera.prototype.getZoom=function getZoom(){return this.transform.zoom};Camera.prototype.setZoom=function setZoom(zoom,eventData){this.jumpTo({zoom:zoom},eventData);return this};Camera.prototype.zoomTo=function zoomTo(zoom,options,eventData){return this.easeTo(util.extend({zoom:zoom},options),eventData)};Camera.prototype.zoomIn=function zoomIn(options,eventData){this.zoomTo(this.getZoom()+1,options,eventData);return this};Camera.prototype.zoomOut=function zoomOut(options,eventData){this.zoomTo(this.getZoom()-1,options,eventData);return this};Camera.prototype.getBearing=function getBearing(){return this.transform.bearing};Camera.prototype.setBearing=function setBearing(bearing,eventData){this.jumpTo({bearing:bearing},eventData);return this};Camera.prototype.rotateTo=function rotateTo(bearing,options,eventData){return this.easeTo(util.extend({bearing:bearing},options),eventData)};Camera.prototype.resetNorth=function resetNorth(options,eventData){this.rotateTo(0,util.extend({duration:1e3},options),eventData);return this};Camera.prototype.snapToNorth=function snapToNorth(options,eventData){if(Math.abs(this.getBearing())<this._bearingSnap){return this.resetNorth(options,eventData)}return this};Camera.prototype.getPitch=function getPitch(){return this.transform.pitch};Camera.prototype.setPitch=function setPitch(pitch,eventData){this.jumpTo({pitch:pitch},eventData);return this};Camera.prototype.fitBounds=function fitBounds(bounds,options,eventData){options=util.extend({padding:0,offset:[0,0],maxZoom:this.getMaxZoom()},options);bounds=LngLatBounds.convert(bounds);var offset=Point.convert(options.offset),tr=this.transform,nw=tr.project(bounds.getNorthWest()),se=tr.project(bounds.getSouthEast()),size=se.sub(nw),scaleX=(tr.width-options.padding*2-Math.abs(offset.x)*2)/size.x,scaleY=(tr.height-options.padding*2-Math.abs(offset.y)*2)/size.y;options.center=tr.unproject(nw.add(se).div(2));options.zoom=Math.min(tr.scaleZoom(tr.scale*Math.min(scaleX,scaleY)),options.maxZoom);options.bearing=0;return options.linear?this.easeTo(options,eventData):this.flyTo(options,eventData)};Camera.prototype.jumpTo=function jumpTo(options,eventData){this.stop();var tr=this.transform;var zoomChanged=false,bearingChanged=false,pitchChanged=false;if("zoom"in options&&tr.zoom!==+options.zoom){zoomChanged=true;tr.zoom=+options.zoom}if("center"in options){tr.center=LngLat.convert(options.center)}if("bearing"in options&&tr.bearing!==+options.bearing){bearingChanged=true;tr.bearing=+options.bearing}if("pitch"in options&&tr.pitch!==+options.pitch){pitchChanged=true;tr.pitch=+options.pitch}this.fire("movestart",eventData).fire("move",eventData);if(zoomChanged){this.fire("zoomstart",eventData).fire("zoom",eventData).fire("zoomend",eventData)}if(bearingChanged){this.fire("rotate",eventData)}if(pitchChanged){this.fire("pitch",eventData)}return this.fire("moveend",eventData)};Camera.prototype.easeTo=function easeTo(options,eventData){var this$1=this;this.stop();options=util.extend({offset:[0,0],duration:500,easing:util.ease},options);var tr=this.transform,offset=Point.convert(options.offset),startZoom=this.getZoom(),startBearing=this.getBearing(),startPitch=this.getPitch(),zoom="zoom"in options?+options.zoom:startZoom,bearing="bearing"in options?this._normalizeBearing(options.bearing,startBearing):startBearing,pitch="pitch"in options?+options.pitch:startPitch;var toLngLat,toPoint;if("center"in options){toLngLat=LngLat.convert(options.center);toPoint=tr.centerPoint.add(offset)}else if("around"in options){toLngLat=LngLat.convert(options.around);toPoint=tr.locationPoint(toLngLat)}else{toPoint=tr.centerPoint.add(offset);toLngLat=tr.pointLocation(toPoint)}var fromPoint=tr.locationPoint(toLngLat);if(options.animate===false)options.duration=0;this.zooming=zoom!==startZoom;this.rotating=startBearing!==bearing;this.pitching=pitch!==startPitch;if(options.smoothEasing&&options.duration!==0){options.easing=this._smoothOutEasing(options.duration)}if(!options.noMoveStart){this.moving=true;this.fire("movestart",eventData)}if(this.zooming){this.fire("zoomstart",eventData)}clearTimeout(this._onEaseEnd);this._ease(function(k){if(this.zooming){tr.zoom=interpolate(startZoom,zoom,k)}if(this.rotating){tr.bearing=interpolate(startBearing,bearing,k)}if(this.pitching){tr.pitch=interpolate(startPitch,pitch,k)}tr.setLocationAtPoint(toLngLat,fromPoint.add(toPoint.sub(fromPoint)._mult(k)));this.fire("move",eventData);if(this.zooming){this.fire("zoom",eventData)}if(this.rotating){this.fire("rotate",eventData)}if(this.pitching){this.fire("pitch",eventData)}},function(){if(options.delayEndEvents){this$1._onEaseEnd=setTimeout(this$1._easeToEnd.bind(this$1,eventData),options.delayEndEvents)}else{this$1._easeToEnd(eventData)}},options);return this};Camera.prototype._easeToEnd=function _easeToEnd(eventData){var wasZooming=this.zooming;this.moving=false;this.zooming=false;this.rotating=false;this.pitching=false;if(wasZooming){this.fire("zoomend",eventData)}this.fire("moveend",eventData)};Camera.prototype.flyTo=function flyTo(options,eventData){this.stop();options=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},options);var tr=this.transform,offset=Point.convert(options.offset),startZoom=this.getZoom(),startBearing=this.getBearing(),startPitch=this.getPitch();var center="center"in options?LngLat.convert(options.center):this.getCenter();var zoom="zoom"in options?+options.zoom:startZoom;var bearing="bearing"in options?this._normalizeBearing(options.bearing,startBearing):startBearing;var pitch="pitch"in options?+options.pitch:startPitch;if(Math.abs(tr.center.lng)+Math.abs(center.lng)>180){if(tr.center.lng>0&&center.lng<0){center.lng+=360}else if(tr.center.lng<0&&center.lng>0){center.lng-=360}}var scale=tr.zoomScale(zoom-startZoom),from=tr.point,to="center"in options?tr.project(center).sub(offset.div(scale)):from;var rho=options.curve;var w0=Math.max(tr.width,tr.height),w1=w0/scale,u1=to.sub(from).mag();if("minZoom"in options){var minZoom=util.clamp(Math.min(options.minZoom,startZoom,zoom),tr.minZoom,tr.maxZoom);var wMax=w0/tr.zoomScale(minZoom-startZoom);rho=Math.sqrt(wMax/u1*2)}var rho2=rho*rho;function r(i){var b=(w1*w1-w0*w0+(i?-1:1)*rho2*rho2*u1*u1)/(2*(i?w1:w0)*rho2*u1);return Math.log(Math.sqrt(b*b+1)-b)}function sinh(n){return(Math.exp(n)-Math.exp(-n))/2}function cosh(n){return(Math.exp(n)+Math.exp(-n))/2}function tanh(n){return sinh(n)/cosh(n)}var r0=r(0);var w=function(s){return cosh(r0)/cosh(r0+rho*s)},u=function(s){return w0*((cosh(r0)*tanh(r0+rho*s)-sinh(r0))/rho2)/u1},S=(r(1)-r0)/rho;if(Math.abs(u1)<1e-6){if(Math.abs(w0-w1)<1e-6)return this.easeTo(options);var k=w1<w0?-1:1;S=Math.abs(Math.log(w1/w0))/rho;u=function(){return 0};w=function(s){return Math.exp(k*rho*s)}}if("duration"in options){
options.duration=+options.duration}else{var V="screenSpeed"in options?+options.screenSpeed/rho:+options.speed;options.duration=1e3*S/V}this.moving=true;this.zooming=true;if(startBearing!==bearing)this.rotating=true;if(startPitch!==pitch)this.pitching=true;this.fire("movestart",eventData);this.fire("zoomstart",eventData);this._ease(function(k){var s=k*S,us=u(s);var scale=1/w(s);tr.zoom=startZoom+tr.scaleZoom(scale);tr.center=tr.unproject(from.add(to.sub(from).mult(us)).mult(scale));if(this.rotating){tr.bearing=interpolate(startBearing,bearing,k)}if(this.pitching){tr.pitch=interpolate(startPitch,pitch,k)}this.fire("move",eventData);this.fire("zoom",eventData);if(this.rotating){this.fire("rotate",eventData)}if(this.pitching){this.fire("pitch",eventData)}},function(){this.moving=false;this.zooming=false;this.rotating=false;this.pitching=false;this.fire("zoomend",eventData);this.fire("moveend",eventData)},options);return this};Camera.prototype.isEasing=function isEasing(){return!!this._abortFn};Camera.prototype.isMoving=function isMoving(){return this.moving};Camera.prototype.stop=function stop(){if(this._abortFn){this._abortFn();this._finishEase()}return this};Camera.prototype._ease=function _ease(frame,finish,options){this._finishFn=finish;this._abortFn=browser.timed(function(t){frame.call(this,options.easing(t));if(t===1){this._finishEase()}},options.animate===false?0:options.duration,this)};Camera.prototype._finishEase=function _finishEase(){delete this._abortFn;var finish=this._finishFn;delete this._finishFn;finish.call(this)};Camera.prototype._normalizeBearing=function _normalizeBearing(bearing,currentBearing){bearing=util.wrap(bearing,-180,180);var diff=Math.abs(bearing-currentBearing);if(Math.abs(bearing-360-currentBearing)<diff)bearing-=360;if(Math.abs(bearing+360-currentBearing)<diff)bearing+=360;return bearing};Camera.prototype._smoothOutEasing=function _smoothOutEasing(duration){var easing=util.ease;if(this._prevEase){var ease=this._prevEase,t=(Date.now()-ease.start)/ease.duration,speed=ease.easing(t+.01)-ease.easing(t),x=.27/Math.sqrt(speed*speed+1e-4)*.01,y=Math.sqrt(.27*.27-x*x);easing=util.bezier(x,y,.25,1)}this._prevEase={start:(new Date).getTime(),duration:duration,easing:easing};return easing};return Camera}(Evented);module.exports=Camera},{"../geo/lng_lat":102,"../geo/lng_lat_bounds":103,"../util/browser":193,"../util/evented":201,"../util/interpolate":204,"../util/util":212,"point-geometry":223}],176:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var AttributionControl=function AttributionControl(options){this.options=options;util.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};AttributionControl.prototype.getDefaultPosition=function getDefaultPosition(){return"bottom-right"};AttributionControl.prototype.onAdd=function onAdd(map){var compact=this.options&&this.options.compact;this._map=map;this._container=DOM.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib");if(compact){this._container.classList.add("compact")}this._updateAttributions();this._updateEditLink();this._map.on("data",this._updateData);this._map.on("moveend",this._updateEditLink);if(compact===undefined){this._map.on("resize",this._updateCompact);this._updateCompact()}return this._container};AttributionControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);this._map.off("data",this._updateData);this._map.off("moveend",this._updateEditLink);this._map.off("resize",this._updateCompact);this._map=undefined};AttributionControl.prototype._updateEditLink=function _updateEditLink(){if(!this._editLink)this._editLink=this._container.querySelector(".mapbox-improve-map");if(this._editLink){var center=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+center.lng+"/"+center.lat+"/"+Math.round(this._map.getZoom()+1)}};AttributionControl.prototype._updateData=function _updateData(event){if(event.dataType==="source"){this._updateAttributions();this._updateEditLink()}};AttributionControl.prototype._updateAttributions=function _updateAttributions(){if(!this._map.style)return;var attributions=[];var sourceCaches=this._map.style.sourceCaches;for(var id in sourceCaches){var source=sourceCaches[id].getSource();if(source.attribution&&attributions.indexOf(source.attribution)<0){attributions.push(source.attribution)}}attributions.sort(function(a,b){return a.length-b.length});attributions=attributions.filter(function(attrib,i){for(var j=i+1;j<attributions.length;j++){if(attributions[j].indexOf(attrib)>=0){return false}}return true});this._container.innerHTML=attributions.join(" | ");this._editLink=null};AttributionControl.prototype._updateCompact=function _updateCompact(){var compact=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[compact?"add":"remove"]("compact")};module.exports=AttributionControl},{"../../util/dom":200,"../../util/util":212}],177:[function(require,module,exports){"use strict";var Evented=require("../../util/evented");var DOM=require("../../util/dom");var window=require("../../util/window");var util=require("../../util/util");var defaultGeoPositionOptions={enableHighAccuracy:false,timeout:6e3};var className="mapboxgl-ctrl";var supportsGeolocation;function checkGeolocationSupport(callback){if(supportsGeolocation!==undefined){callback(supportsGeolocation)}else if(window.navigator.permissions!==undefined){window.navigator.permissions.query({name:"geolocation"}).then(function(p){supportsGeolocation=p.state!=="denied";callback(supportsGeolocation)})}else{supportsGeolocation=!!window.navigator.geolocation;callback(supportsGeolocation)}}var GeolocateControl=function(Evented){function GeolocateControl(options){Evented.call(this);this.options=options||{};util.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}if(Evented)GeolocateControl.__proto__=Evented;GeolocateControl.prototype=Object.create(Evented&&Evented.prototype);GeolocateControl.prototype.constructor=GeolocateControl;GeolocateControl.prototype.onAdd=function onAdd(map){this._map=map;this._container=DOM.create("div",className+" "+className+"-group");checkGeolocationSupport(this._setupUI);return this._container};GeolocateControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);this._map=undefined};GeolocateControl.prototype._onSuccess=function _onSuccess(position){this._map.jumpTo({center:[position.coords.longitude,position.coords.latitude],zoom:17,bearing:0,pitch:0});this.fire("geolocate",position);this._finish()};GeolocateControl.prototype._onError=function _onError(error){this.fire("error",error);this._finish()};GeolocateControl.prototype._finish=function _finish(){if(this._timeoutId){clearTimeout(this._timeoutId)}this._timeoutId=undefined};GeolocateControl.prototype._setupUI=function _setupUI(supported){if(supported===false)return;this._container.addEventListener("contextmenu",function(e){return e.preventDefault()});this._geolocateButton=DOM.create("button",className+"-icon "+className+"-geolocate",this._container);this._geolocateButton.type="button";this._geolocateButton.setAttribute("aria-label","Geolocate");if(this.options.watchPosition)this._geolocateButton.setAttribute("aria-pressed",false);this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this))};GeolocateControl.prototype._onClickGeolocate=function _onClickGeolocate(){var positionOptions=util.extend(defaultGeoPositionOptions,this.options&&this.options.positionOptions||{});if(this.options.watchPosition){if(this._geolocationWatchID!==undefined){this._geolocateButton.classList.remove("watching");this._geolocateButton.setAttribute("aria-pressed",false);window.navigator.geolocation.clearWatch(this._geolocationWatchID);this._geolocationWatchID=undefined}else{this._geolocateButton.classList.add("watching");this._geolocateButton.setAttribute("aria-pressed",true);this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,positionOptions)}}else{window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,positionOptions);this._timeoutId=setTimeout(this._finish,1e4)}};return GeolocateControl}(Evented);module.exports=GeolocateControl},{"../../util/dom":200,"../../util/evented":201,"../../util/util":212,"../../util/window":195}],178:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var window=require("../../util/window");var util=require("../../util/util");var className="mapboxgl-ctrl";var NavigationControl=function NavigationControl(){util.bindAll(["_rotateCompassArrow"],this)};NavigationControl.prototype._rotateCompassArrow=function _rotateCompassArrow(){var rotate="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=rotate};NavigationControl.prototype.onAdd=function onAdd(map){this._map=map;this._container=DOM.create("div",className+" "+className+"-group",map.getContainer());this._container.addEventListener("contextmenu",this._onContextMenu.bind(this));this._zoomInButton=this._createButton(className+"-icon "+className+"-zoom-in","Zoom In",map.zoomIn.bind(map));this._zoomOutButton=this._createButton(className+"-icon "+className+"-zoom-out","Zoom Out",map.zoomOut.bind(map));this._compass=this._createButton(className+"-icon "+className+"-compass","Reset North",map.resetNorth.bind(map));this._compassArrow=DOM.create("span","arrow",this._compass);this._compass.addEventListener("mousedown",this._onCompassDown.bind(this));this._onCompassMove=this._onCompassMove.bind(this);this._onCompassUp=this._onCompassUp.bind(this);this._map.on("rotate",this._rotateCompassArrow);this._rotateCompassArrow();return this._container};NavigationControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);this._map.off("rotate",this._rotateCompassArrow);this._map=undefined};NavigationControl.prototype._onContextMenu=function _onContextMenu(e){e.preventDefault()};NavigationControl.prototype._onCompassDown=function _onCompassDown(e){if(e.button!==0)return;DOM.disableDrag();window.document.addEventListener("mousemove",this._onCompassMove);window.document.addEventListener("mouseup",this._onCompassUp);this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(e));e.stopPropagation()};NavigationControl.prototype._onCompassMove=function _onCompassMove(e){if(e.button!==0)return;this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(e));e.stopPropagation()};NavigationControl.prototype._onCompassUp=function _onCompassUp(e){if(e.button!==0)return;window.document.removeEventListener("mousemove",this._onCompassMove);window.document.removeEventListener("mouseup",this._onCompassUp);DOM.enableDrag();this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(e));e.stopPropagation()};NavigationControl.prototype._createButton=function _createButton(className,ariaLabel,fn){var a=DOM.create("button",className,this._container);a.type="button";a.setAttribute("aria-label",ariaLabel);a.addEventListener("click",function(){fn()});return a};module.exports=NavigationControl;function copyMouseEvent(e){return new window.MouseEvent(e.type,{button:2,buttons:2,bubbles:true,cancelable:true,detail:e.detail,view:e.view,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey})}},{"../../util/dom":200,"../../util/util":212,"../../util/window":195}],179:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var ScaleControl=function ScaleControl(options){this.options=options;util.bindAll(["_onMove"],this)};ScaleControl.prototype.getDefaultPosition=function getDefaultPosition(){return"bottom-left"};ScaleControl.prototype._onMove=function _onMove(){updateScale(this._map,this._container,this.options)};ScaleControl.prototype.onAdd=function onAdd(map){this._map=map;this._container=DOM.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",map.getContainer());this._map.on("move",this._onMove);this._onMove();return this._container};ScaleControl.prototype.onRemove=function onRemove(){this._container.parentNode.removeChild(this._container);this._map.off("move",this._onMove);this._map=undefined};module.exports=ScaleControl;function updateScale(map,container,options){var maxWidth=options&&options.maxWidth||100;var y=map._container.clientHeight/2;var maxMeters=getDistance(map.unproject([0,y]),map.unproject([maxWidth,y]));if(options&&options.unit==="imperial"){var maxFeet=3.2808*maxMeters;if(maxFeet>5280){var maxMiles=maxFeet/5280;setScale(container,maxWidth,maxMiles,"mi")}else{setScale(container,maxWidth,maxFeet,"ft")}}else{setScale(container,maxWidth,maxMeters,"m")}}function setScale(container,maxWidth,maxDistance,unit){var distance=getRoundNum(maxDistance);var ratio=distance/maxDistance;if(unit==="m"&&distance>=1e3){distance=distance/1e3;unit="km"}container.style.width=maxWidth*ratio+"px";container.innerHTML=distance+unit}function getDistance(latlng1,latlng2){var R=6371e3;var rad=Math.PI/180,lat1=latlng1.lat*rad,lat2=latlng2.lat*rad,a=Math.sin(lat1)*Math.sin(lat2)+Math.cos(lat1)*Math.cos(lat2)*Math.cos((latlng2.lng-latlng1.lng)*rad);var maxMeters=R*Math.acos(Math.min(a,1));return maxMeters}function getRoundNum(num){var pow10=Math.pow(10,(""+Math.floor(num)).length-1);var d=num/pow10;d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1;return pow10*d}},{"../../util/dom":200,"../../util/util":212}],180:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var LngLatBounds=require("../../geo/lng_lat_bounds");var util=require("../../util/util");var window=require("../../util/window");var BoxZoomHandler=function BoxZoomHandler(map){this._map=map;this._el=map.getCanvasContainer();this._container=map.getContainer();util.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};BoxZoomHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};BoxZoomHandler.prototype.isActive=function isActive(){return!!this._active};BoxZoomHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("mousedown",this._onMouseDown,false);this._enabled=true};BoxZoomHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("mousedown",this._onMouseDown);this._enabled=false};BoxZoomHandler.prototype._onMouseDown=function _onMouseDown(e){if(!(e.shiftKey&&e.button===0))return;window.document.addEventListener("mousemove",this._onMouseMove,false);window.document.addEventListener("keydown",this._onKeyDown,false);window.document.addEventListener("mouseup",this._onMouseUp,false);DOM.disableDrag();this._startPos=DOM.mousePos(this._el,e);this._active=true};BoxZoomHandler.prototype._onMouseMove=function _onMouseMove(e){var p0=this._startPos,p1=DOM.mousePos(this._el,e);if(!this._box){this._box=DOM.create("div","mapboxgl-boxzoom",this._container);this._container.classList.add("mapboxgl-crosshair");this._fireEvent("boxzoomstart",e)}var minX=Math.min(p0.x,p1.x),maxX=Math.max(p0.x,p1.x),minY=Math.min(p0.y,p1.y),maxY=Math.max(p0.y,p1.y);DOM.setTransform(this._box,"translate("+minX+"px,"+minY+"px)");this._box.style.width=maxX-minX+"px";this._box.style.height=maxY-minY+"px"};BoxZoomHandler.prototype._onMouseUp=function _onMouseUp(e){if(e.button!==0)return;var p0=this._startPos,p1=DOM.mousePos(this._el,e),bounds=(new LngLatBounds).extend(this._map.unproject(p0)).extend(this._map.unproject(p1));this._finish();if(p0.x===p1.x&&p0.y===p1.y){this._fireEvent("boxzoomcancel",e)}else{this._map.fitBounds(bounds,{linear:true}).fire("boxzoomend",{originalEvent:e,boxZoomBounds:bounds})}};BoxZoomHandler.prototype._onKeyDown=function _onKeyDown(e){if(e.keyCode===27){this._finish();this._fireEvent("boxzoomcancel",e)}};BoxZoomHandler.prototype._finish=function _finish(){this._active=false;window.document.removeEventListener("mousemove",this._onMouseMove,false);window.document.removeEventListener("keydown",this._onKeyDown,false);window.document.removeEventListener("mouseup",this._onMouseUp,false);this._container.classList.remove("mapboxgl-crosshair");if(this._box){this._box.parentNode.removeChild(this._box);this._box=null}DOM.enableDrag()};BoxZoomHandler.prototype._fireEvent=function _fireEvent(type,e){return this._map.fire(type,{originalEvent:e})};module.exports=BoxZoomHandler},{"../../geo/lng_lat_bounds":103,"../../util/dom":200,"../../util/util":212,"../../util/window":195}],181:[function(require,module,exports){"use strict";var DoubleClickZoomHandler=function DoubleClickZoomHandler(map){this._map=map;this._onDblClick=this._onDblClick.bind(this)};DoubleClickZoomHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};DoubleClickZoomHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._map.on("dblclick",this._onDblClick);this._enabled=true};DoubleClickZoomHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._map.off("dblclick",this._onDblClick);this._enabled=false};DoubleClickZoomHandler.prototype._onDblClick=function _onDblClick(e){this._map.zoomTo(this._map.getZoom()+(e.originalEvent.shiftKey?-1:1),{around:e.lngLat},e)};module.exports=DoubleClickZoomHandler},{}],182:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var window=require("../../util/window");var inertiaLinearity=.3,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=1400,inertiaDeceleration=2500;var DragPanHandler=function DragPanHandler(map){this._map=map;this._el=map.getCanvasContainer();util.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};DragPanHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};DragPanHandler.prototype.isActive=function isActive(){return!!this._active};DragPanHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("mousedown",this._onDown);this._el.addEventListener("touchstart",this._onDown);this._enabled=true};DragPanHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("mousedown",this._onDown);this._el.removeEventListener("touchstart",this._onDown);this._enabled=false};DragPanHandler.prototype._onDown=function _onDown(e){if(this._ignoreEvent(e))return;if(this.isActive())return;if(e.touches){window.document.addEventListener("touchmove",this._onMove);window.document.addEventListener("touchend",this._onTouchEnd)}else{window.document.addEventListener("mousemove",this._onMove);window.document.addEventListener("mouseup",this._onMouseUp)}this._active=false;this._startPos=this._pos=DOM.mousePos(this._el,e);this._inertia=[[Date.now(),this._pos]]};DragPanHandler.prototype._onMove=function _onMove(e){if(this._ignoreEvent(e))return;if(!this.isActive()){this._active=true;this._fireEvent("dragstart",e);this._fireEvent("movestart",e)}var pos=DOM.mousePos(this._el,e),map=this._map;map.stop();this._drainInertiaBuffer();this._inertia.push([Date.now(),pos]);map.transform.setLocationAtPoint(map.transform.pointLocation(this._pos),pos);this._fireEvent("drag",e);this._fireEvent("move",e);this._pos=pos;e.preventDefault()};DragPanHandler.prototype._onUp=function _onUp(e){var this$1=this;if(!this.isActive())return;this._active=false;this._fireEvent("dragend",e);this._drainInertiaBuffer();var finish=function(){return this$1._fireEvent("moveend",e)};var inertia=this._inertia;if(inertia.length<2){finish();return}var last=inertia[inertia.length-1],first=inertia[0],flingOffset=last[1].sub(first[1]),flingDuration=(last[0]-first[0])/1e3;if(flingDuration===0||last[1].equals(first[1])){finish();return}var velocity=flingOffset.mult(inertiaLinearity/flingDuration);var speed=velocity.mag();if(speed>inertiaMaxSpeed){speed=inertiaMaxSpeed;velocity._unit()._mult(speed)}var duration=speed/(inertiaDeceleration*inertiaLinearity),offset=velocity.mult(-duration/2);this._map.panBy(offset,{duration:duration*1e3,easing:inertiaEasing,noMoveStart:true},{originalEvent:e})};DragPanHandler.prototype._onMouseUp=function _onMouseUp(e){if(this._ignoreEvent(e))return;this._onUp(e);window.document.removeEventListener("mousemove",this._onMove);window.document.removeEventListener("mouseup",this._onMouseUp)};DragPanHandler.prototype._onTouchEnd=function _onTouchEnd(e){if(this._ignoreEvent(e))return;this._onUp(e);window.document.removeEventListener("touchmove",this._onMove);window.document.removeEventListener("touchend",this._onTouchEnd)};DragPanHandler.prototype._fireEvent=function _fireEvent(type,e){return this._map.fire(type,{originalEvent:e})};DragPanHandler.prototype._ignoreEvent=function _ignoreEvent(e){var map=this._map;if(map.boxZoom&&map.boxZoom.isActive())return true;if(map.dragRotate&&map.dragRotate.isActive())return true;if(e.touches){return e.touches.length>1}else{if(e.ctrlKey)return true;var buttons=1,button=0;return e.type==="mousemove"?e.buttons&buttons===0:e.button!==button}};DragPanHandler.prototype._drainInertiaBuffer=function _drainInertiaBuffer(){var inertia=this._inertia,now=Date.now(),cutoff=160;while(inertia.length>0&&now-inertia[0][0]>cutoff)inertia.shift()};module.exports=DragPanHandler},{"../../util/dom":200,"../../util/util":212,"../../util/window":195}],183:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var window=require("../../util/window");var inertiaLinearity=.25,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=180,inertiaDeceleration=720;var DragRotateHandler=function DragRotateHandler(map,options){this._map=map;this._el=map.getCanvasContainer();this._bearingSnap=options.bearingSnap;this._pitchWithRotate=options.pitchWithRotate!==false;util.bindAll(["_onDown","_onMove","_onUp"],this)};DragRotateHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};DragRotateHandler.prototype.isActive=function isActive(){return!!this._active};DragRotateHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("mousedown",this._onDown);this._enabled=true};DragRotateHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("mousedown",this._onDown);this._enabled=false};DragRotateHandler.prototype._onDown=function _onDown(e){if(this._ignoreEvent(e))return;if(this.isActive())return;window.document.addEventListener("mousemove",this._onMove);window.document.addEventListener("mouseup",this._onUp);this._active=false;this._inertia=[[Date.now(),this._map.getBearing()]];this._startPos=this._pos=DOM.mousePos(this._el,e);this._center=this._map.transform.centerPoint;e.preventDefault()};DragRotateHandler.prototype._onMove=function _onMove(e){if(this._ignoreEvent(e))return;if(!this.isActive()){this._active=true;this._fireEvent("rotatestart",e);this._fireEvent("movestart",e)}var map=this._map;map.stop();var p1=this._pos,p2=DOM.mousePos(this._el,e),bearingDiff=(p1.x-p2.x)*.8,pitchDiff=(p1.y-p2.y)*-.5,bearing=map.getBearing()-bearingDiff,pitch=map.getPitch()-pitchDiff,inertia=this._inertia,last=inertia[inertia.length-1];this._drainInertiaBuffer();inertia.push([Date.now(),map._normalizeBearing(bearing,last[1])]);map.transform.bearing=bearing;if(this._pitchWithRotate)map.transform.pitch=pitch;this._fireEvent("rotate",e);this._fireEvent("move",e);this._pos=p2};DragRotateHandler.prototype._onUp=function _onUp(e){var this$1=this;if(this._ignoreEvent(e))return;window.document.removeEventListener("mousemove",this._onMove);window.document.removeEventListener("mouseup",this._onUp);if(!this.isActive())return;this._active=false;this._fireEvent("rotateend",e);this._drainInertiaBuffer();var map=this._map,mapBearing=map.getBearing(),inertia=this._inertia;var finish=function(){if(Math.abs(mapBearing)<this$1._bearingSnap){map.resetNorth({noMoveStart:true},{originalEvent:e})}else{this$1._fireEvent("moveend",e)}};if(inertia.length<2){finish();return}var first=inertia[0],last=inertia[inertia.length-1],previous=inertia[inertia.length-2];var bearing=map._normalizeBearing(mapBearing,previous[1]);var flingDiff=last[1]-first[1],sign=flingDiff<0?-1:1,flingDuration=(last[0]-first[0])/1e3;if(flingDiff===0||flingDuration===0){finish();return}var speed=Math.abs(flingDiff*(inertiaLinearity/flingDuration));if(speed>inertiaMaxSpeed){speed=inertiaMaxSpeed}var duration=speed/(inertiaDeceleration*inertiaLinearity),offset=sign*speed*(duration/2);bearing+=offset;if(Math.abs(map._normalizeBearing(bearing,0))<this._bearingSnap){bearing=map._normalizeBearing(0,bearing)}map.rotateTo(bearing,{duration:duration*1e3,easing:inertiaEasing,noMoveStart:true},{originalEvent:e})};DragRotateHandler.prototype._fireEvent=function _fireEvent(type,e){return this._map.fire(type,{originalEvent:e})};DragRotateHandler.prototype._ignoreEvent=function _ignoreEvent(e){var map=this._map;if(map.boxZoom&&map.boxZoom.isActive())return true;if(map.dragPan&&map.dragPan.isActive())return true;if(e.touches){return e.touches.length>1}else{var buttons=e.ctrlKey?1:2,button=e.ctrlKey?0:2;var eventButton=e.button;if(typeof InstallTrigger!=="undefined"&&e.button===2&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0){eventButton=0}return e.type==="mousemove"?e.buttons&buttons===0:eventButton!==button}};DragRotateHandler.prototype._drainInertiaBuffer=function _drainInertiaBuffer(){var inertia=this._inertia,now=Date.now(),cutoff=160;while(inertia.length>0&&now-inertia[0][0]>cutoff)inertia.shift()};module.exports=DragRotateHandler},{"../../util/dom":200,"../../util/util":212,"../../util/window":195}],184:[function(require,module,exports){"use strict";var panStep=100,bearingStep=15,pitchStep=10;var KeyboardHandler=function KeyboardHandler(map){this._map=map;this._el=map.getCanvasContainer();this._onKeyDown=this._onKeyDown.bind(this)};KeyboardHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};KeyboardHandler.prototype.enable=function enable(){if(this.isEnabled())return;this._el.addEventListener("keydown",this._onKeyDown,false);this._enabled=true};KeyboardHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("keydown",this._onKeyDown);this._enabled=false};KeyboardHandler.prototype._onKeyDown=function _onKeyDown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;var zoomDir=0;var bearingDir=0;var pitchDir=0;var xDir=0;var yDir=0;switch(e.keyCode){case 61:case 107:case 171:case 187:zoomDir=1;break;case 189:case 109:case 173:zoomDir=-1;break;case 37:if(e.shiftKey){bearingDir=-1}else{e.preventDefault();xDir=-1}break;case 39:if(e.shiftKey){bearingDir=1}else{e.preventDefault();xDir=1}break;case 38:if(e.shiftKey){pitchDir=1}else{e.preventDefault();yDir=-1}break;case 40:if(e.shiftKey){pitchDir=-1}else{yDir=1;e.preventDefault()}break}var map=this._map;var zoom=map.getZoom();var easeOptions={duration:300,delayEndEvents:500,easing:easeOut,zoom:zoomDir?Math.round(zoom)+zoomDir*(e.shiftKey?2:1):zoom,bearing:map.getBearing()+bearingDir*bearingStep,pitch:map.getPitch()+pitchDir*pitchStep,offset:[-xDir*panStep,-yDir*panStep],center:map.getCenter()};map.easeTo(easeOptions,{originalEvent:e})};function easeOut(t){return t*(2-t)}module.exports=KeyboardHandler},{}],185:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var browser=require("../../util/browser");var window=require("../../util/window");var ua=window.navigator.userAgent.toLowerCase(),firefox=ua.indexOf("firefox")!==-1,safari=ua.indexOf("safari")!==-1&&ua.indexOf("chrom")===-1;var ScrollZoomHandler=function ScrollZoomHandler(map){this._map=map;this._el=map.getCanvasContainer();util.bindAll(["_onWheel","_onTimeout"],this)};ScrollZoomHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};ScrollZoomHandler.prototype.enable=function enable(options){if(this.isEnabled())return;this._el.addEventListener("wheel",this._onWheel,false);this._el.addEventListener("mousewheel",this._onWheel,false);this._enabled=true;this._aroundCenter=options&&options.around==="center"};ScrollZoomHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("wheel",this._onWheel);this._el.removeEventListener("mousewheel",this._onWheel);this._enabled=false};ScrollZoomHandler.prototype._onWheel=function _onWheel(e){var value;if(e.type==="wheel"){value=e.deltaY;if(firefox&&e.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL)value/=browser.devicePixelRatio;if(e.deltaMode===window.WheelEvent.DOM_DELTA_LINE)value*=40}else if(e.type==="mousewheel"){value=-e.wheelDeltaY;if(safari)value=value/3}var now=browser.now(),timeDelta=now-(this._time||0);this._pos=DOM.mousePos(this._el,e);this._time=now;if(value!==0&&value%4.000244140625===0){this._type="wheel"}else if(value!==0&&Math.abs(value)<4){this._type="trackpad"}else if(timeDelta>400){this._type=null;this._lastValue=value;this._timeout=setTimeout(this._onTimeout,40)}else if(!this._type){this._type=Math.abs(timeDelta*value)<200?"trackpad":"wheel";if(this._timeout){clearTimeout(this._timeout);this._timeout=null;value+=this._lastValue}}if(e.shiftKey&&value)value=value/4;if(this._type)this._zoom(-value,e);e.preventDefault()};ScrollZoomHandler.prototype._onTimeout=function _onTimeout(){this._type="wheel";this._zoom(-this._lastValue)};ScrollZoomHandler.prototype._zoom=function _zoom(delta,e){if(delta===0)return;var map=this._map;var scale=2/(1+Math.exp(-Math.abs(delta/100)));if(delta<0&&scale!==0)scale=1/scale;var fromScale=map.ease?map.ease.to:map.transform.scale,targetZoom=map.transform.scaleZoom(fromScale*scale);map.zoomTo(targetZoom,{duration:this._type==="wheel"?200:0,around:this._aroundCenter?map.getCenter():map.unproject(this._pos),delayEndEvents:200,smoothEasing:true},{originalEvent:e})};module.exports=ScrollZoomHandler},{"../../util/browser":193,"../../util/dom":200,"../../util/util":212,"../../util/window":195}],186:[function(require,module,exports){"use strict";var DOM=require("../../util/dom");var util=require("../../util/util");var window=require("../../util/window");var inertiaLinearity=.15,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaDeceleration=12,inertiaMaxSpeed=2.5,significantScaleThreshold=.15,significantRotateThreshold=4;var TouchZoomRotateHandler=function TouchZoomRotateHandler(map){this._map=map;this._el=map.getCanvasContainer();util.bindAll(["_onStart","_onMove","_onEnd"],this)};TouchZoomRotateHandler.prototype.isEnabled=function isEnabled(){return!!this._enabled};TouchZoomRotateHandler.prototype.enable=function enable(options){if(this.isEnabled())return;this._el.addEventListener("touchstart",this._onStart,false);this._enabled=true;this._aroundCenter=options&&options.around==="center"};TouchZoomRotateHandler.prototype.disable=function disable(){if(!this.isEnabled())return;this._el.removeEventListener("touchstart",this._onStart);this._enabled=false};TouchZoomRotateHandler.prototype.disableRotation=function disableRotation(){this._rotationDisabled=true};TouchZoomRotateHandler.prototype.enableRotation=function enableRotation(){this._rotationDisabled=false};TouchZoomRotateHandler.prototype._onStart=function _onStart(e){if(e.touches.length!==2)return;var p0=DOM.mousePos(this._el,e.touches[0]),p1=DOM.mousePos(this._el,e.touches[1]);this._startVec=p0.sub(p1);this._startScale=this._map.transform.scale;this._startBearing=this._map.transform.bearing;this._gestureIntent=undefined;this._inertia=[];window.document.addEventListener("touchmove",this._onMove,false);window.document.addEventListener("touchend",this._onEnd,false)};TouchZoomRotateHandler.prototype._onMove=function _onMove(e){if(e.touches.length!==2)return;var p0=DOM.mousePos(this._el,e.touches[0]),p1=DOM.mousePos(this._el,e.touches[1]),p=p0.add(p1).div(2),vec=p0.sub(p1),scale=vec.mag()/this._startVec.mag(),bearing=this._rotationDisabled?0:vec.angleWith(this._startVec)*180/Math.PI,map=this._map;

if(!this._gestureIntent){var scalingSignificantly=Math.abs(1-scale)>significantScaleThreshold,rotatingSignificantly=Math.abs(bearing)>significantRotateThreshold;if(rotatingSignificantly){this._gestureIntent="rotate"}else if(scalingSignificantly){this._gestureIntent="zoom"}if(this._gestureIntent){this._startVec=vec;this._startScale=map.transform.scale;this._startBearing=map.transform.bearing}}else{var param={duration:0,around:map.unproject(p)};if(this._gestureIntent==="rotate"){param.bearing=this._startBearing+bearing}if(this._gestureIntent==="zoom"||this._gestureIntent==="rotate"){param.zoom=map.transform.scaleZoom(this._startScale*scale)}map.stop();this._drainInertiaBuffer();this._inertia.push([Date.now(),scale,p]);map.easeTo(param,{originalEvent:e})}e.preventDefault()};TouchZoomRotateHandler.prototype._onEnd=function _onEnd(e){window.document.removeEventListener("touchmove",this._onMove);window.document.removeEventListener("touchend",this._onEnd);this._drainInertiaBuffer();var inertia=this._inertia,map=this._map;if(inertia.length<2){map.snapToNorth({},{originalEvent:e});return}var last=inertia[inertia.length-1],first=inertia[0],lastScale=map.transform.scaleZoom(this._startScale*last[1]),firstScale=map.transform.scaleZoom(this._startScale*first[1]),scaleOffset=lastScale-firstScale,scaleDuration=(last[0]-first[0])/1e3,p=last[2];if(scaleDuration===0||lastScale===firstScale){map.snapToNorth({},{originalEvent:e});return}var speed=scaleOffset*inertiaLinearity/scaleDuration;if(Math.abs(speed)>inertiaMaxSpeed){if(speed>0){speed=inertiaMaxSpeed}else{speed=-inertiaMaxSpeed}}var duration=Math.abs(speed/(inertiaDeceleration*inertiaLinearity))*1e3;var targetScale=lastScale+speed*duration/2e3;if(targetScale<0){targetScale=0}map.easeTo({zoom:targetScale,duration:duration,easing:inertiaEasing,around:this._aroundCenter?map.getCenter():map.unproject(p)},{originalEvent:e})};TouchZoomRotateHandler.prototype._drainInertiaBuffer=function _drainInertiaBuffer(){var inertia=this._inertia,now=Date.now(),cutoff=160;while(inertia.length>2&&now-inertia[0][0]>cutoff)inertia.shift()};module.exports=TouchZoomRotateHandler},{"../../util/dom":200,"../../util/util":212,"../../util/window":195}],187:[function(require,module,exports){"use strict";var util=require("../util/util");var window=require("../util/window");var Hash=function Hash(){util.bindAll(["_onHashChange","_updateHash"],this)};Hash.prototype.addTo=function addTo(map){this._map=map;window.addEventListener("hashchange",this._onHashChange,false);this._map.on("moveend",this._updateHash);return this};Hash.prototype.remove=function remove(){window.removeEventListener("hashchange",this._onHashChange,false);this._map.off("moveend",this._updateHash);delete this._map;return this};Hash.prototype._onHashChange=function _onHashChange(){var loc=window.location.hash.replace("#","").split("/");if(loc.length>=3){this._map.jumpTo({center:[+loc[2],+loc[1]],zoom:+loc[0],bearing:+(loc[3]||0),pitch:+(loc[4]||0)});return true}return false};Hash.prototype._updateHash=function _updateHash(){var center=this._map.getCenter(),zoom=this._map.getZoom(),bearing=this._map.getBearing(),pitch=this._map.getPitch(),precision=Math.max(0,Math.ceil(Math.log(zoom)/Math.LN2));var hash="#"+Math.round(zoom*100)/100+"/"+center.lat.toFixed(precision)+"/"+center.lng.toFixed(precision);if(bearing||pitch)hash+="/"+Math.round(bearing*10)/10;if(pitch)hash+="/"+Math.round(pitch);window.history.replaceState("","",hash)};module.exports=Hash},{"../util/util":212,"../util/window":195}],188:[function(require,module,exports){"use strict";var util=require("../util/util");var browser=require("../util/browser");var window=require("../util/window");var DOM=require("../util/dom");var Style=require("../style/style");var AnimationLoop=require("../style/animation_loop");var Painter=require("../render/painter");var Transform=require("../geo/transform");var Hash=require("./hash");var bindHandlers=require("./bind_handlers");var Camera=require("./camera");var LngLat=require("../geo/lng_lat");var LngLatBounds=require("../geo/lng_lat_bounds");var Point=require("point-geometry");var AttributionControl=require("./control/attribution_control");var isSupported=require("mapbox-gl-supported");var defaultMinZoom=0;var defaultMaxZoom=20;var defaultOptions={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:defaultMinZoom,maxZoom:defaultMaxZoom,interactive:true,scrollZoom:true,boxZoom:true,dragRotate:true,dragPan:true,keyboard:true,doubleClickZoom:true,touchZoomRotate:true,bearingSnap:7,hash:false,attributionControl:true,failIfMajorPerformanceCaveat:false,preserveDrawingBuffer:false,trackResize:true,renderWorldCopies:true};var Map=function(Camera){function Map(options){var this$1=this;options=util.extend({},defaultOptions,options);var transform=new Transform(options.minZoom,options.maxZoom,options.renderWorldCopies);Camera.call(this,transform,options);this._interactive=options.interactive;this._failIfMajorPerformanceCaveat=options.failIfMajorPerformanceCaveat;this._preserveDrawingBuffer=options.preserveDrawingBuffer;this._trackResize=options.trackResize;this._bearingSnap=options.bearingSnap;if(typeof options.container==="string"){this._container=window.document.getElementById(options.container);if(!this._container)throw new Error("Container '"+options.container+"' not found.")}else{this._container=options.container}this.animationLoop=new AnimationLoop;if(options.maxBounds){this.setMaxBounds(options.maxBounds)}util.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this);this._setupContainer();this._setupPainter();this.on("move",this._update.bind(this,false));this.on("zoom",this._update.bind(this,true));this.on("moveend",function(){this$1.animationLoop.set(300);this$1._rerender()});if(typeof window!=="undefined"){window.addEventListener("online",this._onWindowOnline,false);window.addEventListener("resize",this._onWindowResize,false)}bindHandlers(this,options);this._hash=options.hash&&(new Hash).addTo(this);if(!this._hash||!this._hash._onHashChange()){this.jumpTo({center:options.center,zoom:options.zoom,bearing:options.bearing,pitch:options.pitch})}this._classes=[];this.resize();if(options.classes)this.setClasses(options.classes);if(options.style)this.setStyle(options.style);if(options.attributionControl)this.addControl(new AttributionControl);this.on("style.load",function(){if(this.transform.unmodified){this.jumpTo(this.style.stylesheet)}this.style.update(this._classes,{transition:false})});this.on("data",this._onData);this.on("dataloading",this._onDataLoading)}if(Camera)Map.__proto__=Camera;Map.prototype=Object.create(Camera&&Camera.prototype);Map.prototype.constructor=Map;var prototypeAccessors={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};Map.prototype.addControl=function addControl(control,position){if(position===undefined&&control.getDefaultPosition){position=control.getDefaultPosition()}if(position===undefined){position="top-right"}var controlElement=control.onAdd(this);var positionContainer=this._controlPositions[position];if(position.indexOf("bottom")!==-1){positionContainer.insertBefore(controlElement,positionContainer.firstChild)}else{positionContainer.appendChild(controlElement)}return this};Map.prototype.removeControl=function removeControl(control){control.onRemove(this);return this};Map.prototype.addClass=function addClass(klass,options){util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");if(this._classes.indexOf(klass)>=0||klass==="")return this;this._classes.push(klass);this._classOptions=options;if(this.style)this.style.updateClasses();return this._update(true)};Map.prototype.removeClass=function removeClass(klass,options){util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");var i=this._classes.indexOf(klass);if(i<0||klass==="")return this;this._classes.splice(i,1);this._classOptions=options;if(this.style)this.style.updateClasses();return this._update(true)};Map.prototype.setClasses=function setClasses(klasses,options){util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");var uniqueClasses={};for(var i=0;i<klasses.length;i++){if(klasses[i]!=="")uniqueClasses[klasses[i]]=true}this._classes=Object.keys(uniqueClasses);this._classOptions=options;if(this.style)this.style.updateClasses();return this._update(true)};Map.prototype.hasClass=function hasClass(klass){util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");return this._classes.indexOf(klass)>=0};Map.prototype.getClasses=function getClasses(){util.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");return this._classes};Map.prototype.resize=function resize(){var dimensions=this._containerDimensions();var width=dimensions[0];var height=dimensions[1];this._resizeCanvas(width,height);this.transform.resize(width,height);this.painter.resize(width,height);var gl=this.painter.gl;var maxSize=gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)/2;if(this._canvas.width>maxSize||this._canvas.height>maxSize){util.warnOnce("Map is larger than maximum size supported by this system "+"("+maxSize+"px by "+maxSize+"px).")}return this.fire("movestart").fire("move").fire("resize").fire("moveend")};Map.prototype.getBounds=function getBounds(){var bounds=new LngLatBounds(this.transform.pointLocation(new Point(0,this.transform.height)),this.transform.pointLocation(new Point(this.transform.width,0)));if(this.transform.angle||this.transform.pitch){bounds.extend(this.transform.pointLocation(new Point(this.transform.size.x,0)));bounds.extend(this.transform.pointLocation(new Point(0,this.transform.size.y)))}return bounds};Map.prototype.setMaxBounds=function setMaxBounds(lnglatbounds){if(lnglatbounds){var b=LngLatBounds.convert(lnglatbounds);this.transform.lngRange=[b.getWest(),b.getEast()];this.transform.latRange=[b.getSouth(),b.getNorth()];this.transform._constrain();this._update()}else if(lnglatbounds===null||lnglatbounds===undefined){this.transform.lngRange=[];this.transform.latRange=[];this._update()}return this};Map.prototype.setMinZoom=function setMinZoom(minZoom){minZoom=minZoom===null||minZoom===undefined?defaultMinZoom:minZoom;if(minZoom>=defaultMinZoom&&minZoom<=this.transform.maxZoom){this.transform.minZoom=minZoom;this._update();if(this.getZoom()<minZoom)this.setZoom(minZoom);return this}else throw new Error("minZoom must be between "+defaultMinZoom+" and the current maxZoom, inclusive")};Map.prototype.getMinZoom=function getMinZoom(){return this.transform.minZoom};Map.prototype.setMaxZoom=function setMaxZoom(maxZoom){maxZoom=maxZoom===null||maxZoom===undefined?defaultMaxZoom:maxZoom;if(maxZoom>=this.transform.minZoom){this.transform.maxZoom=maxZoom;this._update();if(this.getZoom()>maxZoom)this.setZoom(maxZoom);return this}else throw new Error("maxZoom must be greater than the current minZoom")};Map.prototype.getMaxZoom=function getMaxZoom(){return this.transform.maxZoom};Map.prototype.project=function project(lnglat){return this.transform.locationPoint(LngLat.convert(lnglat))};Map.prototype.unproject=function unproject(point){return this.transform.pointLocation(Point.convert(point))};Map.prototype.queryRenderedFeatures=function queryRenderedFeatures(){var params={};var geometry;if(arguments.length===2){geometry=arguments[0];params=arguments[1]}else if(arguments.length===1&&isPointLike(arguments[0])){geometry=arguments[0]}else if(arguments.length===1){params=arguments[0]}return this.style.queryRenderedFeatures(this._makeQueryGeometry(geometry),params,this.transform.zoom,this.transform.angle);function isPointLike(input){return input instanceof Point||Array.isArray(input)}};Map.prototype._makeQueryGeometry=function _makeQueryGeometry(pointOrBox){var this$1=this;if(pointOrBox===undefined){pointOrBox=[Point.convert([0,0]),Point.convert([this.transform.width,this.transform.height])]}var queryGeometry;var isPoint=pointOrBox instanceof Point||typeof pointOrBox[0]==="number";if(isPoint){var point=Point.convert(pointOrBox);queryGeometry=[point]}else{var box=[Point.convert(pointOrBox[0]),Point.convert(pointOrBox[1])];queryGeometry=[box[0],new Point(box[1].x,box[0].y),box[1],new Point(box[0].x,box[1].y),box[0]]}queryGeometry=queryGeometry.map(function(p){return this$1.transform.pointCoordinate(p)});return queryGeometry};Map.prototype.querySourceFeatures=function querySourceFeatures(sourceID,parameters){return this.style.querySourceFeatures(sourceID,parameters)};Map.prototype.setStyle=function setStyle(style,options){var shouldTryDiff=(!options||options.diff!==false)&&this.style&&style&&!(style instanceof Style)&&typeof style!=="string";if(shouldTryDiff){try{if(this.style.setState(style)){this._update(true)}return this}catch(e){util.warnOnce("Unable to perform style diff: "+(e.message||e.error||e)+".  Rebuilding the style from scratch.")}}if(this.style){this.style.setEventedParent(null);this.style._remove();this.off("rotate",this.style._redoPlacement);this.off("pitch",this.style._redoPlacement)}if(!style){this.style=null;return this}else if(style instanceof Style){this.style=style}else{this.style=new Style(style,this)}this.style.setEventedParent(this,{style:this.style});this.on("rotate",this.style._redoPlacement);this.on("pitch",this.style._redoPlacement);return this};Map.prototype.getStyle=function getStyle(){if(this.style){return this.style.serialize()}};Map.prototype.addSource=function addSource(id,source){this.style.addSource(id,source);this._update(true);return this};Map.prototype.isSourceLoaded=function isSourceLoaded(id){var source=this.style&&this.style.sourceCaches[id];if(source===undefined){this.fire("error",{error:new Error("There is no source with ID '"+id+"'")});return}return source.loaded()};Map.prototype.addSourceType=function addSourceType(name,SourceType,callback){return this.style.addSourceType(name,SourceType,callback)};Map.prototype.removeSource=function removeSource(id){this.style.removeSource(id);this._update(true);return this};Map.prototype.getSource=function getSource(id){return this.style.getSource(id)};Map.prototype.addLayer=function addLayer(layer,before){this.style.addLayer(layer,before);this._update(true);return this};Map.prototype.moveLayer=function moveLayer(id,beforeId){this.style.moveLayer(id,beforeId);this._update(true);return this};Map.prototype.removeLayer=function removeLayer(id){this.style.removeLayer(id);this._update(true);return this};Map.prototype.getLayer=function getLayer(id){return this.style.getLayer(id)};Map.prototype.setFilter=function setFilter(layer,filter){this.style.setFilter(layer,filter);this._update(true);return this};Map.prototype.setLayerZoomRange=function setLayerZoomRange(layerId,minzoom,maxzoom){this.style.setLayerZoomRange(layerId,minzoom,maxzoom);this._update(true);return this};Map.prototype.getFilter=function getFilter(layer){return this.style.getFilter(layer)};Map.prototype.setPaintProperty=function setPaintProperty(layer,name,value,klass){this.style.setPaintProperty(layer,name,value,klass);this._update(true);return this};Map.prototype.getPaintProperty=function getPaintProperty(layer,name,klass){return this.style.getPaintProperty(layer,name,klass)};Map.prototype.setLayoutProperty=function setLayoutProperty(layer,name,value){this.style.setLayoutProperty(layer,name,value);this._update(true);return this};Map.prototype.getLayoutProperty=function getLayoutProperty(layer,name){return this.style.getLayoutProperty(layer,name)};Map.prototype.setLight=function setLight(lightOptions){this.style.setLight(lightOptions);this._update(true);return this};Map.prototype.getLight=function getLight(){return this.style.getLight()};Map.prototype.getContainer=function getContainer(){return this._container};Map.prototype.getCanvasContainer=function getCanvasContainer(){return this._canvasContainer};Map.prototype.getCanvas=function getCanvas(){return this._canvas};Map.prototype._containerDimensions=function _containerDimensions(){var width=0;var height=0;if(this._container){width=this._container.offsetWidth||400;height=this._container.offsetHeight||300}return[width,height]};Map.prototype._setupContainer=function _setupContainer(){var container=this._container;container.classList.add("mapboxgl-map");var canvasContainer=this._canvasContainer=DOM.create("div","mapboxgl-canvas-container",container);if(this._interactive){canvasContainer.classList.add("mapboxgl-interactive")}this._canvas=DOM.create("canvas","mapboxgl-canvas",canvasContainer);this._canvas.style.position="absolute";this._canvas.addEventListener("webglcontextlost",this._contextLost,false);this._canvas.addEventListener("webglcontextrestored",this._contextRestored,false);this._canvas.setAttribute("tabindex",0);this._canvas.setAttribute("aria-label","Map");var dimensions=this._containerDimensions();this._resizeCanvas(dimensions[0],dimensions[1]);var controlContainer=this._controlContainer=DOM.create("div","mapboxgl-control-container",container);var positions=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(positionName){positions[positionName]=DOM.create("div","mapboxgl-ctrl-"+positionName,controlContainer)})};Map.prototype._resizeCanvas=function _resizeCanvas(width,height){var pixelRatio=window.devicePixelRatio||1;this._canvas.width=pixelRatio*width;this._canvas.height=pixelRatio*height;this._canvas.style.width=width+"px";this._canvas.style.height=height+"px"};Map.prototype._setupPainter=function _setupPainter(){var attributes=util.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},isSupported.webGLContextAttributes);var gl=this._canvas.getContext("webgl",attributes)||this._canvas.getContext("experimental-webgl",attributes);if(!gl){this.fire("error",{error:new Error("Failed to initialize WebGL")});return}this.painter=new Painter(gl,this.transform)};Map.prototype._contextLost=function _contextLost(event){event.preventDefault();if(this._frameId){browser.cancelFrame(this._frameId)}this.fire("webglcontextlost",{originalEvent:event})};Map.prototype._contextRestored=function _contextRestored(event){this._setupPainter();this.resize();this._update();this.fire("webglcontextrestored",{originalEvent:event})};Map.prototype.loaded=function loaded(){if(this._styleDirty||this._sourcesDirty)return false;if(!this.style||!this.style.loaded())return false;return true};Map.prototype._update=function _update(updateStyle){if(!this.style)return this;this._styleDirty=this._styleDirty||updateStyle;this._sourcesDirty=true;this._rerender();return this};Map.prototype._render=function _render(){if(this.style&&this._styleDirty){this._styleDirty=false;this.style.update(this._classes,this._classOptions);this._classOptions=null;this.style._recalculate(this.transform.zoom)}if(this.style&&this._sourcesDirty){this._sourcesDirty=false;this.style._updateSources(this.transform)}this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming});this.fire("render");if(this.loaded()&&!this._loaded){this._loaded=true;this.fire("load")}this._frameId=null;if(!this.animationLoop.stopped()){this._styleDirty=true}if(this._sourcesDirty||this._repaint||this._styleDirty){this._rerender()}return this};Map.prototype.remove=function remove(){if(this._hash)this._hash.remove();browser.cancelFrame(this._frameId);this.setStyle(null);if(typeof window!=="undefined"){window.removeEventListener("resize",this._onWindowResize,false)}var extension=this.painter.gl.getExtension("WEBGL_lose_context");if(extension)extension.loseContext();removeNode(this._canvasContainer);removeNode(this._controlContainer);this._container.classList.remove("mapboxgl-map");this.fire("remove")};Map.prototype._rerender=function _rerender(){if(this.style&&!this._frameId){this._frameId=browser.frame(this._render)}};Map.prototype._onWindowOnline=function _onWindowOnline(){this._update()};Map.prototype._onWindowResize=function _onWindowResize(){if(this._trackResize){this.stop().resize()._update()}};prototypeAccessors.showTileBoundaries.get=function(){return!!this._showTileBoundaries};prototypeAccessors.showTileBoundaries.set=function(value){if(this._showTileBoundaries===value)return;this._showTileBoundaries=value;this._update()};prototypeAccessors.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes};prototypeAccessors.showCollisionBoxes.set=function(value){if(this._showCollisionBoxes===value)return;this._showCollisionBoxes=value;this.style._redoPlacement()};prototypeAccessors.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector};prototypeAccessors.showOverdrawInspector.set=function(value){if(this._showOverdrawInspector===value)return;this._showOverdrawInspector=value;this._update()};prototypeAccessors.repaint.get=function(){return!!this._repaint};prototypeAccessors.repaint.set=function(value){this._repaint=value;this._update()};prototypeAccessors.vertices.get=function(){return!!this._vertices};prototypeAccessors.vertices.set=function(value){this._vertices=value;this._update()};Map.prototype._onData=function _onData(event){this._update(event.dataType==="style");this.fire(event.dataType+"data",event)};Map.prototype._onDataLoading=function _onDataLoading(event){this.fire(event.dataType+"dataloading",event)};Object.defineProperties(Map.prototype,prototypeAccessors);return Map}(Camera);module.exports=Map;function removeNode(node){if(node.parentNode){node.parentNode.removeChild(node)}}},{"../geo/lng_lat":102,"../geo/lng_lat_bounds":103,"../geo/transform":104,"../render/painter":119,"../style/animation_loop":142,"../style/style":146,"../util/browser":193,"../util/dom":200,"../util/util":212,"../util/window":195,"./bind_handlers":174,"./camera":175,"./control/attribution_control":176,"./hash":187,"mapbox-gl-supported":83,"point-geometry":223}],189:[function(require,module,exports){"use strict";var DOM=require("../util/dom");var LngLat=require("../geo/lng_lat");var Point=require("point-geometry");var Marker=function Marker(element,options){this._offset=Point.convert(options&&options.offset||[0,0]);this._update=this._update.bind(this);this._onMapClick=this._onMapClick.bind(this);if(!element)element=DOM.create("div");element.classList.add("mapboxgl-marker");this._element=element;this._popup=null};Marker.prototype.addTo=function addTo(map){this.remove();this._map=map;map.getCanvasContainer().appendChild(this._element);map.on("move",this._update);map.on("moveend",this._update);this._update();this._map.on("click",this._onMapClick);return this};Marker.prototype.remove=function remove(){if(this._map){this._map.off("click",this._onMapClick);this._map.off("move",this._update);this._map.off("moveend",this._update);this._map=null}DOM.remove(this._element);if(this._popup)this._popup.remove();return this};Marker.prototype.getLngLat=function getLngLat(){return this._lngLat};Marker.prototype.setLngLat=function setLngLat(lnglat){this._lngLat=LngLat.convert(lnglat);if(this._popup)this._popup.setLngLat(this._lngLat);this._update();return this};Marker.prototype.getElement=function getElement(){return this._element};Marker.prototype.setPopup=function setPopup(popup){if(this._popup){this._popup.remove();this._popup=null}if(popup){this._popup=popup;this._popup.setLngLat(this._lngLat)}return this};Marker.prototype._onMapClick=function _onMapClick(event){var targetElement=event.originalEvent.target;var element=this._element;if(this._popup&&(targetElement===element||element.contains(targetElement))){this.togglePopup()}};Marker.prototype.getPopup=function getPopup(){return this._popup};Marker.prototype.togglePopup=function togglePopup(){var popup=this._popup;if(!popup)return;else if(popup.isOpen())popup.remove();else popup.addTo(this._map)};Marker.prototype._update=function _update(e){if(!this._map)return;var pos=this._map.project(this._lngLat)._add(this._offset);if(!e||e.type==="moveend")pos=pos.round();DOM.setTransform(this._element,"translate("+pos.x+"px, "+pos.y+"px)")};module.exports=Marker},{"../geo/lng_lat":102,"../util/dom":200,"point-geometry":223}],190:[function(require,module,exports){"use strict";var util=require("../util/util");var Evented=require("../util/evented");var DOM=require("../util/dom");var LngLat=require("../geo/lng_lat");var Point=require("point-geometry");var window=require("../util/window");var defaultOptions={closeButton:true,closeOnClick:true};var Popup=function(Evented){function Popup(options){Evented.call(this);this.options=util.extend(Object.create(defaultOptions),options);util.bindAll(["_update","_onClickClose"],this)}if(Evented)Popup.__proto__=Evented;Popup.prototype=Object.create(Evented&&Evented.prototype);Popup.prototype.constructor=Popup;Popup.prototype.addTo=function addTo(map){this._map=map;this._map.on("move",this._update);if(this.options.closeOnClick){this._map.on("click",this._onClickClose)}this._update();return this};Popup.prototype.isOpen=function isOpen(){return!!this._map};Popup.prototype.remove=function remove(){if(this._content&&this._content.parentNode){this._content.parentNode.removeChild(this._content)}if(this._container){this._container.parentNode.removeChild(this._container);delete this._container}if(this._map){this._map.off("move",this._update);this._map.off("click",this._onClickClose);delete this._map}this.fire("close");return this};Popup.prototype.getLngLat=function getLngLat(){return this._lngLat};Popup.prototype.setLngLat=function setLngLat(lnglat){this._lngLat=LngLat.convert(lnglat);this._update();return this};Popup.prototype.setText=function setText(text){return this.setDOMContent(window.document.createTextNode(text))};Popup.prototype.setHTML=function setHTML(html){var frag=window.document.createDocumentFragment();var temp=window.document.createElement("body");var child;temp.innerHTML=html;while(true){child=temp.firstChild;if(!child)break;frag.appendChild(child)}return this.setDOMContent(frag)};Popup.prototype.setDOMContent=function setDOMContent(htmlNode){this._createContent();this._content.appendChild(htmlNode);this._update();return this};Popup.prototype._createContent=function _createContent(){if(this._content&&this._content.parentNode){this._content.parentNode.removeChild(this._content)}this._content=DOM.create("div","mapboxgl-popup-content",this._container);if(this.options.closeButton){this._closeButton=DOM.create("button","mapboxgl-popup-close-button",this._content);this._closeButton.type="button";this._closeButton.innerHTML="&#215;";this._closeButton.addEventListener("click",this._onClickClose)}};Popup.prototype._update=function _update(){if(!this._map||!this._lngLat||!this._content){return}if(!this._container){this._container=DOM.create("div","mapboxgl-popup",this._map.getContainer());this._tip=DOM.create("div","mapboxgl-popup-tip",this._container);this._container.appendChild(this._content)}var anchor=this.options.anchor;var offset=normalizeOffset(this.options.offset);var pos=this._map.project(this._lngLat).round();if(!anchor){var width=this._container.offsetWidth,height=this._container.offsetHeight;if(pos.y+offset.bottom.y<height){anchor=["top"]}else if(pos.y>this._map.transform.height-height){anchor=["bottom"]}else{anchor=[]}if(pos.x<width/2){anchor.push("left")}else if(pos.x>this._map.transform.width-width/2){anchor.push("right")}if(anchor.length===0){anchor="bottom"}else{anchor=anchor.join("-")}}var offsetedPos=pos.add(offset[anchor]);var anchorTranslate={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};var classList=this._container.classList;for(var key in anchorTranslate){classList.remove("mapboxgl-popup-anchor-"+key)}classList.add("mapboxgl-popup-anchor-"+anchor);DOM.setTransform(this._container,anchorTranslate[anchor]+" translate("+offsetedPos.x+"px,"+offsetedPos.y+"px)")};Popup.prototype._onClickClose=function _onClickClose(){this.remove()};return Popup}(Evented);function normalizeOffset(offset){if(!offset){return normalizeOffset(new Point(0,0))}else if(typeof offset==="number"){var cornerOffset=Math.round(Math.sqrt(.5*Math.pow(offset,2)));return{top:new Point(0,offset),"top-left":new Point(cornerOffset,cornerOffset),"top-right":new Point(-cornerOffset,cornerOffset),bottom:new Point(0,-offset),"bottom-left":new Point(cornerOffset,-cornerOffset),"bottom-right":new Point(-cornerOffset,-cornerOffset),left:new Point(offset,0),right:new Point(-offset,0)}}else if(isPointLike(offset)){var convertedOffset=Point.convert(offset);return{top:convertedOffset,"top-left":convertedOffset,"top-right":convertedOffset,bottom:convertedOffset,"bottom-left":convertedOffset,"bottom-right":convertedOffset,left:convertedOffset,right:convertedOffset}}else{return{top:Point.convert(offset["top"]||[0,0]),"top-left":Point.convert(offset["top-left"]||[0,0]),"top-right":Point.convert(offset["top-right"]||[0,0]),bottom:Point.convert(offset["bottom"]||[0,0]),"bottom-left":Point.convert(offset["bottom-left"]||[0,0]),"bottom-right":Point.convert(offset["bottom-right"]||[0,0]),left:Point.convert(offset["left"]||[0,0]),right:Point.convert(offset["right"]||[0,0])}}}function isPointLike(input){return input instanceof Point||Array.isArray(input)}module.exports=Popup},{"../geo/lng_lat":102,"../util/dom":200,"../util/evented":201,"../util/util":212,"../util/window":195,"point-geometry":223}],191:[function(require,module,exports){"use strict";var Actor=function Actor(target,parent,mapId){this.target=target;this.parent=parent;this.mapId=mapId;this.callbacks={};this.callbackID=0;this.receive=this.receive.bind(this);this.target.addEventListener("message",this.receive,false)};Actor.prototype.send=function send(type,data,callback,buffers,targetMapId){var id=callback?this.mapId+":"+this.callbackID++:null;if(callback)this.callbacks[id]=callback;this.target.postMessage({targetMapId:targetMapId,sourceMapId:this.mapId,type:type,id:String(id),data:data},buffers)};Actor.prototype.receive=function receive(message){var this$1=this;var data=message.data,id=data.id;var callback;if(data.targetMapId&&this.mapId!==data.targetMapId)return;var done=function(err,data,buffers){this$1.target.postMessage({sourceMapId:this$1.mapId,type:"<response>",id:String(id),error:err?String(err):null,data:data},buffers)};if(data.type==="<response>"){callback=this.callbacks[data.id];delete this.callbacks[data.id];if(callback)callback(data.error||null,data.data)}else if(typeof data.id!=="undefined"&&this.parent[data.type]){this.parent[data.type](data.sourceMapId,data.data,done)}else if(typeof data.id!=="undefined"&&this.parent.getWorkerSource){var keys=data.type.split(".");var workerSource=this.parent.getWorkerSource(data.sourceMapId,keys[0]);workerSource[keys[1]](data.data,done)}else{this.parent[data.type](data.data)}};Actor.prototype.remove=function remove(){this.target.removeEventListener("message",this.receive,false)};module.exports=Actor},{}],192:[function(require,module,exports){"use strict";var window=require("./window");exports.getJSON=function(url,callback){var xhr=new window.XMLHttpRequest;xhr.open("GET",url,true);xhr.setRequestHeader("Accept","application/json");xhr.onerror=function(e){callback(e)};xhr.onload=function(){if(xhr.status>=200&&xhr.status<300&&xhr.response){var data;try{data=JSON.parse(xhr.response)}catch(err){return callback(err)}callback(null,data)}else{callback(new Error(xhr.statusText))}};xhr.send();return xhr};exports.getArrayBuffer=function(url,callback){var xhr=new window.XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onerror=function(e){callback(e)};xhr.onload=function(){if(xhr.response.byteLength===0&&xhr.status===200){return callback(new Error("http status 200 returned without content."));

}if(xhr.status>=200&&xhr.status<300&&xhr.response){callback(null,{data:xhr.response,cacheControl:xhr.getResponseHeader("Cache-Control"),expires:xhr.getResponseHeader("Expires")})}else{callback(new Error(xhr.statusText))}};xhr.send();return xhr};function sameOrigin(url){var a=window.document.createElement("a");a.href=url;return a.protocol===window.document.location.protocol&&a.host===window.document.location.host}var transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";exports.getImage=function(url,callback){return exports.getArrayBuffer(url,function(err,imgData){if(err)return callback(err);var img=new window.Image;var URL=window.URL||window.webkitURL;img.onload=function(){callback(null,img);URL.revokeObjectURL(img.src)};var blob=new window.Blob([new Uint8Array(imgData.data)],{type:"image/png"});img.cacheControl=imgData.cacheControl;img.expires=imgData.expires;img.src=imgData.data.byteLength?URL.createObjectURL(blob):transparentPngUrl})};exports.getVideo=function(urls,callback){var video=window.document.createElement("video");video.onloadstart=function(){callback(null,video)};for(var i=0;i<urls.length;i++){var s=window.document.createElement("source");if(!sameOrigin(urls[i])){video.crossOrigin="Anonymous"}s.src=urls[i];video.appendChild(s)}return video}},{"./window":195}],193:[function(require,module,exports){"use strict";var window=require("./window");module.exports.now=function(){if(window.performance&&window.performance.now){return window.performance.now.bind(window.performance)}else{return Date.now.bind(Date)}}();var frame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;exports.frame=function(fn){return frame(fn)};var cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;exports.cancelFrame=function(id){cancel(id)};exports.timed=function(fn,dur,ctx){if(!dur){fn.call(ctx,1);return null}var abort=false;var start=module.exports.now();function tick(now){if(abort)return;now=module.exports.now();if(now>=start+dur){fn.call(ctx,1)}else{fn.call(ctx,(now-start)/dur);exports.frame(tick)}}exports.frame(tick);return function(){abort=true}};exports.getImageData=function(img){var canvas=window.document.createElement("canvas");var context=canvas.getContext("2d");canvas.width=img.width;canvas.height=img.height;context.drawImage(img,0,0);return context.getImageData(0,0,img.width,img.height).data};exports.supported=require("mapbox-gl-supported");exports.hardwareConcurrency=window.navigator.hardwareConcurrency||4;Object.defineProperty(exports,"devicePixelRatio",{get:function(){return window.devicePixelRatio}});exports.supportsWebp=false;var webpImgTest=window.document.createElement("img");webpImgTest.onload=function(){exports.supportsWebp=true};webpImgTest.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":195,"mapbox-gl-supported":83}],194:[function(require,module,exports){"use strict";var WebWorkify=require("webworkify");var window=require("../window");var workerURL=window.URL.createObjectURL(new WebWorkify(require("../../source/worker"),{bare:true}));module.exports=function(){return new window.Worker(workerURL)}},{"../../source/worker":140,"../window":195,webworkify:566}],195:[function(require,module,exports){"use strict";module.exports=self},{}],196:[function(require,module,exports){"use strict";var quickselect=require("quickselect");var calculateSignedArea=require("./util").calculateSignedArea;module.exports=function classifyRings(rings,maxRings){var len=rings.length;if(len<=1)return[rings];var polygons=[];var polygon,ccw;for(var i=0;i<len;i++){var area=calculateSignedArea(rings[i]);if(area===0)continue;rings[i].area=Math.abs(area);if(ccw===undefined)ccw=area<0;if(ccw===area<0){if(polygon)polygons.push(polygon);polygon=[rings[i]]}else{polygon.push(rings[i])}}if(polygon)polygons.push(polygon);if(maxRings>1){for(var j=0;j<polygons.length;j++){if(polygons[j].length<=maxRings)continue;quickselect(polygons[j],maxRings,1,polygons[j].length-1,compareAreas);polygons[j]=polygons[j].slice(0,maxRings)}}return polygons};function compareAreas(a,b){return b.area-a.area}},{"./util":212,quickselect:225}],197:[function(require,module,exports){"use strict";var config={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:true,ACCESS_TOKEN:null};module.exports=config},{}],198:[function(require,module,exports){"use strict";var DictionaryCoder=function DictionaryCoder(strings){var this$1=this;this._stringToNumber={};this._numberToString=[];for(var i=0;i<strings.length;i++){var string=strings[i];this$1._stringToNumber[string]=i;this$1._numberToString[i]=string}};DictionaryCoder.prototype.encode=function encode(string){return this._stringToNumber[string]};DictionaryCoder.prototype.decode=function decode(n){return this._numberToString[n]};module.exports=DictionaryCoder},{}],199:[function(require,module,exports){"use strict";var util=require("./util");var Actor=require("./actor");var Dispatcher=function Dispatcher(workerPool,parent){var this$1=this;this.workerPool=workerPool;this.actors=[];this.currentActor=0;this.id=util.uniqueId();var workers=this.workerPool.acquire(this.id);for(var i=0;i<workers.length;i++){var worker=workers[i];var actor=new Actor(worker,parent,this$1.id);actor.name="Worker "+i;this$1.actors.push(actor)}};Dispatcher.prototype.broadcast=function broadcast(type,data,cb){cb=cb||function(){};util.asyncAll(this.actors,function(actor,done){actor.send(type,data,done)},cb)};Dispatcher.prototype.send=function send(type,data,callback,targetID,buffers){if(typeof targetID!=="number"||isNaN(targetID)){targetID=this.currentActor=(this.currentActor+1)%this.actors.length}this.actors[targetID].send(type,data,callback,buffers);return targetID};Dispatcher.prototype.remove=function remove(){this.actors.forEach(function(actor){actor.remove()});this.actors=[];this.workerPool.release(this.id)};module.exports=Dispatcher},{"./actor":191,"./util":212}],200:[function(require,module,exports){"use strict";var Point=require("point-geometry");var window=require("./window");exports.create=function(tagName,className,container){var el=window.document.createElement(tagName);if(className)el.className=className;if(container)container.appendChild(el);return el};var docStyle=window.document.documentElement.style;function testProp(props){for(var i=0;i<props.length;i++){if(props[i]in docStyle){return props[i]}}return props[0]}var selectProp=testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);var userSelect;exports.disableDrag=function(){if(selectProp){userSelect=docStyle[selectProp];docStyle[selectProp]="none"}};exports.enableDrag=function(){if(selectProp){docStyle[selectProp]=userSelect}};var transformProp=testProp(["transform","WebkitTransform"]);exports.setTransform=function(el,value){el.style[transformProp]=value};function suppressClick(e){e.preventDefault();e.stopPropagation();window.removeEventListener("click",suppressClick,true)}exports.suppressClick=function(){window.addEventListener("click",suppressClick,true);window.setTimeout(function(){window.removeEventListener("click",suppressClick,true)},0)};exports.mousePos=function(el,e){var rect=el.getBoundingClientRect();e=e.touches?e.touches[0]:e;return new Point(e.clientX-rect.left-el.clientLeft,e.clientY-rect.top-el.clientTop)};exports.touchPos=function(el,e){var rect=el.getBoundingClientRect(),points=[];var touches=e.type==="touchend"?e.changedTouches:e.touches;for(var i=0;i<touches.length;i++){points.push(new Point(touches[i].clientX-rect.left-el.clientLeft,touches[i].clientY-rect.top-el.clientTop))}return points};exports.remove=function(node){if(node.parentNode){node.parentNode.removeChild(node)}}},{"./window":195,"point-geometry":223}],201:[function(require,module,exports){"use strict";var util=require("./util");var Evented=function Evented(){};Evented.prototype.on=function on(type,listener){this._listeners=this._listeners||{};this._listeners[type]=this._listeners[type]||[];this._listeners[type].push(listener);return this};Evented.prototype.off=function off(type,listener){if(this._listeners&&this._listeners[type]){var index=this._listeners[type].indexOf(listener);if(index!==-1){this._listeners[type].splice(index,1)}}return this};Evented.prototype.once=function once(type,listener){var this$1=this;var wrapper=function(data){this$1.off(type,wrapper);listener.call(this$1,data)};this.on(type,wrapper);return this};Evented.prototype.fire=function fire(type,data){var this$1=this;if(this.listens(type)){data=util.extend({},data,{type:type,target:this});var listeners=this._listeners&&this._listeners[type]?this._listeners[type].slice():[];for(var i=0;i<listeners.length;i++){listeners[i].call(this$1,data)}if(this._eventedParent){this._eventedParent.fire(type,util.extend({},data,this._eventedParentData))}}else if(util.endsWith(type,"error")){console.error(data&&data.error||data||"Empty error event")}return this};Evented.prototype.listens=function listens(type){return this._listeners&&this._listeners[type]||this._eventedParent&&this._eventedParent.listens(type)};Evented.prototype.setEventedParent=function setEventedParent(parent,data){this._eventedParent=parent;this._eventedParentData=typeof data==="function"?data():data;return this};module.exports=Evented},{"./util":212}],202:[function(require,module,exports){"use strict";var Queue=require("tinyqueue");var Point=require("point-geometry");var distToSegmentSquared=require("./intersection_tests").distToSegmentSquared;module.exports=function(polygonRings,precision,debug){precision=precision||1;var minX,minY,maxX,maxY;var outerRing=polygonRings[0];for(var i=0;i<outerRing.length;i++){var p=outerRing[i];if(!i||p.x<minX)minX=p.x;if(!i||p.y<minY)minY=p.y;if(!i||p.x>maxX)maxX=p.x;if(!i||p.y>maxY)maxY=p.y}var width=maxX-minX;var height=maxY-minY;var cellSize=Math.min(width,height);var h=cellSize/2;var cellQueue=new Queue(null,compareMax);for(var x=minX;x<maxX;x+=cellSize){for(var y=minY;y<maxY;y+=cellSize){cellQueue.push(new Cell(x+h,y+h,h,polygonRings))}}var bestCell=getCentroidCell(polygonRings);var numProbes=cellQueue.length;while(cellQueue.length){var cell=cellQueue.pop();if(cell.d>bestCell.d){bestCell=cell;if(debug)console.log("found best %d after %d probes",Math.round(1e4*cell.d)/1e4,numProbes)}if(cell.max-bestCell.d<=precision)continue;h=cell.h/2;cellQueue.push(new Cell(cell.p.x-h,cell.p.y-h,h,polygonRings));cellQueue.push(new Cell(cell.p.x+h,cell.p.y-h,h,polygonRings));cellQueue.push(new Cell(cell.p.x-h,cell.p.y+h,h,polygonRings));cellQueue.push(new Cell(cell.p.x+h,cell.p.y+h,h,polygonRings));numProbes+=4}if(debug){console.log("num probes: "+numProbes);console.log("best distance: "+bestCell.d)}return bestCell.p};function compareMax(a,b){return b.max-a.max}function Cell(x,y,h,polygon){this.p=new Point(x,y);this.h=h;this.d=pointToPolygonDist(this.p,polygon);this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(p,polygon){var inside=false;var minDistSq=Infinity;for(var k=0;k<polygon.length;k++){var ring=polygon[k];for(var i=0,len=ring.length,j=len-1;i<len;j=i++){var a=ring[i];var b=ring[j];if(a.y>p.y!==b.y>p.y&&p.x<(b.x-a.x)*(p.y-a.y)/(b.y-a.y)+a.x)inside=!inside;minDistSq=Math.min(minDistSq,distToSegmentSquared(p,a,b))}}return(inside?1:-1)*Math.sqrt(minDistSq)}function getCentroidCell(polygon){var area=0;var x=0;var y=0;var points=polygon[0];for(var i=0,len=points.length,j=len-1;i<len;j=i++){var a=points[i];var b=points[j];var f=a.x*b.y-b.x*a.y;x+=(a.x+b.x)*f;y+=(a.y+b.y)*f;area+=f*3}return new Cell(x/area,y/area,0,polygon)}},{"./intersection_tests":205,"point-geometry":223,tinyqueue:553}],203:[function(require,module,exports){"use strict";module.exports=Glyphs;function Glyphs(pbf,end){this.stacks=pbf.readFields(readFontstacks,[],end)}function readFontstacks(tag,stacks,pbf){if(tag===1){var fontstack=pbf.readMessage(readFontstack,{glyphs:{}});stacks.push(fontstack)}}function readFontstack(tag,fontstack,pbf){if(tag===1)fontstack.name=pbf.readString();else if(tag===2)fontstack.range=pbf.readString();else if(tag===3){var glyph=pbf.readMessage(readGlyph,{});fontstack.glyphs[glyph.id]=glyph}}function readGlyph(tag,glyph,pbf){if(tag===1)glyph.id=pbf.readVarint();else if(tag===2)glyph.bitmap=pbf.readBytes();else if(tag===3)glyph.width=pbf.readVarint();else if(tag===4)glyph.height=pbf.readVarint();else if(tag===5)glyph.left=pbf.readSVarint();else if(tag===6)glyph.top=pbf.readSVarint();else if(tag===7)glyph.advance=pbf.readVarint()}},{}],204:[function(require,module,exports){"use strict";module.exports=interpolate;function interpolate(a,b,t){return a*(1-t)+b*t}interpolate.number=interpolate;interpolate.vec2=function(from,to,t){return[interpolate(from[0],to[0],t),interpolate(from[1],to[1],t)]};interpolate.color=function(from,to,t){return[interpolate(from[0],to[0],t),interpolate(from[1],to[1],t),interpolate(from[2],to[2],t),interpolate(from[3],to[3],t)]};interpolate.array=function(from,to,t){return from.map(function(d,i){return interpolate(d,to[i],t)})}},{}],205:[function(require,module,exports){"use strict";var isCounterClockwise=require("./util").isCounterClockwise;module.exports={multiPolygonIntersectsBufferedMultiPoint:multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon:multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine:multiPolygonIntersectsBufferedMultiLine,polygonIntersectsPolygon:polygonIntersectsPolygon,distToSegmentSquared:distToSegmentSquared};function polygonIntersectsPolygon(polygonA,polygonB){for(var i=0;i<polygonA.length;i++){if(polygonContainsPoint(polygonB,polygonA[i]))return true}for(var i$1=0;i$1<polygonB.length;i$1++){if(polygonContainsPoint(polygonA,polygonB[i$1]))return true}if(lineIntersectsLine(polygonA,polygonB))return true;return false}function multiPolygonIntersectsBufferedMultiPoint(multiPolygon,rings,radius){for(var j=0;j<multiPolygon.length;j++){var polygon=multiPolygon[j];for(var i=0;i<rings.length;i++){var ring=rings[i];for(var k=0;k<ring.length;k++){var point=ring[k];if(polygonContainsPoint(polygon,point))return true;if(pointIntersectsBufferedLine(point,polygon,radius))return true}}}return false}function multiPolygonIntersectsMultiPolygon(multiPolygonA,multiPolygonB){if(multiPolygonA.length===1&&multiPolygonA[0].length===1){return multiPolygonContainsPoint(multiPolygonB,multiPolygonA[0][0])}for(var m=0;m<multiPolygonB.length;m++){var ring=multiPolygonB[m];for(var n=0;n<ring.length;n++){if(multiPolygonContainsPoint(multiPolygonA,ring[n]))return true}}for(var j=0;j<multiPolygonA.length;j++){var polygon=multiPolygonA[j];for(var i=0;i<polygon.length;i++){if(multiPolygonContainsPoint(multiPolygonB,polygon[i]))return true}for(var k=0;k<multiPolygonB.length;k++){if(lineIntersectsLine(polygon,multiPolygonB[k]))return true}}return false}function multiPolygonIntersectsBufferedMultiLine(multiPolygon,multiLine,radius){for(var i=0;i<multiLine.length;i++){var line=multiLine[i];for(var j=0;j<multiPolygon.length;j++){var polygon=multiPolygon[j];if(polygon.length>=3){for(var k=0;k<line.length;k++){if(polygonContainsPoint(polygon,line[k]))return true}}if(lineIntersectsBufferedLine(polygon,line,radius))return true}}return false}function lineIntersectsBufferedLine(lineA,lineB,radius){if(lineA.length>1){if(lineIntersectsLine(lineA,lineB))return true;for(var j=0;j<lineB.length;j++){if(pointIntersectsBufferedLine(lineB[j],lineA,radius))return true}}for(var k=0;k<lineA.length;k++){if(pointIntersectsBufferedLine(lineA[k],lineB,radius))return true}return false}function lineIntersectsLine(lineA,lineB){if(lineA.length===0||lineB.length===0)return false;for(var i=0;i<lineA.length-1;i++){var a0=lineA[i];var a1=lineA[i+1];for(var j=0;j<lineB.length-1;j++){var b0=lineB[j];var b1=lineB[j+1];if(lineSegmentIntersectsLineSegment(a0,a1,b0,b1))return true}}return false}function lineSegmentIntersectsLineSegment(a0,a1,b0,b1){return isCounterClockwise(a0,b0,b1)!==isCounterClockwise(a1,b0,b1)&&isCounterClockwise(a0,a1,b0)!==isCounterClockwise(a0,a1,b1)}function pointIntersectsBufferedLine(p,line,radius){var radiusSquared=radius*radius;if(line.length===1)return p.distSqr(line[0])<radiusSquared;for(var i=1;i<line.length;i++){var v=line[i-1],w=line[i];if(distToSegmentSquared(p,v,w)<radiusSquared)return true}return false}function distToSegmentSquared(p,v,w){var l2=v.distSqr(w);if(l2===0)return p.distSqr(v);var t=((p.x-v.x)*(w.x-v.x)+(p.y-v.y)*(w.y-v.y))/l2;if(t<0)return p.distSqr(v);if(t>1)return p.distSqr(w);return p.distSqr(w.sub(v)._mult(t)._add(v))}function multiPolygonContainsPoint(rings,p){var c=false,ring,p1,p2;for(var k=0;k<rings.length;k++){ring=rings[k];for(var i=0,j=ring.length-1;i<ring.length;j=i++){p1=ring[i];p2=ring[j];if(p1.y>p.y!==p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x){c=!c}}}return c}function polygonContainsPoint(ring,p){var c=false;for(var i=0,j=ring.length-1;i<ring.length;j=i++){var p1=ring[i];var p2=ring[j];if(p1.y>p.y!==p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x){c=!c}}return c}},{"./util":212}],206:[function(require,module,exports){"use strict";var unicodeBlockLookup={"Latin-1 Supplement":function(char){return char>=128&&char<=255},"Hangul Jamo":function(char){return char>=4352&&char<=4607},"Unified Canadian Aboriginal Syllabics":function(char){return char>=5120&&char<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(char){return char>=6320&&char<=6399},"General Punctuation":function(char){return char>=8192&&char<=8303},"Letterlike Symbols":function(char){return char>=8448&&char<=8527},"Number Forms":function(char){return char>=8528&&char<=8591},"Miscellaneous Technical":function(char){return char>=8960&&char<=9215},"Control Pictures":function(char){return char>=9216&&char<=9279},"Optical Character Recognition":function(char){return char>=9280&&char<=9311},"Enclosed Alphanumerics":function(char){return char>=9312&&char<=9471},"Geometric Shapes":function(char){return char>=9632&&char<=9727},"Miscellaneous Symbols":function(char){return char>=9728&&char<=9983},"Miscellaneous Symbols and Arrows":function(char){return char>=11008&&char<=11263},"CJK Radicals Supplement":function(char){return char>=11904&&char<=12031},"Kangxi Radicals":function(char){return char>=12032&&char<=12255},"Ideographic Description Characters":function(char){return char>=12272&&char<=12287},"CJK Symbols and Punctuation":function(char){return char>=12288&&char<=12351},Hiragana:function(char){return char>=12352&&char<=12447},Katakana:function(char){return char>=12448&&char<=12543},Bopomofo:function(char){return char>=12544&&char<=12591},"Hangul Compatibility Jamo":function(char){return char>=12592&&char<=12687},Kanbun:function(char){return char>=12688&&char<=12703},"Bopomofo Extended":function(char){return char>=12704&&char<=12735},"CJK Strokes":function(char){return char>=12736&&char<=12783},"Katakana Phonetic Extensions":function(char){return char>=12784&&char<=12799},"Enclosed CJK Letters and Months":function(char){return char>=12800&&char<=13055},"CJK Compatibility":function(char){return char>=13056&&char<=13311},"CJK Unified Ideographs Extension A":function(char){return char>=13312&&char<=19903},"Yijing Hexagram Symbols":function(char){return char>=19904&&char<=19967},"CJK Unified Ideographs":function(char){return char>=19968&&char<=40959},"Yi Syllables":function(char){return char>=40960&&char<=42127},"Yi Radicals":function(char){return char>=42128&&char<=42191},"Hangul Jamo Extended-A":function(char){return char>=43360&&char<=43391},"Hangul Syllables":function(char){return char>=44032&&char<=55215},"Hangul Jamo Extended-B":function(char){return char>=55216&&char<=55295},"Private Use Area":function(char){return char>=57344&&char<=63743},"CJK Compatibility Ideographs":function(char){return char>=63744&&char<=64255},"Vertical Forms":function(char){return char>=65040&&char<=65055},"CJK Compatibility Forms":function(char){return char>=65072&&char<=65103},"Small Form Variants":function(char){return char>=65104&&char<=65135},"Halfwidth and Fullwidth Forms":function(char){return char>=65280&&char<=65519}};module.exports=unicodeBlockLookup},{}],207:[function(require,module,exports){"use strict";var LRUCache=function LRUCache(max,onRemove){this.max=max;this.onRemove=onRemove;this.reset()};LRUCache.prototype.reset=function reset(){var this$1=this;for(var key in this.data){this$1.onRemove(this$1.data[key])}this.data={};this.order=[];return this};LRUCache.prototype.add=function add(key,data){if(this.has(key)){this.order.splice(this.order.indexOf(key),1);this.data[key]=data;this.order.push(key)}else{this.data[key]=data;this.order.push(key);if(this.order.length>this.max){var removedData=this.get(this.order[0]);if(removedData)this.onRemove(removedData)}}return this};LRUCache.prototype.has=function has(key){return key in this.data};LRUCache.prototype.keys=function keys(){return this.order};LRUCache.prototype.get=function get(key){if(!this.has(key)){return null}var data=this.data[key];delete this.data[key];this.order.splice(this.order.indexOf(key),1);return data};LRUCache.prototype.remove=function remove(key){if(!this.has(key)){return this}var data=this.data[key];delete this.data[key];this.onRemove(data);this.order.splice(this.order.indexOf(key),1);return this};LRUCache.prototype.setMaxSize=function setMaxSize(max){var this$1=this;this.max=max;while(this.order.length>this.max){var removedData=this$1.get(this$1.order[0]);if(removedData)this$1.onRemove(removedData)}return this};module.exports=LRUCache},{}],208:[function(require,module,exports){"use strict";var config=require("./config");var browser=require("./browser");var help="See https://www.mapbox.com/developers/api/#access-tokens";function makeAPIURL(urlObject,accessToken){var apiUrlObject=parseUrl(config.API_URL);urlObject.protocol=apiUrlObject.protocol;urlObject.authority=apiUrlObject.authority;if(!config.REQUIRE_ACCESS_TOKEN)return formatUrl(urlObject);accessToken=accessToken||config.ACCESS_TOKEN;if(!accessToken)throw new Error("An API access token is required to use Mapbox GL. "+help);if(accessToken[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+help);urlObject.params.push("access_token="+accessToken);return formatUrl(urlObject)}function isMapboxURL(url){return url.indexOf("mapbox:")===0}exports.isMapboxURL=isMapboxURL;exports.normalizeStyleURL=function(url,accessToken){if(!isMapboxURL(url))return url;var urlObject=parseUrl(url);urlObject.path="/styles/v1"+urlObject.path;return makeAPIURL(urlObject,accessToken)};exports.normalizeGlyphsURL=function(url,accessToken){if(!isMapboxURL(url))return url;var urlObject=parseUrl(url);urlObject.path="/fonts/v1"+urlObject.path;return makeAPIURL(urlObject,accessToken)};exports.normalizeSourceURL=function(url,accessToken){if(!isMapboxURL(url))return url;var urlObject=parseUrl(url);urlObject.path="/v4/"+urlObject.authority+".json";urlObject.params.push("secure");return makeAPIURL(urlObject,accessToken)};exports.normalizeSpriteURL=function(url,format,extension,accessToken){var urlObject=parseUrl(url);if(!isMapboxURL(url)){urlObject.path+=""+format+extension;return formatUrl(urlObject)}urlObject.path="/styles/v1"+urlObject.path+"/sprite"+format+extension;return makeAPIURL(urlObject,accessToken)};var imageExtensionRe=/(\.(png|jpg)\d*)(?=$)/;exports.normalizeTileURL=function(tileURL,sourceURL,tileSize){if(!sourceURL||!isMapboxURL(sourceURL))return tileURL;var urlObject=parseUrl(tileURL);var suffix=browser.devicePixelRatio>=2||tileSize===512?"@2x":"";var extension=browser.supportsWebp?".webp":"$1";urlObject.path=urlObject.path.replace(imageExtensionRe,""+suffix+extension);replaceTempAccessToken(urlObject.params);return formatUrl(urlObject)};function replaceTempAccessToken(params){for(var i=0;i<params.length;i++){if(params[i].indexOf("access_token=tk.")===0){params[i]="access_token="+(config.ACCESS_TOKEN||"")}}}var urlRe=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/;function parseUrl(url){var parts=url.match(urlRe);if(!parts){throw new Error("Unable to parse URL object")}return{protocol:parts[1],authority:parts[2],path:parts[3]||"/",params:parts[4]?parts[4].split("&"):[]}}function formatUrl(obj){var params=obj.params.length?"?"+obj.params.join("&"):"";return obj.protocol+"://"+obj.authority+obj.path+params}},{"./browser":193,"./config":197}],209:[function(require,module,exports){"use strict";var isChar=require("./is_char_in_unicode_block");module.exports.allowsIdeographicBreaking=function(chars){for(var i=0,list=chars;i<list.length;i+=1){var char=list[i];if(!exports.charAllowsIdeographicBreaking(char.charCodeAt(0)))return false}return true};module.exports.allowsVerticalWritingMode=function(chars){for(var i=0,list=chars;i<list.length;i+=1){var char=list[i];if(exports.charHasUprightVerticalOrientation(char.charCodeAt(0)))return true}return false};module.exports.charAllowsIdeographicBreaking=function(char){if(char<11904)return false;if(isChar["Bopomofo Extended"](char))return true;if(isChar["Bopomofo"](char))return true;if(isChar["CJK Compatibility Forms"](char))return true;if(isChar["CJK Compatibility Ideographs"](char))return true;if(isChar["CJK Compatibility"](char))return true;if(isChar["CJK Radicals Supplement"](char))return true;if(isChar["CJK Strokes"](char))return true;if(isChar["CJK Symbols and Punctuation"](char))return true;if(isChar["CJK Unified Ideographs Extension A"](char))return true;if(isChar["CJK Unified Ideographs"](char))return true;if(isChar["Enclosed CJK Letters and Months"](char))return true;if(isChar["Halfwidth and Fullwidth Forms"](char))return true;if(isChar["Hiragana"](char))return true;if(isChar["Ideographic Description Characters"](char))return true;if(isChar["Kangxi Radicals"](char))return true;if(isChar["Katakana Phonetic Extensions"](char))return true;if(isChar["Katakana"](char))return true;if(isChar["Vertical Forms"](char))return true;if(isChar["Yi Radicals"](char))return true;if(isChar["Yi Syllables"](char))return true;return false};exports.charHasUprightVerticalOrientation=function(char){if(char===746||char===747){return true}if(char<4352)return false;if(isChar["Bopomofo Extended"](char))return true;if(isChar["Bopomofo"](char))return true;if(isChar["CJK Compatibility Forms"](char)){if(!(char>=65097&&char<=65103)){return true}}if(isChar["CJK Compatibility Ideographs"](char))return true;if(isChar["CJK Compatibility"](char))return true;if(isChar["CJK Radicals Supplement"](char))return true;if(isChar["CJK Strokes"](char))return true;if(isChar["CJK Symbols and Punctuation"](char)){if(!(char>=12296&&char<=12305)&&!(char>=12308&&char<=12319)&&char!==12336){return true}}if(isChar["CJK Unified Ideographs Extension A"](char))return true;if(isChar["CJK Unified Ideographs"](char))return true;if(isChar["Enclosed CJK Letters and Months"](char))return true;if(isChar["Hangul Compatibility Jamo"](char))return true;if(isChar["Hangul Jamo Extended-A"](char))return true;if(isChar["Hangul Jamo Extended-B"](char))return true;if(isChar["Hangul Jamo"](char))return true;if(isChar["Hangul Syllables"](char))return true;if(isChar["Hiragana"](char))return true;if(isChar["Ideographic Description Characters"](char))return true;if(isChar["Kanbun"](char))return true;if(isChar["Kangxi Radicals"](char))return true;if(isChar["Katakana Phonetic Extensions"](char))return true;if(isChar["Katakana"](char)){if(char!==12540){return true}}if(isChar["Halfwidth and Fullwidth Forms"](char)){if(char!==65288&&char!==65289&&char!==65293&&!(char>=65306&&char<=65310)&&char!==65339&&char!==65341&&char!==65343&&!(char>=65371&&char<=65503)&&char!==65507&&!(char>=65512&&char<=65519)){return true}}if(isChar["Small Form Variants"](char)){if(!(char>=65112&&char<=65118)&&!(char>=65123&&char<=65126)){return true}}if(isChar["Unified Canadian Aboriginal Syllabics"](char))return true;if(isChar["Unified Canadian Aboriginal Syllabics Extended"](char))return true;if(isChar["Vertical Forms"](char))return true;if(isChar["Yijing Hexagram Symbols"](char))return true;if(isChar["Yi Syllables"](char))return true;if(isChar["Yi Radicals"](char))return true;return false};exports.charHasNeutralVerticalOrientation=function(char){if(isChar["Latin-1 Supplement"](char)){if(char===167||char===169||char===174||char===177||char===188||char===189||char===190||char===215||char===247){return true}}if(isChar["General Punctuation"](char)){if(char===8214||char===8224||char===8225||char===8240||char===8241||char===8251||char===8252||char===8258||char===8263||char===8264||char===8265||char===8273){return true}}if(isChar["Letterlike Symbols"](char))return true;if(isChar["Number Forms"](char))return true;if(isChar["Miscellaneous Technical"](char)){if(char>=8960&&char<=8967||char>=8972&&char<=8991||char>=8996&&char<=9e3||char===9003||char>=9085&&char<=9114||char>=9150&&char<=9165||char===9167||char>=9169&&char<=9179||char>=9186&&char<=9215){return true}}if(isChar["Control Pictures"](char)&&char!==9251)return true;if(isChar["Optical Character Recognition"](char))return true;if(isChar["Enclosed Alphanumerics"](char))return true;if(isChar["Geometric Shapes"](char))return true;if(isChar["Miscellaneous Symbols"](char)){if(!(char>=9754&&char<=9759)){return true}}if(isChar["Miscellaneous Symbols and Arrows"](char)){if(char>=11026&&char<=11055||char>=11088&&char<=11097||char>=11192&&char<=11243){return true}}if(isChar["CJK Symbols and Punctuation"](char))return true;if(isChar["Katakana"](char))return true;if(isChar["Private Use Area"](char))return true;if(isChar["CJK Compatibility Forms"](char))return true;if(isChar["Small Form Variants"](char))return true;if(isChar["Halfwidth and Fullwidth Forms"](char))return true;if(char===8734||char===8756||char===8757||char>=9984&&char<=10087||char>=10102&&char<=10131||char===65532||char===65533){return true}return false};exports.charHasRotatedVerticalOrientation=function(char){return!(exports.charHasUprightVerticalOrientation(char)||exports.charHasNeutralVerticalOrientation(char))}},{"./is_char_in_unicode_block":206}],210:[function(require,module,exports){"use strict";module.exports=createStructArrayType;var viewTypes={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array};var Struct=function Struct(structArray,index){this._structArray=structArray;this._pos1=index*this.size;this._pos2=this._pos1/2;this._pos4=this._pos1/4;this._pos8=this._pos1/8};var DEFAULT_CAPACITY=128;var RESIZE_MULTIPLIER=5;var StructArray=function StructArray(serialized){this.isTransferred=false;if(serialized!==undefined){this.arrayBuffer=serialized.arrayBuffer;this.length=serialized.length;this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement;this._refreshViews()}else{this.capacity=-1;this.resize(0)}};StructArray.serialize=function serialize(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}};StructArray.prototype.serialize=function serialize(transferables){this._trim();if(transferables){this.isTransferred=true;transferables.push(this.arrayBuffer)}return{length:this.length,arrayBuffer:this.arrayBuffer}};StructArray.prototype.get=function get(index){return new this.StructType(this,index)};StructArray.prototype._trim=function _trim(){if(this.length!==this.capacity){this.capacity=this.length;this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement);this._refreshViews()}};StructArray.prototype.resize=function resize(n){this.length=n;if(n>this.capacity){this.capacity=Math.max(n,Math.floor(this.capacity*RESIZE_MULTIPLIER),DEFAULT_CAPACITY);this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var oldUint8Array=this.uint8;this._refreshViews();if(oldUint8Array)this.uint8.set(oldUint8Array)}};StructArray.prototype._refreshViews=function _refreshViews(){var this$1=this;

for(var i=0,list=this._usedTypes;i<list.length;i+=1){var type=list[i];this$1[getArrayViewName(type)]=new viewTypes[type](this$1.arrayBuffer)}};StructArray.prototype.toArray=function toArray(startIndex,endIndex){var this$1=this;var array=[];for(var i=startIndex;i<endIndex;i++){var struct=this$1.get(i);array.push(struct)}return array};var structArrayTypeCache={};function createStructArrayType(options){var key=JSON.stringify(options);if(structArrayTypeCache[key]){return structArrayTypeCache[key]}var alignment=options.alignment===undefined?1:options.alignment;var offset=0;var maxSize=0;var usedTypes=["Uint8"];var members=options.members.map(function(member){if(usedTypes.indexOf(member.type)<0)usedTypes.push(member.type);var typeSize=sizeOf(member.type);var memberOffset=offset=align(offset,Math.max(alignment,typeSize));var components=member.components||1;maxSize=Math.max(maxSize,typeSize);offset+=typeSize*components;return{name:member.name,type:member.type,components:components,offset:memberOffset}});var size=align(offset,Math.max(maxSize,alignment));var StructType=function(Struct){function StructType(){Struct.apply(this,arguments)}if(Struct)StructType.__proto__=Struct;StructType.prototype=Object.create(Struct&&Struct.prototype);StructType.prototype.constructor=StructType;return StructType}(Struct);StructType.prototype.alignment=alignment;StructType.prototype.size=size;for(var i=0,list=members;i<list.length;i+=1){var member=list[i];for(var c=0;c<member.components;c++){var name=member.name+(member.components===1?"":c);Object.defineProperty(StructType.prototype,name,{get:createGetter(member,c),set:createSetter(member,c)})}}var StructArrayType=function(StructArray){function StructArrayType(){StructArray.apply(this,arguments)}if(StructArray)StructArrayType.__proto__=StructArray;StructArrayType.prototype=Object.create(StructArray&&StructArray.prototype);StructArrayType.prototype.constructor=StructArrayType;return StructArrayType}(StructArray);StructArrayType.prototype.members=members;StructArrayType.prototype.StructType=StructType;StructArrayType.prototype.bytesPerElement=size;StructArrayType.prototype.emplaceBack=createEmplaceBack(members,size);StructArrayType.prototype._usedTypes=usedTypes;structArrayTypeCache[key]=StructArrayType;return StructArrayType}function align(offset,size){return Math.ceil(offset/size)*size}function sizeOf(type){return viewTypes[type].BYTES_PER_ELEMENT}function getArrayViewName(type){return type.toLowerCase()}function createEmplaceBack(members,bytesPerElement){var usedTypeSizes=[];var argNames=[];var body="var i = this.length;\n"+"this.resize(this.length + 1);\n";for(var i=0,list=members;i<list.length;i+=1){var member=list[i];var size=sizeOf(member.type);if(usedTypeSizes.indexOf(size)<0){usedTypeSizes.push(size);body+="var o"+size.toFixed(0)+" = i * "+(bytesPerElement/size).toFixed(0)+";\n"}for(var c=0;c<member.components;c++){var argName="v"+argNames.length;var index="o"+size.toFixed(0)+" + "+(member.offset/size+c).toFixed(0);body+="this."+getArrayViewName(member.type)+"["+index+"] = "+argName+";\n";argNames.push(argName)}}body+="return i;";return new Function(argNames.toString(),body)}function createMemberComponentString(member,component){var elementOffset="this._pos"+sizeOf(member.type).toFixed(0);var componentOffset=(member.offset/sizeOf(member.type)+component).toFixed(0);var index=elementOffset+" + "+componentOffset;return"this._structArray."+getArrayViewName(member.type)+"["+index+"]"}function createGetter(member,c){return new Function("return "+createMemberComponentString(member,c)+";")}function createSetter(member,c){return new Function("x",createMemberComponentString(member,c)+" = x;")}},{}],211:[function(require,module,exports){"use strict";module.exports=resolveTokens;function resolveTokens(properties,text){return text.replace(/{([^{}]+)}/g,function(match,key){return key in properties?properties[key]:""})}},{}],212:[function(require,module,exports){"use strict";var UnitBezier=require("@mapbox/unitbezier");var Coordinate=require("../geo/coordinate");var Point=require("point-geometry");exports.easeCubicInOut=function(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)};exports.bezier=function(p1x,p1y,p2x,p2y){var bezier=new UnitBezier(p1x,p1y,p2x,p2y);return function(t){return bezier.solve(t)}};exports.ease=exports.bezier(.25,.1,.25,1);exports.clamp=function(n,min,max){return Math.min(max,Math.max(min,n))};exports.wrap=function(n,min,max){var d=max-min;var w=((n-min)%d+d)%d+min;return w===min?max:w};exports.asyncAll=function(array,fn,callback){if(!array.length){return callback(null,[])}var remaining=array.length;var results=new Array(array.length);var error=null;array.forEach(function(item,i){fn(item,function(err,result){if(err)error=err;results[i]=result;if(--remaining===0)callback(error,results)})})};exports.values=function(obj){var result=[];for(var k in obj){result.push(obj[k])}return result};exports.keysDifference=function(obj,other){var difference=[];for(var i in obj){if(!(i in other)){difference.push(i)}}return difference};exports.extend=function(dest,source0,source1,source2){var arguments$1=arguments;for(var i=1;i<arguments.length;i++){var src=arguments$1[i];for(var k in src){dest[k]=src[k]}}return dest};exports.pick=function(src,properties){var result={};for(var i=0;i<properties.length;i++){var k=properties[i];if(k in src){result[k]=src[k]}}return result};var id=1;exports.uniqueId=function(){return id++};exports.bindAll=function(fns,context){fns.forEach(function(fn){if(!context[fn]){return}context[fn]=context[fn].bind(context)})};exports.getCoordinatesCenter=function(coords){var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;for(var i=0;i<coords.length;i++){minX=Math.min(minX,coords[i].column);minY=Math.min(minY,coords[i].row);maxX=Math.max(maxX,coords[i].column);maxY=Math.max(maxY,coords[i].row)}var dx=maxX-minX;var dy=maxY-minY;var dMax=Math.max(dx,dy);return new Coordinate((minX+maxX)/2,(minY+maxY)/2,0).zoomTo(Math.floor(-Math.log(dMax)/Math.LN2))};exports.endsWith=function(string,suffix){return string.indexOf(suffix,string.length-suffix.length)!==-1};exports.mapObject=function(input,iterator,context){var this$1=this;var output={};for(var key in input){output[key]=iterator.call(context||this$1,input[key],key,input)}return output};exports.filterObject=function(input,iterator,context){var this$1=this;var output={};for(var key in input){if(iterator.call(context||this$1,input[key],key,input)){output[key]=input[key]}}return output};exports.deepEqual=function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!==b.length)return false;for(var i=0;i<a.length;i++){if(!exports.deepEqual(a[i],b[i]))return false}return true}if(typeof a==="object"&&a!==null&&b!==null){if(!(typeof b==="object"))return false;var keys=Object.keys(a);if(keys.length!==Object.keys(b).length)return false;for(var key in a){if(!exports.deepEqual(a[key],b[key]))return false}return true}return a===b};exports.clone=function(input){if(Array.isArray(input)){return input.map(exports.clone)}else if(typeof input==="object"&&input){return exports.mapObject(input,exports.clone)}else{return input}};exports.arraysIntersect=function(a,b){for(var l=0;l<a.length;l++){if(b.indexOf(a[l])>=0)return true}return false};var warnOnceHistory={};exports.warnOnce=function(message){if(!warnOnceHistory[message]){if(typeof console!=="undefined")console.warn(message);warnOnceHistory[message]=true}};exports.isCounterClockwise=function(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)};exports.calculateSignedArea=function(ring){var sum=0;for(var i=0,len=ring.length,j=len-1,p1,p2;i<len;j=i++){p1=ring[i];p2=ring[j];sum+=(p2.x-p1.x)*(p1.y+p2.y)}return sum};exports.isClosedPolygon=function(points){if(points.length<4)return false;var p1=points[0];var p2=points[points.length-1];if(Math.abs(p1.x-p2.x)>0||Math.abs(p1.y-p2.y)>0){return false}return Math.abs(exports.calculateSignedArea(points))>.01};exports.sphericalToCartesian=function(spherical){var r=spherical[0];var azimuthal=spherical[1],polar=spherical[2];azimuthal+=90;azimuthal*=Math.PI/180;polar*=Math.PI/180;return[r*Math.cos(azimuthal)*Math.sin(polar),r*Math.sin(azimuthal)*Math.sin(polar),r*Math.cos(polar)]};exports.parseCacheControl=function(cacheControl){var re=/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g;var header={};cacheControl.replace(re,function($0,$1,$2,$3){var value=$2||$3;header[$1]=value?value.toLowerCase():true;return""});if(header["max-age"]){var maxAge=parseInt(header["max-age"],10);if(isNaN(maxAge))delete header["max-age"];else header["max-age"]=maxAge}return header}},{"../geo/coordinate":101,"@mapbox/unitbezier":7,"point-geometry":223}],213:[function(require,module,exports){"use strict";var Feature=function Feature(vectorTileFeature,z,x,y){this.type="Feature";this._vectorTileFeature=vectorTileFeature;vectorTileFeature._z=z;vectorTileFeature._x=x;vectorTileFeature._y=y;this.properties=vectorTileFeature.properties;if(vectorTileFeature.id!=null){this.id=vectorTileFeature.id}};var prototypeAccessors={geometry:{}};prototypeAccessors.geometry.get=function(){if(this._geometry===undefined){this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry}return this._geometry};prototypeAccessors.geometry.set=function(g){this._geometry=g};Feature.prototype.toJSON=function toJSON(){var this$1=this;var json={geometry:this.geometry};for(var i in this){if(i==="_geometry"||i==="_vectorTileFeature")continue;json[i]=this$1[i]}return json};Object.defineProperties(Feature.prototype,prototypeAccessors);module.exports=Feature},{}],214:[function(require,module,exports){"use strict";var scriptDetection=require("./script_detection");module.exports=function verticalizePunctuation(input){var output="";for(var i=0;i<input.length;i++){var nextCharCode=input.charCodeAt(i+1)||null;var prevCharCode=input.charCodeAt(i-1)||null;var canReplacePunctuation=(!nextCharCode||!scriptDetection.charHasRotatedVerticalOrientation(nextCharCode)||module.exports.lookup[input[i+1]])&&(!prevCharCode||!scriptDetection.charHasRotatedVerticalOrientation(prevCharCode)||module.exports.lookup[input[i-1]]);if(canReplacePunctuation&&module.exports.lookup[input[i]]){output+=module.exports.lookup[input[i]]}else{output+=input[i]}}return output};module.exports.lookup={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"}},{"./script_detection":209}],215:[function(require,module,exports){"use strict";var WebWorker=require("./web_worker");var WorkerPool=function WorkerPool(){this.active={}};WorkerPool.prototype.acquire=function acquire(mapId){var this$1=this;if(!this.workers){var workerCount=require("../mapbox-gl").workerCount;this.workers=[];while(this.workers.length<workerCount){this$1.workers.push(new WebWorker)}}this.active[mapId]=true;return this.workers.slice()};WorkerPool.prototype.release=function release(mapId){delete this.active[mapId];if(Object.keys(this.active).length===0){this.workers.forEach(function(w){w.terminate()});this.workers=null}};module.exports=WorkerPool},{"../mapbox-gl":107,"./web_worker":194}],216:[function(require,module,exports){module.exports={version:"0.32.1"}},{}],217:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.moment=factory()})(this,function(){"use strict";var hookCallback;function hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return input instanceof Array||Object.prototype.toString.call(input)==="[object Array]"}function isObject(input){return input!=null&&Object.prototype.toString.call(input)==="[object Object]"}function isObjectEmpty(obj){var k;for(k in obj){return false}return true}function isUndefined(input){return input===void 0}function isNumber(input){return typeof input==="number"||Object.prototype.toString.call(input)==="[object Number]"}function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==="[object Date]"}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i))}return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i]}}if(hasOwnProp(b,"toString")){a.toString=b.toString}if(hasOwnProp(b,"valueOf")){a.valueOf=b.valueOf}return a}function createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null,rfc2822:false,weekdayMismatch:false}}function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags()}return m._pf}var some;if(Array.prototype.some){some=Array.prototype.some}else{some=function(fun){var t=Object(this);var len=t.length>>>0;for(var i=0;i<len;i++){if(i in t&&fun.call(this,t[i],i,t)){return true}}return false}}var some$1=some;function isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);var parsedParts=some$1.call(flags.parsedDateParts,function(i){return i!=null});var isNowValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated&&(!flags.meridiem||flags.meridiem&&parsedParts);if(m._strict){isNowValid=isNowValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined}if(Object.isFrozen==null||!Object.isFrozen(m)){m._isValid=isNowValid}else{return isNowValid}}return m._isValid}function createInvalid(flags){var m=createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags)}else{getParsingFlags(m).userInvalidated=true}return m}var momentProperties=hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(!isUndefined(from._isAMomentObject)){to._isAMomentObject=from._isAMomentObject}if(!isUndefined(from._i)){to._i=from._i}if(!isUndefined(from._f)){to._f=from._f}if(!isUndefined(from._l)){to._l=from._l}if(!isUndefined(from._strict)){to._strict=from._strict}if(!isUndefined(from._tzm)){to._tzm=from._tzm}if(!isUndefined(from._isUTC)){to._isUTC=from._isUTC}if(!isUndefined(from._offset)){to._offset=from._offset}if(!isUndefined(from._pf)){to._pf=getParsingFlags(from)}if(!isUndefined(from._locale)){to._locale=from._locale}if(momentProperties.length>0){for(i=0;i<momentProperties.length;i++){prop=momentProperties[i];val=from[prop];if(!isUndefined(val)){to[prop]=val}}}return to}var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(config._d!=null?config._d.getTime():NaN);if(!this.isValid()){this._d=new Date(NaN)}if(updateInProgress===false){updateInProgress=true;hooks.updateOffset(this);updateInProgress=false}}function isMoment(obj){return obj instanceof Moment||obj!=null&&obj._isAMomentObject!=null}function absFloor(number){if(number<0){return Math.ceil(number)||0}else{return Math.floor(number)}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){value=absFloor(coercedNumber)}return value}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i])){diffs++}}return diffs+lengthDiff}function warn(msg){if(hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+msg)}}function deprecate(msg,fn){var firstTime=true;return extend(function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,msg)}if(firstTime){var args=[];var arg;for(var i=0;i<arguments.length;i++){arg="";if(typeof arguments[i]==="object"){arg+="\n["+i+"] ";for(var key in arguments[0]){arg+=key+": "+arguments[0][key]+", "}arg=arg.slice(0,-2)}else{arg=arguments[i]}args.push(arg)}warn(msg+"\nArguments: "+Array.prototype.slice.call(args).join("")+"\n"+(new Error).stack);firstTime=false}return fn.apply(this,arguments)},fn)}var deprecations={};function deprecateSimple(name,msg){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(name,msg)}if(!deprecations[name]){warn(msg);deprecations[name]=true}}hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(input){return input instanceof Function||Object.prototype.toString.call(input)==="[object Function]"}function set(config){var prop,i;for(i in config){prop=config[i];if(isFunction(prop)){this[i]=prop}else{this["_"+i]=prop}}this._config=config;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function mergeConfigs(parentConfig,childConfig){var res=extend({},parentConfig),prop;for(prop in childConfig){if(hasOwnProp(childConfig,prop)){if(isObject(parentConfig[prop])&&isObject(childConfig[prop])){res[prop]={};extend(res[prop],parentConfig[prop]);extend(res[prop],childConfig[prop])}else if(childConfig[prop]!=null){res[prop]=childConfig[prop]}else{delete res[prop]}}}for(prop in parentConfig){if(hasOwnProp(parentConfig,prop)&&!hasOwnProp(childConfig,prop)&&isObject(parentConfig[prop])){res[prop]=extend({},res[prop])}}return res}function Locale(config){if(config!=null){this.set(config)}}var keys;if(Object.keys){keys=Object.keys}else{keys=function(obj){var i,res=[];for(i in obj){if(hasOwnProp(obj,i)){res.push(i)}}return res}}var keys$1=keys;var defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function calendar(key,mom,now){var output=this._calendar[key]||this._calendar["sameElse"];return isFunction(output)?output.call(mom,now):output}var defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];if(format||!formatUpper){return format}this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});return this._longDateFormat[key]}var defaultInvalidDate="Invalid date";function invalidDate(){return this._invalidDate}var defaultOrdinal="%d";var defaultDayOfMonthOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace("%d",number)}var defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return isFunction(output)?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return isFunction(format)?format(output):format.replace(/%s/i,output)}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return typeof units==="string"?aliases[units]||aliases[units.toLowerCase()]:undefined}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop]}}}return normalizedInput}var priorities={};function addUnitPriority(unit,priority){priorities[unit]=priority}function getPrioritizedUnits(unitsObj){var units=[];for(var u in unitsObj){units.push({unit:u,priority:priorities[u]})}units.sort(function(a,b){return a.priority-b.priority});return units}function makeGetSet(unit,keepTime){return function(value){if(value!=null){set$1(this,unit,value);hooks.updateOffset(this,keepTime);return this}else{return get(this,unit)}}}function get(mom,unit){return mom.isValid()?mom._d["get"+(mom._isUTC?"UTC":"")+unit]():NaN}function set$1(mom,unit,value){if(mom.isValid()){mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}}function stringGet(units){units=normalizeUnits(units);if(isFunction(this[units])){return this[units]()}return this}function stringSet(units,value){if(typeof units==="object"){units=normalizeObjectUnits(units);var prioritized=getPrioritizedUnits(units);for(var i=0;i<prioritized.length;i++){this[prioritized[i].unit](units[prioritized[i].unit])}}else{units=normalizeUnits(units);if(isFunction(this[units])){return this[units](value)}}return this}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==="string"){func=function(){return this[callback]()}}if(token){formatTokenFunctions[token]=func}if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}}if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)}}}function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="",i;for(i=0;i<length;i++){output+=isFunction(array[i])?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate()}format=expandFormat(format,m.localeData());formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format);return formatFunctions[format](m)}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1}return format}var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match3to4=/\d\d\d\d?/;var match5to6=/\d\d\d\d\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i;var regexes={};function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token))}return regexes[token](config._strict,config._locale)}function unescapeFormat(s){return regexEscape(s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}))}function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==="string"){token=[token]}if(isNumber(callback)){func=function(input,array){array[callback]=toInt(input)}}for(i=0;i<token.length;i++){tokens[token[i]]=func}}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token)}}var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;var WEEK=7;var WEEKDAY=8;var indexOf;if(Array.prototype.indexOf){indexOf=Array.prototype.indexOf}else{indexOf=function(o){var i;for(i=0;i<this.length;++i){if(this[i]===o){return i}}return-1}}var indexOf$1=indexOf;function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)});addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)});addUnitAlias("month","M");addUnitPriority("month",8);addRegexToken("M",match1to2);addRegexToken("MM",match1to2,match2);addRegexToken("MMM",function(isStrict,locale){return locale.monthsShortRegex(isStrict)});addRegexToken("MMMM",function(isStrict,locale){return locale.monthsRegex(isStrict)});addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1});addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month}else{getParsingFlags(config).invalidMonth=input}});var MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(m,format){if(!m){return isArray(this._months)?this._months:this._months["standalone"]}return isArray(this._months)?this._months[m.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(format)?"format":"standalone"][m.month()]}var defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(m,format){if(!m){return isArray(this._monthsShort)?this._monthsShort:this._monthsShort["standalone"]}return isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?"format":"standalone"][m.month()]}function handleStrictParse(monthName,format,strict){var i,ii,mom,llc=monthName.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){mom=createUTC([2e3,i]);this._shortMonthsParse[i]=this.monthsShort(mom,"").toLocaleLowerCase();this._longMonthsParse[i]=this.months(mom,"").toLocaleLowerCase()}}if(strict){if(format==="MMM"){ii=indexOf$1.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._longMonthsParse,llc);return ii!==-1?ii:null}}else{if(format==="MMM"){ii=indexOf$1.call(this._shortMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._longMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._longMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}}}function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(this._monthsParseExact){return handleStrictParse.call(this,monthName,format,strict)}if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){mom=createUTC([2e3,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")}if(!strict&&!this._monthsParse[i]){regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="MMMM"&&this._longMonthsParse[i].test(monthName)){return i}else if(strict&&format==="MMM"&&this._shortMonthsParse[i].test(monthName)){return i}else if(!strict&&this._monthsParse[i].test(monthName)){return i}}}function setMonth(mom,value){var dayOfMonth;if(!mom.isValid()){return mom}if(typeof value==="string"){if(/^\d+$/.test(value)){value=toInt(value)}else{value=mom.localeData().monthsParse(value);if(!isNumber(value)){return mom}}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth);return mom}function getSetMonth(value){if(value!=null){setMonth(this,value);hooks.updateOffset(this,true);return this}else{return get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}var defaultMonthsShortRegex=matchWord;function monthsShortRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsShortStrictRegex}else{return this._monthsShortRegex}}else{if(!hasOwnProp(this,"_monthsShortRegex")){this._monthsShortRegex=defaultMonthsShortRegex}return this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex}}var defaultMonthsRegex=matchWord;function monthsRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsStrictRegex}else{return this._monthsRegex}}else{if(!hasOwnProp(this,"_monthsRegex")){this._monthsRegex=defaultMonthsRegex}return this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex}}function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length}var shortPieces=[],longPieces=[],mixedPieces=[],i,mom;for(i=0;i<12;i++){mom=createUTC([2e3,i]);shortPieces.push(this.monthsShort(mom,""));longPieces.push(this.months(mom,""));mixedPieces.push(this.months(mom,""));mixedPieces.push(this.monthsShort(mom,""))}shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<12;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i])}for(i=0;i<24;i++){mixedPieces[i]=regexEscape(mixedPieces[i])}this._monthsRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i")}addFormatToken("Y",0,0,function(){var y=this.year();return y<=9999?""+y:"+"+y});addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addUnitPriority("year",1);addRegexToken("Y",matchSigned);addRegexToken("YY",match1to2,match2);addRegexToken("YYYY",match1to4,match4);addRegexToken("YYYYY",match1to6,match6);addRegexToken("YYYYYY",match1to6,match6);addParseToken(["YYYYY","YYYYYY"],YEAR);addParseToken("YYYY",function(input,array){
array[YEAR]=input.length===2?hooks.parseTwoDigitYear(input):toInt(input)});addParseToken("YY",function(input,array){array[YEAR]=hooks.parseTwoDigitYear(input)});addParseToken("Y",function(input,array){array[YEAR]=parseInt(input,10)});function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",true);function getIsLeapYear(){return isLeapYear(this.year())}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<100&&y>=0&&isFinite(date.getFullYear())){date.setFullYear(y)}return date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<100&&y>=0&&isFinite(date.getUTCFullYear())){date.setUTCFullYear(y)}return date}function firstWeekOffset(year,dow,doy){var fwd=7+dow-doy,fwdlw=(7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7;return-fwdlw+fwd-1}function dayOfYearFromWeeks(year,week,weekday,dow,doy){var localWeekday=(7+weekday-dow)%7,weekOffset=firstWeekOffset(year,dow,doy),dayOfYear=1+7*(week-1)+localWeekday+weekOffset,resYear,resDayOfYear;if(dayOfYear<=0){resYear=year-1;resDayOfYear=daysInYear(resYear)+dayOfYear}else if(dayOfYear>daysInYear(year)){resYear=year+1;resDayOfYear=dayOfYear-daysInYear(year)}else{resYear=year;resDayOfYear=dayOfYear}return{year:resYear,dayOfYear:resDayOfYear}}function weekOfYear(mom,dow,doy){var weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1,resWeek,resYear;if(week<1){resYear=mom.year()-1;resWeek=week+weeksInYear(resYear,dow,doy)}else if(week>weeksInYear(mom.year(),dow,doy)){resWeek=week-weeksInYear(mom.year(),dow,doy);resYear=mom.year()+1}else{resYear=mom.year();resWeek=week}return{week:resWeek,year:resYear}}function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addUnitPriority("week",5);addUnitPriority("isoWeek",5);addRegexToken("w",match1to2);addRegexToken("ww",match1to2,match2);addRegexToken("W",match1to2);addRegexToken("WW",match1to2,match2);addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,"d")}addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)});addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)});addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addUnitPriority("day",11);addUnitPriority("weekday",11);addUnitPriority("isoWeekday",11);addRegexToken("d",match1to2);addRegexToken("e",match1to2);addRegexToken("E",match1to2);addRegexToken("dd",function(isStrict,locale){return locale.weekdaysMinRegex(isStrict)});addRegexToken("ddd",function(isStrict,locale){return locale.weekdaysShortRegex(isStrict)});addRegexToken("dddd",function(isStrict,locale){return locale.weekdaysRegex(isStrict)});addWeekParseToken(["dd","ddd","dddd"],function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);if(weekday!=null){week.d=weekday}else{getParsingFlags(config).invalidWeekday=input}});addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});function parseWeekday(input,locale){if(typeof input!=="string"){return input}if(!isNaN(input)){return parseInt(input,10)}input=locale.weekdaysParse(input);if(typeof input==="number"){return input}return null}function parseIsoWeekday(input,locale){if(typeof input==="string"){return locale.weekdaysParse(input)%7||7}return isNaN(input)?null:input}var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(m,format){if(!m){return isArray(this._weekdays)?this._weekdays:this._weekdays["standalone"]}return isArray(this._weekdays)?this._weekdays[m.day()]:this._weekdays[this._weekdays.isFormat.test(format)?"format":"standalone"][m.day()]}var defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(m){return m?this._weekdaysShort[m.day()]:this._weekdaysShort}var defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(m){return m?this._weekdaysMin[m.day()]:this._weekdaysMin}function handleStrictParse$1(weekdayName,format,strict){var i,ii,mom,llc=weekdayName.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){mom=createUTC([2e3,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(mom,"").toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(mom,"").toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(mom,"").toLocaleLowerCase()}}if(strict){if(format==="dddd"){ii=indexOf$1.call(this._weekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf$1.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}}else{if(format==="dddd"){ii=indexOf$1.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf$1.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._minWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}}}function localeWeekdaysParse(weekdayName,format,strict){var i,mom,regex;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,weekdayName,format,strict)}if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);if(strict&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(mom,"").replace(".",".?")+"$","i");this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(mom,"").replace(".",".?")+"$","i");this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(mom,"").replace(".",".?")+"$","i")}if(!this._weekdaysParse[i]){regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="dddd"&&this._fullWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="ddd"&&this._shortWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="dd"&&this._minWeekdaysParse[i].test(weekdayName)){return i}else if(!strict&&this._weekdaysParse[i].test(weekdayName)){return i}}}function getSetDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,"d")}else{return day}}function getSetLocaleDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}if(input!=null){var weekday=parseIsoWeekday(input,this.localeData());return this.day(this.day()%7?weekday:weekday-7)}else{return this.day()||7}}var defaultWeekdaysRegex=matchWord;function weekdaysRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysStrictRegex}else{return this._weekdaysRegex}}else{if(!hasOwnProp(this,"_weekdaysRegex")){this._weekdaysRegex=defaultWeekdaysRegex}return this._weekdaysStrictRegex&&isStrict?this._weekdaysStrictRegex:this._weekdaysRegex}}var defaultWeekdaysShortRegex=matchWord;function weekdaysShortRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysShortStrictRegex}else{return this._weekdaysShortRegex}}else{if(!hasOwnProp(this,"_weekdaysShortRegex")){this._weekdaysShortRegex=defaultWeekdaysShortRegex}return this._weekdaysShortStrictRegex&&isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}var defaultWeekdaysMinRegex=matchWord;function weekdaysMinRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysMinStrictRegex}else{return this._weekdaysMinRegex}}else{if(!hasOwnProp(this,"_weekdaysMinRegex")){this._weekdaysMinRegex=defaultWeekdaysMinRegex}return this._weekdaysMinStrictRegex&&isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function computeWeekdaysParse(){function cmpLenRev(a,b){return b.length-a.length}var minPieces=[],shortPieces=[],longPieces=[],mixedPieces=[],i,mom,minp,shortp,longp;for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);minp=this.weekdaysMin(mom,"");shortp=this.weekdaysShort(mom,"");longp=this.weekdays(mom,"");minPieces.push(minp);shortPieces.push(shortp);longPieces.push(longp);mixedPieces.push(minp);mixedPieces.push(shortp);mixedPieces.push(longp)}minPieces.sort(cmpLenRev);shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<7;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i]);mixedPieces[i]=regexEscape(mixedPieces[i])}this._weekdaysRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+minPieces.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,hFormat);addFormatToken("k",["kk",2],0,kFormat);addFormatToken("hmm",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)});addFormatToken("hmmss",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});addFormatToken("Hmm",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)});addFormatToken("Hmmss",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");addUnitPriority("hour",13);function matchMeridiem(isStrict,locale){return locale._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",match1to2);addRegexToken("h",match1to2);addRegexToken("k",match1to2);addRegexToken("HH",match1to2,match2);addRegexToken("hh",match1to2,match2);addRegexToken("kk",match1to2,match2);addRegexToken("hmm",match3to4);addRegexToken("hmmss",match5to6);addRegexToken("Hmm",match3to4);addRegexToken("Hmmss",match5to6);addParseToken(["H","HH"],HOUR);addParseToken(["k","kk"],function(input,array,config){var kInput=toInt(input);array[HOUR]=kInput===24?0:kInput});addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input});addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true});addParseToken("hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos));getParsingFlags(config).bigHour=true});addParseToken("hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2));getParsingFlags(config).bigHour=true});addParseToken("Hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos))});addParseToken("Hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2))});function localeIsPM(input){return(input+"").toLowerCase().charAt(0)==="p"}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}}var getSetHour=makeGetSet("Hours",true);var baseConfig={calendar:defaultCalendar,longDateFormat:defaultLongDateFormat,invalidDate:defaultInvalidDate,ordinal:defaultOrdinal,dayOfMonthOrdinalParse:defaultDayOfMonthOrdinalParse,relativeTime:defaultRelativeTime,months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:defaultLocaleWeek,weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:defaultLocaleMeridiemParse};var locales={};var localeFamilies={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split("-");j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split("-"):null;while(j>0){locale=loadLocale(split.slice(0,j).join("-"));if(locale){return locale}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break}j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&typeof module!=="undefined"&&module&&module.exports){try{oldLocale=globalLocale._abbr;require("./locale/"+name);getSetGlobalLocale(oldLocale)}catch(e){}}return locales[name]}function getSetGlobalLocale(key,values){var data;if(key){if(isUndefined(values)){data=getLocale(key)}else{data=defineLocale(key,values)}if(data){globalLocale=data}}return globalLocale._abbr}function defineLocale(name,config){if(config!==null){var parentConfig=baseConfig;config.abbr=name;if(locales[name]!=null){deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change "+"an existing locale. moment.defineLocale(localeName, "+"config) should only be used for creating a new locale "+"See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");parentConfig=locales[name]._config}else if(config.parentLocale!=null){if(locales[config.parentLocale]!=null){parentConfig=locales[config.parentLocale]._config}else{if(!localeFamilies[config.parentLocale]){localeFamilies[config.parentLocale]=[]}localeFamilies[config.parentLocale].push({name:name,config:config});return null}}locales[name]=new Locale(mergeConfigs(parentConfig,config));if(localeFamilies[name]){localeFamilies[name].forEach(function(x){defineLocale(x.name,x.config)})}getSetGlobalLocale(name);return locales[name]}else{delete locales[name];return null}}function updateLocale(name,config){if(config!=null){var locale,parentConfig=baseConfig;if(locales[name]!=null){parentConfig=locales[name]._config}config=mergeConfigs(parentConfig,config);locale=new Locale(config);locale.parentLocale=locales[name];locales[name]=locale;getSetGlobalLocale(name)}else{if(locales[name]!=null){if(locales[name].parentLocale!=null){locales[name]=locales[name].parentLocale}else if(locales[name]!=null){delete locales[name]}}}return locales[name]}function getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr}if(!key){return globalLocale}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale}key=[key]}return chooseLocale(key)}function listLocales(){return keys$1(locales)}function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0)?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE}if(getParsingFlags(m)._overflowWeeks&&overflow===-1){overflow=WEEK}if(getParsingFlags(m)._overflowWeekday&&overflow===-1){overflow=WEEKDAY}getParsingFlags(m).overflow=overflow}return m}var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var tzRegex=/Z|[+-]\d\d(?::?\d\d)?/;var isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/]];var isoTimes=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string),allowTime,dateFormat,timeFormat,tzFormat;if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0];allowTime=isoDates[i][2]!==false;break}}if(dateFormat==null){config._isValid=false;return}if(match[3]){for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||" ")+isoTimes[i][0];break}}if(timeFormat==null){config._isValid=false;return}}if(!allowTime&&timeFormat!=null){config._isValid=false;return}if(match[4]){if(tzRegex.exec(match[4])){tzFormat="Z"}else{config._isValid=false;return}}config._f=dateFormat+(timeFormat||"")+(tzFormat||"");configFromStringAndFormat(config)}else{config._isValid=false}}var basicRfcRegex=/^((?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d?\d\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(?:\d\d)?\d\d\s)(\d\d:\d\d)(\:\d\d)?(\s(?:UT|GMT|[ECMP][SD]T|[A-IK-Za-ik-z]|[+-]\d{4}))$/;function configFromRFC2822(config){var string,match,dayFormat,dateFormat,timeFormat,tzFormat;var timezones={" GMT":" +0000"," EDT":" -0400"," EST":" -0500"," CDT":" -0500"," CST":" -0600"," MDT":" -0600"," MST":" -0700"," PDT":" -0700"," PST":" -0800"};var military="YXWVUTSRQPONZABCDEFGHIKLM";var timezone,timezoneIndex;string=config._i.replace(/\([^\)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s|\s$/g,"");match=basicRfcRegex.exec(string);if(match){dayFormat=match[1]?"ddd"+(match[1].length===5?", ":" "):"";dateFormat="D MMM "+(match[2].length>10?"YYYY ":"YY ");timeFormat="HH:mm"+(match[4]?":ss":"");if(match[1]){var momentDate=new Date(match[2]);var momentDay=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][momentDate.getDay()];if(match[1].substr(0,3)!==momentDay){getParsingFlags(config).weekdayMismatch=true;config._isValid=false;return}}switch(match[5].length){case 2:if(timezoneIndex===0){timezone=" +0000"}else{timezoneIndex=military.indexOf(match[5][1].toUpperCase())-12;timezone=(timezoneIndex<0?" -":" +")+(""+timezoneIndex).replace(/^-?/,"0").match(/..$/)[0]+"00"}break;case 4:timezone=timezones[match[5]];break;default:timezone=timezones[" GMT"]}match[5]=timezone;config._i=match.splice(1).join("");tzFormat=" ZZ";config._f=dayFormat+dateFormat+timeFormat+tzFormat;configFromStringAndFormat(config);getParsingFlags(config).rfc2822=true}else{config._isValid=false}}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date(+matched[1]);return}configFromISO(config);if(config._isValid===false){delete config._isValid}else{return}configFromRFC2822(config);if(config._isValid===false){delete config._isValid}else{return}hooks.createFromInputFallback(config)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), "+"which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are "+"discouraged and will be removed in an upcoming major release. Please refer to "+"http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))});function defaults(a,b,c){if(a!=null){return a}if(b!=null){return b}return c}function currentDateArray(config){var nowValue=new Date(hooks.now());if(config._useUTC){return[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()]}return[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()]}function configFromArray(config){var i,date,input=[],currentDate,yearToUse;if(config._d){return}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config)}if(config._dayOfYear!=null){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)||config._dayOfYear===0){getParsingFlags(config)._overflowDayOfYear=true}date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate()}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i]}for(;i<7;i++){config._a[i]=input[i]=config._a[i]==null?i===2?1:0:config._a[i]}if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0}config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm)}if(config._nextDay){config._a[HOUR]=24}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1);if(weekday<1||weekday>7){weekdayOverflow=true}}else{dow=config._locale._week.dow;doy=config._locale._week.doy;var curWeek=weekOfYear(createLocal(),dow,doy);weekYear=defaults(w.gg,config._a[YEAR],curWeek.year);week=defaults(w.w,curWeek.week);if(w.d!=null){weekday=w.d;if(weekday<0||weekday>6){weekdayOverflow=true}}else if(w.e!=null){weekday=w.e+dow;if(w.e<0||w.e>6){weekdayOverflow=true}}else{weekday=dow}}if(week<1||week>weeksInYear(weekYear,dow,doy)){getParsingFlags(config)._overflowWeeks=true}else if(weekdayOverflow!=null){getParsingFlags(config)._overflowWeekday=true}else{temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear}}hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(config){if(config._f===hooks.ISO_8601){configFromISO(config);return}if(config._f===hooks.RFC_2822){configFromRFC2822(config);return}config._a=[];getParsingFlags(config).empty=true;var string=""+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped)}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length}if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false}else{getParsingFlags(config).unusedTokens.push(token)}addTimeToArrayFromToken(token,parsedInput,config)}else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token)}}getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string)}if(config._a[HOUR]<=12&&getParsingFlags(config).bigHour===true&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined}getParsingFlags(config).parsedDateParts=config._a.slice(0);getParsingFlags(config).meridiem=config._meridiem;config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour}if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem)}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12}if(!isPm&&hour===12){hour=0}return hour}else{return hour}}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC}tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!isValid(tempConfig)){continue}currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig}}extend(config,bestMoment||tempConfig)}function configFromObject(config){if(config._d){return}var i=normalizeObjectUnits(config._i);config._a=map([i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],function(obj){return obj&&parseInt(obj,10)});configFromArray(config)}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));if(res._nextDay){res.add(1,"d");res._nextDay=undefined}return res}function prepareConfig(config){var input=config._i,format=config._f;config._locale=config._locale||getLocale(config._l);if(input===null||format===undefined&&input===""){return createInvalid({nullInput:true})}if(typeof input==="string"){config._i=input=config._locale.preparse(input)}if(isMoment(input)){return new Moment(checkOverflow(input))}else if(isDate(input)){config._d=input}else if(isArray(format)){configFromStringAndArray(config)}else if(format){configFromStringAndFormat(config)}else{configFromInput(config)}if(!isValid(config)){config._d=null}return config}function configFromInput(config){var input=config._i;if(isUndefined(input)){config._d=new Date(hooks.now())}else if(isDate(input)){config._d=new Date(input.valueOf())}else if(typeof input==="string"){configFromString(config)}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10)});configFromArray(config)}else if(isObject(input)){configFromObject(config)}else if(isNumber(input)){config._d=new Date(input)}else{hooks.createFromInputFallback(config)}}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(locale===true||locale===false){strict=locale;locale=undefined}if(isObject(input)&&isObjectEmpty(input)||isArray(input)&&input.length===0){input=undefined}c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c)}function createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false)}var prototypeMin=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other<this?this:other}else{return createInvalid()}});var prototypeMax=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other>this?this:other}else{return createInvalid()}});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0]}if(!moments.length){return createLocal()}res=moments[0];for(i=1;i<moments.length;++i){if(!moments[i].isValid()||moments[i][fn](res)){res=moments[i]}}return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}var now=function(){return Date.now?Date.now():+new Date};var ordering=["year","quarter","month","week","day","hour","minute","second","millisecond"];function isDurationValid(m){for(var key in m){if(!(ordering.indexOf(key)!==-1&&(m[key]==null||!isNaN(m[key])))){return false}}var unitHasDecimal=false;for(var i=0;i<ordering.length;++i){if(m[ordering[i]]){if(unitHasDecimal){return false}if(parseFloat(m[ordering[i]])!==toInt(m[ordering[i]])){unitHasDecimal=true}}}return true}function isValid$1(){return this._isValid}function createInvalid$1(){return createDuration(NaN)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._isValid=isDurationValid(normalizedInput);this._milliseconds=+milliseconds+seconds*1e3+minutes*6e4+hours*1e3*60*60;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=getLocale();this._bubble()}function isDuration(obj){return obj instanceof Duration}function absRound(number){if(number<0){return Math.round(-1*number)*-1}else{return Math.round(number)}}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign="+";if(offset<0){offset=-offset;sign="-"}return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",matchShortOffset);addRegexToken("ZZ",matchShortOffset);addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(matchShortOffset,input)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(matcher,string){var matches=(string||"").match(matcher);if(matches===null){return null}var chunk=matches[matches.length-1]||[];var parts=(chunk+"").match(chunkOffset)||["-",0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return minutes===0?0:parts[0]==="+"?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?input.valueOf():createLocal(input).valueOf())-res.valueOf();res._d.setTime(res._d.valueOf()+diff);hooks.updateOffset(res,false);return res}else{return createLocal(input).local()}}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15;

}hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime,keepMinutes){var offset=this._offset||0,localAdjust;if(!this.isValid()){return input!=null?this:NaN}if(input!=null){if(typeof input==="string"){input=offsetFromString(matchShortOffset,input);if(input===null){return this}}else if(Math.abs(input)<16&&!keepMinutes){input=input*60}if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this)}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,"m")}if(offset!==input){if(!keepLocalTime||this._changeInProgress){addSubtract(this,createDuration(input-offset,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?offset:getDateOffset(this)}}function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=="string"){input=-input}this.utcOffset(input,keepLocalTime);return this}else{return-this.utcOffset()}}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm,false,true)}else if(typeof this._i==="string"){var tZone=offsetFromString(matchOffset,this._i);if(tZone!=null){this.utcOffset(tZone)}else{this.utcOffset(0,true)}}return this}function hasAlignedHourOffset(input){if(!this.isValid()){return false}input=input?createLocal(input).utcOffset():0;return(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted}var c={};copyConfig(c,this);c=prepareConfig(c);if(c._a){var other=c._isUTC?createUTC(c._a):createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:false}function isUtcOffset(){return this.isValid()?this._isUTC:false}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false}var aspNetRegex=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var isoRegex=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;function createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months}}else if(isNumber(input)){duration={};if(key){duration[key]=input}else{duration.milliseconds=input}}else if(!!(match=aspNetRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(absRound(match[MILLISECOND]*1e3))*sign}}else if(!!(match=isoRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)}}else if(duration==null){duration={}}else if(typeof duration==="object"&&("from"in duration||"to"in duration)){diffRes=momentsDifference(createLocal(duration.from),createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months}ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,"_locale")){ret._locale=input._locale}return ret}createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,"M").isAfter(other)){--res.months}res.milliseconds=+other-+base.clone().add(res.months,"M");return res}function momentsDifference(base,other){var res;if(!(base.isValid()&&other.isValid())){return{milliseconds:0,months:0}}other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other)}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months}return res}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period). "+"See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");tmp=val;val=period;period=tmp}val=typeof val==="string"?+val:val;dur=createDuration(val,period);addSubtract(this,dur,direction);return this}}function addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);if(!mom.isValid()){return}updateOffset=updateOffset==null?true:updateOffset;if(milliseconds){mom._d.setTime(mom._d.valueOf()+milliseconds*isAdding)}if(days){set$1(mom,"Date",get(mom,"Date")+days*isAdding)}if(months){setMonth(mom,get(mom,"Month")+months*isAdding)}if(updateOffset){hooks.updateOffset(mom,days||months)}}var add=createAdder(1,"add");var subtract=createAdder(-1,"subtract");function getCalendarFormat(myMoment,now){var diff=myMoment.diff(now,"days",true);return diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse"}function calendar$1(time,formats){var now=time||createLocal(),sod=cloneWithOffset(now,this).startOf("day"),format=hooks.calendarFormat(this,sod)||"sameElse";var output=formats&&(isFunction(formats[format])?formats[format].call(this,now):formats[format]);return this.format(output||this.localeData().calendar(format,this,createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()>localInput.valueOf()}else{return localInput.valueOf()<this.clone().startOf(units).valueOf()}}function isBefore(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()<localInput.valueOf()}else{return this.clone().endOf(units).valueOf()<localInput.valueOf()}}function isBetween(from,to,units,inclusivity){inclusivity=inclusivity||"()";return(inclusivity[0]==="("?this.isAfter(from,units):!this.isBefore(from,units))&&(inclusivity[1]===")"?this.isBefore(to,units):!this.isAfter(to,units))}function isSame(input,units){var localInput=isMoment(input)?input:createLocal(input),inputMs;if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(units||"millisecond");if(units==="millisecond"){return this.valueOf()===localInput.valueOf()}else{inputMs=localInput.valueOf();return this.clone().startOf(units).valueOf()<=inputMs&&inputMs<=this.clone().endOf(units).valueOf()}}function isSameOrAfter(input,units){return this.isSame(input,units)||this.isAfter(input,units)}function isSameOrBefore(input,units){return this.isSame(input,units)||this.isBefore(input,units)}function diff(input,units,asFloat){var that,zoneDelta,delta,output;if(!this.isValid()){return NaN}that=cloneWithOffset(input,this);if(!that.isValid()){return NaN}zoneDelta=(that.utcOffset()-this.utcOffset())*6e4;units=normalizeUnits(units);if(units==="year"||units==="month"||units==="quarter"){output=monthDiff(this,that);if(units==="quarter"){output=output/3}else if(units==="year"){output=output/12}}else{delta=this-that;output=units==="second"?delta/1e3:units==="minute"?delta/6e4:units==="hour"?delta/36e5:units==="day"?(delta-zoneDelta)/864e5:units==="week"?(delta-zoneDelta)/6048e5:delta}return asFloat?output:absFloor(output)}function monthDiff(a,b){var wholeMonthDiff=(b.year()-a.year())*12+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months"),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,"months");adjust=(b-anchor)/(anchor-anchor2)}else{anchor2=a.clone().add(wholeMonthDiff+1,"months");adjust=(b-anchor)/(anchor2-anchor)}return-(wholeMonthDiff+adjust)||0}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function toISOString(){if(!this.isValid()){return null}var m=this.clone().utc();if(m.year()<0||m.year()>9999){return formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}if(isFunction(Date.prototype.toISOString)){return this.toDate().toISOString()}return formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function inspect(){if(!this.isValid()){return"moment.invalid(/* "+this._i+" */)"}var func="moment";var zone="";if(!this.isLocal()){func=this.utcOffset()===0?"moment.utc":"moment.parseZone";zone="Z"}var prefix="["+func+'("]';var year=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY";var datetime="-MM-DD[T]HH:mm:ss.SSS";var suffix=zone+'[")]';return this.format(prefix+year+datetime+suffix)}function format(inputString){if(!inputString){inputString=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat}var output=formatMoment(this,inputString);return this.localeData().postformat(output)}function from(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function fromNow(withoutSuffix){return this.from(createLocal(),withoutSuffix)}function to(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function toNow(withoutSuffix){return this.to(createLocal(),withoutSuffix)}function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr}else{newLocaleData=getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData}return this}}var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){if(key===undefined){return this.localeData()}else{return this.locale(key)}});function localeData(){return this._locale}function startOf(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(units==="week"){this.weekday(0)}if(units==="isoWeek"){this.isoWeekday(1)}if(units==="quarter"){this.month(Math.floor(this.month()/3)*3)}return this}function endOf(units){units=normalizeUnits(units);if(units===undefined||units==="millisecond"){return this}if(units==="date"){units="day"}return this.startOf(units).add(1,units==="isoWeek"?"week":units).subtract(1,"ms")}function valueOf(){return this._d.valueOf()-(this._offset||0)*6e4}function unix(){return Math.floor(this.valueOf()/1e3)}function toDate(){return new Date(this.valueOf())}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$2(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addUnitPriority("weekYear",1);addUnitPriority("isoWeekYear",1);addRegexToken("G",matchSigned);addRegexToken("g",matchSigned);addRegexToken("GG",match1to2,match2);addRegexToken("gg",match1to2,match2);addRegexToken("GGGG",match1to4,match4);addRegexToken("gggg",match1to4,match4);addRegexToken("GGGGG",match1to6,match6);addRegexToken("ggggg",match1to6,match6);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)});addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=hooks.parseTwoDigitYear(input)});function getSetWeekYear(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4)}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;if(input==null){return weekOfYear(this,dow,doy).year}else{weeksTarget=weeksInYear(input,dow,doy);if(week>weeksTarget){week=weeksTarget}return setWeekAll.call(this,input,week,weekday,dow,doy)}}function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);this.year(date.getUTCFullYear());this.month(date.getUTCMonth());this.date(date.getUTCDate());return this}addFormatToken("Q",0,"Qo","quarter");addUnitAlias("quarter","Q");addUnitPriority("quarter",7);addRegexToken("Q",match1);addParseToken("Q",function(input,array){array[MONTH]=(toInt(input)-1)*3});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addUnitPriority("date",9);addRegexToken("D",match1to2);addRegexToken("DD",match1to2,match2);addRegexToken("Do",function(isStrict,locale){return isStrict?locale._dayOfMonthOrdinalParse||locale._ordinalParse:locale._dayOfMonthOrdinalParseLenient});addParseToken(["D","DD"],DATE);addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet("Date",true);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addUnitPriority("dayOfYear",4);addRegexToken("DDD",match1to3);addRegexToken("DDDD",match3);addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)});function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return input==null?dayOfYear:this.add(input-dayOfYear,"d")}addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addUnitPriority("minute",14);addRegexToken("m",match1to2);addRegexToken("mm",match1to2,match2);addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addUnitPriority("second",15);addRegexToken("s",match1to2);addRegexToken("ss",match1to2,match2);addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",false);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,function(){return this.millisecond()*10});addFormatToken(0,["SSSSS",5],0,function(){return this.millisecond()*100});addFormatToken(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});addFormatToken(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});addFormatToken(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});addFormatToken(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});addUnitAlias("millisecond","ms");addUnitPriority("millisecond",16);addRegexToken("S",match1to3,match1);addRegexToken("SS",match1to3,match2);addRegexToken("SSS",match1to3,match3);var token;for(token="SSSS";token.length<=9;token+="S"){addRegexToken(token,matchUnsigned)}function parseMs(input,array){array[MILLISECOND]=toInt(("0."+input)*1e3)}for(token="S";token.length<=9;token+="S"){addParseToken(token,parseMs)}var getSetMillisecond=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var proto=Moment.prototype;proto.add=add;proto.calendar=calendar$1;proto.clone=clone;proto.diff=diff;proto.endOf=endOf;proto.format=format;proto.from=from;proto.fromNow=fromNow;proto.to=to;proto.toNow=toNow;proto.get=stringGet;proto.invalidAt=invalidAt;proto.isAfter=isAfter;proto.isBefore=isBefore;proto.isBetween=isBetween;proto.isSame=isSame;proto.isSameOrAfter=isSameOrAfter;proto.isSameOrBefore=isSameOrBefore;proto.isValid=isValid$2;proto.lang=lang;proto.locale=locale;proto.localeData=localeData;proto.max=prototypeMax;proto.min=prototypeMin;proto.parsingFlags=parsingFlags;proto.set=stringSet;proto.startOf=startOf;proto.subtract=subtract;proto.toArray=toArray;proto.toObject=toObject;proto.toDate=toDate;proto.toISOString=toISOString;proto.inspect=inspect;proto.toJSON=toJSON;proto.toString=toString;proto.unix=unix;proto.valueOf=valueOf;proto.creationData=creationData;proto.year=getSetYear;proto.isLeapYear=getIsLeapYear;proto.weekYear=getSetWeekYear;proto.isoWeekYear=getSetISOWeekYear;proto.quarter=proto.quarters=getSetQuarter;proto.month=getSetMonth;proto.daysInMonth=getDaysInMonth;proto.week=proto.weeks=getSetWeek;proto.isoWeek=proto.isoWeeks=getSetISOWeek;proto.weeksInYear=getWeeksInYear;proto.isoWeeksInYear=getISOWeeksInYear;proto.date=getSetDayOfMonth;proto.day=proto.days=getSetDayOfWeek;proto.weekday=getSetLocaleDayOfWeek;proto.isoWeekday=getSetISODayOfWeek;proto.dayOfYear=getSetDayOfYear;proto.hour=proto.hours=getSetHour;proto.minute=proto.minutes=getSetMinute;proto.second=proto.seconds=getSetSecond;proto.millisecond=proto.milliseconds=getSetMillisecond;proto.utcOffset=getSetOffset;proto.utc=setOffsetToUTC;proto.local=setOffsetToLocal;proto.parseZone=setOffsetToParsedOffset;proto.hasAlignedHourOffset=hasAlignedHourOffset;proto.isDST=isDaylightSavingTime;proto.isLocal=isLocal;proto.isUtcOffset=isUtcOffset;proto.isUtc=isUtc;proto.isUTC=isUtc;proto.zoneAbbr=getZoneAbbr;proto.zoneName=getZoneName;proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth);proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear);proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",getSetZone);proto.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",isDaylightSavingTimeShifted);function createUnix(input){return createLocal(input*1e3)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(string){return string}var proto$1=Locale.prototype;proto$1.calendar=calendar;proto$1.longDateFormat=longDateFormat;proto$1.invalidDate=invalidDate;proto$1.ordinal=ordinal;proto$1.preparse=preParsePostFormat;proto$1.postformat=preParsePostFormat;proto$1.relativeTime=relativeTime;proto$1.pastFuture=pastFuture;proto$1.set=set;proto$1.months=localeMonths;proto$1.monthsShort=localeMonthsShort;proto$1.monthsParse=localeMonthsParse;proto$1.monthsRegex=monthsRegex;proto$1.monthsShortRegex=monthsShortRegex;proto$1.week=localeWeek;proto$1.firstDayOfYear=localeFirstDayOfYear;proto$1.firstDayOfWeek=localeFirstDayOfWeek;proto$1.weekdays=localeWeekdays;proto$1.weekdaysMin=localeWeekdaysMin;proto$1.weekdaysShort=localeWeekdaysShort;proto$1.weekdaysParse=localeWeekdaysParse;proto$1.weekdaysRegex=weekdaysRegex;proto$1.weekdaysShortRegex=weekdaysShortRegex;proto$1.weekdaysMinRegex=weekdaysMinRegex;proto$1.isPM=localeIsPM;proto$1.meridiem=localeMeridiem;function get$1(format,index,field,setter){var locale=getLocale();var utc=createUTC().set(setter,index);return locale[field](utc,format)}function listMonthsImpl(format,index,field){if(isNumber(format)){index=format;format=undefined}format=format||"";if(index!=null){return get$1(format,index,field,"month")}var i;var out=[];for(i=0;i<12;i++){out[i]=get$1(format,i,field,"month")}return out}function listWeekdaysImpl(localeSorted,format,index,field){if(typeof localeSorted==="boolean"){if(isNumber(format)){index=format;format=undefined}format=format||""}else{format=localeSorted;index=format;localeSorted=false;if(isNumber(format)){index=format;format=undefined}format=format||""}var locale=getLocale(),shift=localeSorted?locale._week.dow:0;if(index!=null){return get$1(format,(index+shift)%7,field,"day")}var i;var out=[];for(i=0;i<7;i++){out[i]=get$1(format,(i+shift)%7,field,"day")}return out}function listMonths(format,index){return listMonthsImpl(format,index,"months")}function listMonthsShort(format,index){return listMonthsImpl(format,index,"monthsShort")}function listWeekdays(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdays")}function listWeekdaysShort(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysShort")}function listWeekdaysMin(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysMin")}getSetGlobalLocale("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=toInt(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th";return number+output}});hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale);hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var mathAbs=Math.abs;function abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this}function addSubtract$1(duration,input,value,direction){var other=createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble()}function add$1(input,value){return addSubtract$1(this,input,value,1)}function subtract$1(input,value){return addSubtract$1(this,input,value,-1)}function absCeil(number){if(number<0){return Math.floor(number)}else{return Math.ceil(number)}}function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years,monthsFromDays;if(!(milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0)){milliseconds+=absCeil(monthsToDays(months)+days)*864e5;days=0;months=0}data.milliseconds=milliseconds%1e3;seconds=absFloor(milliseconds/1e3);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);monthsFromDays=absFloor(daysToMonths(days));months+=monthsFromDays;days-=absCeil(monthsToDays(monthsFromDays));years=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this}function daysToMonths(days){return days*4800/146097}function monthsToDays(months){return months*146097/4800}function as(units){if(!this.isValid()){return NaN}var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==="month"||units==="year"){days=this._days+milliseconds/864e5;months=this._months+daysToMonths(days);return units==="month"?months:months/12}else{days=this._days+Math.round(monthsToDays(this._months));switch(units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return days*24+milliseconds/36e5;case"minute":return days*1440+milliseconds/6e4;case"second":return days*86400+milliseconds/1e3;case"millisecond":return Math.floor(days*864e5)+milliseconds;default:throw new Error("Unknown unit "+units)}}}function valueOf$1(){if(!this.isValid()){return NaN}return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs("ms");var asSeconds=makeAs("s");var asMinutes=makeAs("m");var asHours=makeAs("h");var asDays=makeAs("d");var asWeeks=makeAs("w");var asMonths=makeAs("M");var asYears=makeAs("y");function get$2(units){units=normalizeUnits(units);return this.isValid()?this[units+"s"]():NaN}function makeGetter(name){return function(){return this.isValid()?this._data[name]:NaN}}var milliseconds=makeGetter("milliseconds");var seconds=makeGetter("seconds");var minutes=makeGetter("minutes");var hours=makeGetter("hours");var days=makeGetter("days");var months=makeGetter("months");var years=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var round=Math.round;var thresholds={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime$1(posNegDuration,withoutSuffix,locale){var duration=createDuration(posNegDuration).abs();var seconds=round(duration.as("s"));var minutes=round(duration.as("m"));var hours=round(duration.as("h"));var days=round(duration.as("d"));var months=round(duration.as("M"));var years=round(duration.as("y"));var a=seconds<=thresholds.ss&&["s",seconds]||seconds<thresholds.s&&["ss",seconds]||minutes<=1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours<=1&&["h"]||hours<thresholds.h&&["hh",hours]||days<=1&&["d"]||days<thresholds.d&&["dd",days]||months<=1&&["M"]||months<thresholds.M&&["MM",months]||years<=1&&["y"]||["yy",years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a)}function getSetRelativeTimeRounding(roundingFunction){if(roundingFunction===undefined){return round}if(typeof roundingFunction==="function"){round=roundingFunction;return true}return false}function getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false}if(limit===undefined){return thresholds[threshold]}thresholds[threshold]=limit;if(threshold==="s"){thresholds.ss=limit-1}return true}function humanize(withSuffix){if(!this.isValid()){return this.localeData().invalidDate()}var locale=this.localeData();var output=relativeTime$1(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output)}return locale.postformat(output)}var abs$1=Math.abs;function toISOString$1(){if(!this.isValid()){return this.localeData().invalidDate()}var seconds=abs$1(this._milliseconds)/1e3;var days=abs$1(this._days);var months=abs$1(this._months);var minutes,hours,years;minutes=absFloor(seconds/60);hours=absFloor(minutes/60);seconds%=60;minutes%=60;years=absFloor(months/12);months%=12;var Y=years;var M=months;var D=days;var h=hours;var m=minutes;var s=seconds;var total=this.asSeconds();if(!total){return"P0D"}return(total<0?"-":"")+"P"+(Y?Y+"Y":"")+(M?M+"M":"")+(D?D+"D":"")+(h||m||s?"T":"")+(h?h+"H":"")+(m?m+"M":"")+(s?s+"S":"")}var proto$2=Duration.prototype;proto$2.isValid=isValid$1;proto$2.abs=abs;proto$2.add=add$1;proto$2.subtract=subtract$1;proto$2.as=as;proto$2.asMilliseconds=asMilliseconds;proto$2.asSeconds=asSeconds;proto$2.asMinutes=asMinutes;proto$2.asHours=asHours;proto$2.asDays=asDays;proto$2.asWeeks=asWeeks;proto$2.asMonths=asMonths;proto$2.asYears=asYears;proto$2.valueOf=valueOf$1;proto$2._bubble=bubble;proto$2.get=get$2;proto$2.milliseconds=milliseconds;proto$2.seconds=seconds;proto$2.minutes=minutes;proto$2.hours=hours;proto$2.days=days;proto$2.weeks=weeks;proto$2.months=months;proto$2.years=years;proto$2.humanize=humanize;proto$2.toISOString=toISOString$1;proto$2.toString=toISOString$1;proto$2.toJSON=toISOString$1;proto$2.locale=locale;proto$2.localeData=localeData;proto$2.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1);proto$2.lang=lang;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",matchSigned);addRegexToken("X",matchTimestamp);addParseToken("X",function(input,array,config){config._d=new Date(parseFloat(input,10)*1e3)});addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))});hooks.version="2.18.1";setHookCallback(createLocal);hooks.fn=proto;hooks.min=min;hooks.max=max;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=proto;return hooks})},{}],218:[function(require,module,exports){var R=require("ramda");var sax=require("sax");function AugmentedDiffParser(xmlData,changesetsFilter,callback){var xmlParser=sax.parser(true,{lowercase:true});var currentAction="";var currentElement={};var oldElement={};var currentMember={};var currentMode="";var changesetMap={};function isElement(symbol){return symbol==="node"||symbol==="way"||symbol==="relation"}function endTag(symbol){if(symbol==="action"){var changeset=currentElement.changeset;if(changesetsFilter&&changesetsFilter.length){if(changesetsFilter.indexOf(changeset)!==-1){if(changesetMap[changeset]){changesetMap[changeset].push(currentElement)}else{changesetMap[changeset]=[currentElement]}}}else{if(changesetMap[changeset]){changesetMap[changeset].push(currentElement)}else{changesetMap[changeset]=[currentElement]}}}if(symbol==="osm"){callback(null,changesetMap)}}function startTag(node){var symbol=node.name;var attrs=node.attributes;if(symbol==="action"){currentAction=attrs.type}if(symbol==="new"||symbol==="old"){currentMode=symbol}if(isElement(symbol)){if(currentMode==="new"&&(currentAction==="modify"||currentAction==="delete")){oldElement=R.clone(currentElement);currentElement=attrs;currentElement.old=oldElement}else{currentElement=attrs}currentElement.action=currentAction;currentElement.type=symbol;currentElement.tags={};if(symbol==="way"){currentElement.nodes=[]}if(symbol==="relation"){currentElement.members=[];currentMember={}}}if(symbol==="tag"&&currentElement){currentElement.tags[attrs.k]=attrs.v}if(symbol==="nd"&&currentElement&&currentElement.type==="way"){currentElement.nodes.push(attrs)}if(symbol==="nd"&&currentElement&&currentElement.type==="relation"){
currentMember.nodes.push(attrs)}if(symbol==="member"&&currentElement&&currentElement.type==="relation"){currentMember=R.clone(attrs);currentMember.nodes=[];currentElement.members.push(currentMember)}}xmlParser.onopentag=startTag;xmlParser.onclosetag=endTag;xmlParser.onerror=function(err){callback(err,null)};xmlParser.write(xmlData)}module.exports=AugmentedDiffParser},{ramda:226,sax:548}],219:[function(require,module,exports){var trim=require("trim"),forEach=require("for-each"),isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"};module.exports=function(headers){if(!headers)return{};var result={};forEach(trim(headers).split("\n"),function(row){var index=row.indexOf(":"),key=trim(row.slice(0,index)).toLowerCase(),value=trim(row.slice(index+1));if(typeof result[key]==="undefined"){result[key]=value}else if(isArray(result[key])){result[key].push(value)}else{result[key]=[result[key],value]}});return result}},{"for-each":23,trim:554}],220:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:13}],221:[function(require,module,exports){"use strict";module.exports=Buffer;var ieee754=require("ieee754");var BufferMethods;function Buffer(length){var arr;if(length&&length.length){arr=length;length=arr.length}var buf=new Uint8Array(length||0);if(arr)buf.set(arr);buf.readUInt32LE=BufferMethods.readUInt32LE;buf.writeUInt32LE=BufferMethods.writeUInt32LE;buf.readInt32LE=BufferMethods.readInt32LE;buf.writeInt32LE=BufferMethods.writeInt32LE;buf.readFloatLE=BufferMethods.readFloatLE;buf.writeFloatLE=BufferMethods.writeFloatLE;buf.readDoubleLE=BufferMethods.readDoubleLE;buf.writeDoubleLE=BufferMethods.writeDoubleLE;buf.toString=BufferMethods.toString;buf.write=BufferMethods.write;buf.slice=BufferMethods.slice;buf.copy=BufferMethods.copy;buf._isBuffer=true;return buf}var lastStr,lastStrEncoded;BufferMethods={readUInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+this[pos+3]*16777216},writeUInt32LE:function(val,pos){this[pos]=val;this[pos+1]=val>>>8;this[pos+2]=val>>>16;this[pos+3]=val>>>24},readInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+(this[pos+3]<<24)},readFloatLE:function(pos){return ieee754.read(this,pos,true,23,4)},readDoubleLE:function(pos){return ieee754.read(this,pos,true,52,8)},writeFloatLE:function(val,pos){return ieee754.write(this,val,pos,true,23,4)},writeDoubleLE:function(val,pos){return ieee754.write(this,val,pos,true,52,8)},toString:function(encoding,start,end){var str="",tmp="";start=start||0;end=Math.min(this.length,end||this.length);for(var i=start;i<end;i++){var ch=this[i];if(ch<=127){str+=decodeURIComponent(tmp)+String.fromCharCode(ch);tmp=""}else{tmp+="%"+ch.toString(16)}}str+=decodeURIComponent(tmp);return str},write:function(str,pos){var bytes=str===lastStr?lastStrEncoded:encodeString(str);for(var i=0;i<bytes.length;i++){this[pos+i]=bytes[i]}},slice:function(start,end){return this.subarray(start,end)},copy:function(buf,pos){pos=pos||0;for(var i=0;i<this.length;i++){buf[pos+i]=this[i]}}};BufferMethods.writeInt32LE=BufferMethods.writeUInt32LE;Buffer.byteLength=function(str){lastStr=str;lastStrEncoded=encodeString(str);return lastStrEncoded.length};Buffer.isBuffer=function(buf){return!!(buf&&buf._isBuffer)};function encodeString(str){var length=str.length,bytes=[];for(var i=0,c,lead;i<length;i++){c=str.charCodeAt(i);if(c>55295&&c<57344){if(lead){if(c<56320){bytes.push(239,191,189);lead=c;continue}else{c=lead-55296<<10|c-56320|65536;lead=null}}else{if(c>56319||i+1===length)bytes.push(239,191,189);else lead=c;continue}}else if(lead){bytes.push(239,191,189);lead=null}if(c<128)bytes.push(c);else if(c<2048)bytes.push(c>>6|192,c&63|128);else if(c<65536)bytes.push(c>>12|224,c>>6&63|128,c&63|128);else bytes.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}return bytes}},{ieee754:36}],222:[function(require,module,exports){(function(global){"use strict";module.exports=Pbf;var Buffer=global.Buffer||require("./buffer");function Pbf(buf){this.buf=!Buffer.isBuffer(buf)?new Buffer(buf||0):buf;this.pos=0;this.length=this.buf.length}Pbf.Varint=0;Pbf.Fixed64=1;Pbf.Bytes=2;Pbf.Fixed32=5;var SHIFT_LEFT_32=(1<<16)*(1<<16),SHIFT_RIGHT_32=1/SHIFT_LEFT_32,POW_2_63=Math.pow(2,63);Pbf.prototype={destroy:function(){this.buf=null},readFields:function(readField,result,end){end=end||this.length;while(this.pos<end){var val=this.readVarint(),tag=val>>3,startPos=this.pos;readField(tag,result,this);if(this.pos===startPos)this.skip(val)}return result},readMessage:function(readField,result){return this.readFields(readField,result,this.readVarint()+this.pos)},readFixed32:function(){var val=this.buf.readUInt32LE(this.pos);this.pos+=4;return val},readSFixed32:function(){var val=this.buf.readInt32LE(this.pos);this.pos+=4;return val},readFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*SHIFT_LEFT_32;this.pos+=8;return val},readSFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*SHIFT_LEFT_32;this.pos+=8;return val},readFloat:function(){var val=this.buf.readFloatLE(this.pos);this.pos+=4;return val},readDouble:function(){var val=this.buf.readDoubleLE(this.pos);this.pos+=8;return val},readVarint:function(){var buf=this.buf,val,b;b=buf[this.pos++];val=b&127;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<7;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<14;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<21;if(b<128)return val;return readVarintRemainder(val,this)},readVarint64:function(){var startPos=this.pos,val=this.readVarint();if(val<POW_2_63)return val;var pos=this.pos-2;while(this.buf[pos]===255)pos--;if(pos<startPos)pos=startPos;val=0;for(var i=0;i<pos-startPos+1;i++){var b=~this.buf[startPos+i]&127;val+=i<4?b<<i*7:b*Math.pow(2,i*7)}return-val-1},readSVarint:function(){var num=this.readVarint();return num%2===1?(num+1)/-2:num/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var end=this.readVarint()+this.pos,str=this.buf.toString("utf8",this.pos,end);this.pos=end;return str},readBytes:function(){var end=this.readVarint()+this.pos,buffer=this.buf.slice(this.pos,end);this.pos=end;return buffer},readPackedVarint:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readVarint());return arr},readPackedSVarint:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSVarint());return arr},readPackedBoolean:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readBoolean());return arr},readPackedFloat:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFloat());return arr},readPackedDouble:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readDouble());return arr},readPackedFixed32:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFixed32());return arr},readPackedSFixed32:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSFixed32());return arr},readPackedFixed64:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFixed64());return arr},readPackedSFixed64:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSFixed64());return arr},skip:function(val){var type=val&7;if(type===Pbf.Varint)while(this.buf[this.pos++]>127){}else if(type===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(type===Pbf.Fixed32)this.pos+=4;else if(type===Pbf.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+type)},writeTag:function(tag,type){this.writeVarint(tag<<3|type)},realloc:function(min){var length=this.length||16;while(length<this.pos+min)length*=2;if(length!==this.length){var buf=new Buffer(length);this.buf.copy(buf);this.buf=buf;this.length=length}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.slice(0,this.length)},writeFixed32:function(val){this.realloc(4);this.buf.writeUInt32LE(val,this.pos);this.pos+=4},writeSFixed32:function(val){this.realloc(4);this.buf.writeInt32LE(val,this.pos);this.pos+=4},writeFixed64:function(val){this.realloc(8);this.buf.writeInt32LE(val&-1,this.pos);this.buf.writeUInt32LE(Math.floor(val*SHIFT_RIGHT_32),this.pos+4);this.pos+=8},writeSFixed64:function(val){this.realloc(8);this.buf.writeInt32LE(val&-1,this.pos);this.buf.writeInt32LE(Math.floor(val*SHIFT_RIGHT_32),this.pos+4);this.pos+=8},writeVarint:function(val){val=+val;if(val>268435455){writeBigVarint(val,this);return}this.realloc(4);this.buf[this.pos++]=val&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=(val>>>=7)&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=(val>>>=7)&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=val>>>7&127},writeSVarint:function(val){this.writeVarint(val<0?-val*2-1:val*2)},writeBoolean:function(val){this.writeVarint(Boolean(val))},writeString:function(str){str=String(str);var bytes=Buffer.byteLength(str);this.writeVarint(bytes);this.realloc(bytes);this.buf.write(str,this.pos);this.pos+=bytes},writeFloat:function(val){this.realloc(4);this.buf.writeFloatLE(val,this.pos);this.pos+=4},writeDouble:function(val){this.realloc(8);this.buf.writeDoubleLE(val,this.pos);this.pos+=8},writeBytes:function(buffer){var len=buffer.length;this.writeVarint(len);this.realloc(len);for(var i=0;i<len;i++)this.buf[this.pos++]=buffer[i]},writeRawMessage:function(fn,obj){this.pos++;var startPos=this.pos;fn(obj,this);var len=this.pos-startPos;if(len>=128)reallocForRawMessage(startPos,len,this);this.pos=startPos-1;this.writeVarint(len);this.pos+=len},writeMessage:function(tag,fn,obj){this.writeTag(tag,Pbf.Bytes);this.writeRawMessage(fn,obj)},writePackedVarint:function(tag,arr){this.writeMessage(tag,writePackedVarint,arr)},writePackedSVarint:function(tag,arr){this.writeMessage(tag,writePackedSVarint,arr)},writePackedBoolean:function(tag,arr){this.writeMessage(tag,writePackedBoolean,arr)},writePackedFloat:function(tag,arr){this.writeMessage(tag,writePackedFloat,arr)},writePackedDouble:function(tag,arr){this.writeMessage(tag,writePackedDouble,arr)},writePackedFixed32:function(tag,arr){this.writeMessage(tag,writePackedFixed32,arr)},writePackedSFixed32:function(tag,arr){this.writeMessage(tag,writePackedSFixed32,arr)},writePackedFixed64:function(tag,arr){this.writeMessage(tag,writePackedFixed64,arr)},writePackedSFixed64:function(tag,arr){this.writeMessage(tag,writePackedSFixed64,arr)},writeBytesField:function(tag,buffer){this.writeTag(tag,Pbf.Bytes);this.writeBytes(buffer)},writeFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeFixed32(val)},writeSFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeSFixed32(val)},writeFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeFixed64(val)},writeSFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeSFixed64(val)},writeVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint);this.writeVarint(val)},writeSVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint);this.writeSVarint(val)},writeStringField:function(tag,str){this.writeTag(tag,Pbf.Bytes);this.writeString(str)},writeFloatField:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeFloat(val)},writeDoubleField:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeDouble(val)},writeBooleanField:function(tag,val){this.writeVarintField(tag,Boolean(val))}};function readVarintRemainder(val,pbf){var buf=pbf.buf,b;b=buf[pbf.pos++];val+=(b&127)*268435456;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*34359738368;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*4398046511104;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*562949953421312;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*72057594037927940;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*0x8000000000000000;if(b<128)return val;throw new Error("Expected varint not more than 10 bytes")}function writeBigVarint(val,pbf){pbf.realloc(10);var maxPos=pbf.pos+10;while(val>=1){if(pbf.pos>=maxPos)throw new Error("Given varint doesn't fit into 10 bytes");var b=val&255;pbf.buf[pbf.pos++]=b|(val>=128?128:0);val/=128}}function reallocForRawMessage(startPos,len,pbf){var extraLen=len<=16383?1:len<=2097151?2:len<=268435455?3:Math.ceil(Math.log(len)/(Math.LN2*7));pbf.realloc(extraLen);for(var i=pbf.pos-1;i>=startPos;i--)pbf.buf[i+extraLen]=pbf.buf[i]}function writePackedVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeVarint(arr[i])}function writePackedSVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSVarint(arr[i])}function writePackedFloat(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFloat(arr[i])}function writePackedDouble(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeDouble(arr[i])}function writePackedBoolean(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeBoolean(arr[i])}function writePackedFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed32(arr[i])}function writePackedSFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed32(arr[i])}function writePackedFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed64(arr[i])}function writePackedSFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed64(arr[i])}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./buffer":221}],223:[function(require,module,exports){"use strict";module.exports=Point;function Point(x,y){this.x=x;this.y=y}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var x=m[0]*this.x+m[1]*this.y,y=m[2]*this.x+m[3]*this.y;this.x=x;this.y=y;return this},_add:function(p){this.x+=p.x;this.y+=p.y;return this},_sub:function(p){this.x-=p.x;this.y-=p.y;return this},_mult:function(k){this.x*=k;this.y*=k;return this},_div:function(k){this.x/=k;this.y/=k;return this},_unit:function(){this._div(this.mag());return this},_perp:function(){var y=this.y;this.y=this.x;this.x=-y;return this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),x=cos*this.x-sin*this.y,y=sin*this.x+cos*this.y;this.x=x;this.y=y;return this},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}};Point.convert=function(a){if(a instanceof Point){return a}if(Array.isArray(a)){return new Point(a[0],a[1])}return a}},{}],224:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:13}],225:[function(require,module,exports){"use strict";module.exports=partialSort;function partialSort(arr,k,left,right,compare){left=left||0;right=right||arr.length-1;compare=compare||defaultCompare;while(right>left){if(right-left>600){var n=right-left+1;var m=k-left+1;var z=Math.log(n);var s=.5*Math.exp(2*z/3);var sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);var newLeft=Math.max(left,Math.floor(k-m*s/n+sd));var newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));partialSort(arr,k,newLeft,newRight,compare)}var t=arr[k];var i=left;var j=right;swap(arr,left,k);if(compare(arr[right],t)>0)swap(arr,left,right);while(i<j){swap(arr,i,j);i++;j--;while(compare(arr[i],t)<0)i++;while(compare(arr[j],t)>0)j--}if(compare(arr[left],t)===0)swap(arr,left,j);else{j++;swap(arr,j,right)}if(j<=k)left=j+1;if(k<=j)right=j-1}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}},{}],226:[function(require,module,exports){module.exports={F:require("./src/F"),T:require("./src/T"),__:require("./src/__"),add:require("./src/add"),addIndex:require("./src/addIndex"),adjust:require("./src/adjust"),all:require("./src/all"),allPass:require("./src/allPass"),always:require("./src/always"),and:require("./src/and"),any:require("./src/any"),anyPass:require("./src/anyPass"),ap:require("./src/ap"),aperture:require("./src/aperture"),append:require("./src/append"),apply:require("./src/apply"),applySpec:require("./src/applySpec"),ascend:require("./src/ascend"),assoc:require("./src/assoc"),assocPath:require("./src/assocPath"),binary:require("./src/binary"),bind:require("./src/bind"),both:require("./src/both"),call:require("./src/call"),chain:require("./src/chain"),clamp:require("./src/clamp"),clone:require("./src/clone"),comparator:require("./src/comparator"),complement:require("./src/complement"),compose:require("./src/compose"),composeK:require("./src/composeK"),composeP:require("./src/composeP"),concat:require("./src/concat"),cond:require("./src/cond"),construct:require("./src/construct"),constructN:require("./src/constructN"),contains:require("./src/contains"),converge:require("./src/converge"),countBy:require("./src/countBy"),curry:require("./src/curry"),curryN:require("./src/curryN"),dec:require("./src/dec"),descend:require("./src/descend"),defaultTo:require("./src/defaultTo"),difference:require("./src/difference"),differenceWith:require("./src/differenceWith"),dissoc:require("./src/dissoc"),dissocPath:require("./src/dissocPath"),divide:require("./src/divide"),drop:require("./src/drop"),dropLast:require("./src/dropLast"),dropLastWhile:require("./src/dropLastWhile"),dropRepeats:require("./src/dropRepeats"),dropRepeatsWith:require("./src/dropRepeatsWith"),dropWhile:require("./src/dropWhile"),either:require("./src/either"),empty:require("./src/empty"),eqBy:require("./src/eqBy"),eqProps:require("./src/eqProps"),equals:require("./src/equals"),evolve:require("./src/evolve"),filter:require("./src/filter"),find:require("./src/find"),findIndex:require("./src/findIndex"),findLast:require("./src/findLast"),findLastIndex:require("./src/findLastIndex"),flatten:require("./src/flatten"),flip:require("./src/flip"),forEach:require("./src/forEach"),forEachObjIndexed:require("./src/forEachObjIndexed"),fromPairs:require("./src/fromPairs"),groupBy:require("./src/groupBy"),groupWith:require("./src/groupWith"),gt:require("./src/gt"),gte:require("./src/gte"),has:require("./src/has"),hasIn:require("./src/hasIn"),head:require("./src/head"),identical:require("./src/identical"),identity:require("./src/identity"),ifElse:require("./src/ifElse"),inc:require("./src/inc"),indexBy:require("./src/indexBy"),indexOf:require("./src/indexOf"),init:require("./src/init"),insert:require("./src/insert"),insertAll:require("./src/insertAll"),intersection:require("./src/intersection"),intersectionWith:require("./src/intersectionWith"),intersperse:require("./src/intersperse"),into:require("./src/into"),invert:require("./src/invert"),invertObj:require("./src/invertObj"),invoker:require("./src/invoker"),is:require("./src/is"),isArrayLike:require("./src/isArrayLike"),isEmpty:require("./src/isEmpty"),isNil:require("./src/isNil"),join:require("./src/join"),juxt:require("./src/juxt"),keys:require("./src/keys"),keysIn:require("./src/keysIn"),last:require("./src/last"),lastIndexOf:require("./src/lastIndexOf"),length:require("./src/length"),lens:require("./src/lens"),lensIndex:require("./src/lensIndex"),lensPath:require("./src/lensPath"),lensProp:require("./src/lensProp"),lift:require("./src/lift"),liftN:require("./src/liftN"),lt:require("./src/lt"),lte:require("./src/lte"),map:require("./src/map"),mapAccum:require("./src/mapAccum"),mapAccumRight:require("./src/mapAccumRight"),mapObjIndexed:require("./src/mapObjIndexed"),match:require("./src/match"),mathMod:require("./src/mathMod"),max:require("./src/max"),maxBy:require("./src/maxBy"),mean:require("./src/mean"),median:require("./src/median"),memoize:require("./src/memoize"),merge:require("./src/merge"),mergeAll:require("./src/mergeAll"),mergeWith:require("./src/mergeWith"),mergeWithKey:require("./src/mergeWithKey"),min:require("./src/min"),minBy:require("./src/minBy"),modulo:require("./src/modulo"),multiply:require("./src/multiply"),nAry:require("./src/nAry"),negate:require("./src/negate"),none:require("./src/none"),not:require("./src/not"),nth:require("./src/nth"),nthArg:require("./src/nthArg"),objOf:require("./src/objOf"),of:require("./src/of"),omit:require("./src/omit"),once:require("./src/once"),or:require("./src/or"),over:require("./src/over"),pair:require("./src/pair"),partial:require("./src/partial"),partialRight:require("./src/partialRight"),partition:require("./src/partition"),path:require("./src/path"),pathEq:require("./src/pathEq"),pathOr:require("./src/pathOr"),pathSatisfies:require("./src/pathSatisfies"),pick:require("./src/pick"),pickAll:require("./src/pickAll"),pickBy:require("./src/pickBy"),pipe:require("./src/pipe"),pipeK:require("./src/pipeK"),pipeP:require("./src/pipeP"),pluck:require("./src/pluck"),prepend:require("./src/prepend"),product:require("./src/product"),project:require("./src/project"),prop:require("./src/prop"),propEq:require("./src/propEq"),propIs:require("./src/propIs"),propOr:require("./src/propOr"),propSatisfies:require("./src/propSatisfies"),props:require("./src/props"),range:require("./src/range"),reduce:require("./src/reduce"),reduceBy:require("./src/reduceBy"),reduceRight:require("./src/reduceRight"),reduceWhile:require("./src/reduceWhile"),reduced:require("./src/reduced"),reject:require("./src/reject"),remove:require("./src/remove"),repeat:require("./src/repeat"),replace:require("./src/replace"),reverse:require("./src/reverse"),scan:require("./src/scan"),sequence:require("./src/sequence"),set:require("./src/set"),slice:require("./src/slice"),sort:require("./src/sort"),sortBy:require("./src/sortBy"),sortWith:require("./src/sortWith"),split:require("./src/split"),splitAt:require("./src/splitAt"),splitEvery:require("./src/splitEvery"),splitWhen:require("./src/splitWhen"),subtract:require("./src/subtract"),sum:require("./src/sum"),symmetricDifference:require("./src/symmetricDifference"),symmetricDifferenceWith:require("./src/symmetricDifferenceWith"),tail:require("./src/tail"),take:require("./src/take"),takeLast:require("./src/takeLast"),takeLastWhile:require("./src/takeLastWhile"),takeWhile:require("./src/takeWhile"),tap:require("./src/tap"),test:require("./src/test"),times:require("./src/times"),toLower:require("./src/toLower"),toPairs:require("./src/toPairs"),toPairsIn:require("./src/toPairsIn"),toString:require("./src/toString"),toUpper:require("./src/toUpper"),transduce:require("./src/transduce"),transpose:require("./src/transpose"),traverse:require("./src/traverse"),trim:require("./src/trim"),tryCatch:require("./src/tryCatch"),type:require("./src/type"),unapply:require("./src/unapply"),unary:require("./src/unary"),uncurryN:require("./src/uncurryN"),unfold:require("./src/unfold"),union:require("./src/union"),unionWith:require("./src/unionWith"),uniq:require("./src/uniq"),uniqBy:require("./src/uniqBy"),uniqWith:require("./src/uniqWith"),unless:require("./src/unless"),unnest:require("./src/unnest"),until:require("./src/until"),update:require("./src/update"),useWith:require("./src/useWith"),values:require("./src/values"),valuesIn:require("./src/valuesIn"),view:require("./src/view"),when:require("./src/when"),where:require("./src/where"),whereEq:require("./src/whereEq"),without:require("./src/without"),xprod:require("./src/xprod"),zip:require("./src/zip"),zipObj:require("./src/zipObj"),zipWith:require("./src/zipWith")}},{"./src/F":227,"./src/T":228,"./src/__":229,"./src/add":230,"./src/addIndex":231,"./src/adjust":232,"./src/all":233,"./src/allPass":234,"./src/always":235,"./src/and":236,"./src/any":237,"./src/anyPass":238,"./src/ap":239,"./src/aperture":240,"./src/append":241,"./src/apply":242,"./src/applySpec":243,"./src/ascend":244,"./src/assoc":245,"./src/assocPath":246,"./src/binary":247,"./src/bind":248,"./src/both":249,"./src/call":250,"./src/chain":251,"./src/clamp":252,"./src/clone":253,"./src/comparator":254,"./src/complement":255,"./src/compose":256,"./src/composeK":257,"./src/composeP":258,"./src/concat":259,"./src/cond":260,"./src/construct":261,"./src/constructN":262,"./src/contains":263,"./src/converge":264,"./src/countBy":265,"./src/curry":266,"./src/curryN":267,"./src/dec":268,"./src/defaultTo":269,"./src/descend":270,"./src/difference":271,"./src/differenceWith":272,"./src/dissoc":273,"./src/dissocPath":274,"./src/divide":275,"./src/drop":276,"./src/dropLast":277,"./src/dropLastWhile":278,"./src/dropRepeats":279,"./src/dropRepeatsWith":280,"./src/dropWhile":281,"./src/either":282,"./src/empty":283,"./src/eqBy":284,"./src/eqProps":285,"./src/equals":286,"./src/evolve":287,"./src/filter":288,"./src/find":289,"./src/findIndex":290,"./src/findLast":291,"./src/findLastIndex":292,"./src/flatten":293,"./src/flip":294,"./src/forEach":295,"./src/forEachObjIndexed":296,"./src/fromPairs":297,"./src/groupBy":298,"./src/groupWith":299,"./src/gt":300,"./src/gte":301,"./src/has":302,"./src/hasIn":303,"./src/head":304,"./src/identical":305,"./src/identity":306,"./src/ifElse":307,"./src/inc":308,"./src/indexBy":309,"./src/indexOf":310,"./src/init":311,"./src/insert":312,"./src/insertAll":313,"./src/intersection":384,"./src/intersectionWith":385,"./src/intersperse":386,"./src/into":387,"./src/invert":388,"./src/invertObj":389,"./src/invoker":390,"./src/is":391,"./src/isArrayLike":392,"./src/isEmpty":393,"./src/isNil":394,"./src/join":395,"./src/juxt":396,"./src/keys":397,"./src/keysIn":398,"./src/last":399,"./src/lastIndexOf":400,"./src/length":401,"./src/lens":402,"./src/lensIndex":403,"./src/lensPath":404,"./src/lensProp":405,"./src/lift":406,"./src/liftN":407,"./src/lt":408,"./src/lte":409,"./src/map":410,"./src/mapAccum":411,"./src/mapAccumRight":412,"./src/mapObjIndexed":413,"./src/match":414,"./src/mathMod":415,"./src/max":416,"./src/maxBy":417,"./src/mean":418,"./src/median":419,"./src/memoize":420,"./src/merge":421,"./src/mergeAll":422,"./src/mergeWith":423,"./src/mergeWithKey":424,"./src/min":425,"./src/minBy":426,"./src/modulo":427,"./src/multiply":428,"./src/nAry":429,"./src/negate":430,"./src/none":431,"./src/not":432,"./src/nth":433,"./src/nthArg":434,"./src/objOf":435,"./src/of":436,"./src/omit":437,"./src/once":438,"./src/or":439,"./src/over":440,"./src/pair":441,"./src/partial":442,"./src/partialRight":443,"./src/partition":444,"./src/path":445,"./src/pathEq":446,"./src/pathOr":447,"./src/pathSatisfies":448,"./src/pick":449,"./src/pickAll":450,"./src/pickBy":451,"./src/pipe":452,"./src/pipeK":453,"./src/pipeP":454,"./src/pluck":455,"./src/prepend":456,"./src/product":457,"./src/project":458,"./src/prop":459,"./src/propEq":460,"./src/propIs":461,"./src/propOr":462,"./src/propSatisfies":463,"./src/props":464,"./src/range":465,"./src/reduce":466,"./src/reduceBy":467,"./src/reduceRight":468,"./src/reduceWhile":469,"./src/reduced":470,"./src/reject":471,"./src/remove":472,"./src/repeat":473,"./src/replace":474,"./src/reverse":475,"./src/scan":476,"./src/sequence":477,"./src/set":478,"./src/slice":479,"./src/sort":480,"./src/sortBy":481,"./src/sortWith":482,"./src/split":483,"./src/splitAt":484,"./src/splitEvery":485,"./src/splitWhen":486,"./src/subtract":487,"./src/sum":488,"./src/symmetricDifference":489,"./src/symmetricDifferenceWith":490,"./src/tail":491,"./src/take":492,"./src/takeLast":493,"./src/takeLastWhile":494,"./src/takeWhile":495,"./src/tap":496,"./src/test":497,"./src/times":498,"./src/toLower":499,"./src/toPairs":500,"./src/toPairsIn":501,"./src/toString":502,"./src/toUpper":503,"./src/transduce":504,"./src/transpose":505,"./src/traverse":506,
"./src/trim":507,"./src/tryCatch":508,"./src/type":509,"./src/unapply":510,"./src/unary":511,"./src/uncurryN":512,"./src/unfold":513,"./src/union":514,"./src/unionWith":515,"./src/uniq":516,"./src/uniqBy":517,"./src/uniqWith":518,"./src/unless":519,"./src/unnest":520,"./src/until":521,"./src/update":522,"./src/useWith":523,"./src/values":524,"./src/valuesIn":525,"./src/view":526,"./src/when":527,"./src/where":528,"./src/whereEq":529,"./src/without":530,"./src/xprod":531,"./src/zip":532,"./src/zipObj":533,"./src/zipWith":534}],227:[function(require,module,exports){var always=require("./always");module.exports=always(false)},{"./always":235}],228:[function(require,module,exports){var always=require("./always");module.exports=always(true)},{"./always":235}],229:[function(require,module,exports){module.exports={"@@functional/placeholder":true}},{}],230:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function add(a,b){return Number(a)+Number(b)})},{"./internal/_curry2":328}],231:[function(require,module,exports){var _concat=require("./internal/_concat");var _curry1=require("./internal/_curry1");var curryN=require("./curryN");module.exports=_curry1(function addIndex(fn){return curryN(fn.length,function(){var idx=0;var origFn=arguments[0];var list=arguments[arguments.length-1];var args=Array.prototype.slice.call(arguments,0);args[0]=function(){var result=origFn.apply(this,_concat(arguments,[idx,list]));idx+=1;return result};return fn.apply(this,args)})})},{"./curryN":267,"./internal/_concat":323,"./internal/_curry1":327}],232:[function(require,module,exports){var _concat=require("./internal/_concat");var _curry3=require("./internal/_curry3");module.exports=_curry3(function adjust(fn,idx,list){if(idx>=list.length||idx<-list.length){return list}var start=idx<0?list.length:0;var _idx=start+idx;var _list=_concat(list);_list[_idx]=fn(list[_idx]);return _list})},{"./internal/_concat":323,"./internal/_curry3":329}],233:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xall=require("./internal/_xall");module.exports=_curry2(_dispatchable(["all"],_xall,function all(fn,list){var idx=0;while(idx<list.length){if(!fn(list[idx])){return false}idx+=1}return true}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xall":364}],234:[function(require,module,exports){var _curry1=require("./internal/_curry1");var curryN=require("./curryN");var max=require("./max");var pluck=require("./pluck");var reduce=require("./reduce");module.exports=_curry1(function allPass(preds){return curryN(reduce(max,0,pluck("length",preds)),function(){var idx=0;var len=preds.length;while(idx<len){if(!preds[idx].apply(this,arguments)){return false}idx+=1}return true})})},{"./curryN":267,"./internal/_curry1":327,"./max":416,"./pluck":455,"./reduce":466}],235:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function always(val){return function(){return val}})},{"./internal/_curry1":327}],236:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function and(a,b){return a&&b})},{"./internal/_curry2":328}],237:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xany=require("./internal/_xany");module.exports=_curry2(_dispatchable(["any"],_xany,function any(fn,list){var idx=0;while(idx<list.length){if(fn(list[idx])){return true}idx+=1}return false}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xany":365}],238:[function(require,module,exports){var _curry1=require("./internal/_curry1");var curryN=require("./curryN");var max=require("./max");var pluck=require("./pluck");var reduce=require("./reduce");module.exports=_curry1(function anyPass(preds){return curryN(reduce(max,0,pluck("length",preds)),function(){var idx=0;var len=preds.length;while(idx<len){if(preds[idx].apply(this,arguments)){return true}idx+=1}return false})})},{"./curryN":267,"./internal/_curry1":327,"./max":416,"./pluck":455,"./reduce":466}],239:[function(require,module,exports){var _concat=require("./internal/_concat");var _curry2=require("./internal/_curry2");var _reduce=require("./internal/_reduce");var map=require("./map");module.exports=_curry2(function ap(applicative,fn){return typeof applicative.ap==="function"?applicative.ap(fn):typeof applicative==="function"?function(x){return applicative(x)(fn(x))}:_reduce(function(acc,f){return _concat(acc,map(f,fn))},[],applicative)})},{"./internal/_concat":323,"./internal/_curry2":328,"./internal/_reduce":359,"./map":410}],240:[function(require,module,exports){var _aperture=require("./internal/_aperture");var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xaperture=require("./internal/_xaperture");module.exports=_curry2(_dispatchable([],_xaperture,_aperture))},{"./internal/_aperture":315,"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xaperture":366}],241:[function(require,module,exports){var _concat=require("./internal/_concat");var _curry2=require("./internal/_curry2");module.exports=_curry2(function append(el,list){return _concat(list,[el])})},{"./internal/_concat":323,"./internal/_curry2":328}],242:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function apply(fn,args){return fn.apply(this,args)})},{"./internal/_curry2":328}],243:[function(require,module,exports){var _curry1=require("./internal/_curry1");var apply=require("./apply");var curryN=require("./curryN");var map=require("./map");var max=require("./max");var pluck=require("./pluck");var reduce=require("./reduce");var values=require("./values");module.exports=_curry1(function applySpec(spec){spec=map(function(v){return typeof v=="function"?v:applySpec(v)},spec);return curryN(reduce(max,0,pluck("length",values(spec))),function(){var args=arguments;return map(function(f){return apply(f,args)},spec)})})},{"./apply":242,"./curryN":267,"./internal/_curry1":327,"./map":410,"./max":416,"./pluck":455,"./reduce":466,"./values":524}],244:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function ascend(fn,a,b){var aa=fn(a);var bb=fn(b);return aa<bb?-1:aa>bb?1:0})},{"./internal/_curry3":329}],245:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function assoc(prop,val,obj){var result={};for(var p in obj){result[p]=obj[p]}result[prop]=val;return result})},{"./internal/_curry3":329}],246:[function(require,module,exports){var _curry3=require("./internal/_curry3");var _has=require("./internal/_has");var _isArray=require("./internal/_isArray");var _isInteger=require("./internal/_isInteger");var assoc=require("./assoc");module.exports=_curry3(function assocPath(path,val,obj){if(path.length===0){return val}var idx=path[0];if(path.length>1){var nextObj=_has(idx,obj)?obj[idx]:_isInteger(path[1])?[]:{};val=assocPath(Array.prototype.slice.call(path,1),val,nextObj)}if(_isInteger(idx)&&_isArray(obj)){var arr=[].concat(obj);arr[idx]=val;return arr}else{return assoc(idx,val,obj)}})},{"./assoc":245,"./internal/_curry3":329,"./internal/_has":339,"./internal/_isArray":343,"./internal/_isInteger":345}],247:[function(require,module,exports){var _curry1=require("./internal/_curry1");var nAry=require("./nAry");module.exports=_curry1(function binary(fn){return nAry(2,fn)})},{"./internal/_curry1":327,"./nAry":429}],248:[function(require,module,exports){var _arity=require("./internal/_arity");var _curry2=require("./internal/_curry2");module.exports=_curry2(function bind(fn,thisObj){return _arity(fn.length,function(){return fn.apply(thisObj,arguments)})})},{"./internal/_arity":316,"./internal/_curry2":328}],249:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isFunction=require("./internal/_isFunction");var and=require("./and");var lift=require("./lift");module.exports=_curry2(function both(f,g){return _isFunction(f)?function _both(){return f.apply(this,arguments)&&g.apply(this,arguments)}:lift(and)(f,g)})},{"./and":236,"./internal/_curry2":328,"./internal/_isFunction":344,"./lift":406}],250:[function(require,module,exports){var curry=require("./curry");module.exports=curry(function call(fn){return fn.apply(this,Array.prototype.slice.call(arguments,1))})},{"./curry":266}],251:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _makeFlat=require("./internal/_makeFlat");var _xchain=require("./internal/_xchain");var map=require("./map");module.exports=_curry2(_dispatchable(["chain"],_xchain,function chain(fn,monad){if(typeof monad==="function"){return function(x){return fn(monad(x))(x)}}return _makeFlat(false)(map(fn,monad))}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_makeFlat":352,"./internal/_xchain":367,"./map":410}],252:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function clamp(min,max,value){if(min>max){throw new Error("min must not be greater than max in clamp(min, max, value)")}return value<min?min:value>max?max:value})},{"./internal/_curry3":329}],253:[function(require,module,exports){var _clone=require("./internal/_clone");var _curry1=require("./internal/_curry1");module.exports=_curry1(function clone(value){return value!=null&&typeof value.clone==="function"?value.clone():_clone(value,[],[],true)})},{"./internal/_clone":320,"./internal/_curry1":327}],254:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function comparator(pred){return function(a,b){return pred(a,b)?-1:pred(b,a)?1:0}})},{"./internal/_curry1":327}],255:[function(require,module,exports){var lift=require("./lift");var not=require("./not");module.exports=lift(not)},{"./lift":406,"./not":432}],256:[function(require,module,exports){var pipe=require("./pipe");var reverse=require("./reverse");module.exports=function compose(){if(arguments.length===0){throw new Error("compose requires at least one argument")}return pipe.apply(this,reverse(arguments))}},{"./pipe":452,"./reverse":475}],257:[function(require,module,exports){var chain=require("./chain");var compose=require("./compose");var map=require("./map");module.exports=function composeK(){if(arguments.length===0){throw new Error("composeK requires at least one argument")}var init=Array.prototype.slice.call(arguments);var last=init.pop();return compose(compose.apply(this,map(chain,init)),last)}},{"./chain":251,"./compose":256,"./map":410}],258:[function(require,module,exports){var pipeP=require("./pipeP");var reverse=require("./reverse");module.exports=function composeP(){if(arguments.length===0){throw new Error("composeP requires at least one argument")}return pipeP.apply(this,reverse(arguments))}},{"./pipeP":454,"./reverse":475}],259:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isArray=require("./internal/_isArray");var _isFunction=require("./internal/_isFunction");var toString=require("./toString");module.exports=_curry2(function concat(a,b){if(a==null||!_isFunction(a.concat)){throw new TypeError(toString(a)+' does not have a method named "concat"')}if(_isArray(a)&&!_isArray(b)){throw new TypeError(toString(b)+" is not an array")}return a.concat(b)})},{"./internal/_curry2":328,"./internal/_isArray":343,"./internal/_isFunction":344,"./toString":502}],260:[function(require,module,exports){var _arity=require("./internal/_arity");var _curry1=require("./internal/_curry1");var map=require("./map");var max=require("./max");var reduce=require("./reduce");module.exports=_curry1(function cond(pairs){var arity=reduce(max,0,map(function(pair){return pair[0].length},pairs));return _arity(arity,function(){var idx=0;while(idx<pairs.length){if(pairs[idx][0].apply(this,arguments)){return pairs[idx][1].apply(this,arguments)}idx+=1}})})},{"./internal/_arity":316,"./internal/_curry1":327,"./map":410,"./max":416,"./reduce":466}],261:[function(require,module,exports){var _curry1=require("./internal/_curry1");var constructN=require("./constructN");module.exports=_curry1(function construct(Fn){return constructN(Fn.length,Fn)})},{"./constructN":262,"./internal/_curry1":327}],262:[function(require,module,exports){var _curry2=require("./internal/_curry2");var curry=require("./curry");var nAry=require("./nAry");module.exports=_curry2(function constructN(n,Fn){if(n>10){throw new Error("Constructor with greater than ten arguments")}if(n===0){return function(){return new Fn}}return curry(nAry(n,function($0,$1,$2,$3,$4,$5,$6,$7,$8,$9){switch(arguments.length){case 1:return new Fn($0);case 2:return new Fn($0,$1);case 3:return new Fn($0,$1,$2);case 4:return new Fn($0,$1,$2,$3);case 5:return new Fn($0,$1,$2,$3,$4);case 6:return new Fn($0,$1,$2,$3,$4,$5);case 7:return new Fn($0,$1,$2,$3,$4,$5,$6);case 8:return new Fn($0,$1,$2,$3,$4,$5,$6,$7);case 9:return new Fn($0,$1,$2,$3,$4,$5,$6,$7,$8);case 10:return new Fn($0,$1,$2,$3,$4,$5,$6,$7,$8,$9)}}))})},{"./curry":266,"./internal/_curry2":328,"./nAry":429}],263:[function(require,module,exports){var _contains=require("./internal/_contains");var _curry2=require("./internal/_curry2");module.exports=_curry2(_contains)},{"./internal/_contains":324,"./internal/_curry2":328}],264:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _map=require("./internal/_map");var curryN=require("./curryN");var max=require("./max");var pluck=require("./pluck");var reduce=require("./reduce");module.exports=_curry2(function converge(after,fns){return curryN(reduce(max,0,pluck("length",fns)),function(){var args=arguments;var context=this;return after.apply(context,_map(function(fn){return fn.apply(context,args)},fns))})})},{"./curryN":267,"./internal/_curry2":328,"./internal/_map":353,"./max":416,"./pluck":455,"./reduce":466}],265:[function(require,module,exports){var reduceBy=require("./reduceBy");module.exports=reduceBy(function(acc,elem){return acc+1},0)},{"./reduceBy":467}],266:[function(require,module,exports){var _curry1=require("./internal/_curry1");var curryN=require("./curryN");module.exports=_curry1(function curry(fn){return curryN(fn.length,fn)})},{"./curryN":267,"./internal/_curry1":327}],267:[function(require,module,exports){var _arity=require("./internal/_arity");var _curry1=require("./internal/_curry1");var _curry2=require("./internal/_curry2");var _curryN=require("./internal/_curryN");module.exports=_curry2(function curryN(length,fn){if(length===1){return _curry1(fn)}return _arity(length,_curryN(length,[],fn))})},{"./internal/_arity":316,"./internal/_curry1":327,"./internal/_curry2":328,"./internal/_curryN":330}],268:[function(require,module,exports){var add=require("./add");module.exports=add(-1)},{"./add":230}],269:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function defaultTo(d,v){return v==null||v!==v?d:v})},{"./internal/_curry2":328}],270:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function descend(fn,a,b){var aa=fn(a);var bb=fn(b);return aa>bb?-1:aa<bb?1:0})},{"./internal/_curry3":329}],271:[function(require,module,exports){var _contains=require("./internal/_contains");var _curry2=require("./internal/_curry2");module.exports=_curry2(function difference(first,second){var out=[];var idx=0;var firstLen=first.length;while(idx<firstLen){if(!_contains(first[idx],second)&&!_contains(first[idx],out)){out[out.length]=first[idx]}idx+=1}return out})},{"./internal/_contains":324,"./internal/_curry2":328}],272:[function(require,module,exports){var _containsWith=require("./internal/_containsWith");var _curry3=require("./internal/_curry3");module.exports=_curry3(function differenceWith(pred,first,second){var out=[];var idx=0;var firstLen=first.length;while(idx<firstLen){if(!_containsWith(pred,first[idx],second)&&!_containsWith(pred,first[idx],out)){out.push(first[idx])}idx+=1}return out})},{"./internal/_containsWith":325,"./internal/_curry3":329}],273:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function dissoc(prop,obj){var result={};for(var p in obj){result[p]=obj[p]}delete result[prop];return result})},{"./internal/_curry2":328}],274:[function(require,module,exports){var _curry2=require("./internal/_curry2");var assoc=require("./assoc");var dissoc=require("./dissoc");module.exports=_curry2(function dissocPath(path,obj){switch(path.length){case 0:return obj;case 1:return dissoc(path[0],obj);default:var head=path[0];var tail=Array.prototype.slice.call(path,1);return obj[head]==null?obj:assoc(head,dissocPath(tail,obj[head]),obj)}})},{"./assoc":245,"./dissoc":273,"./internal/_curry2":328}],275:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function divide(a,b){return a/b})},{"./internal/_curry2":328}],276:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xdrop=require("./internal/_xdrop");var slice=require("./slice");module.exports=_curry2(_dispatchable(["drop"],_xdrop,function drop(n,xs){return slice(Math.max(0,n),Infinity,xs)}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xdrop":368,"./slice":479}],277:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _dropLast=require("./internal/_dropLast");var _xdropLast=require("./internal/_xdropLast");module.exports=_curry2(_dispatchable([],_xdropLast,_dropLast))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_dropLast":332,"./internal/_xdropLast":369}],278:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _dropLastWhile=require("./internal/_dropLastWhile");var _xdropLastWhile=require("./internal/_xdropLastWhile");module.exports=_curry2(_dispatchable([],_xdropLastWhile,_dropLastWhile))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_dropLastWhile":333,"./internal/_xdropLastWhile":370}],279:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _dispatchable=require("./internal/_dispatchable");var _xdropRepeatsWith=require("./internal/_xdropRepeatsWith");var dropRepeatsWith=require("./dropRepeatsWith");var equals=require("./equals");module.exports=_curry1(_dispatchable([],_xdropRepeatsWith(equals),dropRepeatsWith(equals)))},{"./dropRepeatsWith":280,"./equals":286,"./internal/_curry1":327,"./internal/_dispatchable":331,"./internal/_xdropRepeatsWith":371}],280:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xdropRepeatsWith=require("./internal/_xdropRepeatsWith");var last=require("./last");module.exports=_curry2(_dispatchable([],_xdropRepeatsWith,function dropRepeatsWith(pred,list){var result=[];var idx=1;var len=list.length;if(len!==0){result[0]=list[0];while(idx<len){if(!pred(last(result),list[idx])){result[result.length]=list[idx]}idx+=1}}return result}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xdropRepeatsWith":371,"./last":399}],281:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xdropWhile=require("./internal/_xdropWhile");module.exports=_curry2(_dispatchable(["dropWhile"],_xdropWhile,function dropWhile(pred,list){var idx=0;var len=list.length;while(idx<len&&pred(list[idx])){idx+=1}return Array.prototype.slice.call(list,idx)}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xdropWhile":372}],282:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isFunction=require("./internal/_isFunction");var lift=require("./lift");var or=require("./or");module.exports=_curry2(function either(f,g){return _isFunction(f)?function _either(){return f.apply(this,arguments)||g.apply(this,arguments)}:lift(or)(f,g)})},{"./internal/_curry2":328,"./internal/_isFunction":344,"./lift":406,"./or":439}],283:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _isArguments=require("./internal/_isArguments");var _isArray=require("./internal/_isArray");var _isObject=require("./internal/_isObject");var _isString=require("./internal/_isString");module.exports=_curry1(function empty(x){return x!=null&&typeof x.empty==="function"?x.empty():x!=null&&x.constructor!=null&&typeof x.constructor.empty==="function"?x.constructor.empty():_isArray(x)?[]:_isString(x)?"":_isObject(x)?{}:_isArguments(x)?function(){return arguments}():void 0})},{"./internal/_curry1":327,"./internal/_isArguments":342,"./internal/_isArray":343,"./internal/_isObject":347,"./internal/_isString":350}],284:[function(require,module,exports){var _curry3=require("./internal/_curry3");var equals=require("./equals");module.exports=_curry3(function eqBy(f,x,y){return equals(f(x),f(y))})},{"./equals":286,"./internal/_curry3":329}],285:[function(require,module,exports){var _curry3=require("./internal/_curry3");var equals=require("./equals");module.exports=_curry3(function eqProps(prop,obj1,obj2){return equals(obj1[prop],obj2[prop])})},{"./equals":286,"./internal/_curry3":329}],286:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _equals=require("./internal/_equals");module.exports=_curry2(function equals(a,b){return _equals(a,b,[],[])})},{"./internal/_curry2":328,"./internal/_equals":334}],287:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function evolve(transformations,object){var result={};var transformation,key,type;for(key in object){transformation=transformations[key];type=typeof transformation;result[key]=type==="function"?transformation(object[key]):transformation&&type==="object"?evolve(transformation,object[key]):object[key]}return result})},{"./internal/_curry2":328}],288:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _filter=require("./internal/_filter");var _isObject=require("./internal/_isObject");var _reduce=require("./internal/_reduce");var _xfilter=require("./internal/_xfilter");var keys=require("./keys");module.exports=_curry2(_dispatchable(["filter"],_xfilter,function(pred,filterable){return _isObject(filterable)?_reduce(function(acc,key){if(pred(filterable[key])){acc[key]=filterable[key]}return acc},{},keys(filterable)):_filter(pred,filterable)}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_filter":335,"./internal/_isObject":347,"./internal/_reduce":359,"./internal/_xfilter":374,"./keys":397}],289:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xfind=require("./internal/_xfind");module.exports=_curry2(_dispatchable(["find"],_xfind,function find(fn,list){var idx=0;var len=list.length;while(idx<len){if(fn(list[idx])){return list[idx]}idx+=1}}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xfind":375}],290:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xfindIndex=require("./internal/_xfindIndex");module.exports=_curry2(_dispatchable([],_xfindIndex,function findIndex(fn,list){var idx=0;var len=list.length;while(idx<len){if(fn(list[idx])){return idx}idx+=1}return-1}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xfindIndex":376}],291:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xfindLast=require("./internal/_xfindLast");module.exports=_curry2(_dispatchable([],_xfindLast,function findLast(fn,list){var idx=list.length-1;while(idx>=0){if(fn(list[idx])){return list[idx]}idx-=1}}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xfindLast":377}],292:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xfindLastIndex=require("./internal/_xfindLastIndex");module.exports=_curry2(_dispatchable([],_xfindLastIndex,function findLastIndex(fn,list){var idx=list.length-1;while(idx>=0){if(fn(list[idx])){return idx}idx-=1}return-1}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xfindLastIndex":378}],293:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _makeFlat=require("./internal/_makeFlat");module.exports=_curry1(_makeFlat(true))},{"./internal/_curry1":327,"./internal/_makeFlat":352}],294:[function(require,module,exports){var _curry1=require("./internal/_curry1");var curry=require("./curry");module.exports=_curry1(function flip(fn){return curry(function(a,b){var args=Array.prototype.slice.call(arguments,0);args[0]=b;args[1]=a;return fn.apply(this,args)})})},{"./curry":266,"./internal/_curry1":327}],295:[function(require,module,exports){var _checkForMethod=require("./internal/_checkForMethod");var _curry2=require("./internal/_curry2");module.exports=_curry2(_checkForMethod("forEach",function forEach(fn,list){var len=list.length;var idx=0;while(idx<len){fn(list[idx]);idx+=1}return list}))},{"./internal/_checkForMethod":319,"./internal/_curry2":328}],296:[function(require,module,exports){var _curry2=require("./internal/_curry2");var keys=require("./keys");module.exports=_curry2(function forEachObjIndexed(fn,obj){var keyList=keys(obj);var idx=0;while(idx<keyList.length){var key=keyList[idx];fn(obj[key],key,obj);idx+=1}return obj})},{"./internal/_curry2":328,"./keys":397}],297:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function fromPairs(pairs){var result={};var idx=0;while(idx<pairs.length){result[pairs[idx][0]]=pairs[idx][1];idx+=1}return result})},{"./internal/_curry1":327}],298:[function(require,module,exports){var _checkForMethod=require("./internal/_checkForMethod");var _curry2=require("./internal/_curry2");var reduceBy=require("./reduceBy");module.exports=_curry2(_checkForMethod("groupBy",reduceBy(function(acc,item){if(acc==null){acc=[]}acc.push(item);return acc},null)))},{"./internal/_checkForMethod":319,"./internal/_curry2":328,"./reduceBy":467}],299:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function(fn,list){var res=[];var idx=0;var len=list.length;while(idx<len){var nextidx=idx+1;while(nextidx<len&&fn(list[idx],list[nextidx])){nextidx+=1}res.push(list.slice(idx,nextidx));idx=nextidx}return res})},{"./internal/_curry2":328}],300:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function gt(a,b){return a>b})},{"./internal/_curry2":328}],301:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function gte(a,b){return a>=b})},{"./internal/_curry2":328}],302:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _has=require("./internal/_has");module.exports=_curry2(_has)},{"./internal/_curry2":328,"./internal/_has":339}],303:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function hasIn(prop,obj){return prop in obj})},{"./internal/_curry2":328}],304:[function(require,module,exports){var nth=require("./nth");module.exports=nth(0)},{"./nth":433}],305:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function identical(a,b){if(a===b){return a!==0||1/a===1/b}else{return a!==a&&b!==b}})},{"./internal/_curry2":328}],306:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _identity=require("./internal/_identity");module.exports=_curry1(_identity)},{"./internal/_curry1":327,"./internal/_identity":340}],307:[function(require,module,exports){var _curry3=require("./internal/_curry3");var curryN=require("./curryN");module.exports=_curry3(function ifElse(condition,onTrue,onFalse){return curryN(Math.max(condition.length,onTrue.length,onFalse.length),function _ifElse(){return condition.apply(this,arguments)?onTrue.apply(this,arguments):onFalse.apply(this,arguments)})})},{"./curryN":267,"./internal/_curry3":329}],308:[function(require,module,exports){var add=require("./add");module.exports=add(1)},{"./add":230}],309:[function(require,module,exports){var reduceBy=require("./reduceBy");module.exports=reduceBy(function(acc,elem){return elem},null)},{"./reduceBy":467}],310:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _indexOf=require("./internal/_indexOf");var _isArray=require("./internal/_isArray");module.exports=_curry2(function indexOf(target,xs){return typeof xs.indexOf==="function"&&!_isArray(xs)?xs.indexOf(target):_indexOf(xs,target,0)})},{"./internal/_curry2":328,"./internal/_indexOf":341,"./internal/_isArray":343}],311:[function(require,module,exports){var slice=require("./slice");module.exports=slice(0,-1)},{"./slice":479}],312:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function insert(idx,elt,list){idx=idx<list.length&&idx>=0?idx:list.length;var result=Array.prototype.slice.call(list,0);result.splice(idx,0,elt);return result})},{"./internal/_curry3":329}],313:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function insertAll(idx,elts,list){idx=idx<list.length&&idx>=0?idx:list.length;return[].concat(Array.prototype.slice.call(list,0,idx),elts,Array.prototype.slice.call(list,idx))})},{"./internal/_curry3":329}],314:[function(require,module,exports){var _contains=require("./_contains");module.exports=function(){function _Set(){this._nativeSet=typeof Set==="function"?new Set:null;this._items={}}_Set.prototype.add=function(item){return!hasOrAdd(item,true,this)};_Set.prototype.has=function(item){return hasOrAdd(item,false,this)};function hasOrAdd(item,shouldAdd,set){var type=typeof item;var prevSize,newSize;switch(type){case"string":case"number":if(item===0&&1/item===-Infinity){if(set._items["-0"]){return true}else{if(shouldAdd){set._items["-0"]=true}return false}}if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize===prevSize}else{return set._nativeSet.has(item)}}else{if(!(type in set._items)){if(shouldAdd){set._items[type]={};set._items[type][item]=true}return false}else if(item in set._items[type]){return true}else{if(shouldAdd){set._items[type][item]=true}return false}}case"boolean":if(type in set._items){var bIdx=item?1:0;if(set._items[type][bIdx]){return true}else{if(shouldAdd){set._items[type][bIdx]=true}return false}}else{if(shouldAdd){set._items[type]=item?[false,true]:[true,false]}return false}case"function":if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize===prevSize}else{return set._nativeSet.has(item)}}else{if(!(type in set._items)){if(shouldAdd){set._items[type]=[item]}return false}if(!_contains(item,set._items[type])){if(shouldAdd){set._items[type].push(item)}return false}return true}case"undefined":if(set._items[type]){return true}else{if(shouldAdd){set._items[type]=true}return false}case"object":if(item===null){if(!set._items["null"]){if(shouldAdd){set._items["null"]=true}return false}return true}default:type=Object.prototype.toString.call(item);if(!(type in set._items)){if(shouldAdd){set._items[type]=[item]}return false}if(!_contains(item,set._items[type])){if(shouldAdd){set._items[type].push(item);

}return false}return true}}return _Set}()},{"./_contains":324}],315:[function(require,module,exports){module.exports=function _aperture(n,list){var idx=0;var limit=list.length-(n-1);var acc=new Array(limit>=0?limit:0);while(idx<limit){acc[idx]=Array.prototype.slice.call(list,idx,idx+n);idx+=1}return acc}},{}],316:[function(require,module,exports){module.exports=function _arity(n,fn){switch(n){case 0:return function(){return fn.apply(this,arguments)};case 1:return function(a0){return fn.apply(this,arguments)};case 2:return function(a0,a1){return fn.apply(this,arguments)};case 3:return function(a0,a1,a2){return fn.apply(this,arguments)};case 4:return function(a0,a1,a2,a3){return fn.apply(this,arguments)};case 5:return function(a0,a1,a2,a3,a4){return fn.apply(this,arguments)};case 6:return function(a0,a1,a2,a3,a4,a5){return fn.apply(this,arguments)};case 7:return function(a0,a1,a2,a3,a4,a5,a6){return fn.apply(this,arguments)};case 8:return function(a0,a1,a2,a3,a4,a5,a6,a7){return fn.apply(this,arguments)};case 9:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8){return fn.apply(this,arguments)};case 10:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9){return fn.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}},{}],317:[function(require,module,exports){module.exports=function _arrayFromIterator(iter){var list=[];var next;while(!(next=iter.next()).done){list.push(next.value)}return list}},{}],318:[function(require,module,exports){var _objectAssign=require("./_objectAssign");module.exports=typeof Object.assign==="function"?Object.assign:_objectAssign},{"./_objectAssign":354}],319:[function(require,module,exports){var _isArray=require("./_isArray");module.exports=function _checkForMethod(methodname,fn){return function(){var length=arguments.length;if(length===0){return fn()}var obj=arguments[length-1];return _isArray(obj)||typeof obj[methodname]!=="function"?fn.apply(this,arguments):obj[methodname].apply(obj,Array.prototype.slice.call(arguments,0,length-1))}}},{"./_isArray":343}],320:[function(require,module,exports){var _cloneRegExp=require("./_cloneRegExp");var type=require("../type");module.exports=function _clone(value,refFrom,refTo,deep){var copy=function copy(copiedValue){var len=refFrom.length;var idx=0;while(idx<len){if(value===refFrom[idx]){return refTo[idx]}idx+=1}refFrom[idx+1]=value;refTo[idx+1]=copiedValue;for(var key in value){copiedValue[key]=deep?_clone(value[key],refFrom,refTo,true):value[key]}return copiedValue};switch(type(value)){case"Object":return copy({});case"Array":return copy([]);case"Date":return new Date(value.valueOf());case"RegExp":return _cloneRegExp(value);default:return value}}},{"../type":509,"./_cloneRegExp":321}],321:[function(require,module,exports){module.exports=function _cloneRegExp(pattern){return new RegExp(pattern.source,(pattern.global?"g":"")+(pattern.ignoreCase?"i":"")+(pattern.multiline?"m":"")+(pattern.sticky?"y":"")+(pattern.unicode?"u":""))}},{}],322:[function(require,module,exports){module.exports=function _complement(f){return function(){return!f.apply(this,arguments)}}},{}],323:[function(require,module,exports){module.exports=function _concat(set1,set2){set1=set1||[];set2=set2||[];var idx;var len1=set1.length;var len2=set2.length;var result=[];idx=0;while(idx<len1){result[result.length]=set1[idx];idx+=1}idx=0;while(idx<len2){result[result.length]=set2[idx];idx+=1}return result}},{}],324:[function(require,module,exports){var _indexOf=require("./_indexOf");module.exports=function _contains(a,list){return _indexOf(list,a,0)>=0}},{"./_indexOf":341}],325:[function(require,module,exports){module.exports=function _containsWith(pred,x,list){var idx=0;var len=list.length;while(idx<len){if(pred(x,list[idx])){return true}idx+=1}return false}},{}],326:[function(require,module,exports){var _arity=require("./_arity");var _curry2=require("./_curry2");module.exports=function _createPartialApplicator(concat){return _curry2(function(fn,args){return _arity(Math.max(0,fn.length-args.length),function(){return fn.apply(this,concat(args,arguments))})})}},{"./_arity":316,"./_curry2":328}],327:[function(require,module,exports){var _isPlaceholder=require("./_isPlaceholder");module.exports=function _curry1(fn){return function f1(a){if(arguments.length===0||_isPlaceholder(a)){return f1}else{return fn.apply(this,arguments)}}}},{"./_isPlaceholder":348}],328:[function(require,module,exports){var _curry1=require("./_curry1");var _isPlaceholder=require("./_isPlaceholder");module.exports=function _curry2(fn){return function f2(a,b){switch(arguments.length){case 0:return f2;case 1:return _isPlaceholder(a)?f2:_curry1(function(_b){return fn(a,_b)});default:return _isPlaceholder(a)&&_isPlaceholder(b)?f2:_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b)}):fn(a,b)}}}},{"./_curry1":327,"./_isPlaceholder":348}],329:[function(require,module,exports){var _curry1=require("./_curry1");var _curry2=require("./_curry2");var _isPlaceholder=require("./_isPlaceholder");module.exports=function _curry3(fn){return function f3(a,b,c){switch(arguments.length){case 0:return f3;case 1:return _isPlaceholder(a)?f3:_curry2(function(_b,_c){return fn(a,_b,_c)});case 2:return _isPlaceholder(a)&&_isPlaceholder(b)?f3:_isPlaceholder(a)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_curry1(function(_c){return fn(a,b,_c)});default:return _isPlaceholder(a)&&_isPlaceholder(b)&&_isPlaceholder(c)?f3:_isPlaceholder(a)&&_isPlaceholder(b)?_curry2(function(_a,_b){return fn(_a,_b,c)}):_isPlaceholder(a)&&_isPlaceholder(c)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)&&_isPlaceholder(c)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b,c)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b,c)}):_isPlaceholder(c)?_curry1(function(_c){return fn(a,b,_c)}):fn(a,b,c)}}}},{"./_curry1":327,"./_curry2":328,"./_isPlaceholder":348}],330:[function(require,module,exports){var _arity=require("./_arity");var _isPlaceholder=require("./_isPlaceholder");module.exports=function _curryN(length,received,fn){return function(){var combined=[];var argsIdx=0;var left=length;var combinedIdx=0;while(combinedIdx<received.length||argsIdx<arguments.length){var result;if(combinedIdx<received.length&&(!_isPlaceholder(received[combinedIdx])||argsIdx>=arguments.length)){result=received[combinedIdx]}else{result=arguments[argsIdx];argsIdx+=1}combined[combinedIdx]=result;if(!_isPlaceholder(result)){left-=1}combinedIdx+=1}return left<=0?fn.apply(this,combined):_arity(left,_curryN(length,combined,fn))}}},{"./_arity":316,"./_isPlaceholder":348}],331:[function(require,module,exports){var _isArray=require("./_isArray");var _isTransformer=require("./_isTransformer");module.exports=function _dispatchable(methodNames,xf,fn){return function(){if(arguments.length===0){return fn()}var args=Array.prototype.slice.call(arguments,0);var obj=args.pop();if(!_isArray(obj)){var idx=0;while(idx<methodNames.length){if(typeof obj[methodNames[idx]]==="function"){return obj[methodNames[idx]].apply(obj,args)}idx+=1}if(_isTransformer(obj)){var transducer=xf.apply(null,args);return transducer(obj)}}return fn.apply(this,arguments)}}},{"./_isArray":343,"./_isTransformer":351}],332:[function(require,module,exports){var take=require("../take");module.exports=function dropLast(n,xs){return take(n<xs.length?xs.length-n:0,xs)}},{"../take":492}],333:[function(require,module,exports){module.exports=function dropLastWhile(pred,list){var idx=list.length-1;while(idx>=0&&pred(list[idx])){idx-=1}return Array.prototype.slice.call(list,0,idx+1)}},{}],334:[function(require,module,exports){var _arrayFromIterator=require("./_arrayFromIterator");var _functionName=require("./_functionName");var _has=require("./_has");var identical=require("../identical");var keys=require("../keys");var type=require("../type");module.exports=function _equals(a,b,stackA,stackB){if(identical(a,b)){return true}if(type(a)!==type(b)){return false}if(a==null||b==null){return false}if(typeof a.equals==="function"||typeof b.equals==="function"){return typeof a.equals==="function"&&a.equals(b)&&typeof b.equals==="function"&&b.equals(a)}switch(type(a)){case"Arguments":case"Array":case"Object":if(typeof a.constructor==="function"&&_functionName(a.constructor)==="Promise"){return a===b}break;case"Boolean":case"Number":case"String":if(!(typeof a===typeof b&&identical(a.valueOf(),b.valueOf()))){return false}break;case"Date":if(!identical(a.valueOf(),b.valueOf())){return false}break;case"Error":return a.name===b.name&&a.message===b.message;case"RegExp":if(!(a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline&&a.sticky===b.sticky&&a.unicode===b.unicode)){return false}break;case"Map":case"Set":if(!_equals(_arrayFromIterator(a.entries()),_arrayFromIterator(b.entries()),stackA,stackB)){return false}break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":break;case"ArrayBuffer":break;default:return false}var keysA=keys(a);if(keysA.length!==keys(b).length){return false}var idx=stackA.length-1;while(idx>=0){if(stackA[idx]===a){return stackB[idx]===b}idx-=1}stackA.push(a);stackB.push(b);idx=keysA.length-1;while(idx>=0){var key=keysA[idx];if(!(_has(key,b)&&_equals(b[key],a[key],stackA,stackB))){return false}idx-=1}stackA.pop();stackB.pop();return true}},{"../identical":305,"../keys":397,"../type":509,"./_arrayFromIterator":317,"./_functionName":338,"./_has":339}],335:[function(require,module,exports){module.exports=function _filter(fn,list){var idx=0;var len=list.length;var result=[];while(idx<len){if(fn(list[idx])){result[result.length]=list[idx]}idx+=1}return result}},{}],336:[function(require,module,exports){var _forceReduced=require("./_forceReduced");var _reduce=require("./_reduce");var _xfBase=require("./_xfBase");var isArrayLike=require("../isArrayLike");module.exports=function(){var preservingReduced=function(xf){return{"@@transducer/init":_xfBase.init,"@@transducer/result":function(result){return xf["@@transducer/result"](result)},"@@transducer/step":function(result,input){var ret=xf["@@transducer/step"](result,input);return ret["@@transducer/reduced"]?_forceReduced(ret):ret}}};return function _xcat(xf){var rxf=preservingReduced(xf);return{"@@transducer/init":_xfBase.init,"@@transducer/result":function(result){return rxf["@@transducer/result"](result)},"@@transducer/step":function(result,input){return!isArrayLike(input)?_reduce(rxf,result,[input]):_reduce(rxf,result,input)}}}}()},{"../isArrayLike":392,"./_forceReduced":337,"./_reduce":359,"./_xfBase":373}],337:[function(require,module,exports){module.exports=function _forceReduced(x){return{"@@transducer/value":x,"@@transducer/reduced":true}}},{}],338:[function(require,module,exports){module.exports=function _functionName(f){var match=String(f).match(/^function (\w*)/);return match==null?"":match[1]}},{}],339:[function(require,module,exports){module.exports=function _has(prop,obj){return Object.prototype.hasOwnProperty.call(obj,prop)}},{}],340:[function(require,module,exports){module.exports=function _identity(x){return x}},{}],341:[function(require,module,exports){var equals=require("../equals");module.exports=function _indexOf(list,a,idx){var inf,item;if(typeof list.indexOf==="function"){switch(typeof a){case"number":if(a===0){inf=1/a;while(idx<list.length){item=list[idx];if(item===0&&1/item===inf){return idx}idx+=1}return-1}else if(a!==a){while(idx<list.length){item=list[idx];if(typeof item==="number"&&item!==item){return idx}idx+=1}return-1}return list.indexOf(a,idx);case"string":case"boolean":case"function":case"undefined":return list.indexOf(a,idx);case"object":if(a===null){return list.indexOf(a,idx)}}}while(idx<list.length){if(equals(list[idx],a)){return idx}idx+=1}return-1}},{"../equals":286}],342:[function(require,module,exports){var _has=require("./_has");module.exports=function(){var toString=Object.prototype.toString;return toString.call(arguments)==="[object Arguments]"?function _isArguments(x){return toString.call(x)==="[object Arguments]"}:function _isArguments(x){return _has("callee",x)}}()},{"./_has":339}],343:[function(require,module,exports){module.exports=Array.isArray||function _isArray(val){return val!=null&&val.length>=0&&Object.prototype.toString.call(val)==="[object Array]"}},{}],344:[function(require,module,exports){module.exports=function _isFunction(x){return Object.prototype.toString.call(x)==="[object Function]"}},{}],345:[function(require,module,exports){module.exports=Number.isInteger||function _isInteger(n){return n<<0===n}},{}],346:[function(require,module,exports){module.exports=function _isNumber(x){return Object.prototype.toString.call(x)==="[object Number]"}},{}],347:[function(require,module,exports){module.exports=function _isObject(x){return Object.prototype.toString.call(x)==="[object Object]"}},{}],348:[function(require,module,exports){module.exports=function _isPlaceholder(a){return a!=null&&typeof a==="object"&&a["@@functional/placeholder"]===true}},{}],349:[function(require,module,exports){module.exports=function _isRegExp(x){return Object.prototype.toString.call(x)==="[object RegExp]"}},{}],350:[function(require,module,exports){module.exports=function _isString(x){return Object.prototype.toString.call(x)==="[object String]"}},{}],351:[function(require,module,exports){module.exports=function _isTransformer(obj){return typeof obj["@@transducer/step"]==="function"}},{}],352:[function(require,module,exports){var isArrayLike=require("../isArrayLike");module.exports=function _makeFlat(recursive){return function flatt(list){var value,jlen,j;var result=[];var idx=0;var ilen=list.length;while(idx<ilen){if(isArrayLike(list[idx])){value=recursive?flatt(list[idx]):list[idx];j=0;jlen=value.length;while(j<jlen){result[result.length]=value[j];j+=1}}else{result[result.length]=list[idx]}idx+=1}return result}}},{"../isArrayLike":392}],353:[function(require,module,exports){module.exports=function _map(fn,functor){var idx=0;var len=functor.length;var result=Array(len);while(idx<len){result[idx]=fn(functor[idx]);idx+=1}return result}},{}],354:[function(require,module,exports){var _has=require("./_has");module.exports=function _objectAssign(target){if(target==null){throw new TypeError("Cannot convert undefined or null to object")}var output=Object(target);var idx=1;var length=arguments.length;while(idx<length){var source=arguments[idx];if(source!=null){for(var nextKey in source){if(_has(nextKey,source)){output[nextKey]=source[nextKey]}}}idx+=1}return output}},{"./_has":339}],355:[function(require,module,exports){module.exports=function _of(x){return[x]}},{}],356:[function(require,module,exports){module.exports=function _pipe(f,g){return function(){return g.call(this,f.apply(this,arguments))}}},{}],357:[function(require,module,exports){module.exports=function _pipeP(f,g){return function(){var ctx=this;return f.apply(ctx,arguments).then(function(x){return g.call(ctx,x)})}}},{}],358:[function(require,module,exports){module.exports=function _quote(s){var escaped=s.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+escaped.replace(/"/g,'\\"')+'"'}},{}],359:[function(require,module,exports){var _xwrap=require("./_xwrap");var bind=require("../bind");var isArrayLike=require("../isArrayLike");module.exports=function(){function _arrayReduce(xf,acc,list){var idx=0;var len=list.length;while(idx<len){acc=xf["@@transducer/step"](acc,list[idx]);if(acc&&acc["@@transducer/reduced"]){acc=acc["@@transducer/value"];break}idx+=1}return xf["@@transducer/result"](acc)}function _iterableReduce(xf,acc,iter){var step=iter.next();while(!step.done){acc=xf["@@transducer/step"](acc,step.value);if(acc&&acc["@@transducer/reduced"]){acc=acc["@@transducer/value"];break}step=iter.next()}return xf["@@transducer/result"](acc)}function _methodReduce(xf,acc,obj){return xf["@@transducer/result"](obj.reduce(bind(xf["@@transducer/step"],xf),acc))}var symIterator=typeof Symbol!=="undefined"?Symbol.iterator:"@@iterator";return function _reduce(fn,acc,list){if(typeof fn==="function"){fn=_xwrap(fn)}if(isArrayLike(list)){return _arrayReduce(fn,acc,list)}if(typeof list.reduce==="function"){return _methodReduce(fn,acc,list)}if(list[symIterator]!=null){return _iterableReduce(fn,acc,list[symIterator]())}if(typeof list.next==="function"){return _iterableReduce(fn,acc,list)}throw new TypeError("reduce: list must be array or iterable")}}()},{"../bind":248,"../isArrayLike":392,"./_xwrap":383}],360:[function(require,module,exports){module.exports=function _reduced(x){return x&&x["@@transducer/reduced"]?x:{"@@transducer/value":x,"@@transducer/reduced":true}}},{}],361:[function(require,module,exports){var _assign=require("./_assign");var _identity=require("./_identity");var _isTransformer=require("./_isTransformer");var isArrayLike=require("../isArrayLike");var objOf=require("../objOf");module.exports=function(){var _stepCatArray={"@@transducer/init":Array,"@@transducer/step":function(xs,x){xs.push(x);return xs},"@@transducer/result":_identity};var _stepCatString={"@@transducer/init":String,"@@transducer/step":function(a,b){return a+b},"@@transducer/result":_identity};var _stepCatObject={"@@transducer/init":Object,"@@transducer/step":function(result,input){return _assign(result,isArrayLike(input)?objOf(input[0],input[1]):input)},"@@transducer/result":_identity};return function _stepCat(obj){if(_isTransformer(obj)){return obj}if(isArrayLike(obj)){return _stepCatArray}if(typeof obj==="string"){return _stepCatString}if(typeof obj==="object"){return _stepCatObject}throw new Error("Cannot create transformer for "+obj)}}()},{"../isArrayLike":392,"../objOf":435,"./_assign":318,"./_identity":340,"./_isTransformer":351}],362:[function(require,module,exports){module.exports=function(){var pad=function pad(n){return(n<10?"0":"")+n};return typeof Date.prototype.toISOString==="function"?function _toISOString(d){return d.toISOString()}:function _toISOString(d){return d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds())+"."+(d.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}()},{}],363:[function(require,module,exports){var _contains=require("./_contains");var _map=require("./_map");var _quote=require("./_quote");var _toISOString=require("./_toISOString");var keys=require("../keys");var reject=require("../reject");module.exports=function _toString(x,seen){var recur=function recur(y){var xs=seen.concat([x]);return _contains(y,xs)?"<Circular>":_toString(y,xs)};var mapPairs=function(obj,keys){return _map(function(k){return _quote(k)+": "+recur(obj[k])},keys.slice().sort())};switch(Object.prototype.toString.call(x)){case"[object Arguments]":return"(function() { return arguments; }("+_map(recur,x).join(", ")+"))";case"[object Array]":return"["+_map(recur,x).concat(mapPairs(x,reject(function(k){return/^\d+$/.test(k)},keys(x)))).join(", ")+"]";case"[object Boolean]":return typeof x==="object"?"new Boolean("+recur(x.valueOf())+")":x.toString();case"[object Date]":return"new Date("+(isNaN(x.valueOf())?recur(NaN):_quote(_toISOString(x)))+")";case"[object Null]":return"null";case"[object Number]":return typeof x==="object"?"new Number("+recur(x.valueOf())+")":1/x===-Infinity?"-0":x.toString(10);case"[object String]":return typeof x==="object"?"new String("+recur(x.valueOf())+")":_quote(x);case"[object Undefined]":return"undefined";default:if(typeof x.toString==="function"){var repr=x.toString();if(repr!=="[object Object]"){return repr}}return"{"+mapPairs(x,keys(x)).join(", ")+"}"}}},{"../keys":397,"../reject":471,"./_contains":324,"./_map":353,"./_quote":358,"./_toISOString":362}],364:[function(require,module,exports){var _curry2=require("./_curry2");var _reduced=require("./_reduced");var _xfBase=require("./_xfBase");module.exports=function(){function XAll(f,xf){this.xf=xf;this.f=f;this.all=true}XAll.prototype["@@transducer/init"]=_xfBase.init;XAll.prototype["@@transducer/result"]=function(result){if(this.all){result=this.xf["@@transducer/step"](result,true)}return this.xf["@@transducer/result"](result)};XAll.prototype["@@transducer/step"]=function(result,input){if(!this.f(input)){this.all=false;result=_reduced(this.xf["@@transducer/step"](result,false))}return result};return _curry2(function _xall(f,xf){return new XAll(f,xf)})}()},{"./_curry2":328,"./_reduced":360,"./_xfBase":373}],365:[function(require,module,exports){var _curry2=require("./_curry2");var _reduced=require("./_reduced");var _xfBase=require("./_xfBase");module.exports=function(){function XAny(f,xf){this.xf=xf;this.f=f;this.any=false}XAny.prototype["@@transducer/init"]=_xfBase.init;XAny.prototype["@@transducer/result"]=function(result){if(!this.any){result=this.xf["@@transducer/step"](result,false)}return this.xf["@@transducer/result"](result)};XAny.prototype["@@transducer/step"]=function(result,input){if(this.f(input)){this.any=true;result=_reduced(this.xf["@@transducer/step"](result,true))}return result};return _curry2(function _xany(f,xf){return new XAny(f,xf)})}()},{"./_curry2":328,"./_reduced":360,"./_xfBase":373}],366:[function(require,module,exports){var _concat=require("./_concat");var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XAperture(n,xf){this.xf=xf;this.pos=0;this.full=false;this.acc=new Array(n)}XAperture.prototype["@@transducer/init"]=_xfBase.init;XAperture.prototype["@@transducer/result"]=function(result){this.acc=null;return this.xf["@@transducer/result"](result)};XAperture.prototype["@@transducer/step"]=function(result,input){this.store(input);return this.full?this.xf["@@transducer/step"](result,this.getCopy()):result};XAperture.prototype.store=function(input){this.acc[this.pos]=input;this.pos+=1;if(this.pos===this.acc.length){this.pos=0;this.full=true}};XAperture.prototype.getCopy=function(){return _concat(Array.prototype.slice.call(this.acc,this.pos),Array.prototype.slice.call(this.acc,0,this.pos))};return _curry2(function _xaperture(n,xf){return new XAperture(n,xf)})}()},{"./_concat":323,"./_curry2":328,"./_xfBase":373}],367:[function(require,module,exports){var _curry2=require("./_curry2");var _flatCat=require("./_flatCat");var map=require("../map");module.exports=_curry2(function _xchain(f,xf){return map(f,_flatCat(xf))})},{"../map":410,"./_curry2":328,"./_flatCat":336}],368:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XDrop(n,xf){this.xf=xf;this.n=n}XDrop.prototype["@@transducer/init"]=_xfBase.init;XDrop.prototype["@@transducer/result"]=_xfBase.result;XDrop.prototype["@@transducer/step"]=function(result,input){if(this.n>0){this.n-=1;return result}return this.xf["@@transducer/step"](result,input)};return _curry2(function _xdrop(n,xf){return new XDrop(n,xf)})}()},{"./_curry2":328,"./_xfBase":373}],369:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XDropLast(n,xf){this.xf=xf;this.pos=0;this.full=false;this.acc=new Array(n)}XDropLast.prototype["@@transducer/init"]=_xfBase.init;XDropLast.prototype["@@transducer/result"]=function(result){this.acc=null;return this.xf["@@transducer/result"](result)};XDropLast.prototype["@@transducer/step"]=function(result,input){if(this.full){result=this.xf["@@transducer/step"](result,this.acc[this.pos])}this.store(input);return result};XDropLast.prototype.store=function(input){this.acc[this.pos]=input;this.pos+=1;if(this.pos===this.acc.length){this.pos=0;this.full=true}};return _curry2(function _xdropLast(n,xf){return new XDropLast(n,xf)})}()},{"./_curry2":328,"./_xfBase":373}],370:[function(require,module,exports){var _curry2=require("./_curry2");var _reduce=require("./_reduce");var _xfBase=require("./_xfBase");module.exports=function(){function XDropLastWhile(fn,xf){this.f=fn;this.retained=[];this.xf=xf}XDropLastWhile.prototype["@@transducer/init"]=_xfBase.init;XDropLastWhile.prototype["@@transducer/result"]=function(result){this.retained=null;return this.xf["@@transducer/result"](result)};XDropLastWhile.prototype["@@transducer/step"]=function(result,input){return this.f(input)?this.retain(result,input):this.flush(result,input)};XDropLastWhile.prototype.flush=function(result,input){result=_reduce(this.xf["@@transducer/step"],result,this.retained);this.retained=[];return this.xf["@@transducer/step"](result,input)};XDropLastWhile.prototype.retain=function(result,input){this.retained.push(input);return result};return _curry2(function _xdropLastWhile(fn,xf){return new XDropLastWhile(fn,xf)})}()},{"./_curry2":328,"./_reduce":359,"./_xfBase":373}],371:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XDropRepeatsWith(pred,xf){this.xf=xf;this.pred=pred;this.lastValue=undefined;this.seenFirstValue=false}XDropRepeatsWith.prototype["@@transducer/init"]=_xfBase.init;XDropRepeatsWith.prototype["@@transducer/result"]=_xfBase.result;XDropRepeatsWith.prototype["@@transducer/step"]=function(result,input){var sameAsLast=false;if(!this.seenFirstValue){this.seenFirstValue=true}else if(this.pred(this.lastValue,input)){sameAsLast=true}this.lastValue=input;return sameAsLast?result:this.xf["@@transducer/step"](result,input)};return _curry2(function _xdropRepeatsWith(pred,xf){return new XDropRepeatsWith(pred,xf)})}()},{"./_curry2":328,"./_xfBase":373}],372:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XDropWhile(f,xf){this.xf=xf;this.f=f}XDropWhile.prototype["@@transducer/init"]=_xfBase.init;XDropWhile.prototype["@@transducer/result"]=_xfBase.result;XDropWhile.prototype["@@transducer/step"]=function(result,input){if(this.f){if(this.f(input)){return result}this.f=null}return this.xf["@@transducer/step"](result,input)};return _curry2(function _xdropWhile(f,xf){return new XDropWhile(f,xf)})}()},{"./_curry2":328,"./_xfBase":373}],373:[function(require,module,exports){module.exports={init:function(){return this.xf["@@transducer/init"]()},result:function(result){return this.xf["@@transducer/result"](result)}}},{}],374:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XFilter(f,xf){this.xf=xf;this.f=f}XFilter.prototype["@@transducer/init"]=_xfBase.init;XFilter.prototype["@@transducer/result"]=_xfBase.result;XFilter.prototype["@@transducer/step"]=function(result,input){return this.f(input)?this.xf["@@transducer/step"](result,input):result};return _curry2(function _xfilter(f,xf){return new XFilter(f,xf)})}()},{"./_curry2":328,"./_xfBase":373}],375:[function(require,module,exports){var _curry2=require("./_curry2");var _reduced=require("./_reduced");var _xfBase=require("./_xfBase");module.exports=function(){function XFind(f,xf){this.xf=xf;this.f=f;this.found=false}XFind.prototype["@@transducer/init"]=_xfBase.init;XFind.prototype["@@transducer/result"]=function(result){if(!this.found){result=this.xf["@@transducer/step"](result,void 0)}return this.xf["@@transducer/result"](result)};XFind.prototype["@@transducer/step"]=function(result,input){if(this.f(input)){this.found=true;result=_reduced(this.xf["@@transducer/step"](result,input))}return result};return _curry2(function _xfind(f,xf){return new XFind(f,xf)})}()},{"./_curry2":328,"./_reduced":360,"./_xfBase":373}],376:[function(require,module,exports){var _curry2=require("./_curry2");var _reduced=require("./_reduced");var _xfBase=require("./_xfBase");module.exports=function(){function XFindIndex(f,xf){this.xf=xf;this.f=f;this.idx=-1;this.found=false}XFindIndex.prototype["@@transducer/init"]=_xfBase.init;XFindIndex.prototype["@@transducer/result"]=function(result){if(!this.found){result=this.xf["@@transducer/step"](result,-1)}return this.xf["@@transducer/result"](result)};XFindIndex.prototype["@@transducer/step"]=function(result,input){this.idx+=1;if(this.f(input)){this.found=true;result=_reduced(this.xf["@@transducer/step"](result,this.idx))}return result};return _curry2(function _xfindIndex(f,xf){return new XFindIndex(f,xf)})}()},{"./_curry2":328,"./_reduced":360,"./_xfBase":373}],377:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XFindLast(f,xf){this.xf=xf;this.f=f}XFindLast.prototype["@@transducer/init"]=_xfBase.init;XFindLast.prototype["@@transducer/result"]=function(result){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](result,this.last))};XFindLast.prototype["@@transducer/step"]=function(result,input){if(this.f(input)){this.last=input}return result};return _curry2(function _xfindLast(f,xf){return new XFindLast(f,xf)})}()},{"./_curry2":328,"./_xfBase":373}],378:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XFindLastIndex(f,xf){this.xf=xf;this.f=f;this.idx=-1;this.lastIdx=-1}XFindLastIndex.prototype["@@transducer/init"]=_xfBase.init;XFindLastIndex.prototype["@@transducer/result"]=function(result){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](result,this.lastIdx))};XFindLastIndex.prototype["@@transducer/step"]=function(result,input){this.idx+=1;if(this.f(input)){this.lastIdx=this.idx}return result};return _curry2(function _xfindLastIndex(f,xf){return new XFindLastIndex(f,xf)})}()},{"./_curry2":328,"./_xfBase":373}],379:[function(require,module,exports){var _curry2=require("./_curry2");var _xfBase=require("./_xfBase");module.exports=function(){function XMap(f,xf){this.xf=xf;this.f=f}XMap.prototype["@@transducer/init"]=_xfBase.init;XMap.prototype["@@transducer/result"]=_xfBase.result;XMap.prototype["@@transducer/step"]=function(result,input){return this.xf["@@transducer/step"](result,this.f(input))};return _curry2(function _xmap(f,xf){return new XMap(f,xf)})}()},{"./_curry2":328,"./_xfBase":373}],380:[function(require,module,exports){var _curryN=require("./_curryN");var _has=require("./_has");var _xfBase=require("./_xfBase");module.exports=function(){function XReduceBy(valueFn,valueAcc,keyFn,xf){this.valueFn=valueFn;this.valueAcc=valueAcc;this.keyFn=keyFn;this.xf=xf;this.inputs={}}XReduceBy.prototype["@@transducer/init"]=_xfBase.init;XReduceBy.prototype["@@transducer/result"]=function(result){var key;for(key in this.inputs){if(_has(key,this.inputs)){result=this.xf["@@transducer/step"](result,this.inputs[key]);if(result["@@transducer/reduced"]){result=result["@@transducer/value"];break}}}this.inputs=null;return this.xf["@@transducer/result"](result)};XReduceBy.prototype["@@transducer/step"]=function(result,input){var key=this.keyFn(input);this.inputs[key]=this.inputs[key]||[key,this.valueAcc];this.inputs[key][1]=this.valueFn(this.inputs[key][1],input);return result};return _curryN(4,[],function _xreduceBy(valueFn,valueAcc,keyFn,xf){return new XReduceBy(valueFn,valueAcc,keyFn,xf)})}()},{"./_curryN":330,"./_has":339,"./_xfBase":373}],381:[function(require,module,exports){var _curry2=require("./_curry2");var _reduced=require("./_reduced");var _xfBase=require("./_xfBase");module.exports=function(){function XTake(n,xf){this.xf=xf;this.n=n;this.i=0}XTake.prototype["@@transducer/init"]=_xfBase.init;XTake.prototype["@@transducer/result"]=_xfBase.result;XTake.prototype["@@transducer/step"]=function(result,input){this.i+=1;var ret=this.n===0?result:this.xf["@@transducer/step"](result,input);return this.i>=this.n?_reduced(ret):ret};return _curry2(function _xtake(n,xf){return new XTake(n,xf);

})}()},{"./_curry2":328,"./_reduced":360,"./_xfBase":373}],382:[function(require,module,exports){var _curry2=require("./_curry2");var _reduced=require("./_reduced");var _xfBase=require("./_xfBase");module.exports=function(){function XTakeWhile(f,xf){this.xf=xf;this.f=f}XTakeWhile.prototype["@@transducer/init"]=_xfBase.init;XTakeWhile.prototype["@@transducer/result"]=_xfBase.result;XTakeWhile.prototype["@@transducer/step"]=function(result,input){return this.f(input)?this.xf["@@transducer/step"](result,input):_reduced(result)};return _curry2(function _xtakeWhile(f,xf){return new XTakeWhile(f,xf)})}()},{"./_curry2":328,"./_reduced":360,"./_xfBase":373}],383:[function(require,module,exports){module.exports=function(){function XWrap(fn){this.f=fn}XWrap.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")};XWrap.prototype["@@transducer/result"]=function(acc){return acc};XWrap.prototype["@@transducer/step"]=function(acc,x){return this.f(acc,x)};return function _xwrap(fn){return new XWrap(fn)}}()},{}],384:[function(require,module,exports){var _contains=require("./internal/_contains");var _curry2=require("./internal/_curry2");var _filter=require("./internal/_filter");var flip=require("./flip");var uniq=require("./uniq");module.exports=_curry2(function intersection(list1,list2){var lookupList,filteredList;if(list1.length>list2.length){lookupList=list1;filteredList=list2}else{lookupList=list2;filteredList=list1}return uniq(_filter(flip(_contains)(lookupList),filteredList))})},{"./flip":294,"./internal/_contains":324,"./internal/_curry2":328,"./internal/_filter":335,"./uniq":516}],385:[function(require,module,exports){var _containsWith=require("./internal/_containsWith");var _curry3=require("./internal/_curry3");var uniqWith=require("./uniqWith");module.exports=_curry3(function intersectionWith(pred,list1,list2){var lookupList,filteredList;if(list1.length>list2.length){lookupList=list1;filteredList=list2}else{lookupList=list2;filteredList=list1}var results=[];var idx=0;while(idx<filteredList.length){if(_containsWith(pred,filteredList[idx],lookupList)){results[results.length]=filteredList[idx]}idx+=1}return uniqWith(pred,results)})},{"./internal/_containsWith":325,"./internal/_curry3":329,"./uniqWith":518}],386:[function(require,module,exports){var _checkForMethod=require("./internal/_checkForMethod");var _curry2=require("./internal/_curry2");module.exports=_curry2(_checkForMethod("intersperse",function intersperse(separator,list){var out=[];var idx=0;var length=list.length;while(idx<length){if(idx===length-1){out.push(list[idx])}else{out.push(list[idx],separator)}idx+=1}return out}))},{"./internal/_checkForMethod":319,"./internal/_curry2":328}],387:[function(require,module,exports){var _clone=require("./internal/_clone");var _curry3=require("./internal/_curry3");var _isTransformer=require("./internal/_isTransformer");var _reduce=require("./internal/_reduce");var _stepCat=require("./internal/_stepCat");module.exports=_curry3(function into(acc,xf,list){return _isTransformer(acc)?_reduce(xf(acc),acc["@@transducer/init"](),list):_reduce(xf(_stepCat(acc)),_clone(acc,[],[],false),list)})},{"./internal/_clone":320,"./internal/_curry3":329,"./internal/_isTransformer":351,"./internal/_reduce":359,"./internal/_stepCat":361}],388:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _has=require("./internal/_has");var keys=require("./keys");module.exports=_curry1(function invert(obj){var props=keys(obj);var len=props.length;var idx=0;var out={};while(idx<len){var key=props[idx];var val=obj[key];var list=_has(val,out)?out[val]:out[val]=[];list[list.length]=key;idx+=1}return out})},{"./internal/_curry1":327,"./internal/_has":339,"./keys":397}],389:[function(require,module,exports){var _curry1=require("./internal/_curry1");var keys=require("./keys");module.exports=_curry1(function invertObj(obj){var props=keys(obj);var len=props.length;var idx=0;var out={};while(idx<len){var key=props[idx];out[obj[key]]=key;idx+=1}return out})},{"./internal/_curry1":327,"./keys":397}],390:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isFunction=require("./internal/_isFunction");var curryN=require("./curryN");var toString=require("./toString");module.exports=_curry2(function invoker(arity,method){return curryN(arity+1,function(){var target=arguments[arity];if(target!=null&&_isFunction(target[method])){return target[method].apply(target,Array.prototype.slice.call(arguments,0,arity))}throw new TypeError(toString(target)+' does not have a method named "'+method+'"')})})},{"./curryN":267,"./internal/_curry2":328,"./internal/_isFunction":344,"./toString":502}],391:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function is(Ctor,val){return val!=null&&val.constructor===Ctor||val instanceof Ctor})},{"./internal/_curry2":328}],392:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _isArray=require("./internal/_isArray");var _isString=require("./internal/_isString");module.exports=_curry1(function isArrayLike(x){if(_isArray(x)){return true}if(!x){return false}if(typeof x!=="object"){return false}if(_isString(x)){return false}if(x.nodeType===1){return!!x.length}if(x.length===0){return true}if(x.length>0){return x.hasOwnProperty(0)&&x.hasOwnProperty(x.length-1)}return false})},{"./internal/_curry1":327,"./internal/_isArray":343,"./internal/_isString":350}],393:[function(require,module,exports){var _curry1=require("./internal/_curry1");var empty=require("./empty");var equals=require("./equals");module.exports=_curry1(function isEmpty(x){return x!=null&&equals(x,empty(x))})},{"./empty":283,"./equals":286,"./internal/_curry1":327}],394:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function isNil(x){return x==null})},{"./internal/_curry1":327}],395:[function(require,module,exports){var invoker=require("./invoker");module.exports=invoker(1,"join")},{"./invoker":390}],396:[function(require,module,exports){var _curry1=require("./internal/_curry1");var converge=require("./converge");module.exports=_curry1(function juxt(fns){return converge(function(){return Array.prototype.slice.call(arguments,0)},fns)})},{"./converge":264,"./internal/_curry1":327}],397:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _has=require("./internal/_has");var _isArguments=require("./internal/_isArguments");module.exports=function(){var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];var hasArgsEnumBug=function(){"use strict";return arguments.propertyIsEnumerable("length")}();var contains=function contains(list,item){var idx=0;while(idx<list.length){if(list[idx]===item){return true}idx+=1}return false};return typeof Object.keys==="function"&&!hasArgsEnumBug?_curry1(function keys(obj){return Object(obj)!==obj?[]:Object.keys(obj)}):_curry1(function keys(obj){if(Object(obj)!==obj){return[]}var prop,nIdx;var ks=[];var checkArgsLength=hasArgsEnumBug&&_isArguments(obj);for(prop in obj){if(_has(prop,obj)&&(!checkArgsLength||prop!=="length")){ks[ks.length]=prop}}if(hasEnumBug){nIdx=nonEnumerableProps.length-1;while(nIdx>=0){prop=nonEnumerableProps[nIdx];if(_has(prop,obj)&&!contains(ks,prop)){ks[ks.length]=prop}nIdx-=1}}return ks})}()},{"./internal/_curry1":327,"./internal/_has":339,"./internal/_isArguments":342}],398:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function keysIn(obj){var prop;var ks=[];for(prop in obj){ks[ks.length]=prop}return ks})},{"./internal/_curry1":327}],399:[function(require,module,exports){var nth=require("./nth");module.exports=nth(-1)},{"./nth":433}],400:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isArray=require("./internal/_isArray");var equals=require("./equals");module.exports=_curry2(function lastIndexOf(target,xs){if(typeof xs.lastIndexOf==="function"&&!_isArray(xs)){return xs.lastIndexOf(target)}else{var idx=xs.length-1;while(idx>=0){if(equals(xs[idx],target)){return idx}idx-=1}return-1}})},{"./equals":286,"./internal/_curry2":328,"./internal/_isArray":343}],401:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _isNumber=require("./internal/_isNumber");module.exports=_curry1(function length(list){return list!=null&&_isNumber(list.length)?list.length:NaN})},{"./internal/_curry1":327,"./internal/_isNumber":346}],402:[function(require,module,exports){var _curry2=require("./internal/_curry2");var map=require("./map");module.exports=_curry2(function lens(getter,setter){return function(toFunctorFn){return function(target){return map(function(focus){return setter(focus,target)},toFunctorFn(getter(target)))}}})},{"./internal/_curry2":328,"./map":410}],403:[function(require,module,exports){var _curry1=require("./internal/_curry1");var lens=require("./lens");var nth=require("./nth");var update=require("./update");module.exports=_curry1(function lensIndex(n){return lens(nth(n),update(n))})},{"./internal/_curry1":327,"./lens":402,"./nth":433,"./update":522}],404:[function(require,module,exports){var _curry1=require("./internal/_curry1");var assocPath=require("./assocPath");var lens=require("./lens");var path=require("./path");module.exports=_curry1(function lensPath(p){return lens(path(p),assocPath(p))})},{"./assocPath":246,"./internal/_curry1":327,"./lens":402,"./path":445}],405:[function(require,module,exports){var _curry1=require("./internal/_curry1");var assoc=require("./assoc");var lens=require("./lens");var prop=require("./prop");module.exports=_curry1(function lensProp(k){return lens(prop(k),assoc(k))})},{"./assoc":245,"./internal/_curry1":327,"./lens":402,"./prop":459}],406:[function(require,module,exports){var _curry1=require("./internal/_curry1");var liftN=require("./liftN");module.exports=_curry1(function lift(fn){return liftN(fn.length,fn)})},{"./internal/_curry1":327,"./liftN":407}],407:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _reduce=require("./internal/_reduce");var ap=require("./ap");var curryN=require("./curryN");var map=require("./map");module.exports=_curry2(function liftN(arity,fn){var lifted=curryN(arity,fn);return curryN(arity,function(){return _reduce(ap,map(lifted,arguments[0]),Array.prototype.slice.call(arguments,1))})})},{"./ap":239,"./curryN":267,"./internal/_curry2":328,"./internal/_reduce":359,"./map":410}],408:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function lt(a,b){return a<b})},{"./internal/_curry2":328}],409:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function lte(a,b){return a<=b})},{"./internal/_curry2":328}],410:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _map=require("./internal/_map");var _reduce=require("./internal/_reduce");var _xmap=require("./internal/_xmap");var curryN=require("./curryN");var keys=require("./keys");module.exports=_curry2(_dispatchable(["map"],_xmap,function map(fn,functor){switch(Object.prototype.toString.call(functor)){case"[object Function]":return curryN(functor.length,function(){return fn.call(this,functor.apply(this,arguments))});case"[object Object]":return _reduce(function(acc,key){acc[key]=fn(functor[key]);return acc},{},keys(functor));default:return _map(fn,functor)}}))},{"./curryN":267,"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_map":353,"./internal/_reduce":359,"./internal/_xmap":379,"./keys":397}],411:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function mapAccum(fn,acc,list){var idx=0;var len=list.length;var result=[];var tuple=[acc];while(idx<len){tuple=fn(tuple[0],list[idx]);result[idx]=tuple[1];idx+=1}return[tuple[0],result]})},{"./internal/_curry3":329}],412:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function mapAccumRight(fn,acc,list){var idx=list.length-1;var result=[];var tuple=[acc];while(idx>=0){tuple=fn(list[idx],tuple[0]);result[idx]=tuple[1];idx-=1}return[result,tuple[0]]})},{"./internal/_curry3":329}],413:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _reduce=require("./internal/_reduce");var keys=require("./keys");module.exports=_curry2(function mapObjIndexed(fn,obj){return _reduce(function(acc,key){acc[key]=fn(obj[key],key,obj);return acc},{},keys(obj))})},{"./internal/_curry2":328,"./internal/_reduce":359,"./keys":397}],414:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function match(rx,str){return str.match(rx)||[]})},{"./internal/_curry2":328}],415:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isInteger=require("./internal/_isInteger");module.exports=_curry2(function mathMod(m,p){if(!_isInteger(m)){return NaN}if(!_isInteger(p)||p<1){return NaN}return(m%p+p)%p})},{"./internal/_curry2":328,"./internal/_isInteger":345}],416:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function max(a,b){return b>a?b:a})},{"./internal/_curry2":328}],417:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function maxBy(f,a,b){return f(b)>f(a)?b:a})},{"./internal/_curry3":329}],418:[function(require,module,exports){var _curry1=require("./internal/_curry1");var sum=require("./sum");module.exports=_curry1(function mean(list){return sum(list)/list.length})},{"./internal/_curry1":327,"./sum":488}],419:[function(require,module,exports){var _curry1=require("./internal/_curry1");var mean=require("./mean");module.exports=_curry1(function median(list){var len=list.length;if(len===0){return NaN}var width=2-len%2;var idx=(len-width)/2;return mean(Array.prototype.slice.call(list,0).sort(function(a,b){return a<b?-1:a>b?1:0}).slice(idx,idx+width))})},{"./internal/_curry1":327,"./mean":418}],420:[function(require,module,exports){var _arity=require("./internal/_arity");var _curry1=require("./internal/_curry1");var _has=require("./internal/_has");var toString=require("./toString");module.exports=_curry1(function memoize(fn){var cache={};return _arity(fn.length,function(){var key=toString(arguments);if(!_has(key,cache)){cache[key]=fn.apply(this,arguments)}return cache[key]})})},{"./internal/_arity":316,"./internal/_curry1":327,"./internal/_has":339,"./toString":502}],421:[function(require,module,exports){var _assign=require("./internal/_assign");var _curry2=require("./internal/_curry2");module.exports=_curry2(function merge(l,r){return _assign({},l,r)})},{"./internal/_assign":318,"./internal/_curry2":328}],422:[function(require,module,exports){var _assign=require("./internal/_assign");var _curry1=require("./internal/_curry1");module.exports=_curry1(function mergeAll(list){return _assign.apply(null,[{}].concat(list))})},{"./internal/_assign":318,"./internal/_curry1":327}],423:[function(require,module,exports){var _curry3=require("./internal/_curry3");var mergeWithKey=require("./mergeWithKey");module.exports=_curry3(function mergeWith(fn,l,r){return mergeWithKey(function(_,_l,_r){return fn(_l,_r)},l,r)})},{"./internal/_curry3":329,"./mergeWithKey":424}],424:[function(require,module,exports){var _curry3=require("./internal/_curry3");var _has=require("./internal/_has");module.exports=_curry3(function mergeWithKey(fn,l,r){var result={};var k;for(k in l){if(_has(k,l)){result[k]=_has(k,r)?fn(k,l[k],r[k]):l[k]}}for(k in r){if(_has(k,r)&&!_has(k,result)){result[k]=r[k]}}return result})},{"./internal/_curry3":329,"./internal/_has":339}],425:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function min(a,b){return b<a?b:a})},{"./internal/_curry2":328}],426:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function minBy(f,a,b){return f(b)<f(a)?b:a})},{"./internal/_curry3":329}],427:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function modulo(a,b){return a%b})},{"./internal/_curry2":328}],428:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function multiply(a,b){return a*b})},{"./internal/_curry2":328}],429:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function nAry(n,fn){switch(n){case 0:return function(){return fn.call(this)};case 1:return function(a0){return fn.call(this,a0)};case 2:return function(a0,a1){return fn.call(this,a0,a1)};case 3:return function(a0,a1,a2){return fn.call(this,a0,a1,a2)};case 4:return function(a0,a1,a2,a3){return fn.call(this,a0,a1,a2,a3)};case 5:return function(a0,a1,a2,a3,a4){return fn.call(this,a0,a1,a2,a3,a4)};case 6:return function(a0,a1,a2,a3,a4,a5){return fn.call(this,a0,a1,a2,a3,a4,a5)};case 7:return function(a0,a1,a2,a3,a4,a5,a6){return fn.call(this,a0,a1,a2,a3,a4,a5,a6)};case 8:return function(a0,a1,a2,a3,a4,a5,a6,a7){return fn.call(this,a0,a1,a2,a3,a4,a5,a6,a7)};case 9:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8){return fn.call(this,a0,a1,a2,a3,a4,a5,a6,a7,a8)};case 10:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9){return fn.call(this,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9)};default:throw new Error("First argument to nAry must be a non-negative integer no greater than ten")}})},{"./internal/_curry2":328}],430:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function negate(n){return-n})},{"./internal/_curry1":327}],431:[function(require,module,exports){var _complement=require("./internal/_complement");var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xany=require("./internal/_xany");var any=require("./any");module.exports=_curry2(_complement(_dispatchable(["any"],_xany,any)))},{"./any":237,"./internal/_complement":322,"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xany":365}],432:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function not(a){return!a})},{"./internal/_curry1":327}],433:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isString=require("./internal/_isString");module.exports=_curry2(function nth(offset,list){var idx=offset<0?list.length+offset:offset;return _isString(list)?list.charAt(idx):list[idx]})},{"./internal/_curry2":328,"./internal/_isString":350}],434:[function(require,module,exports){var _curry1=require("./internal/_curry1");var curryN=require("./curryN");var nth=require("./nth");module.exports=_curry1(function nthArg(n){var arity=n<0?1:n+1;return curryN(arity,function(){return nth(n,arguments)})})},{"./curryN":267,"./internal/_curry1":327,"./nth":433}],435:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function objOf(key,val){var obj={};obj[key]=val;return obj})},{"./internal/_curry2":328}],436:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _of=require("./internal/_of");module.exports=_curry1(_of)},{"./internal/_curry1":327,"./internal/_of":355}],437:[function(require,module,exports){var _contains=require("./internal/_contains");var _curry2=require("./internal/_curry2");module.exports=_curry2(function omit(names,obj){var result={};for(var prop in obj){if(!_contains(prop,names)){result[prop]=obj[prop]}}return result})},{"./internal/_contains":324,"./internal/_curry2":328}],438:[function(require,module,exports){var _arity=require("./internal/_arity");var _curry1=require("./internal/_curry1");module.exports=_curry1(function once(fn){var called=false;var result;return _arity(fn.length,function(){if(called){return result}called=true;result=fn.apply(this,arguments);return result})})},{"./internal/_arity":316,"./internal/_curry1":327}],439:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function or(a,b){return a||b})},{"./internal/_curry2":328}],440:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=function(){var Identity=function(x){return{value:x,map:function(f){return Identity(f(x))}}};return _curry3(function over(lens,f,x){return lens(function(y){return Identity(f(y))})(x).value})}()},{"./internal/_curry3":329}],441:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function pair(fst,snd){return[fst,snd]})},{"./internal/_curry2":328}],442:[function(require,module,exports){var _concat=require("./internal/_concat");var _createPartialApplicator=require("./internal/_createPartialApplicator");module.exports=_createPartialApplicator(_concat)},{"./internal/_concat":323,"./internal/_createPartialApplicator":326}],443:[function(require,module,exports){var _concat=require("./internal/_concat");var _createPartialApplicator=require("./internal/_createPartialApplicator");var flip=require("./flip");module.exports=_createPartialApplicator(flip(_concat))},{"./flip":294,"./internal/_concat":323,"./internal/_createPartialApplicator":326}],444:[function(require,module,exports){var filter=require("./filter");var juxt=require("./juxt");var reject=require("./reject");module.exports=juxt([filter,reject])},{"./filter":288,"./juxt":396,"./reject":471}],445:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function path(paths,obj){var val=obj;var idx=0;while(idx<paths.length){if(val==null){return}val=val[paths[idx]];idx+=1}return val})},{"./internal/_curry2":328}],446:[function(require,module,exports){var _curry3=require("./internal/_curry3");var equals=require("./equals");var path=require("./path");module.exports=_curry3(function pathEq(_path,val,obj){return equals(path(_path,obj),val)})},{"./equals":286,"./internal/_curry3":329,"./path":445}],447:[function(require,module,exports){var _curry3=require("./internal/_curry3");var defaultTo=require("./defaultTo");var path=require("./path");module.exports=_curry3(function pathOr(d,p,obj){return defaultTo(d,path(p,obj))})},{"./defaultTo":269,"./internal/_curry3":329,"./path":445}],448:[function(require,module,exports){var _curry3=require("./internal/_curry3");var path=require("./path");module.exports=_curry3(function pathSatisfies(pred,propPath,obj){return propPath.length>0&&pred(path(propPath,obj))})},{"./internal/_curry3":329,"./path":445}],449:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function pick(names,obj){var result={};var idx=0;while(idx<names.length){if(names[idx]in obj){result[names[idx]]=obj[names[idx]]}idx+=1}return result})},{"./internal/_curry2":328}],450:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function pickAll(names,obj){var result={};var idx=0;var len=names.length;while(idx<len){var name=names[idx];result[name]=obj[name];idx+=1}return result})},{"./internal/_curry2":328}],451:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function pickBy(test,obj){var result={};for(var prop in obj){if(test(obj[prop],prop,obj)){result[prop]=obj[prop]}}return result})},{"./internal/_curry2":328}],452:[function(require,module,exports){var _arity=require("./internal/_arity");var _pipe=require("./internal/_pipe");var reduce=require("./reduce");var tail=require("./tail");module.exports=function pipe(){if(arguments.length===0){throw new Error("pipe requires at least one argument")}return _arity(arguments[0].length,reduce(_pipe,arguments[0],tail(arguments)))}},{"./internal/_arity":316,"./internal/_pipe":356,"./reduce":466,"./tail":491}],453:[function(require,module,exports){var composeK=require("./composeK");var reverse=require("./reverse");module.exports=function pipeK(){if(arguments.length===0){throw new Error("pipeK requires at least one argument")}return composeK.apply(this,reverse(arguments))}},{"./composeK":257,"./reverse":475}],454:[function(require,module,exports){var _arity=require("./internal/_arity");var _pipeP=require("./internal/_pipeP");var reduce=require("./reduce");var tail=require("./tail");module.exports=function pipeP(){if(arguments.length===0){throw new Error("pipeP requires at least one argument")}return _arity(arguments[0].length,reduce(_pipeP,arguments[0],tail(arguments)))}},{"./internal/_arity":316,"./internal/_pipeP":357,"./reduce":466,"./tail":491}],455:[function(require,module,exports){var _curry2=require("./internal/_curry2");var map=require("./map");var prop=require("./prop");module.exports=_curry2(function pluck(p,list){return map(prop(p),list)})},{"./internal/_curry2":328,"./map":410,"./prop":459}],456:[function(require,module,exports){var _concat=require("./internal/_concat");var _curry2=require("./internal/_curry2");module.exports=_curry2(function prepend(el,list){return _concat([el],list)})},{"./internal/_concat":323,"./internal/_curry2":328}],457:[function(require,module,exports){var multiply=require("./multiply");var reduce=require("./reduce");module.exports=reduce(multiply,1)},{"./multiply":428,"./reduce":466}],458:[function(require,module,exports){var _map=require("./internal/_map");var identity=require("./identity");var pickAll=require("./pickAll");var useWith=require("./useWith");module.exports=useWith(_map,[pickAll,identity])},{"./identity":306,"./internal/_map":353,"./pickAll":450,"./useWith":523}],459:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function prop(p,obj){return obj[p]})},{"./internal/_curry2":328}],460:[function(require,module,exports){var _curry3=require("./internal/_curry3");var equals=require("./equals");module.exports=_curry3(function propEq(name,val,obj){return equals(val,obj[name])})},{"./equals":286,"./internal/_curry3":329}],461:[function(require,module,exports){var _curry3=require("./internal/_curry3");var is=require("./is");module.exports=_curry3(function propIs(type,name,obj){return is(type,obj[name])})},{"./internal/_curry3":329,"./is":391}],462:[function(require,module,exports){var _curry3=require("./internal/_curry3");var _has=require("./internal/_has");module.exports=_curry3(function propOr(val,p,obj){return obj!=null&&_has(p,obj)?obj[p]:val})},{"./internal/_curry3":329,"./internal/_has":339}],463:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function propSatisfies(pred,name,obj){return pred(obj[name])})},{"./internal/_curry3":329}],464:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function props(ps,obj){var len=ps.length;var out=[];var idx=0;while(idx<len){out[idx]=obj[ps[idx]];idx+=1}return out})},{"./internal/_curry2":328}],465:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _isNumber=require("./internal/_isNumber");module.exports=_curry2(function range(from,to){if(!(_isNumber(from)&&_isNumber(to))){throw new TypeError("Both arguments to range must be numbers")}var result=[];var n=from;while(n<to){result.push(n);n+=1}return result})},{"./internal/_curry2":328,"./internal/_isNumber":346}],466:[function(require,module,exports){var _curry3=require("./internal/_curry3");var _reduce=require("./internal/_reduce");module.exports=_curry3(_reduce)},{"./internal/_curry3":329,"./internal/_reduce":359}],467:[function(require,module,exports){var _curryN=require("./internal/_curryN");var _dispatchable=require("./internal/_dispatchable");var _has=require("./internal/_has");var _reduce=require("./internal/_reduce");var _xreduceBy=require("./internal/_xreduceBy");module.exports=_curryN(4,[],_dispatchable([],_xreduceBy,function reduceBy(valueFn,valueAcc,keyFn,list){return _reduce(function(acc,elt){var key=keyFn(elt);acc[key]=valueFn(_has(key,acc)?acc[key]:valueAcc,elt);return acc},{},list)}))},{"./internal/_curryN":330,"./internal/_dispatchable":331,"./internal/_has":339,"./internal/_reduce":359,"./internal/_xreduceBy":380}],468:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function reduceRight(fn,acc,list){var idx=list.length-1;while(idx>=0){acc=fn(list[idx],acc);idx-=1}return acc})},{"./internal/_curry3":329}],469:[function(require,module,exports){var _curryN=require("./internal/_curryN");var _reduce=require("./internal/_reduce");var _reduced=require("./internal/_reduced");module.exports=_curryN(4,[],function _reduceWhile(pred,fn,a,list){return _reduce(function(acc,x){return pred(acc,x)?fn(acc,x):_reduced(acc)},a,list)})},{"./internal/_curryN":330,"./internal/_reduce":359,"./internal/_reduced":360}],470:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _reduced=require("./internal/_reduced");module.exports=_curry1(_reduced)},{"./internal/_curry1":327,"./internal/_reduced":360}],471:[function(require,module,exports){var _complement=require("./internal/_complement");var _curry2=require("./internal/_curry2");var filter=require("./filter");module.exports=_curry2(function reject(pred,filterable){return filter(_complement(pred),filterable)})},{"./filter":288,"./internal/_complement":322,"./internal/_curry2":328}],472:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function remove(start,count,list){var result=Array.prototype.slice.call(list,0);result.splice(start,count);return result})},{"./internal/_curry3":329}],473:[function(require,module,exports){var _curry2=require("./internal/_curry2");var always=require("./always");var times=require("./times");module.exports=_curry2(function repeat(value,n){return times(always(value),n)})},{"./always":235,"./internal/_curry2":328,"./times":498}],474:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function replace(regex,replacement,str){return str.replace(regex,replacement)})},{"./internal/_curry3":329}],475:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _isString=require("./internal/_isString");module.exports=_curry1(function reverse(list){return _isString(list)?list.split("").reverse().join(""):Array.prototype.slice.call(list,0).reverse()})},{"./internal/_curry1":327,"./internal/_isString":350}],476:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function scan(fn,acc,list){var idx=0;var len=list.length;var result=[acc];while(idx<len){acc=fn(acc,list[idx]);result[idx+1]=acc;idx+=1}return result})},{"./internal/_curry3":329}],477:[function(require,module,exports){var _curry2=require("./internal/_curry2");var ap=require("./ap");var map=require("./map");var prepend=require("./prepend");var reduceRight=require("./reduceRight");module.exports=_curry2(function sequence(of,traversable){return typeof traversable.sequence==="function"?traversable.sequence(of):reduceRight(function(x,acc){return ap(map(prepend,x),acc)},of([]),traversable)})},{"./ap":239,"./internal/_curry2":328,"./map":410,"./prepend":456,"./reduceRight":468}],478:[function(require,module,exports){var _curry3=require("./internal/_curry3");var always=require("./always");var over=require("./over");module.exports=_curry3(function set(lens,v,x){return over(lens,always(v),x)})},{"./always":235,"./internal/_curry3":329,"./over":440}],479:[function(require,module,exports){var _checkForMethod=require("./internal/_checkForMethod");var _curry3=require("./internal/_curry3");module.exports=_curry3(_checkForMethod("slice",function slice(fromIndex,toIndex,list){return Array.prototype.slice.call(list,fromIndex,toIndex)}))},{"./internal/_checkForMethod":319,"./internal/_curry3":329
}],480:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function sort(comparator,list){return Array.prototype.slice.call(list,0).sort(comparator)})},{"./internal/_curry2":328}],481:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function sortBy(fn,list){return Array.prototype.slice.call(list,0).sort(function(a,b){var aa=fn(a);var bb=fn(b);return aa<bb?-1:aa>bb?1:0})})},{"./internal/_curry2":328}],482:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function sortWith(fns,list){return Array.prototype.slice.call(list,0).sort(function(a,b){var result=0;var i=0;while(result===0&&i<fns.length){result=fns[i](a,b);i+=1}return result})})},{"./internal/_curry2":328}],483:[function(require,module,exports){var invoker=require("./invoker");module.exports=invoker(1,"split")},{"./invoker":390}],484:[function(require,module,exports){var _curry2=require("./internal/_curry2");var length=require("./length");var slice=require("./slice");module.exports=_curry2(function splitAt(index,array){return[slice(0,index,array),slice(index,length(array),array)]})},{"./internal/_curry2":328,"./length":401,"./slice":479}],485:[function(require,module,exports){var _curry2=require("./internal/_curry2");var slice=require("./slice");module.exports=_curry2(function splitEvery(n,list){if(n<=0){throw new Error("First argument to splitEvery must be a positive integer")}var result=[];var idx=0;while(idx<list.length){result.push(slice(idx,idx+=n,list))}return result})},{"./internal/_curry2":328,"./slice":479}],486:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function splitWhen(pred,list){var idx=0;var len=list.length;var prefix=[];while(idx<len&&!pred(list[idx])){prefix.push(list[idx]);idx+=1}return[prefix,Array.prototype.slice.call(list,idx)]})},{"./internal/_curry2":328}],487:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function subtract(a,b){return Number(a)-Number(b)})},{"./internal/_curry2":328}],488:[function(require,module,exports){var add=require("./add");var reduce=require("./reduce");module.exports=reduce(add,0)},{"./add":230,"./reduce":466}],489:[function(require,module,exports){var _curry2=require("./internal/_curry2");var concat=require("./concat");var difference=require("./difference");module.exports=_curry2(function symmetricDifference(list1,list2){return concat(difference(list1,list2),difference(list2,list1))})},{"./concat":259,"./difference":271,"./internal/_curry2":328}],490:[function(require,module,exports){var _curry3=require("./internal/_curry3");var concat=require("./concat");var differenceWith=require("./differenceWith");module.exports=_curry3(function symmetricDifferenceWith(pred,list1,list2){return concat(differenceWith(pred,list1,list2),differenceWith(pred,list2,list1))})},{"./concat":259,"./differenceWith":272,"./internal/_curry3":329}],491:[function(require,module,exports){var _checkForMethod=require("./internal/_checkForMethod");var _curry1=require("./internal/_curry1");var slice=require("./slice");module.exports=_curry1(_checkForMethod("tail",slice(1,Infinity)))},{"./internal/_checkForMethod":319,"./internal/_curry1":327,"./slice":479}],492:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xtake=require("./internal/_xtake");var slice=require("./slice");module.exports=_curry2(_dispatchable(["take"],_xtake,function take(n,xs){return slice(0,n<0?Infinity:n,xs)}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xtake":381,"./slice":479}],493:[function(require,module,exports){var _curry2=require("./internal/_curry2");var drop=require("./drop");module.exports=_curry2(function takeLast(n,xs){return drop(n>=0?xs.length-n:0,xs)})},{"./drop":276,"./internal/_curry2":328}],494:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function takeLastWhile(fn,list){var idx=list.length-1;while(idx>=0&&fn(list[idx])){idx-=1}return Array.prototype.slice.call(list,idx+1)})},{"./internal/_curry2":328}],495:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _dispatchable=require("./internal/_dispatchable");var _xtakeWhile=require("./internal/_xtakeWhile");module.exports=_curry2(_dispatchable(["takeWhile"],_xtakeWhile,function takeWhile(fn,list){var idx=0;var len=list.length;while(idx<len&&fn(list[idx])){idx+=1}return Array.prototype.slice.call(list,0,idx)}))},{"./internal/_curry2":328,"./internal/_dispatchable":331,"./internal/_xtakeWhile":382}],496:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function tap(fn,x){fn(x);return x})},{"./internal/_curry2":328}],497:[function(require,module,exports){var _cloneRegExp=require("./internal/_cloneRegExp");var _curry2=require("./internal/_curry2");var _isRegExp=require("./internal/_isRegExp");var toString=require("./toString");module.exports=_curry2(function test(pattern,str){if(!_isRegExp(pattern)){throw new TypeError("‘test’ requires a value of type RegExp as its first argument; received "+toString(pattern))}return _cloneRegExp(pattern).test(str)})},{"./internal/_cloneRegExp":321,"./internal/_curry2":328,"./internal/_isRegExp":349,"./toString":502}],498:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function times(fn,n){var len=Number(n);var idx=0;var list;if(len<0||isNaN(len)){throw new RangeError("n must be a non-negative number")}list=new Array(len);while(idx<len){list[idx]=fn(idx);idx+=1}return list})},{"./internal/_curry2":328}],499:[function(require,module,exports){var invoker=require("./invoker");module.exports=invoker(0,"toLowerCase")},{"./invoker":390}],500:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _has=require("./internal/_has");module.exports=_curry1(function toPairs(obj){var pairs=[];for(var prop in obj){if(_has(prop,obj)){pairs[pairs.length]=[prop,obj[prop]]}}return pairs})},{"./internal/_curry1":327,"./internal/_has":339}],501:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function toPairsIn(obj){var pairs=[];for(var prop in obj){pairs[pairs.length]=[prop,obj[prop]]}return pairs})},{"./internal/_curry1":327}],502:[function(require,module,exports){var _curry1=require("./internal/_curry1");var _toString=require("./internal/_toString");module.exports=_curry1(function toString(val){return _toString(val,[])})},{"./internal/_curry1":327,"./internal/_toString":363}],503:[function(require,module,exports){var invoker=require("./invoker");module.exports=invoker(0,"toUpperCase")},{"./invoker":390}],504:[function(require,module,exports){var _reduce=require("./internal/_reduce");var _xwrap=require("./internal/_xwrap");var curryN=require("./curryN");module.exports=curryN(4,function transduce(xf,fn,acc,list){return _reduce(xf(typeof fn==="function"?_xwrap(fn):fn),acc,list)})},{"./curryN":267,"./internal/_reduce":359,"./internal/_xwrap":383}],505:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function transpose(outerlist){var i=0;var result=[];while(i<outerlist.length){var innerlist=outerlist[i];var j=0;while(j<innerlist.length){if(typeof result[j]==="undefined"){result[j]=[]}result[j].push(innerlist[j]);j+=1}i+=1}return result})},{"./internal/_curry1":327}],506:[function(require,module,exports){var _curry3=require("./internal/_curry3");var map=require("./map");var sequence=require("./sequence");module.exports=_curry3(function traverse(of,f,traversable){return sequence(of,map(f,traversable))})},{"./internal/_curry3":329,"./map":410,"./sequence":477}],507:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=function(){var ws="	\n\f\r   ᠎    "+"         　\u2028"+"\u2029\ufeff";var zeroWidth="​";var hasProtoTrim=typeof String.prototype.trim==="function";if(!hasProtoTrim||(ws.trim()||!zeroWidth.trim())){return _curry1(function trim(str){var beginRx=new RegExp("^["+ws+"]["+ws+"]*");var endRx=new RegExp("["+ws+"]["+ws+"]*$");return str.replace(beginRx,"").replace(endRx,"")})}else{return _curry1(function trim(str){return str.trim()})}}()},{"./internal/_curry1":327}],508:[function(require,module,exports){var _arity=require("./internal/_arity");var _concat=require("./internal/_concat");var _curry2=require("./internal/_curry2");module.exports=_curry2(function _tryCatch(tryer,catcher){return _arity(tryer.length,function(){try{return tryer.apply(this,arguments)}catch(e){return catcher.apply(this,_concat([e],arguments))}})})},{"./internal/_arity":316,"./internal/_concat":323,"./internal/_curry2":328}],509:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function type(val){return val===null?"Null":val===undefined?"Undefined":Object.prototype.toString.call(val).slice(8,-1)})},{"./internal/_curry1":327}],510:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function unapply(fn){return function(){return fn(Array.prototype.slice.call(arguments,0))}})},{"./internal/_curry1":327}],511:[function(require,module,exports){var _curry1=require("./internal/_curry1");var nAry=require("./nAry");module.exports=_curry1(function unary(fn){return nAry(1,fn)})},{"./internal/_curry1":327,"./nAry":429}],512:[function(require,module,exports){var _curry2=require("./internal/_curry2");var curryN=require("./curryN");module.exports=_curry2(function uncurryN(depth,fn){return curryN(depth,function(){var currentDepth=1;var value=fn;var idx=0;var endIdx;while(currentDepth<=depth&&typeof value==="function"){endIdx=currentDepth===depth?arguments.length:idx+value.length;value=value.apply(this,Array.prototype.slice.call(arguments,idx,endIdx));currentDepth+=1;idx=endIdx}return value})})},{"./curryN":267,"./internal/_curry2":328}],513:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function unfold(fn,seed){var pair=fn(seed);var result=[];while(pair&&pair.length){result[result.length]=pair[0];pair=fn(pair[1])}return result})},{"./internal/_curry2":328}],514:[function(require,module,exports){var _concat=require("./internal/_concat");var _curry2=require("./internal/_curry2");var compose=require("./compose");var uniq=require("./uniq");module.exports=_curry2(compose(uniq,_concat))},{"./compose":256,"./internal/_concat":323,"./internal/_curry2":328,"./uniq":516}],515:[function(require,module,exports){var _concat=require("./internal/_concat");var _curry3=require("./internal/_curry3");var uniqWith=require("./uniqWith");module.exports=_curry3(function unionWith(pred,list1,list2){return uniqWith(pred,_concat(list1,list2))})},{"./internal/_concat":323,"./internal/_curry3":329,"./uniqWith":518}],516:[function(require,module,exports){var identity=require("./identity");var uniqBy=require("./uniqBy");module.exports=uniqBy(identity)},{"./identity":306,"./uniqBy":517}],517:[function(require,module,exports){var _Set=require("./internal/_Set");var _curry2=require("./internal/_curry2");module.exports=_curry2(function uniqBy(fn,list){var set=new _Set;var result=[];var idx=0;var appliedItem,item;while(idx<list.length){item=list[idx];appliedItem=fn(item);if(set.add(appliedItem)){result.push(item)}idx+=1}return result})},{"./internal/_Set":314,"./internal/_curry2":328}],518:[function(require,module,exports){var _containsWith=require("./internal/_containsWith");var _curry2=require("./internal/_curry2");module.exports=_curry2(function uniqWith(pred,list){var idx=0;var len=list.length;var result=[];var item;while(idx<len){item=list[idx];if(!_containsWith(pred,item,result)){result[result.length]=item}idx+=1}return result})},{"./internal/_containsWith":325,"./internal/_curry2":328}],519:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function unless(pred,whenFalseFn,x){return pred(x)?x:whenFalseFn(x)})},{"./internal/_curry3":329}],520:[function(require,module,exports){var _identity=require("./internal/_identity");var chain=require("./chain");module.exports=chain(_identity)},{"./chain":251,"./internal/_identity":340}],521:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function until(pred,fn,init){var val=init;while(!pred(val)){val=fn(val)}return val})},{"./internal/_curry3":329}],522:[function(require,module,exports){var _curry3=require("./internal/_curry3");var adjust=require("./adjust");var always=require("./always");module.exports=_curry3(function update(idx,x,list){return adjust(always(x),idx,list)})},{"./adjust":232,"./always":235,"./internal/_curry3":329}],523:[function(require,module,exports){var _curry2=require("./internal/_curry2");var curryN=require("./curryN");module.exports=_curry2(function useWith(fn,transformers){return curryN(transformers.length,function(){var args=[];var idx=0;while(idx<transformers.length){args.push(transformers[idx].call(this,arguments[idx]));idx+=1}return fn.apply(this,args.concat(Array.prototype.slice.call(arguments,transformers.length)))})})},{"./curryN":267,"./internal/_curry2":328}],524:[function(require,module,exports){var _curry1=require("./internal/_curry1");var keys=require("./keys");module.exports=_curry1(function values(obj){var props=keys(obj);var len=props.length;var vals=[];var idx=0;while(idx<len){vals[idx]=obj[props[idx]];idx+=1}return vals})},{"./internal/_curry1":327,"./keys":397}],525:[function(require,module,exports){var _curry1=require("./internal/_curry1");module.exports=_curry1(function valuesIn(obj){var prop;var vs=[];for(prop in obj){vs[vs.length]=obj[prop]}return vs})},{"./internal/_curry1":327}],526:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=function(){var Const=function(x){return{value:x,map:function(){return this}}};return _curry2(function view(lens,x){return lens(Const)(x).value})}()},{"./internal/_curry2":328}],527:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function when(pred,whenTrueFn,x){return pred(x)?whenTrueFn(x):x})},{"./internal/_curry3":329}],528:[function(require,module,exports){var _curry2=require("./internal/_curry2");var _has=require("./internal/_has");module.exports=_curry2(function where(spec,testObj){for(var prop in spec){if(_has(prop,spec)&&!spec[prop](testObj[prop])){return false}}return true})},{"./internal/_curry2":328,"./internal/_has":339}],529:[function(require,module,exports){var _curry2=require("./internal/_curry2");var equals=require("./equals");var map=require("./map");var where=require("./where");module.exports=_curry2(function whereEq(spec,testObj){return where(map(equals,spec),testObj)})},{"./equals":286,"./internal/_curry2":328,"./map":410,"./where":528}],530:[function(require,module,exports){var _contains=require("./internal/_contains");var _curry2=require("./internal/_curry2");var flip=require("./flip");var reject=require("./reject");module.exports=_curry2(function(xs,list){return reject(flip(_contains)(xs),list)})},{"./flip":294,"./internal/_contains":324,"./internal/_curry2":328,"./reject":471}],531:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function xprod(a,b){var idx=0;var ilen=a.length;var j;var jlen=b.length;var result=[];while(idx<ilen){j=0;while(j<jlen){result[result.length]=[a[idx],b[j]];j+=1}idx+=1}return result})},{"./internal/_curry2":328}],532:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function zip(a,b){var rv=[];var idx=0;var len=Math.min(a.length,b.length);while(idx<len){rv[idx]=[a[idx],b[idx]];idx+=1}return rv})},{"./internal/_curry2":328}],533:[function(require,module,exports){var _curry2=require("./internal/_curry2");module.exports=_curry2(function zipObj(keys,values){var idx=0;var len=Math.min(keys.length,values.length);var out={};while(idx<len){out[keys[idx]]=values[idx];idx+=1}return out})},{"./internal/_curry2":328}],534:[function(require,module,exports){var _curry3=require("./internal/_curry3");module.exports=_curry3(function zipWith(fn,a,b){var rv=[];var idx=0;var len=Math.min(a.length,b.length);while(idx<len){rv[idx]=fn(a[idx],b[idx]);idx+=1}return rv})},{"./internal/_curry3":329}],535:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":536}],536:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":538,"./_stream_writable":540,"core-util-is":17,inherits:37,"process-nextick-args":224}],537:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":539,"core-util-is":17,inherits:37}],538:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=require("./internal/streams/BufferList");var StringDecoder;util.inherits(Readable,Stream);function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=bufferShim.from(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;if(state.decoder&&!addToFront&&!encoding){chunk=state.decoder.write(chunk);skipAdd=!state.objectMode&&chunk.length===0}if(!addToFront)state.reading=false;if(!skipAdd){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this)}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;

if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=bufferShim.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":536,"./internal/streams/BufferList":541,_process:13,buffer:15,"buffer-shims":14,"core-util-is":17,events:20,inherits:37,isarray:40,"process-nextick-args":224,"string_decoder/":551,util:12}],539:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er,data){done(stream,er,data)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!==null&&data!==undefined)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":536,"core-util-is":17,inherits:37}],540:[function(require,module,exports){(function(process){"use strict";module.exports=Writable;function CorkedRequest(state){this.next=null;this.entry=null;this.finish=onCorkedFinish.bind(undefined,this,state)}var processNextTick=require("process-nextick-args");var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;var isBuf=Buffer.isBuffer(chunk);if(typeof encoding==="function"){cb=encoding;encoding=null}if(isBuf)encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=bufferShim.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer"}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=_this}else{state.corkedRequestsFree=_this}}}}).call(this,require("_process"))},{"./_stream_duplex":536,_process:13,buffer:15,"buffer-shims":14,"core-util-is":17,events:20,inherits:37,"process-nextick-args":224,"util-deprecate":555}],541:[function(require,module,exports){"use strict";var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");module.exports=BufferList;function BufferList(){this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function(n){if(this.length===0)return bufferShim.alloc(0);if(this.length===1)return this.head.data;var ret=bufferShim.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){p.data.copy(ret,i);i+=p.data.length;p=p.next}return ret}},{buffer:15,"buffer-shims":14}],542:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":537}],543:[function(require,module,exports){(function(process){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"&&Stream){module.exports=Stream}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":536,"./lib/_stream_passthrough.js":537,"./lib/_stream_readable.js":538,"./lib/_stream_transform.js":539,"./lib/_stream_writable.js":540,_process:13}],544:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":539}],545:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":540}],546:[function(require,module,exports){var R=require("ramda");var featureCollection=require("@turf/helpers").featureCollection;var elementParser=require("./parsers/element");var changesetParser=R.pipe(R.prop(["elements"]),R.map(elementParser),R.flatten,featureCollection);changesetParser.elementParser=elementParser;module.exports=changesetParser},{"./parsers/element":547,"@turf/helpers":10,ramda:226}],547:[function(require,module,exports){var R=require("ramda");var turf=require("@turf/helpers");var createBbox=require("@turf/bbox");var createBboxPolygon=require("@turf/bbox-polygon");function ElementParser(json){function createFeature(data){switch(data.type){case"node":return createNode(data);case"way":return createWay(data);case"relation":return createRelation(data)}}function createNode(data){var geometry=[data.lon,data.lat].map(parseFloat);var properties=R.omit(["lon","lat"],data);return turf.point(geometry,properties)}function createWay(data){var geometry=data.nodes.map(function(node){return[node.lon,node.lat].map(parseFloat)});var properties=R.omit(["nodes"],data);return turf.lineString(geometry,properties)}function createRelation(data){if("members"in data){data.relations=data.members.map(createFeature).filter(R.complement(R.isNil));var feature=createBboxPolygon(createBbox(turf.featureCollection(data.relations)));feature.properties=R.omit(["members"],data);return feature}return null}if(json.action==="delete"){switch(json.type){case"node":json.lon=json.old.lon;json.lat=json.old.lat;break;case"way":json.nodes=json.old.nodes;break;case"relation":json.members=json.old.members;break}}switch(json.action){case"create":json.changeType="added";break;case"delete":json.changeType="deletedNew";json.old.changeType="deletedOld";break;case"modify":json.changeType="modifiedNew";json.old.changeType="modifiedOld";break}return("old"in json?[R.omit(["old"],json),json.old]:[json]).map(createFeature)}module.exports=ElementParser},{"@turf/bbox":9,"@turf/bbox-polygon":8,"@turf/helpers":10,ramda:226}],548:[function(require,module,exports){(function(Buffer){(function(sax){sax.parser=function(strict,opt){return new SAXParser(strict,opt)};sax.SAXParser=SAXParser;sax.SAXStream=SAXStream;sax.createStream=createStream;sax.MAX_BUFFER_LENGTH=64*1024;var buffers=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];sax.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function SAXParser(strict,opt){if(!(this instanceof SAXParser)){return new SAXParser(strict,opt)}var parser=this;clearBuffers(parser);parser.q=parser.c="";parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH;parser.opt=opt||{};parser.opt.lowercase=parser.opt.lowercase||parser.opt.lowercasetags;parser.looseCase=parser.opt.lowercase?"toLowerCase":"toUpperCase";parser.tags=[];parser.closed=parser.closedRoot=parser.sawRoot=false;parser.tag=parser.error=null;parser.strict=!!strict;parser.noscript=!!(strict||parser.opt.noscript);parser.state=S.BEGIN;parser.strictEntities=parser.opt.strictEntities;parser.ENTITIES=parser.strictEntities?Object.create(sax.XML_ENTITIES):Object.create(sax.ENTITIES);parser.attribList=[];if(parser.opt.xmlns){parser.ns=Object.create(rootNS)}parser.trackPosition=parser.opt.position!==false;if(parser.trackPosition){parser.position=parser.line=parser.column=0}emit(parser,"onready")}if(!Object.create){Object.create=function(o){function F(){}F.prototype=o;var newf=new F;return newf}}if(!Object.keys){Object.keys=function(o){var a=[];for(var i in o)if(o.hasOwnProperty(i))a.push(i);return a}}function checkBufferLength(parser){var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10);var maxActual=0;for(var i=0,l=buffers.length;i<l;i++){var len=parser[buffers[i]].length;if(len>maxAllowed){switch(buffers[i]){case"textNode":closeText(parser);break;case"cdata":emitNode(parser,"oncdata",parser.cdata);parser.cdata="";break;case"script":emitNode(parser,"onscript",parser.script);parser.script="";break;default:error(parser,"Max buffer length exceeded: "+buffers[i])}}maxActual=Math.max(maxActual,len)}var m=sax.MAX_BUFFER_LENGTH-maxActual;parser.bufferCheckPosition=m+parser.position}function clearBuffers(parser){for(var i=0,l=buffers.length;i<l;i++){parser[buffers[i]]=""}}function flushBuffers(parser){closeText(parser);if(parser.cdata!==""){emitNode(parser,"oncdata",parser.cdata);parser.cdata=""}if(parser.script!==""){emitNode(parser,"onscript",parser.script);parser.script=""}}SAXParser.prototype={end:function(){end(this)},write:write,resume:function(){this.error=null;return this},close:function(){return this.write(null)},flush:function(){flushBuffers(this)}};var Stream;try{Stream=require("stream").Stream}catch(ex){Stream=function(){}}var streamWraps=sax.EVENTS.filter(function(ev){return ev!=="error"&&ev!=="end"});function createStream(strict,opt){return new SAXStream(strict,opt)}function SAXStream(strict,opt){if(!(this instanceof SAXStream)){return new SAXStream(strict,opt)}Stream.apply(this);this._parser=new SAXParser(strict,opt);this.writable=true;this.readable=true;var me=this;this._parser.onend=function(){me.emit("end")};this._parser.onerror=function(er){me.emit("error",er);me._parser.error=null};this._decoder=null;streamWraps.forEach(function(ev){Object.defineProperty(me,"on"+ev,{get:function(){return me._parser["on"+ev]},set:function(h){if(!h){me.removeAllListeners(ev);me._parser["on"+ev]=h;return h}me.on(ev,h)},enumerable:true,configurable:false})})}SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}});SAXStream.prototype.write=function(data){if(typeof Buffer==="function"&&typeof Buffer.isBuffer==="function"&&Buffer.isBuffer(data)){if(!this._decoder){var SD=require("string_decoder").StringDecoder;this._decoder=new SD("utf8")}data=this._decoder.write(data)}this._parser.write(data.toString());this.emit("data",data);return true};SAXStream.prototype.end=function(chunk){if(chunk&&chunk.length){this.write(chunk)}this._parser.end();return true};SAXStream.prototype.on=function(ev,handler){var me=this;if(!me._parser["on"+ev]&&streamWraps.indexOf(ev)!==-1){me._parser["on"+ev]=function(){var args=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);args.splice(0,0,ev);me.emit.apply(me,args)}}return Stream.prototype.on.call(me,ev,handler)};var whitespace="\r\n	 ";var quote="'\"";var attribEnd=whitespace+">";var CDATA="[CDATA[";var DOCTYPE="DOCTYPE";var XML_NAMESPACE="http://www.w3.org/XML/1998/namespace";var XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/";var rootNS={xml:XML_NAMESPACE,xmlns:XMLNS_NAMESPACE};whitespace=charClass(whitespace);var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;var entityStart=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var entityBody=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;quote=charClass(quote);attribEnd=charClass(attribEnd);function charClass(str){return str.split("").reduce(function(s,c){s[c]=true;return s},{})}function isMatch(regex,c){return regex.test(c)}function is(charclass,c){return charclass[c]}function notMatch(regex,c){return!isMatch(regex,c)}function not(charclass,c){return!is(charclass,c)}var S=0;sax.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++};sax.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"};sax.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};Object.keys(sax.ENTITIES).forEach(function(key){var e=sax.ENTITIES[key];var s=typeof e==="number"?String.fromCharCode(e):e;sax.ENTITIES[key]=s});for(var s in sax.STATE){sax.STATE[sax.STATE[s]]=s}S=sax.STATE;function emit(parser,event,data){parser[event]&&parser[event](data)}function emitNode(parser,nodeType,data){if(parser.textNode)closeText(parser);emit(parser,nodeType,data)}function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode);if(parser.textNode)emit(parser,"ontext",parser.textNode);parser.textNode=""}function textopts(opt,text){if(opt.trim)text=text.trim();if(opt.normalize)text=text.replace(/\s+/g," ");return text}function error(parser,er){closeText(parser);if(parser.trackPosition){er+="\nLine: "+parser.line+"\nColumn: "+parser.column+"\nChar: "+parser.c}er=new Error(er);parser.error=er;emit(parser,"onerror",er);return parser}function end(parser){if(parser.sawRoot&&!parser.closedRoot)strictFail(parser,"Unclosed root tag");if(parser.state!==S.BEGIN&&parser.state!==S.BEGIN_WHITESPACE&&parser.state!==S.TEXT){error(parser,"Unexpected end")}closeText(parser);parser.c="";parser.closed=true;emit(parser,"onend");SAXParser.call(parser,parser.strict,parser.opt);return parser}function strictFail(parser,message){if(typeof parser!=="object"||!(parser instanceof SAXParser)){throw new Error("bad call to strictFail")}if(parser.strict){error(parser,message)}}function newTag(parser){if(!parser.strict)parser.tagName=parser.tagName[parser.looseCase]();var parent=parser.tags[parser.tags.length-1]||parser;var tag=parser.tag={name:parser.tagName,attributes:{}};if(parser.opt.xmlns){tag.ns=parent.ns}parser.attribList.length=0;emitNode(parser,"onopentagstart",tag)}function qname(name,attribute){var i=name.indexOf(":");var qualName=i<0?["",name]:name.split(":");var prefix=qualName[0];var local=qualName[1];if(attribute&&name==="xmlns"){prefix="xmlns";local=""}return{prefix:prefix,local:local}}function attrib(parser){if(!parser.strict){parser.attribName=parser.attribName[parser.looseCase]()}if(parser.attribList.indexOf(parser.attribName)!==-1||parser.tag.attributes.hasOwnProperty(parser.attribName)){parser.attribName=parser.attribValue="";return}if(parser.opt.xmlns){var qn=qname(parser.attribName,true);var prefix=qn.prefix;var local=qn.local;if(prefix==="xmlns"){if(local==="xml"&&parser.attribValue!==XML_NAMESPACE){strictFail(parser,"xml: prefix must be bound to "+XML_NAMESPACE+"\n"+"Actual: "+parser.attribValue)}else if(local==="xmlns"&&parser.attribValue!==XMLNS_NAMESPACE){strictFail(parser,"xmlns: prefix must be bound to "+XMLNS_NAMESPACE+"\n"+"Actual: "+parser.attribValue)}else{var tag=parser.tag;var parent=parser.tags[parser.tags.length-1]||parser;if(tag.ns===parent.ns){tag.ns=Object.create(parent.ns)}tag.ns[local]=parser.attribValue}}parser.attribList.push([parser.attribName,parser.attribValue])}else{parser.tag.attributes[parser.attribName]=parser.attribValue;emitNode(parser,"onattribute",{name:parser.attribName,value:parser.attribValue})}parser.attribName=parser.attribValue=""}function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag;var qn=qname(parser.tagName);tag.prefix=qn.prefix;tag.local=qn.local;tag.uri=tag.ns[qn.prefix]||"";if(tag.prefix&&!tag.uri){strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(parser.tagName));tag.uri=qn.prefix}var parent=parser.tags[parser.tags.length-1]||parser;if(tag.ns&&parent.ns!==tag.ns){Object.keys(tag.ns).forEach(function(p){emitNode(parser,"onopennamespace",{prefix:p,uri:tag.ns[p]})})}for(var i=0,l=parser.attribList.length;i<l;i++){var nv=parser.attribList[i];var name=nv[0];var value=nv[1];var qualName=qname(name,true);var prefix=qualName.prefix;var local=qualName.local;var uri=prefix===""?"":tag.ns[prefix]||"";var a={name:name,value:value,prefix:prefix,local:local,uri:uri};if(prefix&&prefix!=="xmlns"&&!uri){strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(prefix));a.uri=prefix}parser.tag.attributes[name]=a;emitNode(parser,"onattribute",a)}parser.attribList.length=0}parser.tag.isSelfClosing=!!selfClosing;parser.sawRoot=true;parser.tags.push(parser.tag);emitNode(parser,"onopentag",parser.tag);if(!selfClosing){if(!parser.noscript&&parser.tagName.toLowerCase()==="script"){parser.state=S.SCRIPT}else{parser.state=S.TEXT}parser.tag=null;parser.tagName=""}parser.attribName=parser.attribValue="";parser.attribList.length=0}function closeTag(parser){if(!parser.tagName){strictFail(parser,"Weird empty close tag.");parser.textNode+="</>";parser.state=S.TEXT;return}if(parser.script){if(parser.tagName!=="script"){parser.script+="</"+parser.tagName+">";parser.tagName="";parser.state=S.SCRIPT;return}emitNode(parser,"onscript",parser.script);parser.script=""}var t=parser.tags.length;var tagName=parser.tagName;if(!parser.strict){tagName=tagName[parser.looseCase]()}var closeTo=tagName;while(t--){var close=parser.tags[t];if(close.name!==closeTo){strictFail(parser,"Unexpected close tag")}else{break}}if(t<0){strictFail(parser,"Unmatched closing tag: "+parser.tagName);parser.textNode+="</"+parser.tagName+">";parser.state=S.TEXT;return}parser.tagName=tagName;var s=parser.tags.length;while(s-->t){var tag=parser.tag=parser.tags.pop();parser.tagName=parser.tag.name;emitNode(parser,"onclosetag",parser.tagName);

var x={};for(var i in tag.ns){x[i]=tag.ns[i]}var parent=parser.tags[parser.tags.length-1]||parser;if(parser.opt.xmlns&&tag.ns!==parent.ns){Object.keys(tag.ns).forEach(function(p){var n=tag.ns[p];emitNode(parser,"onclosenamespace",{prefix:p,uri:n})})}}if(t===0)parser.closedRoot=true;parser.tagName=parser.attribValue=parser.attribName="";parser.attribList.length=0;parser.state=S.TEXT}function parseEntity(parser){var entity=parser.entity;var entityLC=entity.toLowerCase();var num;var numStr="";if(parser.ENTITIES[entity]){return parser.ENTITIES[entity]}if(parser.ENTITIES[entityLC]){return parser.ENTITIES[entityLC]}entity=entityLC;if(entity.charAt(0)==="#"){if(entity.charAt(1)==="x"){entity=entity.slice(2);num=parseInt(entity,16);numStr=num.toString(16)}else{entity=entity.slice(1);num=parseInt(entity,10);numStr=num.toString(10)}}entity=entity.replace(/^0+/,"");if(numStr.toLowerCase()!==entity){strictFail(parser,"Invalid character entity");return"&"+parser.entity+";"}return String.fromCodePoint(num)}function beginWhiteSpace(parser,c){if(c==="<"){parser.state=S.OPEN_WAKA;parser.startTagPosition=parser.position}else if(not(whitespace,c)){strictFail(parser,"Non-whitespace before first tag.");parser.textNode=c;parser.state=S.TEXT}}function charAt(chunk,i){var result="";if(i<chunk.length){result=chunk.charAt(i)}return result}function write(chunk){var parser=this;if(this.error){throw this.error}if(parser.closed){return error(parser,"Cannot write after close. Assign an onready handler.")}if(chunk===null){return end(parser)}if(typeof chunk==="object"){chunk=chunk.toString()}var i=0;var c="";while(true){c=charAt(chunk,i++);parser.c=c;if(!c){break}if(parser.trackPosition){parser.position++;if(c==="\n"){parser.line++;parser.column=0}else{parser.column++}}switch(parser.state){case S.BEGIN:parser.state=S.BEGIN_WHITESPACE;if(c==="\ufeff"){continue}beginWhiteSpace(parser,c);continue;case S.BEGIN_WHITESPACE:beginWhiteSpace(parser,c);continue;case S.TEXT:if(parser.sawRoot&&!parser.closedRoot){var starti=i-1;while(c&&c!=="<"&&c!=="&"){c=charAt(chunk,i++);if(c&&parser.trackPosition){parser.position++;if(c==="\n"){parser.line++;parser.column=0}else{parser.column++}}}parser.textNode+=chunk.substring(starti,i-1)}if(c==="<"&&!(parser.sawRoot&&parser.closedRoot&&!parser.strict)){parser.state=S.OPEN_WAKA;parser.startTagPosition=parser.position}else{if(not(whitespace,c)&&(!parser.sawRoot||parser.closedRoot)){strictFail(parser,"Text data outside of root node.")}if(c==="&"){parser.state=S.TEXT_ENTITY}else{parser.textNode+=c}}continue;case S.SCRIPT:if(c==="<"){parser.state=S.SCRIPT_ENDING}else{parser.script+=c}continue;case S.SCRIPT_ENDING:if(c==="/"){parser.state=S.CLOSE_TAG}else{parser.script+="<"+c;parser.state=S.SCRIPT}continue;case S.OPEN_WAKA:if(c==="!"){parser.state=S.SGML_DECL;parser.sgmlDecl=""}else if(is(whitespace,c)){}else if(isMatch(nameStart,c)){parser.state=S.OPEN_TAG;parser.tagName=c}else if(c==="/"){parser.state=S.CLOSE_TAG;parser.tagName=""}else if(c==="?"){parser.state=S.PROC_INST;parser.procInstName=parser.procInstBody=""}else{strictFail(parser,"Unencoded <");if(parser.startTagPosition+1<parser.position){var pad=parser.position-parser.startTagPosition;c=new Array(pad).join(" ")+c}parser.textNode+="<"+c;parser.state=S.TEXT}continue;case S.SGML_DECL:if((parser.sgmlDecl+c).toUpperCase()===CDATA){emitNode(parser,"onopencdata");parser.state=S.CDATA;parser.sgmlDecl="";parser.cdata=""}else if(parser.sgmlDecl+c==="--"){parser.state=S.COMMENT;parser.comment="";parser.sgmlDecl=""}else if((parser.sgmlDecl+c).toUpperCase()===DOCTYPE){parser.state=S.DOCTYPE;if(parser.doctype||parser.sawRoot){strictFail(parser,"Inappropriately located doctype declaration")}parser.doctype="";parser.sgmlDecl=""}else if(c===">"){emitNode(parser,"onsgmldeclaration",parser.sgmlDecl);parser.sgmlDecl="";parser.state=S.TEXT}else if(is(quote,c)){parser.state=S.SGML_DECL_QUOTED;parser.sgmlDecl+=c}else{parser.sgmlDecl+=c}continue;case S.SGML_DECL_QUOTED:if(c===parser.q){parser.state=S.SGML_DECL;parser.q=""}parser.sgmlDecl+=c;continue;case S.DOCTYPE:if(c===">"){parser.state=S.TEXT;emitNode(parser,"ondoctype",parser.doctype);parser.doctype=true}else{parser.doctype+=c;if(c==="["){parser.state=S.DOCTYPE_DTD}else if(is(quote,c)){parser.state=S.DOCTYPE_QUOTED;parser.q=c}}continue;case S.DOCTYPE_QUOTED:parser.doctype+=c;if(c===parser.q){parser.q="";parser.state=S.DOCTYPE}continue;case S.DOCTYPE_DTD:parser.doctype+=c;if(c==="]"){parser.state=S.DOCTYPE}else if(is(quote,c)){parser.state=S.DOCTYPE_DTD_QUOTED;parser.q=c}continue;case S.DOCTYPE_DTD_QUOTED:parser.doctype+=c;if(c===parser.q){parser.state=S.DOCTYPE_DTD;parser.q=""}continue;case S.COMMENT:if(c==="-"){parser.state=S.COMMENT_ENDING}else{parser.comment+=c}continue;case S.COMMENT_ENDING:if(c==="-"){parser.state=S.COMMENT_ENDED;parser.comment=textopts(parser.opt,parser.comment);if(parser.comment){emitNode(parser,"oncomment",parser.comment)}parser.comment=""}else{parser.comment+="-"+c;parser.state=S.COMMENT}continue;case S.COMMENT_ENDED:if(c!==">"){strictFail(parser,"Malformed comment");parser.comment+="--"+c;parser.state=S.COMMENT}else{parser.state=S.TEXT}continue;case S.CDATA:if(c==="]"){parser.state=S.CDATA_ENDING}else{parser.cdata+=c}continue;case S.CDATA_ENDING:if(c==="]"){parser.state=S.CDATA_ENDING_2}else{parser.cdata+="]"+c;parser.state=S.CDATA}continue;case S.CDATA_ENDING_2:if(c===">"){if(parser.cdata){emitNode(parser,"oncdata",parser.cdata)}emitNode(parser,"onclosecdata");parser.cdata="";parser.state=S.TEXT}else if(c==="]"){parser.cdata+="]"}else{parser.cdata+="]]"+c;parser.state=S.CDATA}continue;case S.PROC_INST:if(c==="?"){parser.state=S.PROC_INST_ENDING}else if(is(whitespace,c)){parser.state=S.PROC_INST_BODY}else{parser.procInstName+=c}continue;case S.PROC_INST_BODY:if(!parser.procInstBody&&is(whitespace,c)){continue}else if(c==="?"){parser.state=S.PROC_INST_ENDING}else{parser.procInstBody+=c}continue;case S.PROC_INST_ENDING:if(c===">"){emitNode(parser,"onprocessinginstruction",{name:parser.procInstName,body:parser.procInstBody});parser.procInstName=parser.procInstBody="";parser.state=S.TEXT}else{parser.procInstBody+="?"+c;parser.state=S.PROC_INST_BODY}continue;case S.OPEN_TAG:if(isMatch(nameBody,c)){parser.tagName+=c}else{newTag(parser);if(c===">"){openTag(parser)}else if(c==="/"){parser.state=S.OPEN_TAG_SLASH}else{if(not(whitespace,c)){strictFail(parser,"Invalid character in tag name")}parser.state=S.ATTRIB}}continue;case S.OPEN_TAG_SLASH:if(c===">"){openTag(parser,true);closeTag(parser)}else{strictFail(parser,"Forward-slash in opening tag not followed by >");parser.state=S.ATTRIB}continue;case S.ATTRIB:if(is(whitespace,c)){continue}else if(c===">"){openTag(parser)}else if(c==="/"){parser.state=S.OPEN_TAG_SLASH}else if(isMatch(nameStart,c)){parser.attribName=c;parser.attribValue="";parser.state=S.ATTRIB_NAME}else{strictFail(parser,"Invalid attribute name")}continue;case S.ATTRIB_NAME:if(c==="="){parser.state=S.ATTRIB_VALUE}else if(c===">"){strictFail(parser,"Attribute without value");parser.attribValue=parser.attribName;attrib(parser);openTag(parser)}else if(is(whitespace,c)){parser.state=S.ATTRIB_NAME_SAW_WHITE}else if(isMatch(nameBody,c)){parser.attribName+=c}else{strictFail(parser,"Invalid attribute name")}continue;case S.ATTRIB_NAME_SAW_WHITE:if(c==="="){parser.state=S.ATTRIB_VALUE}else if(is(whitespace,c)){continue}else{strictFail(parser,"Attribute without value");parser.tag.attributes[parser.attribName]="";parser.attribValue="";emitNode(parser,"onattribute",{name:parser.attribName,value:""});parser.attribName="";if(c===">"){openTag(parser)}else if(isMatch(nameStart,c)){parser.attribName=c;parser.state=S.ATTRIB_NAME}else{strictFail(parser,"Invalid attribute name");parser.state=S.ATTRIB}}continue;case S.ATTRIB_VALUE:if(is(whitespace,c)){continue}else if(is(quote,c)){parser.q=c;parser.state=S.ATTRIB_VALUE_QUOTED}else{strictFail(parser,"Unquoted attribute value");parser.state=S.ATTRIB_VALUE_UNQUOTED;parser.attribValue=c}continue;case S.ATTRIB_VALUE_QUOTED:if(c!==parser.q){if(c==="&"){parser.state=S.ATTRIB_VALUE_ENTITY_Q}else{parser.attribValue+=c}continue}attrib(parser);parser.q="";parser.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:if(is(whitespace,c)){parser.state=S.ATTRIB}else if(c===">"){openTag(parser)}else if(c==="/"){parser.state=S.OPEN_TAG_SLASH}else if(isMatch(nameStart,c)){strictFail(parser,"No whitespace between attributes");parser.attribName=c;parser.attribValue="";parser.state=S.ATTRIB_NAME}else{strictFail(parser,"Invalid attribute name")}continue;case S.ATTRIB_VALUE_UNQUOTED:if(not(attribEnd,c)){if(c==="&"){parser.state=S.ATTRIB_VALUE_ENTITY_U}else{parser.attribValue+=c}continue}attrib(parser);if(c===">"){openTag(parser)}else{parser.state=S.ATTRIB}continue;case S.CLOSE_TAG:if(!parser.tagName){if(is(whitespace,c)){continue}else if(notMatch(nameStart,c)){if(parser.script){parser.script+="</"+c;parser.state=S.SCRIPT}else{strictFail(parser,"Invalid tagname in closing tag.")}}else{parser.tagName=c}}else if(c===">"){closeTag(parser)}else if(isMatch(nameBody,c)){parser.tagName+=c}else if(parser.script){parser.script+="</"+parser.tagName;parser.tagName="";parser.state=S.SCRIPT}else{if(not(whitespace,c)){strictFail(parser,"Invalid tagname in closing tag")}parser.state=S.CLOSE_TAG_SAW_WHITE}continue;case S.CLOSE_TAG_SAW_WHITE:if(is(whitespace,c)){continue}if(c===">"){closeTag(parser)}else{strictFail(parser,"Invalid characters in closing tag")}continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:var returnState;var buffer;switch(parser.state){case S.TEXT_ENTITY:returnState=S.TEXT;buffer="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:returnState=S.ATTRIB_VALUE_QUOTED;buffer="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:returnState=S.ATTRIB_VALUE_UNQUOTED;buffer="attribValue";break}if(c===";"){parser[buffer]+=parseEntity(parser);parser.entity="";parser.state=returnState}else if(isMatch(parser.entity.length?entityBody:entityStart,c)){parser.entity+=c}else{strictFail(parser,"Invalid character in entity name");parser[buffer]+="&"+parser.entity+c;parser.entity="";parser.state=returnState}continue;default:throw new Error(parser,"Unknown state: "+parser.state)}}if(parser.position>=parser.bufferCheckPosition){checkBufferLength(parser)}return parser}if(!String.fromCodePoint){(function(){var stringFromCharCode=String.fromCharCode;var floor=Math.floor;var fromCodePoint=function(){var MAX_SIZE=16384;var codeUnits=[];var highSurrogate;var lowSurrogate;var index=-1;var length=arguments.length;if(!length){return""}var result="";while(++index<length){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor(codePoint)!==codePoint){throw RangeError("Invalid code point: "+codePoint)}if(codePoint<=65535){codeUnits.push(codePoint)}else{codePoint-=65536;highSurrogate=(codePoint>>10)+55296;lowSurrogate=codePoint%1024+56320;codeUnits.push(highSurrogate,lowSurrogate)}if(index+1===length||codeUnits.length>MAX_SIZE){result+=stringFromCharCode.apply(null,codeUnits);codeUnits.length=0}}return result};if(Object.defineProperty){Object.defineProperty(String,"fromCodePoint",{value:fromCodePoint,configurable:true,writable:true})}else{String.fromCodePoint=fromCodePoint}})()}})(typeof exports==="undefined"?this.sax={}:exports)}).call(this,require("buffer").Buffer)},{buffer:15,stream:550,string_decoder:551}],549:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ShelfPack=factory()})(this,function(){function ShelfPack(w,h,options){options=options||{};this.w=w||64;this.h=h||64;this.autoResize=!!options.autoResize;this.shelves=[];this.stats={};this.count=function(h){this.stats[h]=(this.stats[h]|0)+1}}ShelfPack.prototype.pack=function(bins,options){bins=[].concat(bins);options=options||{};var results=[],w,h,allocation;for(var i=0;i<bins.length;i++){w=bins[i].w||bins[i].width;h=bins[i].h||bins[i].height;if(w&&h){allocation=this.packOne(w,h);if(!allocation){continue}if(options.inPlace){bins[i].x=allocation.x;bins[i].y=allocation.y}results.push(allocation)}}if(this.shelves.length>0){var w2=0;var h2=0;for(var j=0;j<this.shelves.length;j++){var shelf=this.shelves[j];h2+=shelf.h;w2=Math.max(shelf.w-shelf.free,w2)}this.resize(w2,h2)}return results};ShelfPack.prototype.packOne=function(w,h){var y=0,best={shelf:-1,waste:Infinity},shelf,waste;for(var i=0;i<this.shelves.length;i++){shelf=this.shelves[i];y+=shelf.h;if(h===shelf.h&&w<=shelf.free){this.count(h);return shelf.alloc(w,h)}if(h>shelf.h||w>shelf.free){continue}if(h<shelf.h&&w<=shelf.free){waste=shelf.h-h;if(waste<best.waste){best.waste=waste;best.shelf=i}}}if(best.shelf!==-1){shelf=this.shelves[best.shelf];this.count(h);return shelf.alloc(w,h)}if(h<=this.h-y&&w<=this.w){shelf=new Shelf(y,this.w,h);this.shelves.push(shelf);this.count(h);return shelf.alloc(w,h)}if(this.autoResize){var h1,h2,w1,w2;h1=h2=this.h;w1=w2=this.w;if(w1<=h1||w>w1){w2=Math.max(w,w1)*2}if(h1<w1||h>h1){h2=Math.max(h,h1)*2}this.resize(w2,h2);return this.packOne(w,h)}return null};ShelfPack.prototype.clear=function(){this.shelves=[];this.stats={}};ShelfPack.prototype.resize=function(w,h){this.w=w;this.h=h;for(var i=0;i<this.shelves.length;i++){this.shelves[i].resize(w)}return true};function Shelf(y,w,h){this.x=0;this.y=y;this.w=this.free=w;this.h=h}Shelf.prototype.alloc=function(w,h){if(w>this.free||h>this.h){return null}var x=this.x;this.x+=w;this.free-=w;return{x:x,y:this.y,w:w,h:h,width:w,height:h}};Shelf.prototype.resize=function(w){this.free+=w-this.w;this.w=w;return true};return ShelfPack})},{}],550:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:20,inherits:37,"readable-stream/duplex.js":535,"readable-stream/passthrough.js":542,"readable-stream/readable.js":543,"readable-stream/transform.js":544,"readable-stream/writable.js":545}],551:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:15}],552:[function(require,module,exports){"use strict";var kdbush=require("kdbush");module.exports=supercluster;function supercluster(options){return new SuperCluster(options)}function SuperCluster(options){this.options=extend(Object.create(this.options),options);this.trees=new Array(this.options.maxZoom+1)}SuperCluster.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:false,reduce:null,initial:function(){return{}},map:function(props){return props}},load:function(points){var log=this.options.log;if(log)console.time("total time");var timerId="prepare "+points.length+" points";if(log)console.time(timerId);this.points=points;var clusters=points.map(createPointCluster);if(log)console.timeEnd(timerId);for(var z=this.options.maxZoom;z>=this.options.minZoom;z--){var now=+Date.now();this.trees[z+1]=kdbush(clusters,getX,getY,this.options.nodeSize,Float32Array);clusters=this._cluster(clusters,z);if(log)console.log("z%d: %d clusters in %dms",z,clusters.length,+Date.now()-now)}this.trees[this.options.minZoom]=kdbush(clusters,getX,getY,this.options.nodeSize,Float32Array);if(log)console.timeEnd("total time");return this},getClusters:function(bbox,zoom){var tree=this.trees[this._limitZoom(zoom)];var ids=tree.range(lngX(bbox[0]),latY(bbox[3]),lngX(bbox[2]),latY(bbox[1]));var clusters=[];for(var i=0;i<ids.length;i++){var c=tree.points[ids[i]];clusters.push(c.numPoints?getClusterJSON(c):this.points[c.id])}return clusters},getChildren:function(clusterId,clusterZoom){var origin=this.trees[clusterZoom+1].points[clusterId];var r=this.options.radius/(this.options.extent*Math.pow(2,clusterZoom));var points=this.trees[clusterZoom+1].within(origin.x,origin.y,r);var children=[];for(var i=0;i<points.length;i++){var c=this.trees[clusterZoom+1].points[points[i]];if(c.parentId===clusterId){children.push(c.numPoints?getClusterJSON(c):this.points[c.id])}}return children},getLeaves:function(clusterId,clusterZoom,limit,offset){limit=limit||10;offset=offset||0;var leaves=[];this._appendLeaves(leaves,clusterId,clusterZoom,limit,offset,0);return leaves},getTile:function(z,x,y){var tree=this.trees[this._limitZoom(z)];var z2=Math.pow(2,z);var extent=this.options.extent;var r=this.options.radius;var p=r/extent;var top=(y-p)/z2;var bottom=(y+1+p)/z2;var tile={features:[]};this._addTileFeatures(tree.range((x-p)/z2,top,(x+1+p)/z2,bottom),tree.points,x,y,z2,tile);if(x===0){this._addTileFeatures(tree.range(1-p/z2,top,1,bottom),tree.points,z2,y,z2,tile)}if(x===z2-1){this._addTileFeatures(tree.range(0,top,p/z2,bottom),tree.points,-1,y,z2,tile)}return tile.features.length?tile:null},getClusterExpansionZoom:function(clusterId,clusterZoom){while(clusterZoom<this.options.maxZoom){var children=this.getChildren(clusterId,clusterZoom);clusterZoom++;if(children.length!==1)break;clusterId=children[0].properties.cluster_id}return clusterZoom},_appendLeaves:function(result,clusterId,clusterZoom,limit,offset,skipped){var children=this.getChildren(clusterId,clusterZoom);for(var i=0;i<children.length;i++){var props=children[i].properties;if(props.cluster){if(skipped+props.point_count<=offset){skipped+=props.point_count}else{skipped=this._appendLeaves(result,props.cluster_id,clusterZoom+1,limit,offset,skipped)}}else if(skipped<offset){skipped++}else{result.push(children[i])}if(result.length===limit)break}return skipped},_addTileFeatures:function(ids,points,x,y,z2,tile){for(var i=0;i<ids.length;i++){var c=points[ids[i]];tile.features.push({type:1,geometry:[[Math.round(this.options.extent*(c.x*z2-x)),Math.round(this.options.extent*(c.y*z2-y))]],tags:c.numPoints?getClusterProperties(c):this.points[c.id].properties})}},_limitZoom:function(z){return Math.max(this.options.minZoom,Math.min(z,this.options.maxZoom+1))},_cluster:function(points,zoom){var clusters=[];var r=this.options.radius/(this.options.extent*Math.pow(2,zoom));for(var i=0;i<points.length;i++){var p=points[i];if(p.zoom<=zoom)continue;p.zoom=zoom;var tree=this.trees[zoom+1];var neighborIds=tree.within(p.x,p.y,r);var numPoints=p.numPoints||1;var wx=p.x*numPoints;var wy=p.y*numPoints;var clusterProperties=null;if(this.options.reduce){clusterProperties=this.options.initial();this._accumulate(clusterProperties,p)}for(var j=0;j<neighborIds.length;j++){var b=tree.points[neighborIds[j]];if(zoom<b.zoom){var numPoints2=b.numPoints||1;b.zoom=zoom;wx+=b.x*numPoints2;wy+=b.y*numPoints2;numPoints+=numPoints2;b.parentId=i;if(this.options.reduce){this._accumulate(clusterProperties,b)}}}if(numPoints===1){clusters.push(p)}else{p.parentId=i;clusters.push(createCluster(wx/numPoints,wy/numPoints,numPoints,i,clusterProperties))}}return clusters},_accumulate:function(clusterProperties,point){var properties=point.numPoints?point.properties:this.options.map(this.points[point.id].properties);this.options.reduce(clusterProperties,properties)}};function createCluster(x,y,numPoints,id,properties){return{x:x,y:y,zoom:Infinity,id:id,properties:properties,parentId:-1,numPoints:numPoints}}function createPointCluster(p,id){var coords=p.geometry.coordinates;return{x:lngX(coords[0]),y:latY(coords[1]),zoom:Infinity,id:id,parentId:-1}}function getClusterJSON(cluster){return{type:"Feature",properties:getClusterProperties(cluster),geometry:{type:"Point",coordinates:[xLng(cluster.x),yLat(cluster.y)]}}}function getClusterProperties(cluster){var count=cluster.numPoints;var abbrev=count>=1e4?Math.round(count/1e3)+"k":count>=1e3?Math.round(count/100)/10+"k":count;return extend(extend({},cluster.properties),{cluster:true,cluster_id:cluster.id,point_count:count,point_count_abbreviated:abbrev})}function lngX(lng){return lng/360+.5}function latY(lat){var sin=Math.sin(lat*Math.PI/180),y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;return y<0?0:y>1?1:y}function xLng(x){return(x-.5)*360}function yLat(y){var y2=(180-y*360)*Math.PI/180;return 360*Math.atan(Math.exp(y2))/Math.PI-90}function extend(dest,src){for(var id in src)dest[id]=src[id];return dest}function getX(p){return p.x}function getY(p){return p.y}},{kdbush:41}],553:[function(require,module,exports){"use strict";module.exports=TinyQueue;function TinyQueue(data,compare){if(!(this instanceof TinyQueue))return new TinyQueue(data,compare);this.data=data||[];this.length=this.data.length;this.compare=compare||defaultCompare;if(data)for(var i=Math.floor(this.length/2);i>=0;i--)this._down(i)}function defaultCompare(a,b){return a<b?-1:a>b?1:0}TinyQueue.prototype={push:function(item){this.data.push(item);this.length++;this._up(this.length-1)},pop:function(){var top=this.data[0];this.data[0]=this.data[this.length-1];this.length--;this.data.pop();this._down(0);return top},peek:function(){return this.data[0]},_up:function(pos){var data=this.data,compare=this.compare;while(pos>0){var parent=Math.floor((pos-1)/2);if(compare(data[pos],data[parent])<0){swap(data,parent,pos);pos=parent}else break}},_down:function(pos){var data=this.data,compare=this.compare,len=this.length;while(true){var left=2*pos+1,right=left+1,min=pos;if(left<len&&compare(data[left],data[min])<0)min=left;if(right<len&&compare(data[right],data[min])<0)min=right;if(min===pos)return;swap(data,min,pos);pos=min}}};function swap(data,i,j){var tmp=data[i];data[i]=data[j];data[j]=tmp}},{}],554:[function(require,module,exports){exports=module.exports=trim;function trim(str){return str.replace(/^\s*|\s*$/g,"")}exports.left=function(str){return str.replace(/^\s*/,"")};exports.right=function(str){return str.replace(/\s*$/,"")}},{}],555:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],556:[function(require,module,exports){arguments[4][37][0].apply(exports,arguments)},{dup:37}],557:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],558:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]";

}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":557,_process:13,inherits:556}],559:[function(require,module,exports){module.exports.VectorTile=require("./lib/vectortile.js");module.exports.VectorTileFeature=require("./lib/vectortilefeature.js");module.exports.VectorTileLayer=require("./lib/vectortilelayer.js")},{"./lib/vectortile.js":560,"./lib/vectortilefeature.js":561,"./lib/vectortilelayer.js":562}],560:[function(require,module,exports){"use strict";var VectorTileLayer=require("./vectortilelayer");module.exports=VectorTile;function VectorTile(pbf,end){this.layers=pbf.readFields(readTile,{},end)}function readTile(tag,layers,pbf){if(tag===3){var layer=new VectorTileLayer(pbf,pbf.readVarint()+pbf.pos);if(layer.length)layers[layer.name]=layer}}},{"./vectortilelayer":562}],561:[function(require,module,exports){"use strict";var Point=require("point-geometry");module.exports=VectorTileFeature;function VectorTileFeature(pbf,end,extent,keys,values){this.properties={};this.extent=extent;this.type=0;this._pbf=pbf;this._geometry=-1;this._keys=keys;this._values=values;pbf.readFields(readFeature,this,end)}function readFeature(tag,feature,pbf){if(tag==1)feature.id=pbf.readVarint();else if(tag==2)readTag(pbf,feature);else if(tag==3)feature.type=pbf.readVarint();else if(tag==4)feature._geometry=pbf.pos}function readTag(pbf,feature){var end=pbf.readVarint()+pbf.pos;while(pbf.pos<end){var key=feature._keys[pbf.readVarint()],value=feature._values[pbf.readVarint()];feature.properties[key]=value}}VectorTileFeature.types=["Unknown","Point","LineString","Polygon"];VectorTileFeature.prototype.loadGeometry=function(){var pbf=this._pbf;pbf.pos=this._geometry;var end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,lines=[],line;while(pbf.pos<end){if(!length){var cmdLen=pbf.readVarint();cmd=cmdLen&7;length=cmdLen>>3}length--;if(cmd===1||cmd===2){x+=pbf.readSVarint();y+=pbf.readSVarint();if(cmd===1){if(line)lines.push(line);line=[]}line.push(new Point(x,y))}else if(cmd===7){if(line){line.push(line[0].clone())}}else{throw new Error("unknown command "+cmd)}}if(line)lines.push(line);return lines};VectorTileFeature.prototype.bbox=function(){var pbf=this._pbf;pbf.pos=this._geometry;var end=pbf.readVarint()+pbf.pos,cmd=1,length=0,x=0,y=0,x1=Infinity,x2=-Infinity,y1=Infinity,y2=-Infinity;while(pbf.pos<end){if(!length){var cmdLen=pbf.readVarint();cmd=cmdLen&7;length=cmdLen>>3}length--;if(cmd===1||cmd===2){x+=pbf.readSVarint();y+=pbf.readSVarint();if(x<x1)x1=x;if(x>x2)x2=x;if(y<y1)y1=y;if(y>y2)y2=y}else if(cmd!==7){throw new Error("unknown command "+cmd)}}return[x1,y1,x2,y2]};VectorTileFeature.prototype.toGeoJSON=function(x,y,z){var size=this.extent*Math.pow(2,z),x0=this.extent*x,y0=this.extent*y,coords=this.loadGeometry(),type=VectorTileFeature.types[this.type],i,j;function project(line){for(var j=0;j<line.length;j++){var p=line[j],y2=180-(p.y+y0)*360/size;line[j]=[(p.x+x0)*360/size-180,360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90]}}switch(this.type){case 1:var points=[];for(i=0;i<coords.length;i++){points[i]=coords[i][0]}coords=points;project(coords);break;case 2:for(i=0;i<coords.length;i++){project(coords[i])}break;case 3:coords=classifyRings(coords);for(i=0;i<coords.length;i++){for(j=0;j<coords[i].length;j++){project(coords[i][j])}}break}if(coords.length===1){coords=coords[0]}else{type="Multi"+type}var result={type:"Feature",geometry:{type:type,coordinates:coords},properties:this.properties};if("id"in this){result.id=this.id}return result};function classifyRings(rings){var len=rings.length;if(len<=1)return[rings];var polygons=[],polygon,ccw;for(var i=0;i<len;i++){var area=signedArea(rings[i]);if(area===0)continue;if(ccw===undefined)ccw=area<0;if(ccw===area<0){if(polygon)polygons.push(polygon);polygon=[rings[i]]}else{polygon.push(rings[i])}}if(polygon)polygons.push(polygon);return polygons}function signedArea(ring){var sum=0;for(var i=0,len=ring.length,j=len-1,p1,p2;i<len;j=i++){p1=ring[i];p2=ring[j];sum+=(p2.x-p1.x)*(p1.y+p2.y)}return sum}},{"point-geometry":223}],562:[function(require,module,exports){"use strict";var VectorTileFeature=require("./vectortilefeature.js");module.exports=VectorTileLayer;function VectorTileLayer(pbf,end){this.version=1;this.name=null;this.extent=4096;this.length=0;this._pbf=pbf;this._keys=[];this._values=[];this._features=[];pbf.readFields(readLayer,this,end);this.length=this._features.length}function readLayer(tag,layer,pbf){if(tag===15)layer.version=pbf.readVarint();else if(tag===1)layer.name=pbf.readString();else if(tag===5)layer.extent=pbf.readVarint();else if(tag===2)layer._features.push(pbf.pos);else if(tag===3)layer._keys.push(pbf.readString());else if(tag===4)layer._values.push(readValueMessage(pbf))}function readValueMessage(pbf){var value=null,end=pbf.readVarint()+pbf.pos;while(pbf.pos<end){var tag=pbf.readVarint()>>3;value=tag===1?pbf.readString():tag===2?pbf.readFloat():tag===3?pbf.readDouble():tag===4?pbf.readVarint64():tag===5?pbf.readVarint():tag===6?pbf.readSVarint():tag===7?pbf.readBoolean():null}return value}VectorTileLayer.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var end=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,end,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":561}],563:[function(require,module,exports){var Pbf=require("pbf");var vtpb=require("./vector-tile-pb");var GeoJSONWrapper=require("./lib/geojson_wrapper");module.exports=fromVectorTileJs;module.exports.fromVectorTileJs=fromVectorTileJs;module.exports.fromGeojsonVt=fromGeojsonVt;module.exports.GeoJSONWrapper=GeoJSONWrapper;function fromVectorTileJs(tile){var layers=[];for(var l in tile.layers){layers.push(prepareLayer(tile.layers[l]))}var out=new Pbf;vtpb.tile.write({layers:layers},out);return out.finish()}function fromGeojsonVt(layers){var l={};for(var k in layers){l[k]=new GeoJSONWrapper(layers[k].features);l[k].name=k}return fromVectorTileJs({layers:l})}function prepareLayer(layer){var preparedLayer={name:layer.name||"",version:layer.version||1,extent:layer.extent||4096,keys:[],values:[],features:[]};var keycache={};var valuecache={};for(var i=0;i<layer.length;i++){var feature=layer.feature(i);feature.geometry=encodeGeometry(feature.loadGeometry());var tags=[];for(var key in feature.properties){var keyIndex=keycache[key];if(typeof keyIndex==="undefined"){preparedLayer.keys.push(key);keyIndex=preparedLayer.keys.length-1;keycache[key]=keyIndex}var value=wrapValue(feature.properties[key]);var valueIndex=valuecache[value.key];if(typeof valueIndex==="undefined"){preparedLayer.values.push(value);valueIndex=preparedLayer.values.length-1;valuecache[value.key]=valueIndex}tags.push(keyIndex);tags.push(valueIndex)}feature.tags=tags;preparedLayer.features.push(feature)}return preparedLayer}function command(cmd,length){return(length<<3)+(cmd&7)}function zigzag(num){return num<<1^num>>31}function encodeGeometry(geometry){var encoded=[];var x=0;var y=0;var rings=geometry.length;for(var r=0;r<rings;r++){var ring=geometry[r];encoded.push(command(1,1));for(var i=0;i<ring.length;i++){if(i===1){encoded.push(command(2,ring.length-1))}var dx=ring[i].x-x;var dy=ring[i].y-y;encoded.push(zigzag(dx),zigzag(dy));x+=dx;y+=dy}}return encoded}function wrapValue(value){var result;var type=typeof value;if(type==="string"){result={string_value:value}}else if(type==="boolean"){result={bool_value:value}}else if(type==="number"){if(value%1!==0){result={double_value:value}}else if(value<0){result={sint_value:value}}else{result={uint_value:value}}}else{value=JSON.stringify(value);result={string_value:value}}result.key=type+":"+value;return result}},{"./lib/geojson_wrapper":564,"./vector-tile-pb":565,pbf:222}],564:[function(require,module,exports){"use strict";var Point=require("point-geometry");var VectorTileFeature=require("vector-tile").VectorTileFeature;module.exports=GeoJSONWrapper;function GeoJSONWrapper(features){this.features=features;this.length=features.length}GeoJSONWrapper.prototype.feature=function(i){return new FeatureWrapper(this.features[i])};function FeatureWrapper(feature){this.id=typeof feature.id==="number"?feature.id:undefined;this.type=feature.type;this.rawGeometry=feature.type===1?[feature.geometry]:feature.geometry;this.properties=feature.tags;this.extent=4096}FeatureWrapper.prototype.loadGeometry=function(){var rings=this.rawGeometry;this.geometry=[];for(var i=0;i<rings.length;i++){var ring=rings[i];var newRing=[];for(var j=0;j<ring.length;j++){newRing.push(new Point(ring[j][0],ring[j][1]))}this.geometry.push(newRing)}return this.geometry};FeatureWrapper.prototype.bbox=function(){if(!this.geometry)this.loadGeometry();var rings=this.geometry;var x1=Infinity;var x2=-Infinity;var y1=Infinity;var y2=-Infinity;for(var i=0;i<rings.length;i++){var ring=rings[i];for(var j=0;j<ring.length;j++){var coord=ring[j];x1=Math.min(x1,coord.x);x2=Math.max(x2,coord.x);y1=Math.min(y1,coord.y);y2=Math.max(y2,coord.y)}}return[x1,y1,x2,y2]};FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON},{"point-geometry":223,"vector-tile":559}],565:[function(require,module,exports){"use strict";var tile=exports.tile={read:readTile,write:writeTile};tile.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3};function readTile(pbf,end){return pbf.readFields(readTileField,{layers:[]},end)}function readTileField(tag,tile,pbf){if(tag===3)tile.layers.push(readLayer(pbf,pbf.readVarint()+pbf.pos))}function writeTile(tile,pbf){var i;if(tile.layers!==undefined)for(i=0;i<tile.layers.length;i++)pbf.writeMessage(3,writeLayer,tile.layers[i])}tile.value={read:readValue,write:writeValue};function readValue(pbf,end){return pbf.readFields(readValueField,{},end)}function readValueField(tag,value,pbf){if(tag===1)value.string_value=pbf.readString();else if(tag===2)value.float_value=pbf.readFloat();else if(tag===3)value.double_value=pbf.readDouble();else if(tag===4)value.int_value=pbf.readVarint();else if(tag===5)value.uint_value=pbf.readVarint();else if(tag===6)value.sint_value=pbf.readSVarint();else if(tag===7)value.bool_value=pbf.readBoolean()}function writeValue(value,pbf){if(value.string_value!==undefined)pbf.writeStringField(1,value.string_value);if(value.float_value!==undefined)pbf.writeFloatField(2,value.float_value);if(value.double_value!==undefined)pbf.writeDoubleField(3,value.double_value);if(value.int_value!==undefined)pbf.writeVarintField(4,value.int_value);if(value.uint_value!==undefined)pbf.writeVarintField(5,value.uint_value);if(value.sint_value!==undefined)pbf.writeSVarintField(6,value.sint_value);if(value.bool_value!==undefined)pbf.writeBooleanField(7,value.bool_value)}tile.feature={read:readFeature,write:writeFeature};function readFeature(pbf,end){var feature=pbf.readFields(readFeatureField,{},end);if(feature.type===undefined)feature.type="Unknown";return feature}function readFeatureField(tag,feature,pbf){if(tag===1)feature.id=pbf.readVarint();else if(tag===2)feature.tags=pbf.readPackedVarint();else if(tag===3)feature.type=pbf.readVarint();else if(tag===4)feature.geometry=pbf.readPackedVarint()}function writeFeature(feature,pbf){if(feature.id!==undefined)pbf.writeVarintField(1,feature.id);if(feature.tags!==undefined)pbf.writePackedVarint(2,feature.tags);if(feature.type!==undefined)pbf.writeVarintField(3,feature.type);if(feature.geometry!==undefined)pbf.writePackedVarint(4,feature.geometry)}tile.layer={read:readLayer,write:writeLayer};function readLayer(pbf,end){return pbf.readFields(readLayerField,{features:[],keys:[],values:[]},end)}function readLayerField(tag,layer,pbf){if(tag===15)layer.version=pbf.readVarint();else if(tag===1)layer.name=pbf.readString();else if(tag===2)layer.features.push(readFeature(pbf,pbf.readVarint()+pbf.pos));else if(tag===3)layer.keys.push(pbf.readString());else if(tag===4)layer.values.push(readValue(pbf,pbf.readVarint()+pbf.pos));else if(tag===5)layer.extent=pbf.readVarint()}function writeLayer(layer,pbf){if(layer.version!==undefined)pbf.writeVarintField(15,layer.version);if(layer.name!==undefined)pbf.writeStringField(1,layer.name);var i;if(layer.features!==undefined)for(i=0;i<layer.features.length;i++)pbf.writeMessage(2,writeFeature,layer.features[i]);if(layer.keys!==undefined)for(i=0;i<layer.keys.length;i++)pbf.writeStringField(3,layer.keys[i]);if(layer.values!==undefined)for(i=0;i<layer.values.length;i++)pbf.writeMessage(4,writeValue,layer.values[i]);if(layer.extent!==undefined)pbf.writeVarintField(5,layer.extent)}},{}],566:[function(require,module,exports){var bundleFn=arguments[3];var sources=arguments[4];var cache=arguments[5];var stringify=JSON.stringify;module.exports=function(fn,options){var wkey;var cacheKeys=Object.keys(cache);for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];var exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key}sources[wkey]=[Function(["require","module","exports"],"("+fn+")(self)"),wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var scache={};scache[wkey]=wkey;sources[skey]=[Function(["require"],"var f = require("+stringify(wkey)+");"+"(f.default ? f.default : f)(self);"),scache];var workerSources={};resolveSources(skey);function resolveSources(key){workerSources[key]=true;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];if(!workerSources[depKey]){resolveSources(depKey)}}}var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])";var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare){return blob}var workerUrl=URL.createObjectURL(blob);var worker=new Worker(workerUrl);worker.objectURL=workerUrl;return worker}},{}],567:[function(require,module,exports){module.exports.RADIUS=6378137;module.exports.FLATTENING=1/298.257223563;module.exports.POLAR_RADIUS=6356752.3142},{}],568:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.WhooTS=global.WhooTS||{})})(this,function(exports){function getURL(baseUrl,layer,x,y,z,options){options=options||{};var url=baseUrl+"?"+["bbox="+getTileBBox(x,y,z),"format="+(options.format||"image/png"),"service="+(options.service||"WMS"),"version="+(options.version||"1.1.1"),"request="+(options.request||"GetMap"),"srs="+(options.srs||"EPSG:3857"),"width="+(options.width||256),"height="+(options.height||256),"layers="+layer].join("&");return url}function getTileBBox(x,y,z){y=Math.pow(2,z)-y-1;var min=getMercCoords(x*256,y*256,z),max=getMercCoords((x+1)*256,(y+1)*256,z);return min[0]+","+min[1]+","+max[0]+","+max[1]}function getMercCoords(x,y,z){var resolution=2*Math.PI*6378137/256/Math.pow(2,z),merc_x=x*resolution-2*Math.PI*6378137/2,merc_y=y*resolution-2*Math.PI*6378137/2;return[merc_x,merc_y]}exports.getURL=getURL;exports.getTileBBox=getTileBBox;exports.getMercCoords=getMercCoords;Object.defineProperty(exports,"__esModule",{value:true})})},{}],569:[function(require,module,exports){"use strict";var window=require("global/window");var isFunction=require("is-function");var parseHeaders=require("parse-headers");var xtend=require("xtend");module.exports=createXHR;createXHR.XMLHttpRequest=window.XMLHttpRequest||noop;createXHR.XDomainRequest="withCredentials"in new createXHR.XMLHttpRequest?createXHR.XMLHttpRequest:window.XDomainRequest;forEachArray(["get","put","post","patch","head","delete"],function(method){createXHR[method==="delete"?"del":method]=function(uri,options,callback){options=initParams(uri,options,callback);options.method=method.toUpperCase();return _createXHR(options)}});function forEachArray(array,iterator){for(var i=0;i<array.length;i++){iterator(array[i])}}function isEmpty(obj){for(var i in obj){if(obj.hasOwnProperty(i))return false}return true}function initParams(uri,options,callback){var params=uri;if(isFunction(options)){callback=options;if(typeof uri==="string"){params={uri:uri}}}else{params=xtend(options,{uri:uri})}params.callback=callback;return params}function createXHR(uri,options,callback){options=initParams(uri,options,callback);return _createXHR(options)}function _createXHR(options){if(typeof options.callback==="undefined"){throw new Error("callback argument missing")}var called=false;var callback=function cbOnce(err,response,body){if(!called){called=true;options.callback(err,response,body)}};function readystatechange(){if(xhr.readyState===4){setTimeout(loadFunc,0)}}function getBody(){var body=undefined;if(xhr.response){body=xhr.response}else{body=xhr.responseText||getXml(xhr)}if(isJson){try{body=JSON.parse(body)}catch(e){}}return body}function errorFunc(evt){clearTimeout(timeoutTimer);if(!(evt instanceof Error)){evt=new Error(""+(evt||"Unknown XMLHttpRequest Error"))}evt.statusCode=0;return callback(evt,failureResponse)}function loadFunc(){if(aborted)return;var status;clearTimeout(timeoutTimer);if(options.useXDR&&xhr.status===undefined){status=200}else{status=xhr.status===1223?204:xhr.status}var response=failureResponse;var err=null;if(status!==0){response={body:getBody(),statusCode:status,method:method,headers:{},url:uri,rawRequest:xhr};if(xhr.getAllResponseHeaders){response.headers=parseHeaders(xhr.getAllResponseHeaders())}}else{err=new Error("Internal XMLHttpRequest Error")}return callback(err,response,response.body)}var xhr=options.xhr||null;if(!xhr){if(options.cors||options.useXDR){xhr=new createXHR.XDomainRequest}else{xhr=new createXHR.XMLHttpRequest}}var key;var aborted;var uri=xhr.url=options.uri||options.url;var method=xhr.method=options.method||"GET";var body=options.body||options.data;var headers=xhr.headers=options.headers||{};var sync=!!options.sync;var isJson=false;var timeoutTimer;var failureResponse={body:undefined,headers:{},statusCode:0,method:method,url:uri,rawRequest:xhr};if("json"in options&&options.json!==false){isJson=true;headers["accept"]||headers["Accept"]||(headers["Accept"]="application/json");if(method!=="GET"&&method!=="HEAD"){headers["content-type"]||headers["Content-Type"]||(headers["Content-Type"]="application/json");body=JSON.stringify(options.json===true?body:options.json)}}xhr.onreadystatechange=readystatechange;xhr.onload=loadFunc;xhr.onerror=errorFunc;xhr.onprogress=function(){};xhr.onabort=function(){aborted=true};xhr.ontimeout=errorFunc;xhr.open(method,uri,!sync,options.username,options.password);if(!sync){xhr.withCredentials=!!options.withCredentials}if(!sync&&options.timeout>0){timeoutTimer=setTimeout(function(){if(aborted)return;aborted=true;xhr.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT";errorFunc(e)},options.timeout)}if(xhr.setRequestHeader){for(key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key])}}}else if(options.headers&&!isEmpty(options.headers)){throw new Error("Headers cannot be set on an XDomainRequest object")}if("responseType"in options){xhr.responseType=options.responseType}if("beforeSend"in options&&typeof options.beforeSend==="function"){options.beforeSend(xhr)}xhr.send(body||null);return xhr}function getXml(xhr){if(xhr.responseType==="document"){return xhr.responseXML}var firefoxBugTakenEffect=xhr.responseXML&&xhr.responseXML.documentElement.nodeName==="parsererror";if(xhr.responseType===""&&!firefoxBugTakenEffect){return xhr.responseXML}return null}function noop(){}},{"global/window":34,"is-function":39,"parse-headers":219,xtend:570}],570:[function(require,module,exports){module.exports=extend;var hasOwnProperty=Object.prototype.hasOwnProperty;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target}},{}]},{},[5]);